<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202022217241.jpg"><title>åŸºç¡€çŸ¥è¯† | Trdthg's blog</title><meta name="description" content="æˆ‘çš„ä¸ªäººç½‘ç«™">
    <link rel="modulepreload" href="/assets/app.729fb0a5.js"><link rel="modulepreload" href="/assets/java.html.1ef5b9ac.js"><link rel="modulepreload" href="/assets/java.html.09fb9a2a.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.e8e8fc80.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202022217241.jpg" alt="Trdthg&#39;s blog"><span class="site-name can-hide">Trdthg&#39;s blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å‰ç«¯ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/js/vue" class="" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>pythonç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/python" class="" aria-label="æ€»è§ˆ"><!--[--><!--]--> æ€»è§ˆ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>javaç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/java/java" class="router-link-active" aria-label="åŸºç¡€çŸ¥è¯†"><!--[--><!--]--> åŸºç¡€çŸ¥è¯† <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/sourceread" class="" aria-label="éƒ¨åˆ†æºç "><!--[--><!--]--> éƒ¨åˆ†æºç  <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/spring" class="" aria-label="Springæ¡†æ¶"><!--[--><!--]--> Springæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/springboot" class="" aria-label="å¸¸ç”¨å·¥å…·"><!--[--><!--]--> å¸¸ç”¨å·¥å…· <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/projects/demo1" class="" aria-label="å°é¡¹ç›® ğŸ’ª"><!--[--><!--]--> å°é¡¹ç›® ğŸ’ª <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/rust/wasm" class="" aria-label="Wasm ä½“éªŒ"><!--[--><!--]--> Wasm ä½“éªŒ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/lists" class="" aria-label="å®ç°é“¾è¡¨"><!--[--><!--]--> å®ç°é“¾è¡¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/rust" class="" aria-label="è¯­è¨€ç‰¹æ€§"><!--[--><!--]--> è¯­è¨€ç‰¹æ€§ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/magic/haskell" class="" aria-label="haskellå­¦ä¹ ç¬”è®°"><!--[--><!--]--> haskellå­¦ä¹ ç¬”è®° <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/fd" class="" aria-label="æ–‡ä»¶æè¿°ç¬¦"><!--[--><!--]--> æ–‡ä»¶æè¿°ç¬¦ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/linuxIO" class="" aria-label="IO å¤šè·¯å¤ç”¨"><!--[--><!--]--> IO å¤šè·¯å¤ç”¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/memory_ordering" class="" aria-label="åŸå­æ“ä½œ/å†…å­˜é¡ºåº"><!--[--><!--]--> åŸå­æ“ä½œ/å†…å­˜é¡ºåº <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>åˆ†äº«</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/share_1" class="" aria-label="å…³äºæ•°æ®åº“ä¸B+æ ‘"><!--[--><!--]--> å…³äºæ•°æ®åº“ä¸B+æ ‘ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>æˆè¯¾</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_1" class="" aria-label="åç«¯1"><!--[--><!--]--> åç«¯1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_2" class="" aria-label="åç«¯2"><!--[--><!--]--> åç«¯2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_3" class="" aria-label="åç«¯3"><!--[--><!--]--> åç«¯3 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_4" class="" aria-label="åç«¯4"><!--[--><!--]--> åç«¯4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å…¶ä»– ğŸ“¦"><span class="title">å…¶ä»– ğŸ“¦</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å…¶ä»– ğŸ“¦"><span class="title">å…¶ä»– ğŸ“¦</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/hadoop" class="" aria-label="hadoop"><!--[--><!--]--> hadoop <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/script" class="" aria-label="è„šæœ¬"><!--[--><!--]--> è„šæœ¬ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/datastructure" class="" aria-label="æ•°æ®ç»“æ„"><!--[--><!--]--> æ•°æ®ç»“æ„ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/vim" class="" aria-label="vim"><!--[--><!--]--> vim <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/git" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oauth2" class="" aria-label="oauth2å­¦ä¹ "><!--[--><!--]--> oauth2å­¦ä¹  <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å‰ç«¯ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/js/vue" class="" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>pythonç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/python" class="" aria-label="æ€»è§ˆ"><!--[--><!--]--> æ€»è§ˆ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>javaç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/java/java" class="router-link-active" aria-label="åŸºç¡€çŸ¥è¯†"><!--[--><!--]--> åŸºç¡€çŸ¥è¯† <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/sourceread" class="" aria-label="éƒ¨åˆ†æºç "><!--[--><!--]--> éƒ¨åˆ†æºç  <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/spring" class="" aria-label="Springæ¡†æ¶"><!--[--><!--]--> Springæ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/springboot" class="" aria-label="å¸¸ç”¨å·¥å…·"><!--[--><!--]--> å¸¸ç”¨å·¥å…· <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a href="/projects/demo1" class="" aria-label="å°é¡¹ç›® ğŸ’ª"><!--[--><!--]--> å°é¡¹ç›® ğŸ’ª <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/rust/wasm" class="" aria-label="Wasm ä½“éªŒ"><!--[--><!--]--> Wasm ä½“éªŒ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/lists" class="" aria-label="å®ç°é“¾è¡¨"><!--[--><!--]--> å®ç°é“¾è¡¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/rust" class="" aria-label="è¯­è¨€ç‰¹æ€§"><!--[--><!--]--> è¯­è¨€ç‰¹æ€§ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/magic/haskell" class="" aria-label="haskellå­¦ä¹ ç¬”è®°"><!--[--><!--]--> haskellå­¦ä¹ ç¬”è®° <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/fd" class="" aria-label="æ–‡ä»¶æè¿°ç¬¦"><!--[--><!--]--> æ–‡ä»¶æè¿°ç¬¦ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/linuxIO" class="" aria-label="IO å¤šè·¯å¤ç”¨"><!--[--><!--]--> IO å¤šè·¯å¤ç”¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/memory_ordering" class="" aria-label="åŸå­æ“ä½œ/å†…å­˜é¡ºåº"><!--[--><!--]--> åŸå­æ“ä½œ/å†…å­˜é¡ºåº <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>åˆ†äº«</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/share_1" class="" aria-label="å…³äºæ•°æ®åº“ä¸B+æ ‘"><!--[--><!--]--> å…³äºæ•°æ®åº“ä¸B+æ ‘ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>æˆè¯¾</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_1" class="" aria-label="åç«¯1"><!--[--><!--]--> åç«¯1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_2" class="" aria-label="åç«¯2"><!--[--><!--]--> åç«¯2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_3" class="" aria-label="åç«¯3"><!--[--><!--]--> åç«¯3 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_4" class="" aria-label="åç«¯4"><!--[--><!--]--> åç«¯4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å…¶ä»– ğŸ“¦"><span class="title">å…¶ä»– ğŸ“¦</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å…¶ä»– ğŸ“¦"><span class="title">å…¶ä»– ğŸ“¦</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/hadoop" class="" aria-label="hadoop"><!--[--><!--]--> hadoop <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/script" class="" aria-label="è„šæœ¬"><!--[--><!--]--> è„šæœ¬ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/datastructure" class="" aria-label="æ•°æ®ç»“æ„"><!--[--><!--]--> æ•°æ®ç»“æ„ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/vim" class="" aria-label="vim"><!--[--><!--]--> vim <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/git" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oauth2" class="" aria-label="oauth2å­¦ä¹ "><!--[--><!--]--> oauth2å­¦ä¹  <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">åŸºç¡€çŸ¥è¯† <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#è¯­æ³•ç»†èŠ‚" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¯­æ³•ç»†èŠ‚"><!--[--><!--]--> è¯­æ³•ç»†èŠ‚ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#for-å’Œwhile-true-çš„åŒºåˆ«" class="router-link-active router-link-exact-active sidebar-item" aria-label="for(;;)å’Œwhile(true)çš„åŒºåˆ«"><!--[--><!--]--> for(;;)å’Œwhile(true)çš„åŒºåˆ« <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#equalä¸-çš„åŒºåˆ«" class="router-link-active router-link-exact-active sidebar-item" aria-label="equalä¸==çš„åŒºåˆ«"><!--[--><!--]--> equalä¸==çš„åŒºåˆ« <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#class-thiså’Œthisçš„åŒºåˆ«" class="router-link-active router-link-exact-active sidebar-item" aria-label="Class.thiså’Œthisçš„åŒºåˆ«"><!--[--><!--]--> Class.thiså’Œthisçš„åŒºåˆ« <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#å¾…ç»­" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¾…ç»­..."><!--[--><!--]--> å¾…ç»­... <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/java.html#åŒ…è£…ç±»" class="router-link-active router-link-exact-active sidebar-item" aria-label="åŒ…è£…ç±»"><!--[--><!--]--> åŒ…è£…ç±» <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#int-vs-integer" class="router-link-active router-link-exact-active sidebar-item" aria-label="int VS Integer"><!--[--><!--]--> int VS Integer <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/java.html#ææ„å‡½æ•°" class="router-link-active router-link-exact-active sidebar-item" aria-label="&quot;ææ„å‡½æ•°&quot;"><!--[--><!--]--> &quot;ææ„å‡½æ•°&quot; <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#æ³›å‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ³›å‹"><!--[--><!--]--> æ³›å‹ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#tçš„ä½ç½®" class="router-link-active router-link-exact-active sidebar-item" aria-label="Tçš„ä½ç½®"><!--[--><!--]--> Tçš„ä½ç½® <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#è¾¹ç•Œé€šé…ç¬¦" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¾¹ç•Œé€šé…ç¬¦"><!--[--><!--]--> è¾¹ç•Œé€šé…ç¬¦ <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/java.html#æ³¨è§£" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ³¨è§£"><!--[--><!--]--> æ³¨è§£ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#ä½œç”¨èŒƒå›´" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä½œç”¨èŒƒå›´"><!--[--><!--]--> ä½œç”¨èŒƒå›´ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#target" class="router-link-active router-link-exact-active sidebar-item" aria-label="@Target"><!--[--><!--]--> @Target <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#retention" class="router-link-active router-link-exact-active sidebar-item" aria-label="@Retention"><!--[--><!--]--> @Retention <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#ç¤ºä¾‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç¤ºä¾‹"><!--[--><!--]--> ç¤ºä¾‹ <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/java.html#å¤šçº¿ç¨‹" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¤šçº¿ç¨‹"><!--[--><!--]--> å¤šçº¿ç¨‹ <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#å®ç°" class="router-link-active router-link-exact-active sidebar-item" aria-label="å®ç°"><!--[--><!--]--> å®ç° <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#å¸¸ç”¨æ–¹æ³•" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¸¸ç”¨æ–¹æ³•"><!--[--><!--]--> å¸¸ç”¨æ–¹æ³• <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#çº¿ç¨‹åŒæ­¥" class="router-link-active router-link-exact-active sidebar-item" aria-label="çº¿ç¨‹åŒæ­¥"><!--[--><!--]--> çº¿ç¨‹åŒæ­¥ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" class="router-link-active router-link-exact-active sidebar-item" aria-label="çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼"><!--[--><!--]--> çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#voletileå…³é”®å­—" class="router-link-active router-link-exact-active sidebar-item" aria-label="voletileå…³é”®å­—"><!--[--><!--]--> voletileå…³é”®å­— <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#å¾…ç»­-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¾…ç»­..."><!--[--><!--]--> å¾…ç»­... <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/java/java.html#juc" class="router-link-active router-link-exact-active sidebar-item" aria-label="JUC"><!--[--><!--]--> JUC <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/java/java.html#ç‰¹å¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç‰¹å¾"><!--[--><!--]--> ç‰¹å¾ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#åŸºæœ¬æ“ä½œ" class="router-link-active router-link-exact-active sidebar-item" aria-label="åŸºæœ¬æ“ä½œ"><!--[--><!--]--> åŸºæœ¬æ“ä½œ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#æ­»é”" class="router-link-active router-link-exact-active sidebar-item" aria-label="æ­»é”"><!--[--><!--]--> æ­»é” <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#ç”Ÿäº§è€…æ¶ˆè´¹è€…" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç”Ÿäº§è€…æ¶ˆè´¹è€…"><!--[--><!--]--> ç”Ÿäº§è€…æ¶ˆè´¹è€… <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#trylock" class="router-link-active router-link-exact-active sidebar-item" aria-label="tryLock"><!--[--><!--]--> tryLock <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#åŒæ—¶è¯»å†™" class="router-link-active router-link-exact-active sidebar-item" aria-label="åŒæ—¶è¯»å†™"><!--[--><!--]--> åŒæ—¶è¯»å†™ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#è®¡æ•°å™¨" class="router-link-active router-link-exact-active sidebar-item" aria-label="è®¡æ•°å™¨"><!--[--><!--]--> è®¡æ•°å™¨ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#è¯»å†™é”" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¯»å†™é”"><!--[--><!--]--> è¯»å†™é” <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#çº¿ç¨‹æ± " class="router-link-active router-link-exact-active sidebar-item" aria-label="çº¿ç¨‹æ± "><!--[--><!--]--> çº¿ç¨‹æ±  <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#forkjoin" class="router-link-active router-link-exact-active sidebar-item" aria-label="Forkjoin"><!--[--><!--]--> Forkjoin <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/java/java.html#å¾…ç»­-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¾…ç»­..."><!--[--><!--]--> å¾…ç»­... <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="åŸºç¡€çŸ¥è¯†" tabindex="-1"><a class="header-anchor" href="#åŸºç¡€çŸ¥è¯†" aria-hidden="true">#</a> åŸºç¡€çŸ¥è¯†</h1><h2 id="è¯­æ³•ç»†èŠ‚" tabindex="-1"><a class="header-anchor" href="#è¯­æ³•ç»†èŠ‚" aria-hidden="true">#</a> è¯­æ³•ç»†èŠ‚</h2><h3 id="for-å’Œwhile-true-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#for-å’Œwhile-true-çš„åŒºåˆ«" aria-hidden="true">#</a> for(;;)å’Œwhile(true)çš„åŒºåˆ«</h3><p>è™½ç„¶ä¸¤è€…éƒ½èƒ½å®ç°æ­»å¾ªç¯, ä½†æ˜¯æºç ä¸­éƒ½æ˜¯é€‰æ‹©for(;ğŸ˜‰ åŸå› :</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>ç¼–è¯‘å‰              ç¼–è¯‘å
while (1)           mov eax,1
                    test eax,eax
                    je foo+23h
                    jmp foo+18h

ç¼–è¯‘å‰              ç¼–è¯‘å
for (;;)          jmp foo+23h ã€€ã€€
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¯¹æ¯”ä¹‹ä¸‹ï¼Œfor (;;)æŒ‡ä»¤å°‘ï¼Œä¸å ç”¨å¯„å­˜å™¨ï¼Œè€Œä¸”æ²¡æœ‰åˆ¤æ–­è·³è½¬ï¼Œæ¯”while (1)å¥½ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸¤è€…åœ¨åœ¨å®è§‚ä¸Šå®Œå…¨ä¸€æ ·çš„é€»è¾‘ï¼Œä½†æ˜¯åº•å±‚å®Œå…¨ä¸ä¸€æ ·ï¼Œforç›¸å¯¹äºæ¥è¯´æ›´åŠ ç®€æ´æ˜äº†ã€‚</p><h3 id="equalä¸-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#equalä¸-çš„åŒºåˆ«" aria-hidden="true">#</a> equalä¸==çš„åŒºåˆ«</h3><ol><li>åŒºåˆ«</li></ol><ul><li>==æ˜¯è¿ç®—ç¬¦, equalæ˜¯æ–¹æ³•,</li><li>æ¯”è¾ƒåŸºæœ¬ç±»å‹: åªèƒ½ç”¨==, ä¸èƒ½ç”¨equal</li><li>æ¯”è¾ƒåŒ…è£…ç±»å‹: ==æ¯”è¾ƒçš„æ˜¯å†…å­˜åœ°å€, è€Œequalæ¯”è¾ƒçš„æ˜¯å€¼</li><li>æ¯”è¾ƒå¯¹è±¡: ==å’Œequalæ¯”è¾ƒçš„éƒ½æ˜¯å†…å­˜åœ°å€ï¼Œå› ä¸ºequalæ²¡æœ‰è¢«é‡å†™ï¼Œæ²¡æœ‰è¢«é‡å†™çš„equaléƒ½æ˜¯objectçš„equalæ–¹æ³•<div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p><p>Stringï¼ˆè¿˜æœ‰Dateï¼ŒIntegerï¼‰ç±»å‹é‡å†™äº†equalsæ–¹æ³•ï¼Œä½¿å…¶æ¯”è¾ƒçš„æ˜¯å­˜å‚¨å¯¹è±¡çš„å†…å®¹æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯å †å†…å­˜åœ°å€ã€‚</p></div></li></ul><h3 id="class-thiså’Œthisçš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#class-thiså’Œthisçš„åŒºåˆ«" aria-hidden="true">#</a> Class.thiså’Œthisçš„åŒºåˆ«</h3><p>å½“inner classï¼ˆå†…éƒ¨ç±»ï¼‰å¿…é¡ºä½¿ç”¨åˆ°outer classï¼ˆå¤–éƒ¨ç±»ï¼‰çš„this instanceï¼ˆå®ä¾‹ï¼‰æ—¶ï¼Œæˆ–è€…åŒ¿åå†…éƒ¨ç±»è¦ä½¿ç”¨å¤–éƒ¨ç±»çš„å®ä¾‹ã€‚</p><h3 id="å¾…ç»­" tabindex="-1"><a class="header-anchor" href="#å¾…ç»­" aria-hidden="true">#</a> å¾…ç»­...</h3><h2 id="åŒ…è£…ç±»" tabindex="-1"><a class="header-anchor" href="#åŒ…è£…ç±»" aria-hidden="true">#</a> åŒ…è£…ç±»</h2><h3 id="int-vs-integer" tabindex="-1"><a class="header-anchor" href="#int-vs-integer" aria-hidden="true">#</a> int VS Integer</h3><h5 id="åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–" aria-hidden="true">#</a> åˆå§‹åŒ–</h5><ul><li>1 intç±»çš„å˜é‡åˆå§‹ä¸º0. Integerçš„å˜é‡åˆ™åˆå§‹åŒ–ä¸ºnull.</li><li>2 Integerå˜é‡å¿…é¡»å®ä¾‹åŒ–åæ‰èƒ½ä½¿ç”¨ï¼Œ intå˜é‡ä¸éœ€è¦ .</li><li>3 åœ¨Intæ˜¯å°†å€¼ç›´æ¥å­˜å‚¨ï¼Œ Integerå¯¹è±¡æ˜¯ç”ŸæˆæŒ‡é’ˆæŒ‡å‘æ­¤å¯¹è±¡ã€‚</li></ul><h5 id="æ¯”è¾ƒ" tabindex="-1"><a class="header-anchor" href="#æ¯”è¾ƒ" aria-hidden="true">#</a> æ¯”è¾ƒ</h5><ol><li>Integer ? int <code>&lt;br/&gt;</code> åªè¦ä¸¤ä¸ªå˜é‡çš„å€¼æ˜¯å‘ç­‰çš„ï¼Œåˆ™ç»“æœä¸ºtrueã€‚ å› ä¸ºåŒ…è£…ç±»Integerå’ŒåŸºæœ¬æ•°æ®ç±»å‹intæ¯”è¾ƒæ—¶ï¼Œjavaä¼šè‡ªåŠ¨æ‹†åŒ…è£…ä¸ºintï¼Œç„¶åè¿›è¡Œæ¯”è¾ƒï¼Œå®é™…ä¸Šå°±å˜ä¸ºä¸¤ä¸ªintå˜é‡çš„æ¯”è¾ƒã€‚</li><li>new Integer() ? !new Integer()ï¼Œ<code>&lt;br/&gt;</code> ç»“æœä¸ºfalse ! new Integer()å½“å˜é‡å€¼åœ¨-128~127ä¹‹é—´æ—¶ï¼Œénewç”Ÿæˆçš„Integerå˜é‡æŒ‡å‘çš„æ˜¯javaå¸¸é‡æ± ä¸­cacheæ•°ç»„ä¸­å­˜å‚¨çš„æŒ‡å‘äº†å †ä¸­çš„Integerå¯¹è±¡ï¼Œ è€Œnew Integer()ç”Ÿæˆçš„å˜é‡æŒ‡å‘å †ä¸­æ–°å»ºçš„å¯¹è±¡ï¼Œä¸¤è€…åœ¨å†…å­˜ä¸­çš„åœ°å€ä¸åŒï¼›</li><li>new Interger() ? new Integer() <code>&lt;br/&gt;</code> false</li><li>!new Integer() ? !new Integer() <code>&lt;br/&gt;</code> å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰,ä¸”åœ¨åŒºé—´-128åˆ°127ä¹‹é—´åˆ™true åªè¦ä¸åŒæˆ–è€…æœ‰å€¼åœ¨åŒºé—´å¤–å°±ä¸ç›¸åŒ</li></ol><h5 id="åº”ç”¨" tabindex="-1"><a class="header-anchor" href="#åº”ç”¨" aria-hidden="true">#</a> åº”ç”¨</h5><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Integer</span> a <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> b <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">synchronized</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="ææ„å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#ææ„å‡½æ•°" aria-hidden="true">#</a> &quot;ææ„å‡½æ•°&quot;</h2><p>javaæä¾›finalize()æ–¹æ³•ï¼Œåƒåœ¾å›æ”¶å™¨å‡†å¤‡é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œä¼šå…ˆè°ƒç”¨finalize()ã€‚</p><ul><li>ç‰¹å¾</li></ul><ol><li>å¯¹è±¡ä¸ä¸€å®šä¼šè¢«å›æ”¶ã€‚</li><li>åƒåœ¾å›æ”¶ä¸æ˜¯ææ„å‡½æ•°ã€‚</li><li>åƒåœ¾å›æ”¶åªä¸å†…å­˜æœ‰å…³ã€‚</li><li>åƒåœ¾å›æ”¶å’Œfinalize()éƒ½æ˜¯é ä¸ä½çš„ï¼Œåªè¦JVMè¿˜æ²¡æœ‰å¿«åˆ°è€—å°½å†…å­˜çš„åœ°æ­¥ï¼Œå®ƒæ˜¯ä¸ä¼šæµªè´¹æ—¶é—´è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚</li></ol><ul><li>åº”å¯¹æ–¹æ³•</li></ul><ol><li>ä¸»åŠ¨è°ƒç”¨System.gc() æ–¹æ³•å¼ºåˆ¶åƒåœ¾å›æ”¶å™¨æ¥é‡Šæ”¾è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚</li><li>Java 1.1 é€šè¿‡æä¾›ä¸€ä¸ªSystem.runFinalizersOnExit() æ–¹æ³•ï¼Œä¸è±¡System.gc() æ–¹æ³•é‚£æ ·ï¼ŒSystem.runFinalizersOnExit() æ–¹æ³•å¹¶ä¸ç«‹å³è¯•å›¾å¯åŠ¨åƒåœ¾å›æ”¶å™¨ã€‚è€Œæ˜¯å½“åº”ç”¨ç¨‹åºæˆ– Applet é€€å‡ºæ—¶ï¼Œå®ƒè°ƒç”¨æ¯ä¸ªå¯¹è±¡çš„finalize() æ–¹æ³•ã€‚</li><li>ç»§æ‰¿finalize()</li></ol><h2 id="æ³›å‹" tabindex="-1"><a class="header-anchor" href="#æ³›å‹" aria-hidden="true">#</a> æ³›å‹</h2><h3 id="tçš„ä½ç½®" tabindex="-1"><a class="header-anchor" href="#tçš„ä½ç½®" aria-hidden="true">#</a> Tçš„ä½ç½®</h3><ol><li>ç¤ºä¾‹</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ä½¿ç”¨æ³›å‹ -------&gt;&quot;</span> <span class="token operator">+</span> <span class="token class-name">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>è§£é‡Š</li></ol><ul><li>ç¬¬ä¸€å¤„: é™æ€æ–¹æ³•ä¸èƒ½ç›´æ¥å¼•ç”¨ç±»å®šä¹‰å¤„çš„æ³›å‹, éœ€è¦æå‰å®šä¹‰å¥½æ³›å‹æ‰èƒ½ä½¿ç”¨</li><li>ç¬¬äºŒå¤„: æŒ‡å®šCollectionçš„å…ƒç´ ç±»å‹ä¸ºT</li></ul><h3 id="è¾¹ç•Œé€šé…ç¬¦" tabindex="-1"><a class="header-anchor" href="#è¾¹ç•Œé€šé…ç¬¦" aria-hidden="true">#</a> è¾¹ç•Œé€šé…ç¬¦</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>å’Œ<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol><li>å¼•ä¾‹</li></ol><ul><li>è¿™ç§æƒ…å†µä¸‹æ˜¯å¯è¡Œçš„</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fruit</span><span class="token punctuation">&gt;</span></span> plate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li>è¿™ç§æƒ…å†µä¸‹, è™½ç„¶è‹¹æœå’Œæ°´æœæœ‰ç»§æ‰¿å…³ç³», ä½†ç›˜å­é—´æ²¡æœ‰ç»§æ‰¿å…³ç³»ä¼šæŠ¥é”™</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fruit</span><span class="token punctuation">&gt;</span></span> plate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>ä¸Šä¸‹ç•Œé€šé…ç¬¦</li></ol><ul><li>Apple -&gt; Fruit -&gt; Food</li><li><code>&lt;? extends T&gt;</code> å¯ä»¥æ˜¯ä»»ä½•Tçš„å­ç±»</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Food</span><span class="token punctuation">&gt;</span></span> plate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fruit</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ul><li><code>&lt;? super T&gt;</code> å¯ä»¥æ˜¯ä»»ä½•Tçš„çˆ¶ç±»</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> plate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Food</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="3"><li>ä¸Šä¸‹ç•Œé€šé…ç¬¦çš„å‰¯ä½œç”¨</li></ol><ul><li>ä¸Šç•Œ<code>&lt;? extends T&gt;</code>ä¸èƒ½å¾€é‡Œå­˜ï¼Œåªèƒ½å¾€å¤–å–</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Food</span><span class="token punctuation">&gt;</span></span> plate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Fruit</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Food</span> a <span class="token operator">=</span> plate<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// plate.setItem(food);  å¤±æ•ˆ</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>ä¸‹ç•Œ&lt;? super T&gt;ä¸å½±å“å¾€é‡Œå­˜ï¼Œä½†å¾€å¤–å–åªèƒ½æ”¾åœ¨Objectå¯¹è±¡é‡Œ</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">Apple</span><span class="token punctuation">&gt;</span></span> plate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Plate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Food</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>fruit<span class="token punctuation">)</span><span class="token punctuation">;</span>
plate2<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>apple<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Apple b = plate2.getItem(); å¤±æ•ˆ</span>
<span class="token comment">// å…ƒç´ çš„ç±»å‹ä¿¡æ¯å…¨éƒ¨ä¸¢å¤±ã€‚</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">è¡¥å……</p><ul><li>?ä¸Tçš„åŒºåˆ«</li><li>å¯¹ç¼–è¯‘å™¨æ¥è¯´æ‰€æœ‰çš„Téƒ½ä»£è¡¨åŒä¸€ç§ç±»å‹ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ³›å‹æ–¹æ³•é‡Œï¼Œä¸‰ä¸ªTéƒ½æŒ‡ä»£åŒä¸€ä¸ªç±»å‹ï¼Œè¦ä¹ˆéƒ½æ˜¯Stringï¼Œè¦ä¹ˆéƒ½æ˜¯Integerã€‚</li><li>ä½†é€šé…ç¬¦<code>&lt;?&gt;æ²¡æœ‰è¿™ç§çº¦æŸï¼ŒPlate&lt;?&gt;</code>å•çº¯çš„å°±è¡¨ç¤ºï¼šç›˜å­é‡Œæ”¾äº†ä¸€ä¸ªä¸œè¥¿ï¼Œæ˜¯ä»€ä¹ˆæˆ‘ä¸çŸ¥é“ã€‚ æ‰€ä»¥é¢˜ä¸»é—®é¢˜é‡Œçš„é”™è¯¯å°±åœ¨è¿™é‡Œï¼ŒPlate&lt;ï¼Ÿ extends Fruit&gt;é‡Œä»€ä¹ˆéƒ½æ”¾ä¸è¿›å»ã€‚</li></ul></div><h2 id="æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#æ³¨è§£" aria-hidden="true">#</a> æ³¨è§£</h2><ol><li>æ³¨è§£ä¼šå½±å“ç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œ</li><li>æ³¨è§£æœ¬èº«åªæ˜¯ä¸€ä¸ªæ ‡æ³¨ï¼Œæœ¬èº«ä¸ç”¨åŒ…å«é€»è¾‘å¤„ç†å†…å®¹</li></ol><h3 id="ä½œç”¨èŒƒå›´" tabindex="-1"><a class="header-anchor" href="#ä½œç”¨èŒƒå›´" aria-hidden="true">#</a> ä½œç”¨èŒƒå›´</h3><ul><li>RUNTIMEï¼šç¨‹åºè¿è¡Œæ—¶èµ·ä½œç”¨ï¼Œä¾‹å¦‚ï¼š<code>@WebServlet</code></li><li>SOURCEï¼šç¼–è¯‘æ—¶æœŸä½œç”¨ï¼Œä¾‹å¦‚ <code>@Override</code></li></ul><h3 id="target" tabindex="-1"><a class="header-anchor" href="#target" aria-hidden="true">#</a> @Target</h3><p>æŒ‡å®šæ³¨è§£é’ˆå¯¹çš„ç›®æ ‡</p><ul><li>ElementType.Type ç±»ã€æ–¹æ³•</li><li>ElementType.Field æˆå‘˜å˜é‡</li><li>ElementType.METHOD æˆå‘˜æ–¹æ³•</li><li>ElementType.PARAMETER æ–¹æ³•å‚æ•°</li><li>ElementType.CONSTRUCTOR æ„é€ å™¨</li><li>ElementType.PACKAGE åŒ…</li><li>ElementType.ANNOTATION_TYPE æ³¨è§£</li></ul><h3 id="retention" tabindex="-1"><a class="header-anchor" href="#retention" aria-hidden="true">#</a> @Retention</h3><p>æŒ‡å®šæ³¨è§£çš„ä¿ç•™åŸŸ</p><ul><li>RetentionPolicy.SOURCE æºä»£ç çº§åˆ«ï¼Œç”±ç¼–è¯‘å™¨å¤„ç†ï¼Œå¤„ç†åä¸å†ä¿ç•™</li><li>RetentionPolicy.CLASS æ³¨è§£ä¿¡æ¯ä¿ç•™åˆ°classæ–‡ä»¶ä¸­</li><li>RetentionPolicy.RUNTION ç”±jvmè¯»å–ï¼Œè¿è¡Œæ—¶ä½¿ç”¨</li></ul><h3 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹" aria-hidden="true">#</a> ç¤ºä¾‹</h3><ol><li>æ³¨è§£ç±»</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">InitAnno</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>è¢«æ³¨è§£ç±»</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@InitAnno</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿›å…¥äº†baræ–¹æ³•&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>Main</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;Foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Annotation</span> annotation <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">InitAnno</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>annotation <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç±»å‰æ²¡æœ‰InitAnnoæ³¨è§£&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> methods<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> isInitAnno <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">InitAnno</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isInitAnno<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="å¤šçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#å¤šçº¿ç¨‹" aria-hidden="true">#</a> å¤šçº¿ç¨‹</h2><h3 id="å®ç°" tabindex="-1"><a class="header-anchor" href="#å®ç°" aria-hidden="true">#</a> å®ç°</h3><ol><li>ç»§æ‰¿Threadç±»</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MyThread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>å®ç°Runnableæ¥å£</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MyRunnable</span> runnable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>runnable<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyRunnable1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">æç¤º</p><p>Runnableç›¸æ¯”Threadè€¦åˆä½ï¼Œlambdaè¡¨è¾¾å¼æ›´ä½</p></div><ol start="3"><li>å®ç°Callableæ¥å£</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> callable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿›å»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> featureTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>callable<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>featureTask<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>featureTask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>æ³¨æ„ï¼ Callableä¸Threadæ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œéœ€è¦é—´æ¥å®ç°</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">Runnable</span><span class="token punctuation">,</span> <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Sets this Future to the result of its computation
     * unless it has been cancelled.
     */</span>
    <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">RunnableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> callable<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-mermaid ext-mermaid line-numbers-mode"><pre class="language-mermaid"><code><span class="token keyword">graph</span> LR
A<span class="token text string">[Callable]</span> <span class="token arrow operator">--&gt;</span>B<span class="token text string">(FutureTask)</span> <span class="token arrow operator">--&gt;</span> C<span class="token text string">(RunnableFuture)</span> <span class="token arrow operator">--&gt;</span> D<span class="token text string">(Runnable)</span> <span class="token arrow operator">--&gt;</span> E<span class="token text string">(Thread)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="å¸¸ç”¨æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨æ–¹æ³•" aria-hidden="true">#</a> å¸¸ç”¨æ–¹æ³•</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token number">1.</span> ä¼‘çœ 
thread<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">2.</span> åˆå¹¶
thread<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">3.</span> ç¤¼è®©
<span class="token keyword">yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="çº¿ç¨‹åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹åŒæ­¥" aria-hidden="true">#</a> çº¿ç¨‹åŒæ­¥</h3><p>æ¯ä¸ªjavaå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…ç½®é”, å†…ç½®é”ä¼šä¿æŠ¤ä½¿ç”¨synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³• è¦è°ƒç”¨è¯¥æ–¹æ³•å¿…é¡»å…ˆè·å–é”, å¦åˆ™å°±å¤„äºå µå¡çŠ¶æ€</p><ul><li>é™æ€å˜é‡</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SameRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">++</span>num<span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç¬¬&quot;</span> <span class="token operator">+</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ä½è®¿å®¢æ˜¯ç¬¬&quot;</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">&quot;ä¸ª&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>é™æ€ä»£ç å—, é”å®šç±» synchronizedå…³é”®å­—ä¹Ÿèƒ½ä¿®é¥°ä»£ç å—, ä»¥ä¸‹ä¾‹å­ä¹Ÿèƒ½æœ‰ç›¸åŒçš„æ•ˆæœ</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Test</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    test<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Test</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// é”å®šç±»(éé™æ€å¯this), ä¸èƒ½æ˜¯ç±»çš„å®ä¾‹</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>é”å®šå®ä¾‹æ–¹æ³•<div class="custom-container danger"><p class="custom-container-title">æ³¨æ„</p><p>synchronizedå…³é”®å­—åªæ˜¯ä¿®é¥°å…±äº«çš„èµ„æº, ä¸‹é¢çš„ä¾‹å­ä¸èƒ½å¾—åˆ°æƒ³è¦çš„æ•ˆæœ</p></div></li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼" aria-hidden="true">#</a> çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼</h3><ul><li>é”å®šç±»</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">volatile</span> <span class="token keyword">class</span> <span class="token class-name">Runner</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Runner</span> runner<span class="token punctuation">;</span>
    <span class="token comment">// è®°å¾—åŠ å…³é”®å­—, é˜²æ­¢å¤šä¸ªçº¿ç¨‹è®¿é—®æ—¶è¿˜æ²¡åˆ›å»ºè¿‡å¯¹è±¡</span>
    <span class="token comment">// 1. ğŸ”’æ•´ä¸ªæ–¹æ³•</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token class-name">Runner</span> <span class="token function">getRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>runner <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            runner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> runner<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// åªé”ä»£ç å—, ä¸å½±å“è¯¥æ–¹æ³•å†…çš„å…¶ä»–ä¸šåŠ¡</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Runner</span> <span class="token function">getRunner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Runner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>runner <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                runner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Runner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> runner<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">å…¶ä»–é”å®šå¯¹è±¡</p><ol><li>synchronized(runner): nä¸ªç©ºæŒ‡é’ˆå¼‚å¸¸, ä¸èƒ½é”ç©ºå¯¹è±¡</li><li>Integer i = Integer.parseInt(&quot;1&quot;); synchronized(i): ä¹Ÿå¯ä»¥</li><li>Integer a = Integer.parseInt(&quot;1&quot;); Integer b = Integer.parseInt(&quot;1&quot;); synchronized(i) å¼€å¯ä¸¤ä¸ªçº¿ç¨‹, è‹¥a,bå€¼(è¯¦æƒ…è§IntegeråŒ…è£…ç±»)ç›¸åŒ, åˆ™çº¿ç¨‹å®‰å…¨, å¦åˆ™ä¸å®‰å…¨</li></ol></div><h3 id="voletileå…³é”®å­—" tabindex="-1"><a class="header-anchor" href="#voletileå…³é”®å­—" aria-hidden="true">#</a> voletileå…³é”®å­—</h3><ol><li>å¼•ä¾‹</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> exam <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> finalNum <span class="token operator">=</span> num<span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>finalNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>åœ¨è¯¥ä¾‹å­ä¸­, å¾ªç¯ä¸ä¼šåœæ­¢ new Thread ä¸ mainåŒæ—¶æ“ä½œnum, ä»–ä»¬åˆ†åˆ«ä»ä¸»å†…å­˜å¤åˆ¶åˆ°å·¥ä½œå†…å­˜, å¯¹å„è‡ªçš„å·¥ä½œå†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œæ“ä½œ, mainçº¿ç¨‹å¯¹num+1, åŒæ­¥åˆ°ä¸»çº¿ç¨‹, ä½†new Threadçš„ä»»åŠ¡æœªåœæ­¢, æ²¡æœ‰ä¸ä¸»å†…å­˜åŒæ­¥, å¾ªç¯ä¸ä¼šç»ˆæ­¢</li><li>è‹¥å¾ªç¯ä¸­åŠ ä¸€ä¸ªæ‰§è¡Œè¯­å¥, å¾ªç¯ä¼šç»ˆæ­¢, å·¥ä½œå†…å­˜ä¼šå³ä½¿ä¸ä¸»å†…å­˜è¿›è¡ŒåŒæ­¥</li></ul><p>å½“å„ä¸ªçº¿ç¨‹æ“ä½œæ—¶, æ•°æ®æ²¡æœ‰è¿›è¡ŒåŒæ­¥åˆ°ä¸»å†…å­˜, äº§ç”Ÿé”™è¯¯ voletileå…³é”®å­—ä½¿å¤šä¸ªçº¿ç¨‹ç›´æ¥æ“ä½œä¸»å†…å­˜, ä¸åœ¨ç»è¿‡å·¥ä½œå†…å­˜</p><h3 id="å¾…ç»­-1" tabindex="-1"><a class="header-anchor" href="#å¾…ç»­-1" aria-hidden="true">#</a> å¾…ç»­...</h3><h2 id="juc" tabindex="-1"><a class="header-anchor" href="#juc" aria-hidden="true">#</a> JUC</h2><h3 id="ç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#ç‰¹å¾" aria-hidden="true">#</a> ç‰¹å¾</h3><p>synchronized ä¸ Lock å¯¹æ¯”</p><ol><li>synchronizedè‡ªåŠ¨ä¸Šé”è§£é”ï¼Œ Lockæ‰‹åŠ¨ä¸Šé”è§£é”</li><li>synchronizedæ— æ³•åˆ¤æ–­æ˜¯å¦è·å–åˆ°é”ï¼Œ Lockå¯ä»¥</li><li>synchronizedæ‹¿ä¸åˆ°é”ä¼šä¸€ç›´ç­‰å¾…ï¼Œ Lockä¸ä¼š</li><li>synchronizedæ˜¯å…³é”®å­—ï¼Œjvmå®ç°ï¼Œ Lockæ˜¯æ¥å£ï¼Œjdkå®ç°</li><li>synchronizedæ˜¯éå…¬å¹³é”ï¼ŒLockè‡ªç”±è®¾ç½®</li></ol><blockquote><p>å…¬å¹³é”: å¤šä¸ªçº¿ç¨‹æ’é˜ŸåŠ é”<code>&lt;br/&gt;</code> éå…¬å¹³é”: ä¸åˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–ç­‰å¾…çº¿ç¨‹ï¼Œç›´æ¥å ç”¨</p></blockquote><h3 id="åŸºæœ¬æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æ“ä½œ" aria-hidden="true">#</a> åŸºæœ¬æ“ä½œ</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Lock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="æ­»é”" tabindex="-1"><a class="header-anchor" href="#æ­»é”" aria-hidden="true">#</a> æ­»é”</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
* num = 1çš„äººæ‹¿åˆ°chopsticks1, ç­‰å¾…chopsticks2
* num = 2çš„äººæ‹¿åˆ°chopsticks2, ç­‰å¾…chopsticks1
* */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>chopsticks1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>chopsticks2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;1åƒå®Œäº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>chopsticks2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>chopsticks1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;2åƒå®Œäº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="ç”Ÿäº§è€…æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#ç”Ÿäº§è€…æ¶ˆè´¹è€…" aria-hidden="true">#</a> ç”Ÿäº§è€…æ¶ˆè´¹è€…</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 1. synchronize</span>
<span class="token keyword">class</span> <span class="token class-name">Container</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ç”Ÿäº§äº†1ä¸ª,è¿˜æœ‰&quot;</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">&quot;ä¸ª&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        num <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">&quot;è´­ä¹°äº†1ä¸ª,è¿˜æœ‰&quot;</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">&quot;ä¸ª&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2. Lock è¦ä»¥condition.await å’Œ condition.singalä»£æ›¿ wait å’Œ notify</span>
<span class="token keyword">class</span> <span class="token class-name">Container2</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> num <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Condition</span> condition <span class="token operator">=</span> lock<span class="token punctuation">.</span><span class="token function">newCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>num <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            condition<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;ç”Ÿäº§äº†1ä¸ª,è¿˜æœ‰&quot;</span> <span class="token operator">+</span> num <span class="token operator">+</span> <span class="token string">&quot;ä¸ª&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        condition<span class="token punctuation">.</span><span class="token function">signal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h3 id="trylock" tabindex="-1"><a class="header-anchor" href="#trylock" aria-hidden="true">#</a> tryLock</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">TimeLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3ç§’å†…æ‹¿åˆ°äº†é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;3ç§’å†…æ²¡æ‹¿åˆ°é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">isHeldByCurrentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// åªèƒ½ç”±ä¸Šé”è€…å»è§£é”</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="åŒæ—¶è¯»å†™" tabindex="-1"><a class="header-anchor" href="#åŒæ—¶è¯»å†™" aria-hidden="true">#</a> åŒæ—¶è¯»å†™</h3><ol><li>å¯¹ArrayListè¯»å†™æ“ä½œåŒæ—¶å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReadAndWrite</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//List&lt;String&gt; list = new Vector&lt;&gt;();</span>
        <span class="token comment">// List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span>
        <span class="token comment">// List&lt;String&gt; list = new CopyOnWriteArrayList();</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>MILLISECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="2"><li>åŸå›  ArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount!!</span>
    elementData<span class="token punctuation">[</span>size<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>è§£å†³æ–¹æ³•</li></ol><ul><li>æ›´æ¢ä¸ºVector</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">ensureCapacityHelper</span><span class="token punctuation">(</span>elementCount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elementData<span class="token punctuation">[</span>elementCount<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><p>æ›´æ¢ä¸ºCollections.synchronizedList()</p></li><li><p>JUC: CopyOnWriteList</p></li></ul><blockquote><p>CopyOnWriteå®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œå½“æˆ‘ä»¬å¾€ä¸€ä¸ªå®¹å™¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¸æ˜¯ç›´æ¥ç»™å®¹å™¨æ·»åŠ ï¼Œè€Œæ˜¯å…ˆå°†å½“å‰å®¹å™¨å¤åˆ¶ä¸€ ä»½ï¼Œå‘æ–°çš„å®¹å™¨ä¸­æ·»åŠ æ•°æ®ï¼Œæ·»åŠ å®Œæˆä¹‹åï¼Œå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°çš„å®¹å™¨ã€‚</p></blockquote><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">E</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lock<span class="token punctuation">;</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> elements <span class="token operator">=</span> <span class="token function">getArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newElements <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        newElements<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
        <span class="token function">setArray</span><span class="token punctuation">(</span>newElements<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="è®¡æ•°å™¨" tabindex="-1"><a class="header-anchor" href="#è®¡æ•°å™¨" aria-hidden="true">#</a> è®¡æ•°å™¨</h3><ul><li>å‡æ³•è®¡æ•°å™¨countDownLatch å¯ä»¥ç¡®ä¿æŸä¸ªçº¿ç¨‹ä¼˜å…ˆæ‰§è¡Œ, å½“è®¡æ•°å™¨æ¸…é›¶åœ¨å”¤é†’å…¶ä»–çº¿ç¨‹</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDown</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å¿…é¡»å”¤é†’, ä¸”è®¡æ•°å™¨è¦æ¸…é›¶</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="custom-container warning"><p class="custom-container-title">æ³¨æ„</p><p>new CountDownLatch(80), countDownLatch.countDown(), countDownLatch.await() å¿…é¡»é…åˆä½¿ç”¨, åªè¦è®¡æ•°å™¨æ²¡æœ‰æ¸…é›¶, è®¡æ•°å™¨ä¸ä¼šåœæ­¢, å…¶ä»–çº¿ç¨‹ä¹Ÿä¸èƒ½å”¤é†’</p></div><ul><li>åŠ æ³•è®¡æ•°å™¨ è¯•å›¾å”¤é†’å½“å‰çº¿ç¨‹, å½“åŠ åˆ°ä¸€å®šæ•°é‡æˆåŠŸå”¤é†’, ä¹‹åæ¸…é›¶, å†æ¬¡ç´¯åŠ å¾ªç¯</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// æ„é€ å™¨</span>
<span class="token keyword">public</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token keyword">int</span> parties<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> barrierAction<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parties <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>parties <span class="token operator">=</span> parties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> parties<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>barrierCommand <span class="token operator">=</span> barrierAction<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Test</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CyclicBarrier_</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CyclicBarrier</span> cyclicBarrier <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CyclicBarrier</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ”¾è¡Œ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                cyclicBarrier<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>è®¡æ•°çº¿ç¨‹é™æµ é™åˆ¶åŒæ—¶è¿›å…¥çš„çº¿ç¨‹æ•°</li></ul><ol><li>åˆå§‹åŒ–</li><li>è·å¾—è®¸å¯</li><li>é‡Šæ”¾</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// é™åˆ¶æœ€å¤š5äºº</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;è¿›å»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;å‡ºå»äº†&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="è¯»å†™é”" tabindex="-1"><a class="header-anchor" href="#è¯»å†™é”" aria-hidden="true">#</a> è¯»å†™é”</h3><p>è¯»å†™é”ä¹Ÿæ˜¯ä¸ºäº†å®ç°çº¿ç¨‹åŒæ­¥, åªä¸è¿‡ç²’åº¦æ›´ç»†, å¯ä»¥ä¸ºè¯»å’Œå†™è®¾ç½®ä¸åŒçš„é”</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Cache</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ReadWriteLock</span> readWriteLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹å†™å…¥ ID: &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å†™å…¥å®Œæˆ ID: &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        readWriteLock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼€å§‹è¯»å– ID: &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> a <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯»å–å®Œæˆ ID: &quot;</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        readWriteLock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="custom-container tip"><p class="custom-container-title">è¡¥å……</p><p>å†™å…¥é”ä¹Ÿå«ç‹¬å é”ï¼Œåªèƒ½è¢«1ä¸ªçº¿ç¨‹å ç”¨ï¼Œè¯»å–é”ä¹Ÿå«å…±äº«é”ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å ç”¨ã€‚</p></div><h3 id="çº¿ç¨‹æ± " tabindex="-1"><a class="header-anchor" href="#çº¿ç¨‹æ± " aria-hidden="true">#</a> çº¿ç¨‹æ± </h3><ol><li>åŸºæœ¬ä½¿ç”¨</li></ol><p>é¢„å…ˆåˆ›å»ºå¥½ä¸€å®šæ•°é‡çš„çº¿ç¨‹å¯¹è±¡ï¼Œå­˜å…¥ç¼“å†²æ± ä¸­ï¼Œéœ€è¦ç”¨çš„æ—¶å€™ç›´æ¥ä»ç¼“å†²æ± ä¸­å–å‡ºï¼Œç”¨å®Œä¹‹åä¸è¦é”€æ¯ï¼Œè¿˜å›åˆ°ç¼“å†²æ± ä¸­ï¼Œä¸ºäº†æé«˜èµ„æºçš„åˆ©ç”¨ç‡ã€‚ ä¼˜åŠ¿:</p><ul><li>æé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡</li><li>æé«˜å“åº”é€Ÿåº¦</li><li>ä¾¿äºç»Ÿä¸€ç®¡ç†çº¿ç¨‹å¯¹è±¡</li><li>å¯ä»¥æ§åˆ¶æœ€å¤§çš„å¹¶å‘æ•°</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadPool_</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å•ä¾‹</span>
        <span class="token comment">//ExecutorService executorService = Executors.newSingleThreadExecutor();</span>
        <span class="token comment">// æŒ‡å®šçº¿ç¨‹æ•°é‡</span>
        <span class="token comment">//ExecutorService executorService = Executors.newFixedThreadPool(5);</span>
        <span class="token comment">// ç¼“å†²çº¿ç¨‹æ± </span>
        <span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newCachedThreadPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> temp <span class="token operator">=</span> i<span class="token punctuation">;</span>
            executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executorService<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ol start="2"><li>æ„é€ å‡½æ•°</li></ol><p>ä¸‰ä¸ªå¸¸ç”¨çº¿ç¨‹æ± éƒ½ return new ThreadPoolExecutor(); ThreadPoolExecutorçš„æ„é€ å‡½æ•°å¦‚ä¸‹</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>  <span class="token keyword">int</span> corePoolSize<span class="token punctuation">,</span>
                            <span class="token keyword">int</span> maximumPoolSize<span class="token punctuation">,</span>
                            <span class="token keyword">long</span> keepAliveTime<span class="token punctuation">,</span>
                            <span class="token class-name">TimeUnit</span> unit<span class="token punctuation">,</span>
                            <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Runnable</span><span class="token punctuation">&gt;</span></span> workQueue<span class="token punctuation">,</span>
                            <span class="token class-name">ThreadFactory</span> threadFactory<span class="token punctuation">,</span>
                            <span class="token class-name">RejectedExecutionHandler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>corePoolSize: æ ¸å¿ƒæ± æ•°é‡</li><li>maximumPoolSize: çº¿ç¨‹æ± å®¹é‡ä¸Šé™, ä»»åŠ¡é‡å¢å¤§æ—¶, çº¿ç¨‹æ± ä¸»åŠ¨æ‰©å®¹</li><li>keepAliveTime: çº¿ç¨‹å¯¹è±¡å­˜æ´»æ—¶é—´</li><li>unit: çº¿ç¨‹å¯¹è±¡å­˜æ´»æ—¶é—´å•ä½</li><li>workQueue: çº¿ç¨‹é˜Ÿåˆ—(æ–°çš„ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å€™è·å–çº¿ç¨‹å¯¹è±¡)</li><li>threadFactory: çº¿ç¨‹å·¥å‚åˆ›å»ºçº¿ç¨‹å¯¹è±¡</li><li>handler: æ‹’ç»ç­–ç•¥</li></ul><ol start="3"><li>æ‹’ç»ç­–ç•¥</li></ol><p>RejectedExecutionHandleræ˜¯ä¸€ä¸ªæ¥å£, å‡åœ¨ThreadPoolExecutorä¸­å®ç°</p><ul><li>AbortPolicyz:ç›´æ¥æŠ›å‡ºå¼‚å¸¸</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * A handler for rejected tasks that throws a
    * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">RejectedExecutionException</span></span></span><span class="token punctuation">}</span>.
    */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AbortPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>DiscardPolicy: ç›´æ¥æ‹’ç»</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * A handler for rejected tasks that silently discards the
    * rejected task.
    */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DiscardPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>DiscardOldestPolicy: å°è¯•ä¸ç­‰å¾…é˜Ÿåˆ—ä¸­æœ€å¼€å§‹çš„ä»»åŠ¡äº‰å¤º,ä¸æŠ›å‡ºå¼‚å¸¸</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * A handler for rejected tasks that discards the oldest unhandled
     * request and then retries <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">execute</span></span><span class="token punctuation">}</span>, unless the executor
     * is shut down, in which case the task is discarded.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DiscardOldestPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>CallerRunsPolicy ç”±å‘èµ·è¯·æ±‚çº¿ç¨‹å¤„ç†</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
    * A handler for rejected tasks that runs the rejected task
    * directly in the calling thread of the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">execute</span></span><span class="token punctuation">}</span> method,
    * unless the executor has been shut down, in which case the task
    * is discarded.
    */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CallerRunsPolicy</span> <span class="token keyword">implements</span> <span class="token class-name">RejectedExecutionHandler</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ol start="4"><li>è‡ªå®šä¹‰çº¿ç¨‹æ± </li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>executorService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span>
        <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token number">10</span><span class="token punctuation">,</span>
        <span class="token number">2L</span><span class="token punctuation">,</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">defaultThreadFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor<span class="token punctuation">.</span>AbortPolicy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>4ç§workQueue å µå¡é˜Ÿåˆ—,ç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡</p><ul><li>ArrayBlockingQueue: åŸºäºæ•°ç»„çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œåˆ›å»ºæ—¶å¿…é¡»æŒ‡å®šå¤§å°ã€‚</li><li>LinkedBlockingQueue: åŸºäºé“¾è¡¨çš„å…ˆè¿›å…ˆå‡ºé˜Ÿåˆ—ï¼Œåˆ›å»ºæ—¶å¯ä»¥ä¸æŒ‡å®šå¤§å°ï¼Œé»˜è®¤å€¼æ˜¯Integer.MAX VALUEã€‚ æœ€å¤§å€¼ã€‚</li><li>SynchronousQueue: å®ƒä¸ä¼šä¿æŒæäº¤çš„ä»»åŠ¡ï¼Œè€Œæ˜¯ç›´æ¥æ–°å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡ã€‚</li><li>PriorityBlockingQueue: å…·æœ‰ä¼˜å…ˆçº§çš„é˜»å¡é˜Ÿåˆ—ã€‚</li></ul><h3 id="forkjoin" tabindex="-1"><a class="header-anchor" href="#forkjoin" aria-hidden="true">#</a> Forkjoin</h3><ol><li>æ¦‚å¿µ</li></ol><ul><li>Forkjoinæ˜¯JDK 1.7åå‘å¸ƒçš„å¤šçº¿ç¨‹å¹¶å‘å¤„ç†æ¡†æ¶ï¼ŒåŠŸèƒ½ä¸Šå’ŒJUCç±»ä¼¼, JUCæ›´å¤šæ—¶å€™æ˜¯ä½¿ç”¨å•ä¸ªç±»å®Œæˆæ“ä½œ,Forkjoinä½¿ç”¨å¤šä¸ªç±»åŒæ—¶å®ŒæˆæŸé¡¹å·¥ä½œ,å¤„ç†ä¸Šæ¯”JUCæ›´åŠ ä¸°å¯Œï¼Œ</li><li>æœ¬è´¨ä¸Šæ˜¯å¯¹çº¿ç¨‹æ± çš„ä¸€ç§çš„è¡¥å……ï¼Œå¯¹çº¿ç¨‹æ± åŠŸèƒ½çš„ä¸€ç§æ‰©å±•ï¼ŒåŸºäºçº¿ç¨‹æ± ï¼Œ</li><li>å®ƒçš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯å°†ä¸€ä¸ªå¤§å‹çš„ä»»åŠ¡æ‹†åˆ†æˆå¾ˆå¤šä¸ªå°ä»»åŠ¡ï¼Œç„¶åç”±å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæœ€ç»ˆå°†å°ä»»åŠ¡çš„ç»“æœè¿›è¡Œæ±‡æ€»ï¼Œç”Ÿæˆæœ€ç»ˆçš„ç»“æœã€‚</li></ul><ol start="2"><li>åŸºæœ¬ä½¿ç”¨ è®¾ç½®ä¸´ç•Œå€¼, é€’å½’åˆ†é…ä»»åŠ¡, çŸ¥é“ä»»åŠ¡ä¸èƒ½è¢«å†åˆ†</li></ol><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FolkJoin_</span> <span class="token keyword">extends</span> <span class="token class-name">RecursiveTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> start<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> end<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> temp <span class="token operator">=</span> <span class="token number">200_0000L</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">FolkJoin_</span><span class="token punctuation">(</span><span class="token class-name">Long</span> start<span class="token punctuation">,</span> <span class="token class-name">Long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> end<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Long</span> <span class="token function">compute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>end <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">&lt;</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> sum <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> end <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sum <span class="token operator">+=</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> sum<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Long</span> avg <span class="token operator">=</span> <span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token class-name">FolkJoin_</span> tast1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FolkJoin_</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> avg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FolkJoin_</span> tast2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FolkJoin_</span><span class="token punctuation">(</span>avg<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
            tast1<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tast2<span class="token punctuation">.</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> tast1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span>tast2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>Main.java</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ForkJoinPool</span> folkJoinPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ForkJoinPool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FolkJoin_</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FolkJoin_</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">,</span> <span class="token number">10_0000_0000L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
folkJoinPool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="å¾…ç»­-2" tabindex="-1"><a class="header-anchor" href="#å¾…ç»­-2" aria-hidden="true">#</a> å¾…ç»­...</h3><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: trdthg@outlook.com">trdthg</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.729fb0a5.js" defer></script>
  </body>
</html>
