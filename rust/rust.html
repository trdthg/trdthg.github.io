<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rust | Trdthg&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="logo.png">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.4f34acde.css" as="style"><link rel="preload" href="/assets/js/app.2ecf9b91.js" as="script"><link rel="preload" href="/assets/js/2.bae41e59.js" as="script"><link rel="preload" href="/assets/js/24.214a572f.js" as="script"><link rel="prefetch" href="/assets/js/10.9ad8f8ec.js"><link rel="prefetch" href="/assets/js/11.b341bba8.js"><link rel="prefetch" href="/assets/js/12.732fc0eb.js"><link rel="prefetch" href="/assets/js/13.638abf22.js"><link rel="prefetch" href="/assets/js/14.8fb05921.js"><link rel="prefetch" href="/assets/js/15.f04df864.js"><link rel="prefetch" href="/assets/js/16.711a3a35.js"><link rel="prefetch" href="/assets/js/17.91b38042.js"><link rel="prefetch" href="/assets/js/18.fc30a3ab.js"><link rel="prefetch" href="/assets/js/19.69b1ef03.js"><link rel="prefetch" href="/assets/js/20.d8f5e767.js"><link rel="prefetch" href="/assets/js/21.70af3f06.js"><link rel="prefetch" href="/assets/js/22.acbab802.js"><link rel="prefetch" href="/assets/js/23.be1ed270.js"><link rel="prefetch" href="/assets/js/25.9523a6c6.js"><link rel="prefetch" href="/assets/js/3.c82449e8.js"><link rel="prefetch" href="/assets/js/4.7e0bf73d.js"><link rel="prefetch" href="/assets/js/5.6decbbcf.js"><link rel="prefetch" href="/assets/js/6.2010f2ff.js"><link rel="prefetch" href="/assets/js/7.0782112c.js"><link rel="prefetch" href="/assets/js/8.be767d2d.js"><link rel="prefetch" href="/assets/js/9.c7e564a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4f34acde.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Trdthg's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/java.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/js/js.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/python/python.html" class="nav-link">
  Python
</a></div><div class="nav-item"><a href="/rust/rust.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Rust
</a></div><div class="nav-item"><a href="/other/other.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/java.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/js/js.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/python/python.html" class="nav-link">
  Python
</a></div><div class="nav-item"><a href="/rust/rust.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Rust
</a></div><div class="nav-item"><a href="/other/other.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/rust/rust.html" aria-current="page" class="active sidebar-link">Rust</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust/rust.html#path" class="sidebar-link">Path</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust/rust.html#stdlib" class="sidebar-link">stdlib</a></li></ul></li><li class="sidebar-sub-header"><a href="/rust/rust.html#lifetime" class="sidebar-link">lifetime</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust/rust.html#自动处理" class="sidebar-link">自动处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/rust/rust.html#rc-arc" class="sidebar-link">Rc &amp; Arc</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust/rust.html#introduce" class="sidebar-link">Introduce</a></li><li class="sidebar-sub-header"><a href="/rust/rust.html#try-unwrap" class="sidebar-link">try_unwrap()</a></li><li class="sidebar-sub-header"><a href="/rust/rust.html#from-std-lib" class="sidebar-link">From Std Lib</a></li></ul></li><li class="sidebar-sub-header"><a href="/rust/rust.html#cell-refcell" class="sidebar-link">Cell &amp; RefCell</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust/rust.html#from-std-lib-2" class="sidebar-link">From Std Lib</a></li></ul></li><li class="sidebar-sub-header"><a href="/rust/rust.html#ref-refmut" class="sidebar-link">Ref &amp; RefMut</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/rust/rust.html#ref-map" class="sidebar-link">Ref::map()</a></li><li class="sidebar-sub-header"><a href="/rust/rust.html#refmut-map" class="sidebar-link">RefMut::map()</a></li></ul></li><li class="sidebar-sub-header"><a href="/rust/rust.html#" class="sidebar-link"></a></li></ul></li><li><a href="/rust/lists.html" class="sidebar-link">Too-Many-Lists</a></li><li><a href="/rust/wasm.html" class="sidebar-link">WebAssembly初体验</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rust"><a href="#rust" class="header-anchor">#</a> Rust</h1> <h2 id="path"><a href="#path" class="header-anchor">#</a> Path</h2> <h3 id="stdlib"><a href="#stdlib" class="header-anchor">#</a> stdlib</h3> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 从 `&amp;'static str` 创建一个 `Path`</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `display` 方法返回一个可显示（showable）的结构体</span>
<span class="token keyword">let</span> display <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `join` 使用操作系统特定的分隔符来合并路径到一个字节容器，并返回新的路径</span>
<span class="token keyword">let</span> new_path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将路径转换成一个字符串切片</span>
<span class="token keyword">match</span> new_path<span class="token punctuation">.</span><span class="token function">to_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;new path is not a valid UTF-8 sequence&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;new path is {}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="lifetime"><a href="#lifetime" class="header-anchor">#</a> lifetime</h2> <h3 id="自动处理"><a href="#自动处理" class="header-anchor">#</a> 自动处理</h3> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// Only one reference in input, so the output must be derived from that input</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">B</span><span class="token punctuation">;</span> <span class="token comment">// sugar for:</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token class-name">A</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token class-name">B</span><span class="token punctuation">;</span>

<span class="token comment">// Many inputs, assume they're all independent</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sugar for:</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">'b</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">'c</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'b</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'c</span> <span class="token class-name">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Methods, assume all output lifetimes are derived from `self`</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">D</span><span class="token punctuation">;</span> <span class="token comment">// sugar for:</span>
<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">'b</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">'c</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'b</span> <span class="token class-name">B</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'c</span> <span class="token class-name">C</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token class-name">D</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="rc-arc"><a href="#rc-arc" class="header-anchor">#</a> Rc &amp; Arc</h2> <h3 id="introduce"><a href="#introduce" class="header-anchor">#</a> Introduce</h3> <p>The key to our design is the RefCell type. The heart of RefCell is a pair of methods:</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">borrow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token keyword">fn</span> <span class="token function-definition function">borrow_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">RefMut</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="try-unwrap"><a href="#try-unwrap" class="header-anchor">#</a> try_unwrap()</h3> <p>Get T from Rc&lt;T&gt;
try to use <code>try_unwrap()</code>, which moves out the contents of an Rc if its refcount is 1.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>unwrap on Result requires that you can debug-print the error case. RefCell<T> only implements Debug if T does. Node doesn't implement Debug.
try: Rc::try_unwrap(old_head).ok().unwrap().into_inner().elem</T></p></div> <h3 id="from-std-lib"><a href="#from-std-lib" class="header-anchor">#</a> From Std Lib</h3> <blockquote><p>Introducing inherited mutability roots to shared types
Shared smart pointer types, including Rc<T> and Arc<T>, provide containers that can be cloned and shared between multiple parties. Because the contained values may be multiply-aliased, they can only be borrowed as shared references, not mutable references. Without cells it would be impossible to mutate data inside of shared boxes at all!</T></T></p></blockquote> <blockquote><p>It's very common then to put a RefCell<T> inside shared pointer types to reintroduce mutability:</T></p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token class-name">RefCell</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>rc<span class="token punctuation">::</span></span><span class="token class-name">Rc</span><span class="token punctuation">;</span>
<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> shared_map<span class="token punctuation">:</span> <span class="token class-name">Rc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span>_<span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shared_map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;africa&quot;</span><span class="token punctuation">,</span> <span class="token number">92388</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shared_map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;kyoto&quot;</span><span class="token punctuation">,</span> <span class="token number">11837</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shared_map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;piccadilly&quot;</span><span class="token punctuation">,</span> <span class="token number">11826</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shared_map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;marbles&quot;</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>Note that this example uses Rc<T> and not Arc<T>. RefCell<T>s are for single-threaded scenarios. Consider using Mutex<T> if you need shared mutability in a multi-threaded situation.</T></T></T></T></p></blockquote> <h2 id="cell-refcell"><a href="#cell-refcell" class="header-anchor">#</a> Cell &amp; RefCell</h2> <h3 id="from-std-lib-2"><a href="#from-std-lib-2" class="header-anchor">#</a> From Std Lib</h3> <blockquote><p>Shareable mutable containers.</p></blockquote> <blockquote><p>Values of the Cell<T> and RefCell<T> types may be mutated through shared references (i.e. the common &amp;T type), whereas most Rust types can only be mutated through unique (&amp;mut T) references. We say that Cell<T> and RefCell<T> provide 'interior mutability', in contrast with typical Rust types that exhibit 'inherited mutability'.</T></T></T></T></p></blockquote> <blockquote><p>Cell types come in two flavors: Cell<T> and RefCell<T>. Cell<T> provides get and set methods that change the interior value with a single method call. Cell<T> though is only compatible with types that implement Copy. For other types, one must use the RefCell<T> type, acquiring a write lock before mutating.</T></T></T></T></T></p></blockquote> <blockquote><p>RefCell<T> uses Rust's lifetimes to implement 'dynamic borrowing', a process whereby one can claim temporary, exclusive, mutable access to the inner value. Borrows for RefCell<T>s are tracked 'at runtime', unlike Rust's native reference types which are entirely tracked statically, at compile time. Because RefCell<T> borrows are dynamic it is possible to attempt to borrow a value that is already mutably borrowed; when this happens it results in thread panic.</T></T></T></p></blockquote> <h2 id="ref-refmut"><a href="#ref-refmut" class="header-anchor">#</a> Ref &amp; RefMut</h2> <h3 id="ref-map"><a href="#ref-map" class="header-anchor">#</a> Ref::map()</h3> <ol><li>mine</li></ol> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Ref</span><span class="token operator">&lt;</span> <span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token class-name">U</span><span class="token operator">&gt;</span>
<span class="token comment">// Get Ref&lt;T&gt; from Ref&lt;Node&lt;T&gt;&gt;</span>
<span class="token comment">// my example</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">peek_front</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>node<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token class-name">Ref</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>node<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">&amp;</span>node<span class="token punctuation">.</span>elem<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>from std lib</li></ol> <div class="language-rust extra-class"><pre class="language-rust"><code>
<span class="token class-name">Makes</span> a new <span class="token class-name">Ref</span> <span class="token keyword">for</span> a component of the borrowed data<span class="token punctuation">.</span>

<span class="token class-name">The</span> <span class="token class-name">RefCell</span> is already immutably borrowed<span class="token punctuation">,</span> so this cannot fail<span class="token punctuation">.</span>

<span class="token class-name">This</span> is an associated function that needs to be used <span class="token keyword">as</span> <span class="token class-name">Ref</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token class-name">A</span> method would interfere with methods of the same name on the contents of a <span class="token class-name">RefCell</span> used through <span class="token class-name">Deref</span><span class="token punctuation">.</span>

<span class="token class-name">Examples</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">RefCell</span><span class="token punctuation">,</span> <span class="token class-name">Ref</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token char string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b1<span class="token punctuation">:</span> <span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b2<span class="token punctuation">:</span> <span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Ref</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span>b1<span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>t<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">&amp;</span>t<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">*</span>b2<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="refmut-map"><a href="#refmut-map" class="header-anchor">#</a> RefMut::map()</h3> <p>同上</p> <h2 id=""><a href="#" class="header-anchor">#</a></h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/3/2021, 6:00:19 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/rust/lists.html">
        Too-Many-Lists
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2ecf9b91.js" defer></script><script src="/assets/js/2.bae41e59.js" defer></script><script src="/assets/js/24.214a572f.js" defer></script>
  </body>
</html>
