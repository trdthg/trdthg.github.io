<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Rust-å…­è¾¹å½¢æ¶æ„-3-HTTP-API - Trdthg&#x27;s Self</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">trans</li><li class="chapter-item expanded "><a href="../../trans/2022-04-20-è¯‘-ä½¿ç”¨-Tokio-å¤„ç†-CPU-å¯†é›†å‹ä»»åŠ¡.html"><strong aria-hidden="true">1.</strong> 2022-04-20-è¯‘-ä½¿ç”¨-Tokio-å¤„ç†-CPU-å¯†é›†å‹ä»»åŠ¡</a></li><li class="chapter-item expanded "><a href="../../trans/2023-01-03-è¯‘-Rustå†’é™©:-æ»¥ç”¨-Serde.html"><strong aria-hidden="true">2.</strong> 2023-01-03-è¯‘-Rustå†’é™©:-æ»¥ç”¨-Serde</a></li><li class="chapter-item expanded "><a href="../../trans/2023-01-01-è¯‘-æ‹“å±•-Rust-ä¸­çš„-Map.html"><strong aria-hidden="true">3.</strong> 2023-01-01-è¯‘-æ‹“å±•-Rust-ä¸­çš„-Map</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-01-è¯‘-search_engine.html"><strong aria-hidden="true">4.</strong> 2022-04-01-è¯‘-search_engine</a></li><li class="chapter-item expanded "><a href="../../trans/2022-05-04-è¯‘-å¯è§†åŒ–-Rust-å„æ•°æ®ç±»å‹çš„å†…å­˜å¸ƒå±€.html"><strong aria-hidden="true">5.</strong> 2022-05-04-è¯‘-å¯è§†åŒ–-Rust-å„æ•°æ®ç±»å‹çš„å†…å­˜å¸ƒå±€</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-13-è¯‘-tail_latency.html"><strong aria-hidden="true">6.</strong> 2022-04-13-è¯‘-tail_latency</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-30-è¯‘-ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Rust-ï¼Ÿ.html"><strong aria-hidden="true">7.</strong> 2022-04-30-è¯‘-ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Rust-ï¼Ÿ</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-11-è¯‘-å¼‚æ­¥-Rustï¼šåä½œä¸æŠ¢å å¼è°ƒåº¦.html"><strong aria-hidden="true">8.</strong> 2022-04-11-è¯‘-å¼‚æ­¥-Rustï¼šåä½œä¸æŠ¢å å¼è°ƒåº¦</a></li><li class="chapter-item expanded "><a href="../../trans/2023-01-02-è¯‘-æœªåˆå§‹åŒ–å†…å­˜:-unsafe-Rustå¤ªéš¾äº†.html"><strong aria-hidden="true">9.</strong> 2023-01-02-è¯‘-æœªåˆå§‹åŒ–å†…å­˜:-unsafe-Rustå¤ªéš¾äº†</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/index.html"><strong aria-hidden="true">10.</strong> 2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-4-é‡æ„.html"><strong aria-hidden="true">10.1.</strong> Rust-å…­è¾¹å½¢æ¶æ„-4-é‡æ„</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-2-å†…å­˜å­˜å‚¨åº“.html"><strong aria-hidden="true">10.2.</strong> Rust-å…­è¾¹å½¢æ¶æ„-2-å†…å­˜å­˜å‚¨åº“</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-7-é•¿æœŸå­˜å‚¨åº“.html"><strong aria-hidden="true">10.3.</strong> Rust-å…­è¾¹å½¢æ¶æ„-7-é•¿æœŸå­˜å‚¨åº“</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-1-åŸŸ.html"><strong aria-hidden="true">10.4.</strong> Rust-å…­è¾¹å½¢æ¶æ„-1-åŸŸ</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-5-å…¶ä»–ç”¨ä¾‹.html"><strong aria-hidden="true">10.5.</strong> Rust-å…­è¾¹å½¢æ¶æ„-5-å…¶ä»–ç”¨ä¾‹</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-6-CLI.html"><strong aria-hidden="true">10.6.</strong> Rust-å…­è¾¹å½¢æ¶æ„-6-CLI</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-3-HTTP-API.html" class="active"><strong aria-hidden="true">10.7.</strong> Rust-å…­è¾¹å½¢æ¶æ„-3-HTTP-API</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/index.html"><strong aria-hidden="true">10.8.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">note</li><li class="chapter-item expanded "><a href="../../note/java/index.html"><strong aria-hidden="true">11.</strong> java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../note/java/java.html"><strong aria-hidden="true">11.1.</strong> java</a></li><li class="chapter-item expanded "><a href="../../note/java/springboot.html"><strong aria-hidden="true">11.2.</strong> springboot</a></li><li class="chapter-item expanded "><a href="../../note/java/spring.html"><strong aria-hidden="true">11.3.</strong> spring</a></li><li class="chapter-item expanded "><a href="../../note/java/sourceread.html"><strong aria-hidden="true">11.4.</strong> sourceread</a></li><li class="chapter-item expanded "><a href="../../note/java/index.html"><strong aria-hidden="true">11.5.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../note/frontend/index.html"><strong aria-hidden="true">12.</strong> frontend</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../note/frontend/mini_bundle.html"><strong aria-hidden="true">12.1.</strong> mini_bundle</a></li><li class="chapter-item expanded "><a href="../../note/frontend/js_advanced.html"><strong aria-hidden="true">12.2.</strong> js_advanced</a></li><li class="chapter-item expanded "><a href="../../note/frontend/mini_vue.html"><strong aria-hidden="true">12.3.</strong> mini_vue</a></li><li class="chapter-item expanded "><a href="../../note/frontend/vue.html"><strong aria-hidden="true">12.4.</strong> vue</a></li><li class="chapter-item expanded "><a href="../../note/frontend/list.html"><strong aria-hidden="true">12.5.</strong> list</a></li><li class="chapter-item expanded "><a href="../../note/frontend/http.html"><strong aria-hidden="true">12.6.</strong> http</a></li><li class="chapter-item expanded "><a href="../../note/frontend/flutter.html"><strong aria-hidden="true">12.7.</strong> flutter</a></li><li class="chapter-item expanded "><a href="../../note/frontend/css.html"><strong aria-hidden="true">12.8.</strong> css</a></li><li class="chapter-item expanded "><a href="../../note/frontend/vdom.html"><strong aria-hidden="true">12.9.</strong> vdom</a></li><li class="chapter-item expanded "><a href="../../note/frontend/index.html"><strong aria-hidden="true">12.10.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">blog</li><li class="chapter-item expanded "><a href="../../blog/index.html"><strong aria-hidden="true">13.</strong> README</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">docs</li><li class="chapter-item expanded "><a href="../../docs/log.html"><strong aria-hidden="true">14.</strong> log</a></li><li class="chapter-item expanded "><a href="../../docs/intro.html"><strong aria-hidden="true">15.</strong> intro</a></li><li class="chapter-item expanded "><a href="../../docs/magic/index.html"><strong aria-hidden="true">16.</strong> magic</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/magic/riscv.html"><strong aria-hidden="true">16.1.</strong> riscv</a></li><li class="chapter-item expanded "><a href="../../docs/magic/haskell.html"><strong aria-hidden="true">16.2.</strong> haskell</a></li><li class="chapter-item expanded "><a href="../../docs/magic/bash.html"><strong aria-hidden="true">16.3.</strong> bash</a></li><li class="chapter-item expanded "><a href="../../docs/magic/memory_ordering.html"><strong aria-hidden="true">16.4.</strong> memory_ordering</a></li><li class="chapter-item expanded "><a href="../../docs/magic/linuxIO.html"><strong aria-hidden="true">16.5.</strong> linuxIO</a></li><li class="chapter-item expanded "><a href="../../docs/magic/cicd.html"><strong aria-hidden="true">16.6.</strong> cicd</a></li><li class="chapter-item expanded "><a href="../../docs/magic/fd.html"><strong aria-hidden="true">16.7.</strong> fd</a></li><li class="chapter-item expanded "><a href="../../docs/magic/hadoop.html"><strong aria-hidden="true">16.8.</strong> hadoop</a></li><li class="chapter-item expanded "><a href="../../docs/magic/go.html"><strong aria-hidden="true">16.9.</strong> go</a></li><li class="chapter-item expanded "><a href="../../docs/magic/async.html"><strong aria-hidden="true">16.10.</strong> async</a></li><li class="chapter-item expanded "><a href="../../docs/magic/index.html"><strong aria-hidden="true">16.11.</strong> README</a></li><li class="chapter-item expanded "><a href="../../docs/magic/software_arch.html"><strong aria-hidden="true">16.12.</strong> software_arch</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs/riscv/index.html"><strong aria-hidden="true">17.</strong> riscv</a></li><li class="chapter-item expanded "><a href="../../docs/common/index.html"><strong aria-hidden="true">18.</strong> common</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/common/pgsql.html"><strong aria-hidden="true">18.1.</strong> pgsql</a></li><li class="chapter-item expanded "><a href="../../docs/common/git.html"><strong aria-hidden="true">18.2.</strong> git</a></li><li class="chapter-item expanded "><a href="../../docs/common/linux.html"><strong aria-hidden="true">18.3.</strong> linux</a></li><li class="chapter-item expanded "><a href="../../docs/common/datastructure.html"><strong aria-hidden="true">18.4.</strong> datastructure</a></li><li class="chapter-item expanded "><a href="../../docs/common/docker.html"><strong aria-hidden="true">18.5.</strong> docker</a></li><li class="chapter-item expanded "><a href="../../docs/common/analyze.html"><strong aria-hidden="true">18.6.</strong> analyze</a></li><li class="chapter-item expanded "><a href="../../docs/common/oci.html"><strong aria-hidden="true">18.7.</strong> oci</a></li><li class="chapter-item expanded "><a href="../../docs/common/unsorted.html"><strong aria-hidden="true">18.8.</strong> unsorted</a></li><li class="chapter-item expanded "><a href="../../docs/common/oauth2.html"><strong aria-hidden="true">18.9.</strong> oauth2</a></li><li class="chapter-item expanded "><a href="../../docs/common/vim.html"><strong aria-hidden="true">18.10.</strong> vim</a></li><li class="chapter-item expanded "><a href="../../docs/common/python.html"><strong aria-hidden="true">18.11.</strong> python</a></li><li class="chapter-item expanded "><a href="../../docs/common/index.html"><strong aria-hidden="true">18.12.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs/rust/index.html"><strong aria-hidden="true">19.</strong> rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/rust/mini_tokio.html"><strong aria-hidden="true">19.1.</strong> mini_tokio</a></li><li class="chapter-item expanded "><a href="../../docs/rust/wasm.html"><strong aria-hidden="true">19.2.</strong> wasm</a></li><li class="chapter-item expanded "><a href="../../docs/rust/rust_quiz.html"><strong aria-hidden="true">19.3.</strong> rust_quiz</a></li><li class="chapter-item expanded "><a href="../../docs/rust/rust.html"><strong aria-hidden="true">19.4.</strong> rust</a></li><li class="chapter-item expanded "><a href="../../docs/rust/print_into_detail.html"><strong aria-hidden="true">19.5.</strong> print_into_detail</a></li><li class="chapter-item expanded "><a href="../../docs/rust/net-piercer.html"><strong aria-hidden="true">19.6.</strong> net-piercer</a></li><li class="chapter-item expanded "><a href="../../docs/rust/rs_channel.html"><strong aria-hidden="true">19.7.</strong> rs_channel</a></li><li class="chapter-item expanded "><a href="../../docs/rust/lists.html"><strong aria-hidden="true">19.8.</strong> lists</a></li><li class="chapter-item expanded "><a href="../../docs/rust/index.html"><strong aria-hidden="true">19.9.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs/riscv/index.html"><strong aria-hidden="true">20.</strong> riscv</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/riscv/index.html"><strong aria-hidden="true">20.1.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">other</li><li class="chapter-item expanded "><a href="../../other/2023-04-12-remote-usb.html"><strong aria-hidden="true">21.</strong> 2023-04-12-remote-usb</a></li><li class="chapter-item expanded "><a href="../../other/resources.html"><strong aria-hidden="true">22.</strong> resources</a></li><li class="chapter-item expanded "><a href="../../other/i3wm.html"><strong aria-hidden="true">23.</strong> i3wm</a></li><li class="chapter-item expanded "><a href="../../other/lsm.html"><strong aria-hidden="true">24.</strong> lsm</a></li><li class="chapter-item expanded "><a href="../../other/site_update_log.html"><strong aria-hidden="true">25.</strong> site_update_log</a></li><li class="chapter-item expanded "><a href="../../other/ioclub/index.html"><strong aria-hidden="true">26.</strong> ioclub</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../other/ioclub/share_1.html"><strong aria-hidden="true">26.1.</strong> share_1</a></li><li class="chapter-item expanded "><a href="../../other/ioclub/index.html"><strong aria-hidden="true">26.2.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/index.html"><strong aria-hidden="true">27.</strong> 2021-åç«¯</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_1.html"><strong aria-hidden="true">27.1.</strong> backend_1</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_2.html"><strong aria-hidden="true">27.2.</strong> backend_2</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_3.html"><strong aria-hidden="true">27.3.</strong> backend_3</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_4.html"><strong aria-hidden="true">27.4.</strong> backend_4</a></li></ol></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/index.html"><strong aria-hidden="true">28.</strong> 2021-åç«¯</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_1.html"><strong aria-hidden="true">28.1.</strong> backend_1</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_2.html"><strong aria-hidden="true">28.2.</strong> backend_2</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_3.html"><strong aria-hidden="true">28.3.</strong> backend_3</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_4.html"><strong aria-hidden="true">28.4.</strong> backend_4</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/index.html"><strong aria-hidden="true">28.5.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">draft</li><li class="chapter-item expanded "><a href="../../draft/ç»„æˆåŸç†.html"><strong aria-hidden="true">29.</strong> ç»„æˆåŸç†</a></li><li class="chapter-item expanded "><a href="../../draft/è®¡ç®—æœºç½‘ç»œ.html"><strong aria-hidden="true">30.</strong> è®¡ç®—æœºç½‘ç»œ</a></li><li class="chapter-item expanded "><a href="../../draft/è¯‘-pkg_mng.html"><strong aria-hidden="true">31.</strong> è¯‘-pkg_mng</a></li><li class="chapter-item expanded "><a href="../../draft/DistributedSystem.html"><strong aria-hidden="true">32.</strong> DistributedSystem</a></li><li class="chapter-item expanded "><a href="../../draft/oscamp2022.html"><strong aria-hidden="true">33.</strong> oscamp2022</a></li><li class="chapter-item expanded "><a href="../../draft/compile.html"><strong aria-hidden="true">34.</strong> compile</a></li><li class="chapter-item expanded "><a href="../../draft/test.html"><strong aria-hidden="true">35.</strong> test</a></li><li class="chapter-item expanded "><a href="../../draft/ld.html"><strong aria-hidden="true">36.</strong> ld</a></li><li class="chapter-item expanded "><a href="../../draft/æ•°æ®åº“è®¾è®¡.html"><strong aria-hidden="true">37.</strong> æ•°æ®åº“è®¾è®¡</a></li><li class="chapter-item expanded "><a href="../../draft/index.html"><strong aria-hidden="true">38.</strong> README</a></li><li class="chapter-item expanded "><a href="../../draft/computer_network/index.html"><strong aria-hidden="true">39.</strong> computer_network</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../draft/computer_network/index.html"><strong aria-hidden="true">39.1.</strong> README</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Trdthg&#x27;s Self</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <blockquote>
<p>åŸæ–‡é“¾æ¥ï¼šhttps://alexis-lozano.com/hexagonal-architecture-in-rust-3/</p>
<p>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg">trdthg</a></p>
<p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg">trdthg</a></p>
<p>æœ¬æ–‡ç”± <a href="https://Rustt.org">Rustt</a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org">StudyRust</a> è£èª‰æ¨å‡º</p>
</blockquote>
<h1 id="2021-08-26---rust-å…­è¾¹å½¢æ¶æ„-3---http-api"><a class="header" href="#2021-08-26---rust-å…­è¾¹å½¢æ¶æ„-3---http-api">2021-08-26 - Rust å…­è¾¹å½¢æ¶æ„ #3 - HTTP API</a></h1>
<p>è¿™ç¯‡æ–‡ç« æ˜¯ä¸‹é¢ç³»åˆ—çš„ä¸€éƒ¨åˆ†</p>
<ul>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-1/">Hexagonal architecture in Rust #1 - Domain</a></li>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-2/">Hexagonal architecture in Rust #2 - In-memory repository</a></li>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-3/">Hexagonal architecture in Rust #3 - HTTP API</a></li>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-4/">Hexagonal architecture in Rust #4 - Refactoring</a></li>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-5/">Hexagonal architecture in Rust #5 - Remaining use-cases</a></li>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-6/">Hexagonal architecture in Rust #6 - CLI</a></li>
<li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-7/">Hexagonal architecture in Rust #7 - Long-lived repositories</a></li>
</ul>
<p>é›†ç»“å§ï¼Œæˆ‘çš„æˆ˜å‹ä»¬ã€‚ä»Šå¤©æˆ‘ä»¬å°†è¦æˆ˜æ–—ï¼è°ï¼Ÿä½ é—®æˆ‘ã€‚å®ƒæ˜¯è¿™ç‰‡åœŸåœ°ä¸Šä¸è¨€è€Œå–»çš„æ¶é­”ï¼šğŸ‘¿å€Ÿç”¨æ£€æŸ¥ï¼</p>
<p>å¥½äº†ï¼Œè®©æˆ‘ä»¬æš‚æ—¶åœæ­¢è¿™ä¸ªæŒ‡ç¯ç‹é£æ ¼çš„å°è±¡ï¼Œå·¥ä½œç­‰å¾…ç€æˆ‘ä»¬ : )</p>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬çš„åŸŸå®ä½“ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ªç”¨ä¾‹å’Œä¸€ä¸ªå­˜å‚¨åº“ã€‚</p>
<pre><code>src
â”œâ”€â”€ domain
â”‚   â”œâ”€â”€ create_pokemon.rs
â”‚   â”œâ”€â”€ entities.rs
â”‚   â””â”€â”€ mod.rs
â”œâ”€â”€ repositories
â”‚   â”œâ”€â”€ mod.rs
â”‚   â””â”€â”€ pokemon.rs
â””â”€â”€ main.rs
</code></pre>
<p>æˆ‘ä»¬æœ¬å¯ä»¥æŠŠå®ƒäº¤ç»™æˆ‘ä»¬çš„å®¢æˆ·ï¼Œä½†æ˜¯é™¤äº†è¿è¡Œæµ‹è¯•èƒ½å¤Ÿé€šè¿‡ä¹‹å¤–ï¼Œ<em>main.rs</em> æ–‡ä»¶ä»ç„¶åªè¾“å‡ºä¸€ä¸ª hello
worldã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„é¡¹ç›®è½¬æ¢æˆä¸€ä¸ªè¿”å› JSON çš„ HTTP APIã€‚</p>
<h2 id="http-api"><a class="header" href="#http-api">HTTP API</a></h2>
<p>å¦‚æœä½ æ²¡è®°é”™çš„è¯ï¼Œæˆ‘æ²¡æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¼‚æ­¥ã€‚è¿™æ˜¯ä¸ºäº†ä¸“æ³¨äºè€ƒè™‘æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ¶æ„ã€‚å¦‚æœä½ çœŸçš„æƒ³ä½¿ç”¨å¼‚æ­¥ï¼Œé‚£å°±å»å§ : ) éå¼‚æ­¥çš„ Web
æ¡†æ¶å¹¶ä¸å¤šï¼Œä½†ä»ç„¶æœ‰ä¸€äº›ã€‚æˆ‘å†æœ¬æ–‡ä¸­çš„é€‰æ‹©æ˜¯
<a href="https://github.com/tomaka/rouille">rouille</a>ï¼Œå®ƒèƒ½å¾ˆå¥½åœ°å¤„ç†æˆ‘ä»¬çš„ç”¨ä¾‹ã€‚</p>
<p>æ‰€ä»¥é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€ <em>Cargo.toml</em> å¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ä¾èµ–é¡¹ä¸­ï¼š</p>
<pre><code class="language-toml">[dependencies]
rouille = &quot;3.2.1&quot;
</code></pre>
<p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬æ‰€æœ‰çš„ API çš„æ–‡ä»¶å¤¹ã€‚è¿™é‡Œé¢åŒ…æ‹¬ <em>mod.rs</em> æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ·»åŠ åŸºæœ¬çš„è·¯ç”±é€»è¾‘ã€‚æˆ‘è¿˜å°†æ·»åŠ ä¸€ä¸ªç®€å•çš„
<em>health.rs</em> æ–‡ä»¶æ¥å¤„ç†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè·¯ç”±ï¼š</p>
<pre><code>src
â””â”€â”€ api
    â”œâ”€â”€ health.rs
    â””â”€â”€ mod.rs
</code></pre>
<p>æˆ‘ä»¬åªä¼šåœ¨ <em>api</em> æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨åˆ° <code>rouille</code>ï¼Œå¦‚æœåœ¨ä»¥åï¼Œæˆ‘ä»¬æƒ³ç”¨ <code>actix</code> ä»£æ›¿ <code>rouille</code>ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ <em>api</em>
çš„éƒ¨åˆ†å³å¯ (å…¶å®æˆ‘ä»¬è¿˜è¦æŠŠä¸€äº›å‡½æ•°è½¬æ¢ä¸ºå¼‚æ­¥çš„ï¼Œä½†æ˜¯å®ƒä¸ Web æ¡†æ¶çš„é€‰æ‹©å¹¶ä¸ç›¸å…³)</p>
<p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬å¯ç”¨çš„ APIï¼Œå½“æˆ‘ä»¬åœ¨å‘ <code>/health</code> ä¸Šå‘é€ GET è¯·æ±‚æ—¶ï¼Œå®ƒåº”è¯¥è¿”å›ä¸€äº›æ–‡æœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦åœ¨ <em>main.rs</em> ä¸­å¼•å…¥
<code>rutille</code>, å¹¶ä½¿ç”¨ä¹‹åä¼šåˆ›å»ºçš„ <code>serve</code> å‡½æ•°ï¼š</p>
<pre><code class="language-rs">mod api;
mod domain;
mod repositories;

#[macro_use]
extern crate rouille;

fn main() {
    api::serve(&quot;localhost:8000&quot;);
}
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œåœ¨ <em>api/mod.rs</em> é‡Œæ·»åŠ  <code>serve</code> å‡½æ•°</p>
<pre><code class="language-rs">mod health;

pub fn serve(url: &amp;str) {
    rouille::start_server(url, move |req| {
        router!(req,
            (GET) (/health) =&gt; {
                health::serve()
            },
            _ =&gt; {
                rouille::Response::from(Status::NotFound)
            }
        )
    });
}
</code></pre>
<p>ç°åœ¨åªéœ€è¦ç¼–è¾‘ <em>api/health.rs</em>ï¼š</p>
<pre><code class="language-rs">use rouille;

pub fn serve() -&gt; rouille::Response {
    rouille::Response::text(&quot;Gotta catch them all!&quot;)
}
</code></pre>
<p>ç°åœ¨æ‚¨åº”è¯¥å¯ä»¥ä½¿ç”¨ <code>cargo run</code> è¿è¡Œç¨‹åºå¹¶ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://localhost:8000/healthã€‚
åœ¨é‚£é‡Œï¼Œä¸€æ¡ç¾ä¸½çš„ä¿¡æ¯åœ¨ç­‰ç€ä½ ï¼š</p>
<pre><code>Gotta catch them all!
</code></pre>
<p>å¤ªæ£’äº†ï¼ä½†æˆ‘ä¹‹å‰è¯´è¿‡æˆ‘ä»¬æƒ³è¦ä¸€ä¸ª JSON APIã€‚è®©æˆ‘ä»¬å°†è¿™ä¸ª API æ¥å£è½¬æ¢ä¸ºè¿”å› JSONã€‚æˆ‘ä»¬å°†ç”¨åˆ° <code>serde</code>ã€‚<code>rouille</code>
æœ¬èº«å·²ç»ä½¿ç”¨äº†ä¸€äº› <code>serde</code> çš„ç‰¹å¾ï¼Œä½ å¯ä»¥é€šè¿‡ <code>cargo tree | grep serde</code> æŸ¥çœ‹ï¼š</p>
<pre><code>â”œâ”€â”€ serde v1.0.129
â”œâ”€â”€ serde_derive v1.0.129 (proc-macro)
â”œâ”€â”€ serde_json v1.0.66
â”‚   â””â”€â”€ serde v1.0.129
</code></pre>
<p>æ¥ç€è®©æˆ‘ä»¬åœ¨ <em>Cargo.toml</em> ä¸­æ·»åŠ ä¸ <code>rouille</code> ä½¿ç”¨çš„ç‰ˆæœ¬ç›¸åŒçš„ <code>serde</code> ä¾èµ–ã€‚</p>
<pre><code class="language-toml">[dependencies]
rouille = &quot;3.2.1&quot;
serde = { version = &quot;1.0.129&quot;, features = [&quot;derive&quot;] }
serde_json = &quot;1.0.66&quot;
</code></pre>
<p>ç°åœ¨æ¥ä¿®æ”¹ <em>api/health.rs</em>:</p>
<pre><code class="language-rs">use rouille;
use serde::Serialize;

#[derive(Serialize)]
struct Response {
    message: String,
}

pub fn serve() -&gt; rouille::Response {
    rouille::Response::json(&amp;Response {
        message: String::from(&quot;Gotta catch them all!&quot;),
    })
}
</code></pre>
<p>åœ¨æ¬¡è®¿é—®ä½ çš„æµè§ˆå™¨ ğŸ‰ :D</p>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;Gotta catch them all!&quot;
}
</code></pre>
<h2 id="è·å–è¯·æ±‚"><a class="header" href="#è·å–è¯·æ±‚">è·å–è¯·æ±‚</a></h2>
<p>æˆ‘ä»¬çš„å®¢æˆ·æƒ³è¦çš„æ˜¯èƒ½å¤Ÿåˆ›é€ ä¸€ä¸ªå®å¯æ¢¦ã€‚é¦–å…ˆï¼Œç”±äºæˆ‘ä»¬çš„ API å°†æ˜¯ RESTfulï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨çš„ HTTP è¯·æ±‚çš„ç¤ºä¾‹ï¼š</p>
<pre><code>- POST http://localhost:8000
- Headers
    Content-Type: application/json
- Body
    {
        &quot;number&quot;: 4,
        &quot;name&quot;: &quot;Charmander&quot;,
        &quot;types&quot;: [&quot;Fire&quot;]
    }
</code></pre>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ° <em>api/mod.rs</em> æ·»åŠ ä¸€ä¸ªæ–°çš„è·¯ç”±</p>
<pre><code class="language-rs">mod create_pokemon;
mod health;

pub fn serve(url: &amp;str) {
    rouille::start_server(url, move |req| {
        router!(req,
            ...
            (POST) (/) =&gt; {
                create_pokemon::serve(req)
            },
            ...
        )
    });
}
</code></pre>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ <em>api/create_pokemon.rs</em> å¹¶å†™å…¥ä¸‹é¢çš„å†…å®¹ï¼š</p>
<pre><code class="language-rs">use rouille;
use serde::Serialize;

#[derive(Serialize)]
struct Response {
    message: String,
}

pub fn serve(_req: &amp;rouille::Request) -&gt; rouille::Response {
    rouille::Response::json(&amp;Response {
        message: String::from(&quot;Pokemon created!&quot;),
    })
}
</code></pre>
<p>ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ REST å®¢æˆ·ç«¯ (postmanã€curlã€...) åœ¨ http://localhost:8000 ä¸Šå‘é€ POST è¯·æ±‚ï¼Œbody
å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚ä½ åº”è¯¥ä¼šæ”¶åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p>
<pre><code class="language-json">{
  &quot;message&quot;: &quot;Pokemon created!&quot;
}
</code></pre>
<p>ä½†æ˜¯å½“è¯·æ±‚ä¸Šä¸‹æ–‡ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ—¶ï¼ŒAPI æœ€å¥½èƒ½è¿”å› 400 çŠ¶æ€ç ã€‚è®©æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ <em>api/create_pokemon.rs</em>ï¼š</p>
<pre><code class="language-rs">use crate::api::Status;
use serde::{Deserialize, Serialize};

#[derive(Deserialize)]
struct Request {
    number: u16,
    name: String,
    types: Vec&lt;String&gt;,
}

pub fn serve(req: &amp;rouille::Request) -&gt; rouille::Response {
    match rouille::input::json_input::&lt;Request&gt;(req) {
        Ok(_) =&gt; {}
        _ =&gt; return rouille::Response::from(Status::BadRequest),
    };
    ...
}
</code></pre>
<p>ç°åœ¨ï¼Œå¦‚æœå‘ API å‘é€ä¸€ä¸ªæ²¡æœ‰ <code>name</code> å€¼çš„è¯·æ±‚ï¼Œæˆ–è€…å¦‚æœ <code>number</code> ä¸ºè´Ÿæ•°ï¼Œç”¨æˆ·å°†ä¼šæ”¶åˆ° 400 çŠ¶æ€ç ã€‚</p>
<h2 id="æ·»åŠ å­˜å‚¨åº“"><a class="header" href="#æ·»åŠ å­˜å‚¨åº“">æ·»åŠ å­˜å‚¨åº“</a></h2>
<p>å¥½çš„ï¼Œä½†æ˜¯å®é™…ä¸Šç°åœ¨å®å¯æ¢¦æ—¢æ²¡æœ‰åˆ›å»ºä¹Ÿæ²¡æœ‰æ·»åŠ åˆ°å­˜å‚¨åº“ä¸­ã€‚è€Œä¸” API ä¹Ÿä¸ä¼šè°ƒç”¨ç”¨ä¾‹ï¼é¦–å…ˆè®©æˆ‘ä»¬åœ¨ <em>main.rs</em>
ä¸­åˆ›å»ºä¸€ä¸ªå†…å­˜å­˜å‚¨åº“ï¼Œå¹¶æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™ APIï¼š</p>
<pre><code class="language-rs">use repositories::pokemon::InMemoryRepository;

fn main() {
    let repo = InMemoryRepository::new();
    api::serve(&quot;localhost:8000&quot;, &amp;mut repo);
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»ç›¸åº”åœ°ç¼–è¾‘ <em>api/mod.rs</em>ï¼š</p>
<pre><code class="language-rs">use crate::repositories::pokemon::Repository;

pub fn serve(url: &amp;str, repo: &amp;mut dyn Repository) {
    rouille::start_server(url, move |req| {
        router!(req,
            ...
            (POST) (/) =&gt; {
                create_pokemon::serve(repo, req)
            },
            ...
        )
    });
}
</code></pre>
<p>åˆ«å¿˜äº†ä¿®æ”¹ <em>api/create_pokemon.rs</em>ï¼š</p>
<pre><code class="language-rs">use crate::repositories::pokemon::Repository;

pub fn serve(_repo: &amp;mut dyn Repository, req: &amp;rouille::Request) -&gt; rouille::Response {
</code></pre>
<p>ä½ ç°åœ¨å¯ä»¥è¿è¡Œ <code>cargo run</code> äº†ï¼Œå®ƒåº”è¯¥ ...</p>
<pre><code>error[E0277]: `dyn Repository` cannot be sent between threads safely
= help: the trait `Send` is not implemented for `dyn Repository`
error[E0277]: `dyn Repository` cannot be shared between threads safely
= help: the trait `Sync` is not implemented for `dyn Repository`
error: aborting due to 2 previous errors
</code></pre>
<p>æˆ‘åªä¿ç•™äº†æœ€åŸºç¡€çš„é”™è¯¯æ—¥å¿—ã€‚æœ‰äº›ä¸œè¥¿ä¸èµ·ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸º......å€Ÿç”¨æ£€æŸ¥å™¨ã€‚æˆ‘çš„æ„æ€æ˜¯è¿™å…¶å®æ˜¯æˆ‘çš„é”™ï¼Œä½†æ˜¯å€Ÿç”¨æ£€æŸ¥å™¨åœ¨ç½©ç€æˆ‘ä»¬ : )</p>
<h2 id="æ‰“è´¥å€Ÿç”¨æ£€æŸ¥å™¨"><a class="header" href="#æ‰“è´¥å€Ÿç”¨æ£€æŸ¥å™¨">æ‰“è´¥å€Ÿç”¨æ£€æŸ¥å™¨</a></h2>
<p>åƒå¾€å¸¸ä¸€æ ·ï¼Œç¼–è¯‘å™¨å¾ˆæœ‰å¸®åŠ©ï¼šå®ƒå‘Šè¯‰æˆ‘ä»¬éœ€è¦åœ¨ <code>Repository</code> ä¸Šå®ç° <code>Send</code> å’Œ <code>Sync</code>ã€‚è®©æˆ‘ä»¬ä¿®æ”¹
<code>repositories/pokemon.rs</code> æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="language-rs">pub trait Repository: Send + Sync {
    fn insert(&amp;mut self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert;
}
</code></pre>
<p>Rust å¾ˆå®¹æ˜“ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬çš„ä¿®å¤å°†éå¸¸å¿«ï¼Œå› ä¸ºä¸€æ—¦è¿è¡Œ <code>cargo run</code>ï¼š</p>
<pre><code>error[E0621]: explicit lifetime required in the type of `repo`
 --&gt; src/api/mod.rs:7:5
  |
6 | pub fn serve(url: &amp;str, repo: &amp;mut dyn Repository) {
  |                               ------------------- help: add explicit lifetime `'static` to the type of `repo`: `&amp;'static mut (dyn Repository + 'static)`
</code></pre>
<p>ç°åœ¨ï¼Œç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬å­˜å‚¨åº“ä¸Šéœ€è¦ä¸€ä¸ª
â€œé™æ€ç”Ÿå‘½å‘¨æœŸâ€ã€‚è®©æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œè¿™é‡ŒçœŸæ­£çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¸Œæœ›å°†å­˜å‚¨åº“çš„å¼•ç”¨å‘é€åˆ°ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆçš„çº¿ç¨‹ä¸­ã€‚ç°åœ¨æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„
<code>InMemoryRepository</code>
ç»“æ„ä½“åˆ›å»ºäº†ä¸€ä¸ªå­˜å‚¨åº“ã€‚é—®é¢˜æ˜¯ï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰§è¡Œåˆ°ä¸»å‡½æ•°ç»“æŸæ—¶ï¼Œè¿™ä¸ªå­˜å‚¨åº“çš„èµ„æºå°†è¢«é‡Šæ”¾ã€‚ä½†ä¹Ÿè®¸æœ‰äº›çº¿ç¨‹ä»ç„¶ä¼šå¼•ç”¨åˆ°å®ƒã€‚æœ€ç»ˆå¯¼è‡´ç¼–è¯‘å™¨é”™è¯¯ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä»¥æŸç§æ–¹å¼å‘Šè¯‰ç¨‹åºï¼Œåªæœ‰åœ¨å¼•ç”¨ä¸å†å­˜åœ¨æ—¶å†é‡Šæ”¾æ‰æˆ‘ä»¬çš„å­˜å‚¨åº“ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºå¼•ç”¨è®¡æ•°å™¨ã€‚æˆ‘ä»¬å¾ˆå¹¸è¿ï¼ŒRust
ä¸ºæ­¤æä¾›äº†ä¸¤ç§ç±»å‹ï¼Œå…¶ä¸­ä¸€ç§æ˜¯ä¸“é—¨ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´å®‰å…¨å…±äº«è€Œåˆ›å»ºçš„ã€‚å®ƒçš„åå­—æ˜¯ <strong><code>Arc</code></strong>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ã€‚</p>
<p>å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨ <em>main.rs</em> ä¸­ç”¨ <code>Arc</code> åŒ…è£…æˆ‘ä»¬çš„å­˜å‚¨åº“ï¼š</p>
<pre><code class="language-rs">use std::sync::Arc;

fn main() {
    let repo = Arc::new(InMemoryRepository::new());
    api::serve(&quot;localhost:8000&quot;, repo);
}
</code></pre>
<p>ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç§»é™¤äº†ä¸¤ä¸ªä¸œè¥¿ï¼šä¸€ä¸ª <code>&amp;</code> å’Œä¸€ä¸ª <code>mut</code>ã€‚ <code>Arc</code>
å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå› æ­¤å®ƒçš„å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥çš„ã€‚å®ƒæŒ‡å‘ä½äºå †ä¸­çš„å­˜å‚¨åº“ã€‚å› æ­¤æˆ‘ä»¬ä¸éœ€è¦å¼•ç”¨å®ƒã€‚å…¶æ¬¡ï¼ŒArc
æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å†…éƒ¨å¯å˜æ€§ã€‚è¿™ç‚¹æˆ‘ä»¬ç¨åå†è°ˆã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬ä¿®æ”¹ <em>api/mod.rs</em>ï¼š</p>
<pre><code class="language-rs">use std::sync::Arc;

pub fn serve(url: &amp;str, repo: Arc&lt;dyn Repository&gt;) {
    rouille::start_server(url, move |req| {
        router!(req,
            ...
            (POST) (/) =&gt; {
                create_pokemon::serve(repo.clone(), req)
            },
            ...
        )
    });
}
</code></pre>
<p>æœ€åå†æ¥ä¿®æ”¹ <em>api/create_pokemon.rs</em>:</p>
<pre><code class="language-rs">use std::sync::Arc;

pub fn serve(_repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {
</code></pre>
<p>ç¼–è¯‘æˆåŠŸ \o/</p>
<h2 id="åŸŸä¹Ÿéœ€è¦çˆ±-"><a class="header" href="#åŸŸä¹Ÿéœ€è¦çˆ±-">åŸŸä¹Ÿéœ€è¦çˆ± ğŸ’“</a></h2>
<p>æˆ‘ä»¬å›´ç»•ç€ä¸€ä¸ªåŸŸè®¾è®¡äº†æˆ‘ä»¬çš„ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨ç”¨ä¾‹è·å–æ•°æ®å’Œä¸€ä¸ªå­˜å‚¨åº“ç”¨æ¥ä¿å­˜æ•°æ®ã€‚åƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åœ¨ç”¨ä¾‹ä¸­æŠŠå­˜å‚¨åº“æ›¿æ¢ä¸º <code>Arc</code>
çš„å¯å˜å¼•ç”¨ã€‚å¥½åœ¨æˆ‘ç°åœ¨åªå®ç°äº†ä¸€ä¸ªç”¨ä¾‹ : ) è®©æˆ‘ä»¬åœ¨ <em>domain/create_pokemon.rs</em> ä¸­ä¿®æ”¹å‡½æ•°ç­¾åï¼š</p>
<pre><code class="language-rs">use std::sync::Arc;

fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Response {
</code></pre>
<p>ä¸è¦å¿˜è®°æµ‹è¯•ä¸­ä¹Ÿè¦ä¿®æ”¹ï¼</p>
<pre><code class="language-rs">let repo = Arc::new(InMemoryRepository::new());
let res = execute(repo, req);
</code></pre>
<p>åœ¨è¿è¡Œ <code>cargo run</code> ä¹‹åï¼Œæˆ‘ä»¬å¶ç„¶å‘ç°äº†æˆ‘ä¹‹å‰è®¨è®ºè¿‡çš„ä¸€ä¸ªé—®é¢˜ï¼š<code>Arc</code> æ˜¯ä¸å¯å˜çš„ã€‚</p>
<pre><code>25 |         (Ok(number), Ok(name), Ok(types)) =&gt; match repo.insert(number, name, types) {
   |                                                    ^^^^ cannot borrow as mutable
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ£€æŸ¥ <em>repositories/pokemon.rs</em> ä¸­çš„ <code>Repository</code> Traitï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>insert</code>
æ–¹æ³•å¸Œæœ›å­˜å‚¨åº“æ˜¯å¯å˜çš„ï¼š</p>
<pre><code class="language-rs">pub trait Repository: Send + Sync {
    fn insert(&amp;mut self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert;
}
</code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬å°†åœ¨ <code>Repository</code> Trait å’Œæˆ‘ä»¬çš„å®ç°ä¸­åˆ é™¤è¿™ä¸ª <code>mut</code> : ) è®©æˆ‘ä»¬è¿è¡Œ <code>cargo run</code>ï¼š</p>
<pre><code class="language-rs">36 |     fn insert(&amp;self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert {
   |               ----- help: consider changing this to be a mutable reference: `&amp;mut self`
...
46 |         self.pokemons.push(Pokemon::new(number_clone, name, types));
   |         ^^^^^^^^^^^^^ `self` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable
</code></pre>
<p>å“å‘€ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯ä¸æ˜¯å¾ˆæœ‰å¸®åŠ©ã€‚æˆ‘ä»¬åˆšåˆšåˆ é™¤äº† <code>mut</code>ï¼Œç°åœ¨ç¼–è¯‘å™¨å¸Œæœ›æˆ‘ä»¬é‡æ–°æ·»åŠ å®ƒã€‚å®é™…ä¸Šè¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“å­˜å‚¨åº“åœ¨ <code>Arc</code> ä¸­ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼Œé—®é¢˜ä¸å†åœ¨äº <code>trait</code>ï¼Œè€Œåœ¨äºæˆ‘ä»¬çš„å­˜å‚¨åº“å®ç°ã€‚æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåœ¨ <code>self</code> ä¸å¯å˜çš„æƒ…å†µä¸‹æ”¹å˜å†…éƒ¨çš„ <code>pokemons</code>ã€‚
è¿™å°±æ˜¯å†…éƒ¨å¯å˜æ€§ã€‚è€Œä¸”ï¼ŒRust å†æ¬¡ä¸ºæ­¤æä¾›äº†ä¸€äº›åŸè¯­ï¼æˆ‘ä»¬å°†é€‰æ‹© <code>Mutex</code> åŸè¯­ï¼Œå› ä¸ºå®ƒæ˜¯ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®è€Œè®¾è®¡çš„ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†
<code>pokemons</code> åŒ…è£…åˆ° <code>Mutex</code> ä¸­ï¼š</p>
<pre><code class="language-rs">use std::sync::Mutex;

pub struct InMemoryRepository {
    error: bool,
    pokemons: Mutex&lt;Vec&lt;Pokemon&gt;&gt;,
}

impl InMemoryRepository {
    pub fn new() -&gt; Self {
        let pokemons: Mutex&lt;Vec&lt;Pokemon&gt;&gt; = Mutex::new(vec![]);
        Self {
            error: false,
            pokemons,
        }
    }
}
</code></pre>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»é”å®š <code>Mutex</code> æ‰èƒ½è¯»å–æˆ–å†™å…¥å®å¯æ¢¦ã€‚é”å®š <code>Mutex</code>
æ„å‘³ç€æ‰€æœ‰çº¿ç¨‹å¿…é¡»è½®æµç­‰å¾…è¯»å–æˆ–å†™å…¥å®ƒæ‰€ä¿å­˜çš„æ•°æ®ï¼Œå› æ­¤åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®ã€‚</p>
<pre><code class="language-rs">impl Repository for InMemoryRepository {
    fn insert(&amp;self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert {
        if self.error {
            return Insert::Error;
        }

        let mut lock = match self.pokemons.lock() {
            Ok(lock) =&gt; lock,
            _ =&gt; return Insert::Error,
        };

        if lock.iter().any(|pokemon| pokemon.number == number) {
            return Insert::Conflict;
        }

        let number_clone = number.clone();
        lock.push(Pokemon::new(number_clone, name, types));
        Insert::Ok(number)
    }
}
</code></pre>
<p>ç°åœ¨å®ƒç¼–è¯‘é€šè¿‡ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æµ‹è¯•ä¹Ÿä»ç„¶é€šè¿‡ï¼</p>
<h2 id="api--domain--3"><a class="header" href="#api--domain--3">API + domain =&lt; 3</a></h2>
<p>æ˜¯æ—¶å€™å°† API è¿æ¥åˆ° Domain äº†ã€‚è®©æˆ‘ä»¬ä¿®æ”¹ <code>api/create_pokemon.rs</code>ï¼š</p>
<pre><code class="language-rs">use crate::domain::create_pokemon;

pub fn serve(repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {
    let req = match rouille::input::json_input::&lt;Request&gt;(req) {
        Ok(req) =&gt; create_pokemon::Request {
            number: req.number,
            name: req.name,
            types: req.types,
        },
        _ =&gt; return rouille::Response::from(Status::BadRequest),
    };
    match create_pokemon::execute(repo, req) {
        create_pokemon::Response::Ok(number) =&gt; rouille::Response::json(&amp;Response { number }),
        create_pokemon::Response::BadRequest =&gt; rouille::Response::from(Status::BadRequest),
        create_pokemon::Response::Conflict =&gt; rouille::Response::from(Status::Conflict),
        create_pokemon::Response::Error =&gt; rouille::Response::from(Status::InternalServerError),
    }
}
</code></pre>
<p>è®°å¾—æŠŠåŸŸä¸­éœ€è¦çš„ä»£ç æ”¹ä¸º pubï¼š</p>
<pre><code class="language-rs">// domain/mod.rs
pub mod create_pokemon;

// domain/create_pokemon.rs
pub struct Request {
    pub number: u16,
    pub name: String,
    pub types: Vec&lt;String&gt;,
}

pub enum Response {
    ...
}

pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Response {
    ...
}
</code></pre>
<p>åœ¨æ¬¡è¿è¡Œ <code>cargo run</code> å¹¶å‘ <code>create_pokemon</code> è·¯ç”±å‘é€æœ‰æ•ˆè¯·æ±‚ï¼š</p>
<pre><code class="language-json">{
  &quot;number&quot;: 30
}
</code></pre>
<p>\o/</p>
<h2 id="ä¸‹ä¸€æ­¥"><a class="header" href="#ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥</a></h2>
<p>è¿™ç¯‡æ–‡ç« æ¯”é¢„æœŸçš„è¦é•¿ï¼Œå¯¹æ­¤æˆ‘æ„Ÿåˆ°æŠ±æ­‰ã€‚å¸Œæœ›å®ƒå¯¹ä½ æœ‰ç”¨ :) åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å®ç°å…¶ä»–çš„ç”¨ä¾‹ (å®¢æˆ·åŒå€¦äº†ç­‰å¾…æˆ‘è§£é‡Šä¸€åˆ‡ï¼Œå®¢æˆ·çœŸç³Ÿç³• :p)
å†ä¹‹åï¼Œæˆ‘å°†å®ç°å…¶ä»–çš„å‰ç«¯å’Œå­˜å‚¨åº“ï¼Œä»¥æ›´å¥½åœ°äº†è§£å…­è¾¹å½¢æ¶æ„çš„å¼ºå¤§åŠŸèƒ½ã€‚</p>
<p>åƒå¾€å¸¸ä¸€æ ·ï¼Œä»£ç å¯ä»¥åœ¨ <a href="https://github.com/alexislozano/pokedex/tree/article-3">github</a>
ä¸ŠæŸ¥çœ‹ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-6-CLI.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-6-CLI.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
