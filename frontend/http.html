<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202022217241.jpg"><title>HTTP 相关 | Trdthg's blog</title><meta name="description" content="我的个人网站">
    <link rel="modulepreload" href="/assets/app.30f6e763.js"><link rel="modulepreload" href="/assets/http.html.9ff7f999.js"><link rel="modulepreload" href="/assets/http.html.0aecf915.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.e8e8fc80.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Trdthg&#39;s blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习笔记 📚"><span class="title">学习笔记 📚</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习笔记 📚"><span class="title">学习笔记 📚</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/vdom" class="" aria-label="虚拟DOM"><!--[--><!--]--> 虚拟DOM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/js_advanced" class="" aria-label="js进阶"><!--[--><!--]--> js进阶 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/list" class="" aria-label="资料"><!--[--><!--]--> 资料 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/vue" class="" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/http" class="router-link-active" aria-label="HTTP相关"><!--[--><!--]--> HTTP相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/flutter" class="" aria-label="Flutter"><!--[--><!--]--> Flutter <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>python相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/python" class="" aria-label="总览"><!--[--><!--]--> 总览 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>java相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/java/java" class="" aria-label="基础知识"><!--[--><!--]--> 基础知识 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/sourceread" class="" aria-label="部分源码"><!--[--><!--]--> 部分源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/spring" class="" aria-label="Spring框架"><!--[--><!--]--> Spring框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/springboot" class="" aria-label="常用工具"><!--[--><!--]--> 常用工具 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="小玩具 🎮"><span class="title">小玩具 🎮</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="小玩具 🎮"><span class="title">小玩具 🎮</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projects/mini_vue" class="" aria-label="mini-vue"><!--[--><!--]--> mini-vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_bundle" class="" aria-label="打包器"><!--[--><!--]--> 打包器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_tokio" class="" aria-label="异步运行时"><!--[--><!--]--> 异步运行时 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Rust 🦀"><span class="title">Rust 🦀</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Rust 🦀"><span class="title">Rust 🦀</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/rust/rust" class="" aria-label="语言特性"><!--[--><!--]--> 语言特性 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/wasm" class="" aria-label="Wasm 体验"><!--[--><!--]--> Wasm 体验 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/lists" class="" aria-label="rust链表"><!--[--><!--]--> rust链表 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/go" class="" aria-label="go学习笔记"><!--[--><!--]--> go学习笔记 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="魔法 🔮"><span class="title">魔法 🔮</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="魔法 🔮"><span class="title">魔法 🔮</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/magic/haskell" class="" aria-label="haskell学习笔记"><!--[--><!--]--> haskell学习笔记 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/fd" class="" aria-label="文件描述符"><!--[--><!--]--> 文件描述符 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/linuxIO" class="" aria-label="IO 多路复用"><!--[--><!--]--> IO 多路复用 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/memory_ordering" class="" aria-label="原子操作/内存顺序"><!--[--><!--]--> 原子操作/内存顺序 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/async" class="" aria-label="协程异步思考"><!--[--><!--]--> 协程异步思考 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/software_arch" class="" aria-label="软件架构"><!--[--><!--]--> 软件架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/cicd" class="" aria-label="CI/CD"><!--[--><!--]--> CI/CD <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="IO Club ⚽"><span class="title">IO Club ⚽</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="IO Club ⚽"><span class="title">IO Club ⚽</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>分享</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/share_1" class="" aria-label="关于数据库与B+树"><!--[--><!--]--> 关于数据库与B+树 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>授课</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_1" class="" aria-label="后端1"><!--[--><!--]--> 后端1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_2" class="" aria-label="后端2"><!--[--><!--]--> 后端2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_3" class="" aria-label="后端3"><!--[--><!--]--> 后端3 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_4" class="" aria-label="后端4"><!--[--><!--]--> 后端4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他 📦"><span class="title">其他 📦</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他 📦"><span class="title">其他 📦</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/hadoop" class="" aria-label="hadoop"><!--[--><!--]--> hadoop <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/script" class="" aria-label="脚本"><!--[--><!--]--> 脚本 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/datastructure" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/vim" class="" aria-label="vim"><!--[--><!--]--> vim <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/git" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/analyze" class="" aria-label="性能监测工具"><!--[--><!--]--> 性能监测工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oci" class="" aria-label="OCI规范"><!--[--><!--]--> OCI规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oauth2" class="" aria-label="OAuth2.0"><!--[--><!--]--> OAuth2.0 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/trdthg" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="切换夜间"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习笔记 📚"><span class="title">学习笔记 📚</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习笔记 📚"><span class="title">学习笔记 📚</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/vdom" class="" aria-label="虚拟DOM"><!--[--><!--]--> 虚拟DOM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/js_advanced" class="" aria-label="js进阶"><!--[--><!--]--> js进阶 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/list" class="" aria-label="资料"><!--[--><!--]--> 资料 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/vue" class="" aria-label="vue"><!--[--><!--]--> vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/http" class="router-link-active" aria-label="HTTP相关"><!--[--><!--]--> HTTP相关 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/flutter" class="" aria-label="Flutter"><!--[--><!--]--> Flutter <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>python相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/python" class="" aria-label="总览"><!--[--><!--]--> 总览 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>java相关</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/java/java" class="" aria-label="基础知识"><!--[--><!--]--> 基础知识 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/sourceread" class="" aria-label="部分源码"><!--[--><!--]--> 部分源码 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/spring" class="" aria-label="Spring框架"><!--[--><!--]--> Spring框架 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/springboot" class="" aria-label="常用工具"><!--[--><!--]--> 常用工具 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="小玩具 🎮"><span class="title">小玩具 🎮</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="小玩具 🎮"><span class="title">小玩具 🎮</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projects/mini_vue" class="" aria-label="mini-vue"><!--[--><!--]--> mini-vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_bundle" class="" aria-label="打包器"><!--[--><!--]--> 打包器 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_tokio" class="" aria-label="异步运行时"><!--[--><!--]--> 异步运行时 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Rust 🦀"><span class="title">Rust 🦀</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Rust 🦀"><span class="title">Rust 🦀</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/rust/rust" class="" aria-label="语言特性"><!--[--><!--]--> 语言特性 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/wasm" class="" aria-label="Wasm 体验"><!--[--><!--]--> Wasm 体验 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/lists" class="" aria-label="rust链表"><!--[--><!--]--> rust链表 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/go" class="" aria-label="go学习笔记"><!--[--><!--]--> go学习笔记 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="魔法 🔮"><span class="title">魔法 🔮</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="魔法 🔮"><span class="title">魔法 🔮</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/magic/haskell" class="" aria-label="haskell学习笔记"><!--[--><!--]--> haskell学习笔记 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/fd" class="" aria-label="文件描述符"><!--[--><!--]--> 文件描述符 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/linuxIO" class="" aria-label="IO 多路复用"><!--[--><!--]--> IO 多路复用 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/memory_ordering" class="" aria-label="原子操作/内存顺序"><!--[--><!--]--> 原子操作/内存顺序 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/async" class="" aria-label="协程异步思考"><!--[--><!--]--> 协程异步思考 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/software_arch" class="" aria-label="软件架构"><!--[--><!--]--> 软件架构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/cicd" class="" aria-label="CI/CD"><!--[--><!--]--> CI/CD <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="IO Club ⚽"><span class="title">IO Club ⚽</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="IO Club ⚽"><span class="title">IO Club ⚽</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>分享</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/share_1" class="" aria-label="关于数据库与B+树"><!--[--><!--]--> 关于数据库与B+树 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>授课</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_1" class="" aria-label="后端1"><!--[--><!--]--> 后端1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_2" class="" aria-label="后端2"><!--[--><!--]--> 后端2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_3" class="" aria-label="后端3"><!--[--><!--]--> 后端3 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_4" class="" aria-label="后端4"><!--[--><!--]--> 后端4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="其他 📦"><span class="title">其他 📦</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="其他 📦"><span class="title">其他 📦</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/hadoop" class="" aria-label="hadoop"><!--[--><!--]--> hadoop <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/script" class="" aria-label="脚本"><!--[--><!--]--> 脚本 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/datastructure" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/vim" class="" aria-label="vim"><!--[--><!--]--> vim <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/git" class="" aria-label="git"><!--[--><!--]--> git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/analyze" class="" aria-label="性能监测工具"><!--[--><!--]--> 性能监测工具 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oci" class="" aria-label="OCI规范"><!--[--><!--]--> OCI规范 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oauth2" class="" aria-label="OAuth2.0"><!--[--><!--]--> OAuth2.0 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/trdthg" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">HTTP 相关 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend/http.html#压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="压缩"><!--[--><!--]--> 压缩 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend/http.html#后端gzip" class="router-link-active router-link-exact-active sidebar-item" aria-label="后端gzip"><!--[--><!--]--> 后端gzip <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#terser压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="terser压缩"><!--[--><!--]--> terser压缩 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#tree-shaking" class="router-link-active router-link-exact-active sidebar-item" aria-label="tree shaking"><!--[--><!--]--> tree shaking <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/frontend/http.html#http缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="http缓存"><!--[--><!--]--> http缓存 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend/http.html#介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#cache-control" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cache-Control"><!--[--><!--]--> Cache-Control <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#什么是指纹" class="router-link-active router-link-exact-active sidebar-item" aria-label="什么是指纹"><!--[--><!--]--> 什么是指纹 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#文件指纹生成策略" class="router-link-active router-link-exact-active sidebar-item" aria-label="文件指纹生成策略"><!--[--><!--]--> 文件指纹生成策略 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#css-contenthash" class="router-link-active router-link-exact-active sidebar-item" aria-label="css-contenthash"><!--[--><!--]--> css-contenthash <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#永久缓存-强制缓存-带指纹" class="router-link-active router-link-exact-active sidebar-item" aria-label="永久缓存 / 强制缓存(带指纹)"><!--[--><!--]--> 永久缓存 / 强制缓存(带指纹) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#协商缓存-对比缓存-不带指纹" class="router-link-active router-link-exact-active sidebar-item" aria-label="协商缓存 / 对比缓存(不带指纹)"><!--[--><!--]--> 协商缓存 / 对比缓存(不带指纹) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#etag-和-last-modified的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="Etag 和 Last-Modified的区别"><!--[--><!--]--> Etag 和 Last-Modified的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#最佳缓存策略" class="router-link-active router-link-exact-active sidebar-item" aria-label="最佳缓存策略"><!--[--><!--]--> 最佳缓存策略 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#参考资料" class="router-link-active router-link-exact-active sidebar-item" aria-label="参考资料"><!--[--><!--]--> 参考资料 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/frontend/http.html#cookie和session的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="cookie和session的区别"><!--[--><!--]--> cookie和session的区别 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend/http.html#localstorage和sessionstorage的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="localStorage和sessionStorage的区别"><!--[--><!--]--> localStorage和sessionStorage的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#cookie中的httponly的属性和作用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Cookie中的httponly的属性和作用"><!--[--><!--]--> Cookie中的httponly的属性和作用 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/frontend/http.html#package-json" class="router-link-active router-link-exact-active sidebar-item" aria-label="package.json"><!--[--><!--]--> package.json <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/frontend/http.html#dependencies-与-devdependencies-有何区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="dependencies 与 devDependencies 有何区别"><!--[--><!--]--> dependencies 与 devDependencies 有何区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/frontend/http.html#cjs、es、umd" class="router-link-active router-link-exact-active sidebar-item" aria-label="cjs、es、umd"><!--[--><!--]--> cjs、es、umd <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="http-相关" tabindex="-1"><a class="header-anchor" href="#http-相关" aria-hidden="true">#</a> HTTP 相关</h1><h2 id="压缩" tabindex="-1"><a class="header-anchor" href="#压缩" aria-hidden="true">#</a> 压缩</h2><h3 id="后端gzip" tabindex="-1"><a class="header-anchor" href="#后端gzip" aria-hidden="true">#</a> 后端gzip</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>网址 trdthg.github.io 检测结果
是否压缩是
压缩类型gzip
原始文件大小23146 字节
压缩后文件大小3454 字节
压缩率（估计值）85.08%
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="配置压缩" tabindex="-1"><a class="header-anchor" href="#配置压缩" aria-hidden="true">#</a> 配置压缩</h4><ol start="2"><li>在nginx配置压缩效果 <a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noopener noreferrer">官方doc<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://www.cnblogs.com/Renyi-Fan/p/11047490.html" target="_blank" rel="noopener noreferrer">博客<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>gzip on;  #是否开启gzip模块 on表示开启 off表示关闭
gzip_buffers 4 16k;  #设置压缩所需要的缓冲区大小
gzip_comp_level 6;  #压缩级别1-9，数字越大压缩的越好，也越占用CPU时间
gzip_min_length 100k;  #设置允许压缩的最小字节
gzip_http_version 1.1;  #设置压缩http协议的版本,默认是1.1
gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;  #设置压缩的文件类型
gzip_vary on;  #是否在http header中添加`Vary: Accept-Encoding`，辅助选择不同压缩算法产生的副本
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意一些不常用的资源，比如字体，有需要也应该加入gzip_type</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>字体类型扩展名	Content-type
.eot	application/vnd.ms-fontobject
.ttf	font/ttf
.otf	font/opentype
.woff	font/x-woff
.svg	image/svg+xml
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>怎么选择合适的压缩比</strong></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>gzip_comp_level 0: 0，94840, 63 [ms], 29%
gzip_comp_level 1: 2.43，39005, 248 [ms], 100%
gzip_comp_level 2: 2.51，37743, 273 [ms], 100%
gzip_comp_level 3; 2.57，36849, 327 [ms], 100%
gzip_comp_level 4; 2.73，34807, 370 [ms], 100%
gzip_comp_level 5; 2.80，33898, 491 [ms], 100%
gzip_comp_level 6; 2.82，33686, 604 [ms], 100%
gzip_comp_level 7; 2.82，33626, 659 [ms], 100%
gzip_comp_level 8; 2.82，33626, 698 [ms], 100%
gzip_comp_level 9; 2.82，33626, 698 [ms], 100%
- 随着压缩级别的升高，压缩比有所提高，但到了级别6后，很难再提高；
- 随着压缩级别的升高，处理时间明显变慢；
- gzip很消耗cpu的性能，高并发情况下cpu达到100%
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意事项</p><ul><li>不是压缩级别越高越好，其实gzip_comp_level 1的压缩能力已经够用了，后面级别越高，压缩的比例其实增长不大，反而很吃处理性能。</li><li>压缩一定要和静态资源缓存相结合，缓存压缩后的版本，否则每次都压缩高负载下服务器肯定吃不住。</li><li>图片/mp3这样的二进制文件,不必压缩,因为压缩率比较小, 比如100只能压缩到80字节,而且压缩也是耗费CPU资源的.</li><li>比较小的文件不必压缩,意义不存在.</li></ul><h4 id="配置压缩缓存" tabindex="-1"><a class="header-anchor" href="#配置压缩缓存" aria-hidden="true">#</a> 配置压缩缓存</h4><p>这里的缓存控制主要是针对图片,css,js等变化周期较短的静态文件; 第一次访问 以图片为例,当我们第一次访问这张图片时,服务器返回的是200,同时在响应头返回了两个键,</p><ul><li>Etag:即该文件的&#39;指纹&#39;(唯一标识)</li><li>Last-Modified:&#39;文件的修改时间&#39;; 此时浏览器,以及其他的缓存服务器就会把这张图片给缓存起来;</li></ul><p>第二次访问 再次请求这张图片时,请求头增加了两个键值,</p><ul><li>If-Modified-Since:上次发生改变的时间;</li><li>If-None-Match:上次文件本身的Etag值, 服务器根据这两个键值判断其Etag和Last-Modified,如果都没发生改变就不返回这张图片,只返回一个304的状态码,服务器接收到这个304的状态码就会自己去从缓存里面找这个被缓存的图片;</li></ul><p>可以减少服务器的带宽压力以及提升了网站访问速度;</p><div class="language-conf ext-conf line-numbers-mode"><pre class="language-conf"><code>location ~* ^.+\.(ico|gif|jpg|jpeg|png)$ {
  access_log   off;
  expires      30d;
}

location ~* ^.+\.(css|js|txt|xml|swf|wav)$ {
  access_log   off;
  expires      24h;
}

location ~* ^.+\.(html|htm)$ {
  expires      1h;
}
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="terser压缩" tabindex="-1"><a class="header-anchor" href="#terser压缩" aria-hidden="true">#</a> terser压缩</h3><ul><li>去除多余字符: 空格，换行及注释 <ul><li>多行代码压缩到一行时要注意行尾分号</li></ul></li><li>压缩变量名：变量名，函数名及属性名 <ul><li>缩短变量的命名也需要 AST 支持，不至于在作用域中造成命名冲突。</li></ul></li><li>解析程序逻辑：合并声明以及布尔值简化<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 压缩前</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">// 压缩后</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">// 压缩前</span>
<span class="token operator">!</span>b <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>c <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>d <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>e

<span class="token comment">// 压缩后</span>
<span class="token operator">!</span><span class="token punctuation">(</span>b<span class="token operator">||</span>c<span class="token operator">||</span>d<span class="token operator">||</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>解析程序逻辑: 编译预计算</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 压缩前</span>
<span class="token keyword">const</span> <span class="token constant">ONE_YEAR</span> <span class="token operator">=</span> <span class="token number">365</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span>
<span class="token comment">// 压缩后</span>
<span class="token keyword">const</span> <span class="token constant">ONE_YAAR</span> <span class="token operator">=</span> <span class="token number">31536000</span>

<span class="token comment">// 压缩前</span>
<span class="token keyword">function</span> <span class="token function">hello</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello, world&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 压缩后</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;hello, world&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li></ul><h4 id="库" tabindex="-1"><a class="header-anchor" href="#库" aria-hidden="true">#</a> 库</h4><p>uglify、terser 与 swc</p><h3 id="tree-shaking" tabindex="-1"><a class="header-anchor" href="#tree-shaking" aria-hidden="true">#</a> tree shaking</h3><ul><li>依赖于webpack静态分析，结合AST删除不必要的节点</li><li>对引入的json文件做静态分析 <ul><li>需要使用wabpack插件<code>webpack-json-access-optimizer</code></li><li>把json转换为array，并删除不必要的内容<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// strings.json</span>
<span class="token punctuation">[</span><span class="token string">&quot;Hello world!&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello world again!&quot;</span><span class="token punctuation">]</span>

<span class="token comment">// index.js</span>
<span class="token keyword">const</span> strings <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./strings.json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>strings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li><li>对css，下面用到了style-loader,会把css加到style 标签里<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">// You just have to add the sideEffects: true property to it.</span>

<span class="token punctuation">{</span>
    <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;style-loader&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">sideEffects</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li>sideeffect能直接跳过整个模块/文件 <img src="https://blog.logrocket.com/tree-shaking-json-files-webpack/" alt="Webpack - Tree Shaking"><img src="https://blog.logrocket.com/tree-shaking-json-files-webpack/" alt="JSON-CSS"></li></ul><h2 id="http缓存" tabindex="-1"><a class="header-anchor" href="#http缓存" aria-hidden="true">#</a> http缓存</h2><h3 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h3><p>更少的请求，更少的流量，更少的峰值带宽，从而节省一大笔服务器或者 CDN 的费用。</p><ul><li>减少请求次数</li><li>减少峰值带宽 控制HTTP缓存只需要使用Cache-control控制</li></ul><blockquote><p>Expires：是http1.0的规范，它的值是一个绝对时间的GMT格式的时间字符串。比如网页的Expires值是：expires:Mar, 06 Apr 2020 10:47:02 GMT。问题：到期时间是由服务端生成的，如果客户端时间跟服务器时间不一致，这就会导致缓存命中的误差。 <strong>两者同时存在的话，Cache-Control优先级高于Expires</strong></p></blockquote><h3 id="cache-control" tabindex="-1"><a class="header-anchor" href="#cache-control" aria-hidden="true">#</a> Cache-Control</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>1) max-age：用来设置资源（representations）可以被缓存多长时间，单位为秒；
2) s-maxage：和 max-age 是一样的，不过它只针对代理服务器缓存而言；**s-maxage的优先级高于max-age**

3) public：可以被所有的用户缓存，包括用户浏览器和CDN等中间代理服务器。
4) private：只能被用户浏览器缓存，而不能被代理服务器缓存；

5) no-cache：no-cache是会被缓存的，但是依然强制客户端直接向服务器发送请求, 只不过每次在向客户端（浏览器）提供响应数据时，缓存都要向服务器评估缓存响应的有效性。当服务器接收到请求，会判断资源是否变更，变更则返回新内容，否则返回304。
6) no-store：禁止一切缓存（响应真的不被缓存）。

7) max-stale：能容忍的最大过期时间。max-stale指令标示了客户端愿意接收一个已经过期了的响应。如果指定了max-stale的值，则最大容忍时间为对应的秒数。如果没有指定，那么说明浏览器愿意接收任何age的响应（age表示响应由源站生成或确认的时间与当前时间的差值）。
8) min-fresh：能够容忍的最小新鲜度。min-fresh标示了客户端不愿意接受新鲜度不多于当前的age加上min-fresh设定的时间之和的响应。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="什么是指纹" tabindex="-1"><a class="header-anchor" href="#什么是指纹" aria-hidden="true">#</a> 什么是指纹</h3><p><img src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202122340765.png" alt=""> 如图所示， 指纹就是文件的hash值</p><ul><li>main.js带有hash值，属于带指纹的永久资源(强缓存)</li><li>index.js不带hash值，虽然设置了no-chche，但是依然是协商缓存</li></ul><p>区别下面两种缓存就是依靠指纹(是不是永久缓存)，而cache-control值是决定对缓存的处理策略(存不存，用不用)</p><h3 id="文件指纹生成策略" tabindex="-1"><a class="header-anchor" href="#文件指纹生成策略" aria-hidden="true">#</a> 文件指纹生成策略</h3><h4 id="生成策略" tabindex="-1"><a class="header-anchor" href="#生成策略" aria-hidden="true">#</a> 生成策略</h4><ul><li>hash：当有文件修改，整个项目构建的hash值就会更新。 <code>filename: &#39;[name]-[hash].bundle.css&#39;</code></li><li>chunkhash：和webpack打包的chunk相关，不同的entry会生成不同的hash，一般用于js的打包。 <code>filename: &#39;[name]-[chunkhash].bundle.css&#39;</code></li><li>contenthash：根据文件内容来定义hash，文件内容不变，contenthash不变。例如css的打包，由于 修改js或html文件，但是没有修改引入的css样式时，文件不需要生成新的哈希值，所以可适用于css的打包。 <code>filename: &#39;[name]-[contenthash:8].bundle.css&#39; </code></li></ul><blockquote><p>可以在哈希末尾配置哈希值的长度 <a href="https://webpack.js.org/configuration/output/#template-strings" target="_blank" rel="noopener noreferrer">filename配置格式<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h4 id="js-chunkhash" tabindex="-1"><a class="header-anchor" href="#js-chunkhash" aria-hidden="true">#</a> js-chunkhash</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">JS</span><span class="token literal-property property">文件指纹设置</span><span class="token operator">:</span>chunkhash
module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token string">&#39;./src/index.js&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">search</span><span class="token operator">:</span> <span class="token string">&#39;./src/search.js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&#39;dist&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name][chunkhash:8].js&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="css-contenthash" tabindex="-1"><a class="header-anchor" href="#css-contenthash" aria-hidden="true">#</a> css-contenthash</h3><p>CSS文件指纹：contenthash --（ min-css-extract-plugin 可以生产css文件） 1.直接使用&#39;style-loader&#39;方式通过style标签将CSS插入到head中并没有生成单独的CSS文件，因此也不存在 使用指纹时候可以更新文件，所以这里通过&#39;min-css-extract-plugin&#39;插件将CSS提取成单独的CSS文件，并添加文件指纹。 2.安装依赖mini-css-extract-plugin -- &#39;npm i mini-css-extract-plugin -D&#39;</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mini-css-extract-plugin&#39;</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
              <span class="token string">&#39;css-loader&#39;</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;[name][contenthash:8].css&#39;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="img-hash" tabindex="-1"><a class="header-anchor" href="#img-hash" aria-hidden="true">#</a> img-hash</h4><p>图片文件指纹设置：hash 1.其中，hash对应的是文件内容的哈希值，默认为md5生成，不同于前面所说的hash值。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>export <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|svg|jpg|jpeg|gif)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span><span class="token string">&#39;file-loader&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;img/[name][hash:8].[ext]&#39;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项" aria-hidden="true">#</a> 注意事项</h4><blockquote><p>使用了md5指纹之后发现每次打包还是会发生变化？ 答：这是由于webpack的处理机制导致的，webpack每次打包会把每个模块的配置信息,如文件名、文件顺序、文件md5等信息作为配置打入js中，以便于其进行模块管理，而这部内容，每次打包都有可能发生变化，导致整个js文件名每次都会发生变化。 webpack提供了一个 manifest 的机制来剥出这个配置文件。我们需要使用 CommonsChunkPlugin 来将其剥离，同时使用 chunk-manifest-webpack-plugin 读取其 内容导出另外一个文件，防止其内容变化导致整个js文件指纹发生变化</p></blockquote><h4 id="bundle-splitting-尽量减少资源变更" tabindex="-1"><a class="header-anchor" href="#bundle-splitting-尽量减少资源变更" aria-hidden="true">#</a> Bundle Splitting：尽量减少资源变更</h4><p>把大js文件，分成小的文件，尽量减少缓存失效的范围 <img src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202130126302.png" alt=""> 此时我们可以对资源进行分层次缓存的打包方案，这是一个建议方案：</p><ul><li>webpack-runtime: 应用中的 webpack 的版本比较稳定，分离出来，保证长久的永久缓存</li><li>react/react-dom: react 的版本更新频次也较低</li><li>vendor: 常用的第三方模块打包在一起，如 lodash，- classnames 基本上每个页面都会引用到，但是它们的更新频率会更高一些。另外对低频次使用的第三方模块不要打进来</li><li>pageA: A 路由页面，当 A 页面的组件发生变更后，它的缓存将会失效</li><li>pageB: B 路由页面</li><li>echarts: 不常用且过大的第三方模块单独打包</li><li>mathjax: 不常用且过大的第三方模块单独打包</li><li>jspdf: 不常用且过大的第三方模块单独打包</li></ul><p>随着 <strong>http2</strong> 的发展，特别是多路复用，初始页面的静态资源不受资源数量的影响。因此为了更好的缓存效果以及按需加载，也有很多方案建议把<strong>所有的第三方模块进行单模块打包</strong>。</p><h3 id="永久缓存-强制缓存-带指纹" tabindex="-1"><a class="header-anchor" href="#永久缓存-强制缓存-带指纹" aria-hidden="true">#</a> 永久缓存 / 强制缓存(带指纹)</h3><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>Cache-Control: public,max-age=31536000,immutable
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>max-age表示缓存时间为1年，直接从缓存数据库(浏览器的本地缓存)拿到数据，下图中的(disk cache)就是 <img src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202122312621.png" alt=""> 而为了解决更新的问题，就需要在文件名(或者路径)中添加 hash， 版本号等动态字符，之后更改动态字符，从而达到更改引用 URL 的目的，让之前的强制缓存失效 (其实并未立即失效，只是不再使用了而已)。 在线提供的类库 (如 jquery-3.3.1.min.js, lodash.min.js 等) 均采用这个模式。</p><p><strong>默认的强制缓存时间</strong></p><p>首先要明确两个响应头代表的含义：</p><ul><li>Date: 指源服务器响应报文生成的时间，差不多与发请求的时间等价</li><li>Last-Modified: 指静态资源上次修改的时间，取决于 mtime</li></ul><p>LM factor 算法认为当请求服务器时，如果没有设置 Cache-Control，如果距离上次的 Last-Modified 越远，则生成的强制缓存时间越长。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 用公式表示如下，其中 factor 介于 0 与 1 之间：</span>
MaxAge <span class="token operator">=</span> <span class="token punctuation">(</span>Date <span class="token operator">-</span> LastModified<span class="token punctuation">)</span> <span class="token operator">*</span> factor
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202130123289.png" alt=""></p><h3 id="协商缓存-对比缓存-不带指纹" tabindex="-1"><a class="header-anchor" href="#协商缓存-对比缓存-不带指纹" aria-hidden="true">#</a> 协商缓存 / 对比缓存(不带指纹)</h3><p>第一次请求会缓存<code>数据，Etag，Last-Modified</code>，之后请求都要发出请求携带<code>If-Modified-Since, If-None-Match</code>判断缓存的时效性，如果是304,就表示缓存可用，浏览器就直接用缓存数据 <img src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202122321204.png" alt=""></p><h3 id="etag-和-last-modified的区别" tabindex="-1"><a class="header-anchor" href="#etag-和-last-modified的区别" aria-hidden="true">#</a> Etag 和 Last-Modified的区别</h3><p>Etag优先级更高，服务前先比较Etag，同时存在时会以 ETag 为准。</p><h4 id="last-modified-if-modified-since" tabindex="-1"><a class="header-anchor" href="#last-modified-if-modified-since" aria-hidden="true">#</a> Last-Modified / If-Modified-Since</h4><ol><li>精确到秒：<code>Last-Modify: Thu,31 Dec 2037 23:59:59 GMT</code></li><li>使用<code>stat ./xxx.txt</code>获取文件(夹)信息</li></ol><p>服务器响应请求时，会告诉浏览器一个告诉浏览器资源的最后修改时间：Last-Modified，浏览器之后再请求的时候，会带上一个头：If-Modified-Since，这个值就是服务器上一次给的 Last-Modified 的时间，服务器会比对资源当前最后的修改时间，如果大于If-Modified-Since，则说明资源修改过了，浏览器不能再使用缓存，否则浏览器可以继续使用缓存，并返回304状态码。</p><h4 id="etag-if-none-match" tabindex="-1"><a class="header-anchor" href="#etag-if-none-match" aria-hidden="true">#</a> Etag / If-None-Match</h4><ol><li>Etag/If-None-Match 是“实体标签”（Entity Tag）的缩写</li><li>优先级高于Last-Modified / If-Modified-Since）</li><li>优势</li></ol><ul><li>解决内容并不改变，仅仅改改变修改时间的问题</li><li>解决只就精确到秒的问题: 某些文件修改非常频繁，比如在秒以下的时间内进行修改，(比方说1s内修改了N次)，If-Modified-Since能检查到的粒度是s级的，这种修改无法判断(或者说UNIX记录MTIME只能精确到秒)；</li><li>某些服务器不能精确的得到文件的最后修改时间。</li></ul><p>服务器响应请求时，通过Etag头部告诉浏览器当前资源在服务器的唯一标识（生成规则由服务器决定），浏览器再次请求时，就会带上一个头If-None-Match，这个值就是服务器上一次给的Etag的值，服务器比对一下资源当前的Etag是否跟If-None-Match一致，不一致则说明资源修改过了，浏览器不能再使用缓存，否则浏览器可以继续使用缓存，并返回304状态码。</p><p><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#etag" target="_blank" rel="noopener noreferrer">nginx配置etag<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 由文件内容的 hash 或者 mtime/size 生成</p><h3 id="最佳缓存策略" tabindex="-1"><a class="header-anchor" href="#最佳缓存策略" aria-hidden="true">#</a> 最佳缓存策略</h3><h4 id="缓存位置" tabindex="-1"><a class="header-anchor" href="#缓存位置" aria-hidden="true">#</a> 缓存位置</h4><p>请求一个资源时，会按照优先级（Service Worker - Memory Cache - Disk Cache - Push Cache）依次查找缓存，如果命中则使用缓存，否则发起请求。</p><ol><li>service walker</li></ol><p>浏览器背后的独立线程, Service Worker 中涉及到请求拦截，所以必须使用 HTTPS 协议来保障安全</p><p>当 Service Worker 没有命中缓存的时候，我们需要去调用 fetch 函数获取数据。也就是说，如果我们没有在 Service Worker 命中缓存的话，会根据缓存查找优先级去查找数据。但是不管我们是从 Memory Cache 中还是从网络请求中获取的数据，浏览器都会显示我们是从 Service Worker 中获取的内容。</p><ol start="2"><li>200 from memory cache</li></ol><p>主要包含的是当前中页面中已经抓取到的资源, 会随着进程的释放而释放, 一旦我们关闭 Tab 页面，内存中的缓存也就被释放了。 一般来说，系统不会给内存分配较大的容量，因此内存缓存一般用于存储较小文件。同时内存缓存在有时效性要求的场景下也很有用（比如浏览器的隐私模式）。当前系统内存使用率高的话，文件优先存储进硬盘</p><blockquote><p>还保存着preload/prefetch相关的资源，preloader的相关指令已经是页面优化的常见手段之一，它可以一边解析js/css文件，一边网络请求下一个资源。 200 from prefetch cache 在 preload 或 prefetch 的资源加载时，两者也是均存储在 http cache，当资源加载完成后，如果资源是可以被缓存的，那么其被存储在 http cache 中等待后续使用；如果资源不可被缓存，那么其在被使用前均存储在 memory cache。</p></blockquote><ol start="3"><li><p>200 from disk cache 表示不访问服务器，直接从硬盘中读取缓存。与内存相比，硬盘的读取速度相对较慢，但硬盘缓存持续的时间更长，关闭进程之后，缓存的资源仍然存在。由于硬盘的容量较大，因此一般用于存储大文件。 对于大文件来说，大概率是不存储在内存中的，反之优先</p></li><li><p>Push cache</p></li></ol><p>Push Cache（推送缓存）是 HTTP/2 中的内容，当以上三种缓存都没有命中时，它才会被使用。它只在会话（Session）中存在，一旦会话结束就被释放，并且缓存时间也很短暂，在Chrome浏览器中只有5分钟左右，同时它也并非严格执行HTTP头中的缓存指令。</p><ul><li>可以推送 no-cache 和 no-store 的资源</li><li>一旦连接被关闭，Push Cache 就被释放</li><li>多个页面可以使用同一个HTTP/2的连接, 可以使用同一个Push Cache, 有的浏览器会对相同域名但不同的tab标签使用同一个HTTP连接。</li><li>Push Cache 中的缓存只能被使用一次</li><li>浏览器可以拒绝接受已经存在的资源推送</li><li>你可以给其他域名推送资源</li></ul><p>其他</p><ol><li>CDN Cache</li></ol><p>以腾讯 CDN 为例：X-Cache-Lookup:Hit From MemCache 表示命中 CDN 节点的内存；X-Cache-Lookup:Hit From Disktank 表示命中 CDN 节点的磁盘；X-Cache-Lookup:Hit From Upstream 表示没有命中 CDN。</p><ol start="2"><li>其他的不展开了, 具体参考下面的 所有缓存机制的解读</li></ol><p>IndexDB(浏览器本地存储)，Service Worker，LocalStorage，SessionStorage</p><h4 id="用户行为如何触发缓存策略" tabindex="-1"><a class="header-anchor" href="#用户行为如何触发缓存策略" aria-hidden="true">#</a> 用户行为如何触发缓存策略</h4><ol><li><p>打开网页，地址栏输入地址： 查找 disk cache 中是否有匹配。如有则使用；如没有则发送网络请求。</p></li><li><p>普通刷新 (F5)：跳过强缓存，但是会检查协商缓存(因为 TAB 并没有关闭，因此 memory cache 是可用的，会被优先使用(如果匹配的话)。其次才是 disk cache)。</p></li></ol><ul><li>当你点“刷新”按钮的时候，浏览器会在请求头里加一个“Cache-Control: maxage=0”。因为 max-age 是“生存时间”，而本地缓存里的数据至少保存了几秒钟，所以浏览器就不会使用缓存，而是向服务器发请求。服务器看到 max-age=0，也就会用一个最新生成的报文回应浏览器。</li></ul><ol start="3"><li>强制刷新 (Ctrl + F5)：浏览器不使用缓存(跳过强缓存和协商缓存)，直接从服务器加载，因此发送的请求头部均带有 Cache-control: no-cache(为了兼容，还带了 Pragma: no-cache),服务器直接返回 200 和最新内容。</li></ol><ul><li>“Cache-Control: no-cache”，含义和“max-age=0”基本一样，就看后台的服务器怎么理解，通常两者的效果是相同的。</li></ul><h4 id="最佳缓存策略-1" tabindex="-1"><a class="header-anchor" href="#最佳缓存策略-1" aria-hidden="true">#</a> 最佳缓存策略</h4><p>定义最优缓存策略</p><ul><li><p>更新频繁的应该提取为单文件：有些资源的更新比其他资源频繁。如果资源的特定部分（例如 JS 函数或一组 CSS 样式）会经常更新，应考虑将其代码作为单独的文件提供。这样，每次获取更新时，剩余内容（例如不会频繁更新的库代码）可以从缓存中获取，确保下载的内容量最少；</p></li><li><p>确保服务器配置或移除 ETag：因为 Etag 跟服务器配置有关，每台服务器的 Etag 都是不同的； 其他</p></li><li><p>确定中继缓存可以缓存哪些资源：对所有用户的响应完全相同的资源很适合由 CDN 或其他中继缓存进行缓存；</p></li><li><p>使用一致的网址：如果您在不同的网址上提供相同的内容，将会多次获取和存储该内容。注意：URL 区分大小写！</p></li><li><p>确定每个资源的最优缓存周期：不同的资源可能有不同的更新要求。审查并确定每个资源适合的 max-age；</p></li><li><p>确定网站的最佳缓存层级：对 HTML 文档组合使用包含内容特征码的资源网址以及短时间或 no-cache 的生命周期，可以控制客户端获取更新的速度；</p></li><li><p>善用 HTML5 的缓存机制：合理设计启用 LocalStorage、SessionStorage、IndexDB、SW 等存储，会给页面性能带来明显提升；</p></li><li><p>用好本地缓存</p></li></ul><p><img src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202130038910.png" alt=""></p><h3 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h3><ul><li><a href="https://www.jiqizhixin.com/articles/2020-07-24-12" target="_blank" rel="noopener noreferrer">所有缓存机制的解读<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://developer.huawei.com/consumer/cn/forum/topic/0202357360658600848" target="_blank" rel="noopener noreferrer">前端学习之浏览器缓存机制<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://cloud.tencent.com/developer/news/588770" target="_blank" rel="noopener noreferrer">资料<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://shanyue.tech/frontend-engineering/http-cache.html" target="_blank" rel="noopener noreferrer">山月<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching" target="_blank" rel="noopener noreferrer">MDN-caching<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://zhuanlan.zhihu.com/p/111190645" target="_blank" rel="noopener noreferrer">缓存策略：强缓存&amp;协商缓存<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.kancloud.cn/cyyspring/webpack/1836682" target="_blank" rel="noopener noreferrer">文件指纹<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><h2 id="cookie和session的区别" tabindex="-1"><a class="header-anchor" href="#cookie和session的区别" aria-hidden="true">#</a> cookie和session的区别</h2><p>1.使用方式</p><p>cookie机制：如果不在浏览器中设置过期事件，cookie被保存在内存中，生命周期随浏览器的关闭而结束，这种cookie简称为会话cookie。如果在浏览器中设置了cookie的过期事件，cookie会被保存在硬盘中，关闭浏览器后，cookie数据仍然存在，直到过期事件结束才消失。cookie是服务端发给客户端的特殊信息，cookie是以文本的方式保存在客户端，每次请求时都带上它</p><p>session机制：当服务器收到请求需要创建session对象时，首先会检查客户端请求中是否包含sessionid。如果有sessionid，服务器将根据该id返回对应session对象。如果客户端请求中没有sessionid，服务器会创建新的session对象，并把sessionid在本次响应中返回给客户端。通常使用cookie方式存储sessionid到客户端，在交互中浏览器按照规则将sessionid发送给服务器。如果用户禁用cookie，则要使用URL重写，可以通过response.encodeURL(url)进行实现；API对encodeURL的结束为，当浏览器支持cookie时，url不做任何处理；当浏览器不支持cookie的时候，将会重写URL将sessionid拼接到访问地址后。</p><p>2.保持状态</p><p>cookie保存在浏览器端，session保存在服务器端</p><p>3.存储的大小</p><p>单个cookie保存的数据不能超过4kb；session大小没有限制。</p><p>4.存储内容</p><p>cookie只能保存字符串类型，以文本的方式。session通过类似与Hashtable的数据结构来保存，能支持任何类型的对象（session中可含有多个对象）</p><p>5.安全性</p><p>session的安全性大于cookie。原因如下：</p><p>① sessionid存储在cookie中，若要攻破session首先要攻破cookie； ② sessionid是要有人登录，或者启动session_start才会有，所以攻破cookie也不一定能得到sessionid； ③ 第二次启动session_start后，前一次的sessionid就是失效了，session过期后，sessionid也随之失效。 ④ sessionid是加密的。</p><p>综上所述，攻击者必须在短时间内攻破加密的sessionid，这很难。</p><p>6.应用场景</p><p>cookie：（1）判断用户是否登录过网站，以便下次登录时能够实现自动登录（或者记住密码）。 （2）保存上次登录的事件等信息。 （3）保存上次查看的页面 （4）浏览计数</p><p>session：</p><p>（1）网上商城中的购物车 （2）保存用户登录信息 （3）将某些数据放入session中，供同一用户的不同页面使用 （4）防止用户非法登录</p><h3 id="localstorage和sessionstorage的区别" tabindex="-1"><a class="header-anchor" href="#localstorage和sessionstorage的区别" aria-hidden="true">#</a> localStorage和sessionStorage的区别</h3><p>1.生命周期</p><p>localStorage的生命周期是永久的，关闭页面或浏览器之后localStorage中的数据也不会消失。localStorage除非主动删除数据，否则数据永远不会消失。</p><p>sessionStorage的生命周期是仅在当前会话下有效。sessionStorage引入了一个“浏览器窗口”的概念，sessionStorage是在同源的窗口中始终存在的数据。只要这个浏览器窗口没有关闭，即使刷新页面或者进入同源另一个页面，数据依然存在。但是sessionStorage在关闭了浏览器窗口后就会被销毁。同时独立的打开同一个窗口同一个页面，sessionStorage也是不一样的。</p><p>2.存储大小</p><p>localStorage和sessionStorage的存储数据大小一般都是：5MB</p><p>3.存储位置</p><p>localStorage和sessionStorage都保存在客户端，不与服务器进行交互通信</p><p>4.存储内容类型</p><p>localStorage和sessionStorage只能存储字符串类型，对于复杂的对象可以使用ECMAScript提供的JSON对象的stringify和parse来处理</p><p>5.应用场景</p><p>localStorage：常用于长期登录（+判断用户是否已登录），适合长期保存在本地的数据</p><p>sessionStorage：敏感账号一次性登录</p><h3 id="cookie中的httponly的属性和作用" tabindex="-1"><a class="header-anchor" href="#cookie中的httponly的属性和作用" aria-hidden="true">#</a> Cookie中的httponly的属性和作用</h3><p>1.什么是HttpOnly?</p><p>如果cookie中设置了HttpOnly属性，那么，这样能有效的防止XSS攻击，窃取cookie内容，这样就增加了cookie的安全性，即便是这样，也不要将重要信息存入cookie。XSS全称Cross SiteScript，跨站脚本攻击，是Web程序中常见的漏洞，XSS属于被动式且用于客户端的攻击方式，所以容易被忽略其危害性。其原理是攻击者向有XSS漏洞的网站中输入(传入)恶意的HTML代码，当其它用户浏览该网站时，这段HTML代码会自动执行，从而达到攻击的目的。如，盗取用户Cookie、破坏页面结构、重定向到其它网站等。</p><p>2.HttpOnly的设置样例</p><p>response.setHeader(&quot;Set-Cookie&quot;, &quot;cookiename=httponlyTest;Path=/;Domain=domainvalue;Max-Age=seconds;HTTPOnly&quot;); 例如： //设置cookie</p><p>response.addHeader(&quot;Set-Cookie&quot;, &quot;uid=112; Path=/; HttpOnly&quot;)</p><p>//设置多个cookie</p><p>response.addHeader(&quot;Set-Cookie&quot;, &quot;uid=112; Path=/; HttpOnly&quot;);</p><p>response.addHeader(&quot;Set-Cookie&quot;, &quot;timeout=30; Path=/test; HttpOnly&quot;);</p><p>//设置https的cookie</p><p>response.addHeader(&quot;Set-Cookie&quot;, &quot;uid=112; Path=/; Secure; HttpOnly&quot;);</p><p>具体参数的含义再次不做阐述，设置完毕后通过js脚本是读不到该cookie的，但使用如下方式可以读取。</p><p>Cookie cookies[]=request.getCookies();</p><h2 id="package-json" tabindex="-1"><a class="header-anchor" href="#package-json" aria-hidden="true">#</a> package.json</h2><h3 id="dependencies-与-devdependencies-有何区别" tabindex="-1"><a class="header-anchor" href="#dependencies-与-devdependencies-有何区别" aria-hidden="true">#</a> dependencies 与 devDependencies 有何区别</h3><ul><li>对于业务代码，打包时依靠的是bundle的依赖分析，与dev无关</li><li>对于库而言，当库被引入时，dev中的依赖不会被下载</li></ul><h3 id="cjs、es、umd" tabindex="-1"><a class="header-anchor" href="#cjs、es、umd" aria-hidden="true">#</a> cjs、es、umd</h3><ol><li>cjs是动态加载模块，可以直接require一个变量</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>a<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><ol start="2"><li>esm是语言上的规范，因此在 Node 及 浏览器中均会支持</li></ol><ul><li>esm是静态导入，可以在编译期进行Tree shaking，减少js体积</li><li>如果要动态导入，可以<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> ms <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;https://cdn.skypack.dev/ms@latest&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ms<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/trdthg/edit/main/frontend/http.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: trdthg@outlook.com">trdthg</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.30f6e763.js" defer></script>
  </body>
</html>
