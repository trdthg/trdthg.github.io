<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.35">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202202022217241.jpg"><title>æ‹“å±• Rust ä¸­çš„ Map | Trdthg's blog</title><meta name="description" content="Welcome to Trdthg's blog">
    <link rel="modulepreload" href="/assets/app.7c129ada.js"><link rel="modulepreload" href="/assets/_2023-01-01_ æ‹“å±• Rust ä¸­çš„ Map.html.0c1c590d.js"><link rel="modulepreload" href="/assets/_2023-01-01_ æ‹“å±• Rust ä¸­çš„ Map.html.88f0fa6a.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/assets/style.e8e8fc80.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name can-hide">Trdthg&#39;s blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/rust/rust" class="" aria-label="è¯­è¨€ç‰¹æ€§"><!--[--><!--]--> è¯­è¨€ç‰¹æ€§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/print_into_detail" class="" aria-label="print å®è¯¦è§£"><!--[--><!--]--> print å®è¯¦è§£ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/rs_channel" class="" aria-label="channel æºç å‰–æ doing"><!--[--><!--]--> channel æºç å‰–æ doing <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/wasm" class="" aria-label="Wasm"><!--[--><!--]--> Wasm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/lists" class="" aria-label="Rust é“¾è¡¨"><!--[--><!--]--> Rust é“¾è¡¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/go" class="" aria-label="Go å­¦ä¹ ç¬”è®°"><!--[--><!--]--> Go å­¦ä¹ ç¬”è®° <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/magic/haskell" class="" aria-label="Haskell å­¦ä¹ ç¬”è®°"><!--[--><!--]--> Haskell å­¦ä¹ ç¬”è®° <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/fd" class="" aria-label="æ–‡ä»¶æè¿°ç¬¦"><!--[--><!--]--> æ–‡ä»¶æè¿°ç¬¦ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/linuxIO" class="" aria-label="IO å¤šè·¯å¤ç”¨"><!--[--><!--]--> IO å¤šè·¯å¤ç”¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/memory_ordering" class="" aria-label="åŸå­æ“ä½œ/å†…å­˜é¡ºåº"><!--[--><!--]--> åŸå­æ“ä½œ/å†…å­˜é¡ºåº <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/async" class="" aria-label="åç¨‹å¼‚æ­¥æ€è€ƒ"><!--[--><!--]--> åç¨‹å¼‚æ­¥æ€è€ƒ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/software_arch" class="" aria-label="è½¯ä»¶æ¶æ„"><!--[--><!--]--> è½¯ä»¶æ¶æ„ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/cicd" class="" aria-label="CI/CD"><!--[--><!--]--> CI/CD <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="æ‚æ–‡ ğŸ±"><span class="title">æ‚æ–‡ ğŸ±</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="æ‚æ–‡ ğŸ±"><span class="title">æ‚æ–‡ ğŸ±</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/articles/menu" class="" aria-label="ä¼˜è´¨æ–‡ç« èµ„æº"><!--[--><!--]--> ä¼˜è´¨æ–‡ç« èµ„æº <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/articles/i3wm" class="" aria-label="æŠ˜è…¾ i3wm"><!--[--><!--]--> æŠ˜è…¾ i3wm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/articles/tail_latency" class="" aria-label="(è¯‘) å°¾éƒ¨å»¶è¿Ÿ"><!--[--><!--]--> (è¯‘) å°¾éƒ¨å»¶è¿Ÿ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/articles/search_engine" class="" aria-label="(è¯‘) æŸ¥è¯¢å¼•æ“"><!--[--><!--]--> (è¯‘) æŸ¥è¯¢å¼•æ“ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å‰ç«¯ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/vdom" class="" aria-label="è™šæ‹Ÿ DOM"><!--[--><!--]--> è™šæ‹Ÿ DOM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/js_advanced" class="" aria-label="Js è¿›é˜¶"><!--[--><!--]--> Js è¿›é˜¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/list" class="" aria-label="èµ„æ–™"><!--[--><!--]--> èµ„æ–™ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/http" class="" aria-label="HTTP ç›¸å…³"><!--[--><!--]--> HTTP ç›¸å…³ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/flutter" class="" aria-label="Flutter"><!--[--><!--]--> Flutter <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Python ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/python" class="" aria-label="æ€»è§ˆ"><!--[--><!--]--> æ€»è§ˆ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/java/java" class="" aria-label="åŸºç¡€çŸ¥è¯†"><!--[--><!--]--> åŸºç¡€çŸ¥è¯† <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/sourceread" class="" aria-label="éƒ¨åˆ†æºç "><!--[--><!--]--> éƒ¨åˆ†æºç  <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/spring" class="" aria-label="Spring æ¡†æ¶"><!--[--><!--]--> Spring æ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/springboot" class="" aria-label="å¸¸ç”¨å·¥å…·"><!--[--><!--]--> å¸¸ç”¨å·¥å…· <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å°ç©å…· ğŸ®"><span class="title">å°ç©å…· ğŸ®</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å°ç©å…· ğŸ®"><span class="title">å°ç©å…· ğŸ®</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projects/mini_vue" class="" aria-label="Mini-Vue"><!--[--><!--]--> Mini-Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_bundle" class="" aria-label="æ‰“åŒ…å™¨"><!--[--><!--]--> æ‰“åŒ…å™¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_tokio" class="" aria-label="å¼‚æ­¥è¿è¡Œæ—¶"><!--[--><!--]--> å¼‚æ­¥è¿è¡Œæ—¶ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>åˆ†äº«</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/share_1" class="" aria-label="å…³äºæ•°æ®åº“ä¸ B+ æ ‘"><!--[--><!--]--> å…³äºæ•°æ®åº“ä¸ B+ æ ‘ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>æˆè¯¾</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_1" class="" aria-label="åç«¯ 1"><!--[--><!--]--> åç«¯ 1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_2" class="" aria-label="åç«¯ 2"><!--[--><!--]--> åç«¯ 2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_3" class="" aria-label="åç«¯ 3"><!--[--><!--]--> åç«¯ 3 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_4" class="" aria-label="åç«¯ 4"><!--[--><!--]--> åç«¯ 4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="èµ„æ–™åº“ ğŸ“¦"><span class="title">èµ„æ–™åº“ ğŸ“¦</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="èµ„æ–™åº“ ğŸ“¦"><span class="title">èµ„æ–™åº“ ğŸ“¦</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/hadoop" class="" aria-label="å¤§æ•°æ®"><!--[--><!--]--> å¤§æ•°æ® <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/script" class="" aria-label="è„šæœ¬"><!--[--><!--]--> è„šæœ¬ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/datastructure" class="" aria-label="æ•°æ®ç»“æ„"><!--[--><!--]--> æ•°æ®ç»“æ„ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/vim" class="" aria-label="Vim"><!--[--><!--]--> Vim <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/git" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/analyze" class="" aria-label="æ€§èƒ½ç›‘æµ‹å·¥å…·"><!--[--><!--]--> æ€§èƒ½ç›‘æµ‹å·¥å…· <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oci" class="" aria-label="OCI è§„èŒƒ"><!--[--><!--]--> OCI è§„èŒƒ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oauth2" class="" aria-label="OAuth2.0"><!--[--><!--]--> OAuth2.0 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/trdthg" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="åˆ‡æ¢å¤œé—´"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Rust ğŸ¦€"><span class="title">Rust ğŸ¦€</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/rust/rust" class="" aria-label="è¯­è¨€ç‰¹æ€§"><!--[--><!--]--> è¯­è¨€ç‰¹æ€§ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/print_into_detail" class="" aria-label="print å®è¯¦è§£"><!--[--><!--]--> print å®è¯¦è§£ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/rs_channel" class="" aria-label="channel æºç å‰–æ doing"><!--[--><!--]--> channel æºç å‰–æ doing <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/wasm" class="" aria-label="Wasm"><!--[--><!--]--> Wasm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/lists" class="" aria-label="Rust é“¾è¡¨"><!--[--><!--]--> Rust é“¾è¡¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/rust/go" class="" aria-label="Go å­¦ä¹ ç¬”è®°"><!--[--><!--]--> Go å­¦ä¹ ç¬”è®° <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="é­”æ³• ğŸ”®"><span class="title">é­”æ³• ğŸ”®</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/magic/haskell" class="" aria-label="Haskell å­¦ä¹ ç¬”è®°"><!--[--><!--]--> Haskell å­¦ä¹ ç¬”è®° <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/fd" class="" aria-label="æ–‡ä»¶æè¿°ç¬¦"><!--[--><!--]--> æ–‡ä»¶æè¿°ç¬¦ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/linuxIO" class="" aria-label="IO å¤šè·¯å¤ç”¨"><!--[--><!--]--> IO å¤šè·¯å¤ç”¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/memory_ordering" class="" aria-label="åŸå­æ“ä½œ/å†…å­˜é¡ºåº"><!--[--><!--]--> åŸå­æ“ä½œ/å†…å­˜é¡ºåº <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/async" class="" aria-label="åç¨‹å¼‚æ­¥æ€è€ƒ"><!--[--><!--]--> åç¨‹å¼‚æ­¥æ€è€ƒ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/software_arch" class="" aria-label="è½¯ä»¶æ¶æ„"><!--[--><!--]--> è½¯ä»¶æ¶æ„ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/magic/cicd" class="" aria-label="CI/CD"><!--[--><!--]--> CI/CD <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="æ‚æ–‡ ğŸ±"><span class="title">æ‚æ–‡ ğŸ±</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="æ‚æ–‡ ğŸ±"><span class="title">æ‚æ–‡ ğŸ±</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/articles/menu" class="" aria-label="ä¼˜è´¨æ–‡ç« èµ„æº"><!--[--><!--]--> ä¼˜è´¨æ–‡ç« èµ„æº <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/articles/i3wm" class="" aria-label="æŠ˜è…¾ i3wm"><!--[--><!--]--> æŠ˜è…¾ i3wm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/articles/tail_latency" class="" aria-label="(è¯‘) å°¾éƒ¨å»¶è¿Ÿ"><!--[--><!--]--> (è¯‘) å°¾éƒ¨å»¶è¿Ÿ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/articles/search_engine" class="" aria-label="(è¯‘) æŸ¥è¯¢å¼•æ“"><!--[--><!--]--> (è¯‘) æŸ¥è¯¢å¼•æ“ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å­¦ä¹ ç¬”è®° ğŸ“š"><span class="title">å­¦ä¹ ç¬”è®° ğŸ“š</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å‰ç«¯ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/frontend/vdom" class="" aria-label="è™šæ‹Ÿ DOM"><!--[--><!--]--> è™šæ‹Ÿ DOM <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/js_advanced" class="" aria-label="Js è¿›é˜¶"><!--[--><!--]--> Js è¿›é˜¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/list" class="" aria-label="èµ„æ–™"><!--[--><!--]--> èµ„æ–™ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/vue" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/http" class="" aria-label="HTTP ç›¸å…³"><!--[--><!--]--> HTTP ç›¸å…³ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/frontend/flutter" class="" aria-label="Flutter"><!--[--><!--]--> Flutter <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Python ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/other/python" class="" aria-label="æ€»è§ˆ"><!--[--><!--]--> æ€»è§ˆ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Java ç›¸å…³</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/java/java" class="" aria-label="åŸºç¡€çŸ¥è¯†"><!--[--><!--]--> åŸºç¡€çŸ¥è¯† <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/sourceread" class="" aria-label="éƒ¨åˆ†æºç "><!--[--><!--]--> éƒ¨åˆ†æºç  <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/spring" class="" aria-label="Spring æ¡†æ¶"><!--[--><!--]--> Spring æ¡†æ¶ <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/java/springboot" class="" aria-label="å¸¸ç”¨å·¥å…·"><!--[--><!--]--> å¸¸ç”¨å·¥å…· <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å°ç©å…· ğŸ®"><span class="title">å°ç©å…· ğŸ®</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å°ç©å…· ğŸ®"><span class="title">å°ç©å…· ğŸ®</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/projects/mini_vue" class="" aria-label="Mini-Vue"><!--[--><!--]--> Mini-Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_bundle" class="" aria-label="æ‰“åŒ…å™¨"><!--[--><!--]--> æ‰“åŒ…å™¨ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/projects/mini_tokio" class="" aria-label="å¼‚æ­¥è¿è¡Œæ—¶"><!--[--><!--]--> å¼‚æ­¥è¿è¡Œæ—¶ <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="IO Club âš½"><span class="title">IO Club âš½</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>åˆ†äº«</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/share_1" class="" aria-label="å…³äºæ•°æ®åº“ä¸ B+ æ ‘"><!--[--><!--]--> å…³äºæ•°æ®åº“ä¸ B+ æ ‘ <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>æˆè¯¾</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_1" class="" aria-label="åç«¯ 1"><!--[--><!--]--> åç«¯ 1 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_2" class="" aria-label="åç«¯ 2"><!--[--><!--]--> åç«¯ 2 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_3" class="" aria-label="åç«¯ 3"><!--[--><!--]--> åç«¯ 3 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/ioclub/backend_4" class="" aria-label="åç«¯ 4"><!--[--><!--]--> åç«¯ 4 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="èµ„æ–™åº“ ğŸ“¦"><span class="title">èµ„æ–™åº“ ğŸ“¦</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="èµ„æ–™åº“ ğŸ“¦"><span class="title">èµ„æ–™åº“ ğŸ“¦</span><span class="right arrow"></span></button><!--[--><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/other/hadoop" class="" aria-label="å¤§æ•°æ®"><!--[--><!--]--> å¤§æ•°æ® <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/script" class="" aria-label="è„šæœ¬"><!--[--><!--]--> è„šæœ¬ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/datastructure" class="" aria-label="æ•°æ®ç»“æ„"><!--[--><!--]--> æ•°æ®ç»“æ„ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/vim" class="" aria-label="Vim"><!--[--><!--]--> Vim <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/git" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/docker" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/analyze" class="" aria-label="æ€§èƒ½ç›‘æµ‹å·¥å…·"><!--[--><!--]--> æ€§èƒ½ç›‘æµ‹å·¥å…· <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oci" class="" aria-label="OCI è§„èŒƒ"><!--[--><!--]--> OCI è§„èŒƒ <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/other/oauth2" class="" aria-label="OAuth2.0"><!--[--><!--]--> OAuth2.0 <!--[--><!--]--></a></li><!--]--></ul><!--]--></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/trdthg" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">æ‹“å±• Rust ä¸­çš„ Map <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#å¼•å…¥-any-ç‰¹å¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¼•å…¥ Any ç‰¹å¾"><!--[--><!--]--> å¼•å…¥ Any ç‰¹å¾ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#å†…éƒ¨å¯å˜æ€§" class="router-link-active router-link-exact-active sidebar-item" aria-label="å†…éƒ¨å¯å˜æ€§"><!--[--><!--]--> å†…éƒ¨å¯å˜æ€§ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#åŒæ­¥æ”¯æŒ" class="router-link-active router-link-exact-active sidebar-item" aria-label="åŒæ­¥æ”¯æŒ"><!--[--><!--]--> åŒæ­¥æ”¯æŒ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#ä¸º-map-å®ç°-debug" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¸º map å®ç° Debug"><!--[--><!--]--> ä¸º map å®ç° Debug <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#ç®€åŒ–é—®é¢˜" class="router-link-active router-link-exact-active sidebar-item" aria-label="ç®€åŒ–é—®é¢˜"><!--[--><!--]--> ç®€åŒ–é—®é¢˜ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#è¶…çº§ç‰¹å¾" class="router-link-active router-link-exact-active sidebar-item" aria-label="è¶…çº§ç‰¹å¾"><!--[--><!--]--> è¶…çº§ç‰¹å¾ <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#å¯è°ƒè¯•çš„-extension-map" class="router-link-active router-link-exact-active sidebar-item" aria-label="å¯è°ƒè¯•çš„ Extension Map"><!--[--><!--]--> å¯è°ƒè¯•çš„ Extension Map <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/draft/%5B2023-01-01%5D%20%E6%8B%93%E5%B1%95%20Rust%20%E4%B8%AD%E7%9A%84%20Map.html#ä¿ç•™ç±»å‹åç§°" class="router-link-active router-link-exact-active sidebar-item" aria-label="ä¿ç•™ç±»å‹åç§°"><!--[--><!--]--> ä¿ç•™ç±»å‹åç§° <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><blockquote><p>åŸæ–‡é“¾æ¥ï¼šhttps://lucumr.pocoo.org/2022/1/6/rust-extension-map/</p><p><strong>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></strong></p><p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>æœ¬æ–‡ç”± <a href="https://Rustt.org" target="_blank" rel="noopener noreferrer">Rustt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org" target="_blank" rel="noopener noreferrer">StudyRust<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> è£èª‰æ¨å‡º</p></blockquote><h1 id="æ‹“å±•-rust-ä¸­çš„-map" tabindex="-1"><a class="header-anchor" href="#æ‹“å±•-rust-ä¸­çš„-map" aria-hidden="true">#</a> æ‹“å±• Rust ä¸­çš„ Map</h1><p>åœ¨ Rust ä¸­ï¼Œå¦‚æœä½ æƒ³ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªçµæ´»çš„ APIï¼Œä¸€èˆ¬å¯ä»¥å¼•å…¥æ³›å‹å‚æ•°ã€‚ä»¥ä¸€ä¸ª web æ¡†æ¶ä¸ºä¾‹ï¼Œå®ƒå¯èƒ½éœ€è¦ä¸€ä¸ªç¨‹åºç±»å‹ï¼Œå¹¶ä¸”éœ€è¦ä¼ é€’ç»™å¾ˆå¤šå‡½æ•°ã€‚è¿™ä¸ªç¨‹åºç±»å‹éœ€è¦èƒ½å¤Ÿä»¥é…ç½®çš„å½¢å¼è¢«å‚æ•°åŒ–ã€‚</p><h2 id="å¼•å…¥-any-ç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#å¼•å…¥-any-ç‰¹å¾" aria-hidden="true">#</a> å¼•å…¥ Any ç‰¹å¾</h2><p>ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <code>Any</code> ç‰¹å¾ã€‚å®ƒéœ€è¦ä¸€ä¸ª <code>&#39;static</code> çš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“ä½ ä¹‹åä½¿ç”¨å®ƒæ—¶ï¼Œè¿˜éœ€è¦ç”¨ <code>Box</code> è¿›è¡Œè£…ç®±ã€‚æ¯”å¦‚æˆ‘ä»¬å¯èƒ½å¯¹å®ƒè¿›è¡Œå‘ä¸‹è½¬å‹ï¼Œå³è½¬æ¢ä¸ºåŸå§‹çš„ç±»å‹ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨æŸä¸ªåœ°æ–¹ï¼ˆæ¯”å¦‚æˆ‘ä»¬çš„ Appï¼‰ä¸­å­˜å‚¨å’Œè·å–ä»»æ„ç±»å‹ã€‚</p><p>æˆ‘ä»¬æœŸæœ›çš„ API å¤§è‡´å¦‚ä¸‹ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token class-name">App</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// place in extension map</span>
app<span class="token punctuation">.</span><span class="token function">extensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Config</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">extensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Database</span> <span class="token punctuation">{</span> <span class="token punctuation">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// retrieve from extension map</span>
<span class="token keyword">let</span> config <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">extensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Config</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æˆ‘ä»¬çš„ app éœ€è¦å®¹çº³å…¶ä»–æ‹“å±•çš„ç±»å‹ï¼Œä»¥ä¾¿ä¹‹åä½¿ç”¨ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¯•è¯•æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼šå‡†å¤‡ä¸€ä¸ª <code>Extensions</code> å¯¹è±¡ï¼Œè®©å®ƒå®ç°æ’å…¥å’Œè·å–çš„æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªæ‹“å±•è¿˜ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±è‡ªåŠ¨æ’å…¥ä¸€ä¸ªé»˜è®¤çš„ï¼ˆéœ€è¦å®ç° <code>Default</code> ç‰¹å¾ï¼‰ã€‚</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Any</span><span class="token punctuation">,</span> <span class="token class-name">TypeId</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Default)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Extensions</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">TypeId</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Extensions</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">T</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_mut</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span><span class="token function">downcast_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">ensure</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_none</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>ä¸Šé¢çš„ä»£ç éå¸¸ç›´æ¥ï¼Œä½†æ˜¯å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼šé¦–å…ˆï¼Œåªæœ‰ <code>get_mut</code> èƒ½å¤Ÿè°ƒç”¨ <code>ensure</code> å»æ’å…¥é»˜è®¤å€¼ï¼Œå¦‚æœæœ‰äººç›´æ¥è°ƒç”¨ <code>get</code> å°±ä¼šå¯¼è‡´ panicã€‚ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨ä¼šè®©ä¹‹åçš„ç¼–å†™éå¸¸å›°éš¾ã€‚ä¸Šé¢çš„ map å¯¹äºè§£å†³ç»å…¸çš„é—®é¢˜ï¼ˆä¾‹å¦‚ appï¼‰æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä½ åªéœ€è¦é…ç½®ä¸€æ¬¡ï¼Œè‡ªé‚£ä¹‹å map å°±åƒæ˜¯è¢«å†»ç»“äº†ä¸€æ ·ï¼Œå› ä¸ºæœ‰å¤ªå¤šçš„å¼•ç”¨åœ¨é£æ¥åˆ†é£å»ï¼Œä»¥è‡³äºæ²¡æœ‰äººèƒ½å¤Ÿå¾—åˆ° <code>&amp;mut</code> çš„å¼•ç”¨ã€‚</p><p>how does it workï¼Ÿ</p><p>ä¸Šé¢çš„ä»£ç æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼ŒRust ä¸­çš„æ¯ä¸€ç§ç±»å‹éƒ½ä¼šæœ‰ä¸€ä¸ª type IDï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>TypeId::of::&lt;T&gt;()</code> è·å–ã€‚ä»–æ˜¯å”¯ä¸€çš„ï¼Œä½ å¯ä»¥ç”¨å®ƒè¿›è¡Œæ¯”è¾ƒï¼Œæˆ–è€…æ˜¯ä½œä¸º map çš„é”®æ¥ä½¿ç”¨ã€‚æ¯ç§ç±»å‹åªå…è®¸æœ‰ä¸€ä¸ªå€¼ã€‚æ¥ç€æˆ‘ä»¬æŠŠ T ä½œä¸º <code>dyn Any</code> å­˜å‚¨åœ¨ map é‡Œï¼Œ<code>Any</code> ç‰¹å¾å…è®¸æˆ‘ä»¬ä½¿ç”¨ <code>downcast_ref</code> å’Œ <code>downcast_mut</code> æ–¹æ³•æ‹¿åˆ°åŸå§‹ç±»å‹ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº† ensure æ–¹æ³•ç¡®ä¿è¿™é‡Œçš„ç±»å‹å­˜åœ¨ï¼Œå› æ­¤å¯ä»¥å®‰å…¨çš„ unwrapã€‚</p><h2 id="å†…éƒ¨å¯å˜æ€§" tabindex="-1"><a class="header-anchor" href="#å†…éƒ¨å¯å˜æ€§" aria-hidden="true">#</a> å†…éƒ¨å¯å˜æ€§</h2><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ª web æ¡†æ¶æˆ–è€…æ˜¯æ¨¡æ¿å¼•æ“çš„å¸¸è§æ¡ˆä¾‹ã€‚ä»¥ <a href="https://github.com/mitsuhiko/minijinja" target="_blank" rel="noopener noreferrer">MiniJinja<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼ˆæ¨¡æ¿å¼•æ“ï¼‰ä¸ºä¾‹ï¼Œå®ƒé‡Œé¢æœ‰ä¸€ä¸ª State å¯¹è±¡ï¼Œæ¯æ¬¡æ¨¡æ¿åˆå§‹åŒ–æ—¶éƒ½ä¼šåˆ›å»ºä¸€æ¬¡ï¼ŒState æ²¡æœ‰å®ç° Send å’Œ Syncï¼ŒMiniJinja åœ¨è¯„ä¼°æ—¶éœ€è¦ Stateã€‚å¦‚æœä½ æƒ³è®©ç”¨æˆ·èƒ½å¤Ÿæ”¾å…¥è‡ªå®šä¹‰çš„ State å‘¢ï¼Ÿåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å†…éƒ¨ä½¿ç”¨ <code>RefCell</code> æ¥è°ƒæ•´ä¸Šé¢çš„ç±»å‹ã€‚</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Any</span><span class="token punctuation">,</span> <span class="token class-name">TypeId</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token class-name">RefCell</span><span class="token punctuation">,</span> <span class="token class-name">RefMut</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Default)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Extensions</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">TypeId</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Extensions</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ref</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_mut</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">RefMut</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RefMut</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span><span class="token function">downcast_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">ensure</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_none</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>ä»ç”¨æˆ·çš„è§’åº¦æ¥çœ‹ï¼Œå‡ ä¹æ²¡æœ‰å˜åŒ–ã€‚ä¸»è¦çš„åŒºåˆ«æ˜¯ä½ ä¸éœ€è¦ä¸€ä¸ªå¯å˜å¼•ç”¨å°±èƒ½è°ƒç”¨ <code>get_mut</code>ï¼Œè¿™ä¸€å£®ä¸¾æ˜¯ç”± <code>RefCell</code> å®ç°çš„ï¼ŒRefcell èƒ½å¤Ÿå°†æ£€æŸ¥ç§»åŠ¨åˆ°è¿è¡Œæ—¶ã€‚å½“ä¸€ä¸ª <code>RefMut</code> è¢«ç»™å‡ºæ—¶ï¼Œå¦‚æœå·²ç»å­˜åœ¨ä»»ä½•çš„å¯å˜æˆ–ä¸å¯å˜å¼•ç”¨ï¼Œå°±ä¼šå‘ç”Ÿ panicã€‚å¯¹äºè¿™é‡Œçš„ç”¨æˆ·æ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ç¡®ä¿åªæœ‰ä¸€ä¸ªå¯å˜çš„å¼•ç”¨åœ¨ä½¿ç”¨ã€‚ç‰¹åˆ«æ£’çš„æ˜¯ï¼ŒRef å’Œ RefMut ç±»å‹æä¾›äº†ä¸€ä¸ªé™æ€çš„ map æ–¹æ³•ï¼Œè®©ä½ å¯ä»¥è½»æ¾æ´¾ç”Ÿå‡ºå¦ä¸€ä¸ª Ref æˆ– RefMutï¼Œå¹¶ä¿æŒåŸæ¥çš„å¼•ç”¨ï¼Œä½†å¯¹å€¼è¿›è¡Œè½¬æ¢ã€‚</p><h2 id="åŒæ­¥æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#åŒæ­¥æ”¯æŒ" aria-hidden="true">#</a> åŒæ­¥æ”¯æŒ</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ç”¨ Send å’Œ Sync æ¥å®ç°å’Œä¸Šé¢ç›¸åŒçš„æ•ˆæœå‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé”ã€‚å¯æƒœçš„æ˜¯æ ‡å‡†åº“æä¾›çš„ Mutex å’Œ RwLock ä¸èƒ½è®©ä½ åœ¨æ‹¿åˆ°é”çš„åŒæ—¶ mapï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>parking_lot</code> æ›¿ä»£ï¼Œå®ƒå®ç°äº†å¿…è¦çš„ä¸€äº›æ–¹æ³•ã€‚</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">parking_lot<span class="token punctuation">::</span></span><span class="token punctuation">{</span>
    <span class="token class-name">MappedRwLockReadGuard</span><span class="token punctuation">,</span>
    <span class="token class-name">MappedRwLockWriteGuard</span><span class="token punctuation">,</span>
    <span class="token class-name">RwLock</span><span class="token punctuation">,</span>
    <span class="token class-name">RwLockReadGuard</span><span class="token punctuation">,</span>
    <span class="token class-name">RwLockWriteGuard</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Any</span><span class="token punctuation">,</span> <span class="token class-name">TypeId</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Default)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Extensions</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">TypeId</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Extensions</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MappedRwLockReadGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RwLockReadGuard</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_mut</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">MappedRwLockWriteGuard</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RwLockWriteGuard</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span><span class="token function">downcast_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">ensure</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_none</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>æ³¨æ„ï¼šç”±äº Any å¹¶æ²¡æœ‰å®ç° Debugï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾ä¸ºæˆ‘ä»¬çš„ map å®ç° Debug ç‰¹å¾ï¼Œä¸€äº›ç®€å•çš„æ”¹å˜å¹¶ä¸èƒ½è§£å†³ç›®å‰çš„é—®é¢˜ã€‚ä¸‹åŠéƒ¨åˆ†æˆ‘ä»¬å°†ä»‹ç» <code>as-any</code> æ¨¡å¼</p><p>æˆ‘ä»¬é¢ä¸´çš„æŒ‘æˆ˜æ˜¯ï¼Œåœ¨ Rust é‡Œï¼Œä½ ä¸èƒ½ä½¿ç”¨ <code>Box&lt;Any + Debug&gt;</code>ï¼Œç„¶è€Œè¿˜æ˜¯æœ‰ä¸€äº›æ–¹æ³•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="ä¸º-map-å®ç°-debug" tabindex="-1"><a class="header-anchor" href="#ä¸º-map-å®ç°-debug" aria-hidden="true">#</a> ä¸º map å®ç° Debug</h2><h3 id="ç®€åŒ–é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#ç®€åŒ–é—®é¢˜" aria-hidden="true">#</a> ç®€åŒ–é—®é¢˜</h3><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¯¹ <code>Box&lt;dyn Any&gt;</code> åšä¸€ä¸ªåŒ…è£…ï¼Œå¹¶è®© Wrapper å®ç° Debugã€‚</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">AnyBox</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å¦‚æœä½ å°è¯•ç¼–è¯‘ï¼Œç¼–è¯‘å™¨åº”è¯¥ä¼šå¾ˆä¸é«˜å…´çš„æŠ›å‡ºé”™è¯¯ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>error<span class="token punctuation">[</span><span class="token constant">E0225</span><span class="token punctuation">]</span><span class="token punctuation">:</span> only auto traits can be used <span class="token keyword">as</span> additional traits <span class="token keyword">in</span> a <span class="token keyword">trait</span> <span class="token type-definition class-name">object</span>
 <span class="token operator">-</span><span class="token punctuation">-&gt;</span> src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token number">29</span>
  <span class="token operator">|</span>
<span class="token number">9</span> <span class="token operator">|</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">AnyBox</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">|</span>                       <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>   <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span> additional non<span class="token operator">-</span>auto <span class="token keyword">trait</span>
  <span class="token operator">|</span>                       <span class="token operator">|</span>
  <span class="token operator">|</span>                       first non<span class="token operator">-</span>auto <span class="token keyword">trait</span>
  <span class="token operator">|</span>
  <span class="token operator">=</span> help<span class="token punctuation">:</span> consider creating a new <span class="token keyword">trait</span> <span class="token type-definition class-name">with</span> all of these <span class="token keyword">as</span> supertraits and
    using that <span class="token keyword">trait</span> <span class="token type-definition class-name">here</span> instead<span class="token punctuation">:</span> `<span class="token keyword">trait</span> <span class="token type-definition class-name">NewTrait</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>`
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="è¶…çº§ç‰¹å¾" tabindex="-1"><a class="header-anchor" href="#è¶…çº§ç‰¹å¾" aria-hidden="true">#</a> è¶…çº§ç‰¹å¾</h3><p>å¹¸è¿çš„æ˜¯ï¼Œç¼–è¯‘å™¨å†æ¬¡ä¸ºæˆ‘ä»¬æŒ‡æ˜äº†è§£å†³ä¹‹é“ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªçˆ¶ç‰¹å¾ï¼Œå¹¶åˆ©ç”¨ç‰¹å¾çº¦æŸã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¸ºæ‰€æœ‰å®ç°äº† Any å’Œ Debug çš„ç±»å‹å®ç°æˆ‘ä»¬çš„è¶…çº§ç‰¹å¾ã€‚å°±åƒä¸‹é¢è¿™æ ·ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">AnyBox</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">DebugAny</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">trait</span> <span class="token type-definition class-name">DebugAny</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span> <span class="token class-name">DebugAny</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä½ å¯ä»¥æƒ³è¿™æ ·æ„å»ºä¸€ä¸ª Boxï¼Œä½†æ˜¯çœŸæ­£ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„æ˜¯å‘ä¸‹è½¬å‹</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> any_box <span class="token operator">=</span> <span class="token class-name">AnyBox</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">42i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>any_box<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç¼–è¯‘å™¨ä¼šå‘Šè¯‰æˆ‘ä»¬ï¼ŒAnyBox ä¸­çš„å€¼å¹¶æ²¡æœ‰ <code>downcast_ref</code> æ–¹æ³•</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code>error<span class="token punctuation">[</span><span class="token constant">E0599</span><span class="token punctuation">]</span><span class="token punctuation">:</span> no method named `downcast_ref` found <span class="token keyword">for</span> <span class="token keyword">struct</span>
  `<span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">dyn</span> <span class="token class-name">DebugAny</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>` <span class="token keyword">in</span> the current scope
  <span class="token operator">-</span><span class="token punctuation">-&gt;</span> src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">:</span><span class="token number">20</span>
   <span class="token operator">|</span>
<span class="token number">15</span> <span class="token operator">|</span>     <span class="token macro property">dbg!</span><span class="token punctuation">(</span>any_box<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token operator">|</span>                    <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span> method not found <span class="token keyword">in</span> `<span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">dyn</span> <span class="token class-name">DebugAny</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token punctuation">)</span><span class="token operator">&gt;</span>`
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŸå› æ˜¯ <code>Box&lt;dyn DebugAny&gt;</code> å¹¶ä¸æ˜¯ <code>Box&lt;dyn Any&gt;</code>ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½é‚£é‡Œå¾—åˆ° Any ç‰¹å¾æ‹¥æœ‰çš„æ–¹æ³•ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯ <strong>&quot;as any&quot;</strong> æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„ DebugAny ç‰¹å¾ä¸Šå®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œå°†å…¶å‘ä¸Šè½¬æ¢ä¸ºä¸€ä¸ª Anyã€‚çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">trait</span> <span class="token type-definition class-name">DebugAny</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span> <span class="token class-name">DebugAny</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token punctuation">{</span> <span class="token keyword">self</span> <span class="token punctuation">}</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token punctuation">{</span> <span class="token keyword">self</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ç°åœ¨è™½ç„¶æˆ‘ä»¬ä¾ç„¶ä¸èƒ½åœ¨ DebugAny ä¸Šè°ƒç”¨ <code>downcast_ref</code>ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ‹¿èµ°å®ƒçš„å€¼ï¼Œå¹¶è°ƒç”¨ <code>as_any</code> å¾—åˆ°ä¸€ä¸ª <code>&amp;dyn Any</code>ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> any_box <span class="token operator">=</span> <span class="token class-name">AnyBox</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">42i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>any_box<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">as_any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>any_box<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä½†æ˜¯å½“æˆ‘ä»¬è¿è¡Œåï¼Œå´å¾—åˆ°äº†ä¸€ä¸ª Noneã€‚å‘ç”Ÿä»€ä¹ˆäº‹äº†ï¼Ÿï¼Ÿï¼Ÿ</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">[</span>src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">]</span> any_box<span class="token number">.0</span><span class="token punctuation">.</span><span class="token function">as_any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token class-name">None</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>è¿™ä¸ªè°œé¢˜çš„ç­”æ¡ˆä¸æ–¹æ³•è§£æçš„å·¥ä½œæ–¹å¼å’Œç©ºç™½å®ç°æœ‰å…³ã€‚å½“æˆ‘ä»¬åœ¨ <code>Box&lt;dyn DebugAny&gt;</code> ä¸Šè°ƒç”¨ <code>as_any</code> æ—¶ï¼ŒBox å¹¶æ²¡æœ‰å‘ç”Ÿè‡ªåŠ¨è§£å¼•ç”¨ï¼Œäº‹å®ä¸Šè°ƒç”¨çš„æ˜¯ <code>Box&lt;dyn DebugAny&gt;</code> çš„ as_anyï¼Œå› ä¸º Box ç°åœ¨ä¹Ÿå®ç°äº†æˆ‘ä»¬çš„ DebugAnyã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ç©¿è¿‡è¿™ä¸ª Box å‘¢ï¼Ÿé€šè¿‡æ‰‹åŠ¨è§£å¼•ç”¨ã€‚</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> any_box <span class="token operator">=</span> <span class="token class-name">AnyBox</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">42i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>any_box<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>any_box<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>è¿™æ ·å°±æ˜¯æˆ‘ä»¬é¢„æœŸçš„å€¼äº†</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">[</span>src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token operator">*</span>any_box<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>
    <span class="token number">42</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token punctuation">[</span>src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>any_box <span class="token operator">=</span> <span class="token class-name">AnyBox</span><span class="token punctuation">(</span>
    <span class="token number">42</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="å¯è°ƒè¯•çš„-extension-map" tabindex="-1"><a class="header-anchor" href="#å¯è°ƒè¯•çš„-extension-map" aria-hidden="true">#</a> å¯è°ƒè¯•çš„ Extension Map</h2><p>æœ‰äº†ä¸Šé¢çš„ç»éªŒï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ‹¿å‡ºä¹‹å‰çš„éåŒæ­¥ mapï¼Œç¨åŠ æ”¹é€ å°±èƒ½ä¸ºå…¶å®ç° Debugã€‚</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Any</span><span class="token punctuation">,</span> <span class="token class-name">TypeId</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token class-name">RefCell</span><span class="token punctuation">,</span> <span class="token class-name">RefMut</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span><span class="token punctuation">;</span>

<span class="token keyword">trait</span> <span class="token type-definition class-name">DebugAny</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">dyn</span> <span class="token class-name">Any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Any</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span> <span class="token class-name">DebugAny</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token punctuation">{</span> <span class="token keyword">self</span> <span class="token punctuation">}</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">as_any_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">dyn</span> <span class="token class-name">Any</span> <span class="token punctuation">{</span> <span class="token keyword">self</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Default, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Extensions</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">TypeId</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">DebugAny</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Extensions</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>map
            <span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Ref</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Ref</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downcast_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_mut</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">RefMut</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">ensure</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RefMut</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>m<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            m<span class="token punctuation">.</span><span class="token function">get_mut</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>b<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_any_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">downcast_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">ensure</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Default</span> <span class="token operator">+</span> <span class="token class-name">Debug</span> <span class="token operator">+</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_none</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>å‘ map é‡Œé¢æ·»åŠ ç‚¹ä¸œè¥¿ï¼Œæ‰“å°ä¸€ä¸‹ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">[</span>src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">63</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>extensions <span class="token operator">=</span> <span class="token class-name">Extensions</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token class-name">RefCell</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token class-name">TypeId</span> <span class="token punctuation">{</span>
                t<span class="token punctuation">:</span> <span class="token number">13431306602944299956</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åœ¨ map ä¸­æ”¾ç½®äº†ä¸€ä¸ª 32 ä½çš„æ•´æ•° 42ï¼Œå®ƒæ‰“å°å‡ºäº†ä½œä¸ºé”®çš„ TypeIdï¼Œå’Œä½œä¸ºå€¼çš„ 42ã€‚</p><h2 id="ä¿ç•™ç±»å‹åç§°" tabindex="-1"><a class="header-anchor" href="#ä¿ç•™ç±»å‹åç§°" aria-hidden="true">#</a> ä¿ç•™ç±»å‹åç§°</h2><p>å¦‚æœä½ æƒ³ä¿ç•™åŸæ¥çš„ç±»å‹åç§°ï¼Œè€Œä¸ä»…ä»…æ˜¯ç±»å‹çš„ IDï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»å‹ä½œä¸º map çš„é”®ã€‚é€šè¿‡å¯¹ TypeId å’Œ TypeName åšä¸€æ¬¡ç®€å•çš„åŒ…è£…å°±èƒ½è½»æ¾å®ç°ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>any<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">TypeId</span><span class="token punctuation">,</span> type_name<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>hash<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Hash</span><span class="token punctuation">,</span> <span class="token class-name">Hasher</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Debug</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">TypeKey</span><span class="token punctuation">(</span><span class="token class-name">TypeId</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;static</span> <span class="token keyword">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">impl</span> <span class="token class-name">TypeKey</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">of</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token lifetime-annotation symbol">&#39;static</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">TypeKey</span> <span class="token punctuation">{</span>
        <span class="token class-name">TypeKey</span><span class="token punctuation">(</span><span class="token class-name">TypeId</span><span class="token punctuation">::</span><span class="token function">of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">type_name</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Hash</span> <span class="token keyword">for</span> <span class="token class-name">TypeKey</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">hash</span><span class="token operator">&lt;</span><span class="token class-name">H</span><span class="token punctuation">:</span> <span class="token class-name">Hasher</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> state<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">H</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">PartialEq</span> <span class="token keyword">for</span> <span class="token class-name">TypeKey</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">eq</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> other<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">Self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span> <span class="token operator">==</span> other<span class="token number">.0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Eq</span> <span class="token keyword">for</span> <span class="token class-name">TypeKey</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Debug</span> <span class="token keyword">for</span> <span class="token class-name">TypeKey</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span>
        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>æ¥ç€ç”¨å®ƒæ›¿æ¢æ‰åŸæ¥çš„é”®ï¼Œè°ƒè¯•ä¸€ä¸‹ï¼š</p><div class="language-rust ext-rs line-numbers-mode"><pre class="language-rust"><code><span class="token punctuation">[</span>src<span class="token operator">/</span>main<span class="token punctuation">.</span>rs<span class="token punctuation">:</span><span class="token number">90</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span>extensions <span class="token operator">=</span> <span class="token class-name">Extensions</span> <span class="token punctuation">{</span>
    map<span class="token punctuation">:</span> <span class="token class-name">RefCell</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token keyword">i32</span><span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
            <span class="token namespace">alloc<span class="token punctuation">::</span>vec<span class="token punctuation">::</span></span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>æ³¨æ„ï¼Œæˆ‘åœ¨ map ä¸­é¢å¤–æ’å…¥äº†ä¸€ä¸ª <code>Vec&lt;i32&gt;</code>ï¼Œä»¥è·å¾—æ›´æ˜æ˜¾çš„è¾“å‡ºã€‚</p><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/trdthg/edit/main/draft/[2023-01-01] æ‹“å±• Rust ä¸­çš„ Map.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.7c129ada.js" defer></script>
  </body>
</html>
