"use strict";(self.webpackChunktrdthg_github_io=self.webpackChunktrdthg_github_io||[]).push([[3942],{3905:(e,n,t)=>{t.d(n,{Zo:()=>s,kt:()=>d});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),p=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},s=function(e){var n=p(e.components);return a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),m=p(t),d=r,g=m["".concat(c,".").concat(d)]||m[d]||u[d]||o;return t?a.createElement(g,l(l({ref:n},s),{},{components:t})):a.createElement(g,l({ref:n},s))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,l=new Array(o);l[0]=m;var i={};for(var c in n)hasOwnProperty.call(n,c)&&(i[c]=n[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},4770:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=t(7462),r=(t(7294),t(3905));const o={},l="Spring",i={unversionedId:"java/spring",id:"java/spring",title:"Spring",description:"IOC",source:"@site/docs/java/spring.md",sourceDirName:"java",slug:"/java/spring",permalink:"/docs/java/spring",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u96c6\u5408\u6846\u67b6",permalink:"/docs/java/sourceread"},next:{title:"SprintBoot",permalink:"/docs/java/springboot"}},c={},p=[{value:"IOC",id:"ioc",level:2},{value:"\u83b7\u53d6\u5b9e\u4f8b",id:"\u83b7\u53d6\u5b9e\u4f8b",level:3},{value:"Bean \u914d\u7f6e",id:"bean-\u914d\u7f6e",level:3},{value:"AOP",id:"aop",level:2},{value:"\u624b\u52a8\u53cd\u5c04\u5b9e\u73b0",id:"\u624b\u52a8\u53cd\u5c04\u5b9e\u73b0",level:3},{value:"@Aspect \u5b9e\u73b0",id:"aspect-\u5b9e\u73b0",level:3},{value:"spring-mvc",id:"spring-mvc",level:2},{value:"Mybatis",id:"mybatis",level:2}],s={toc:p};function u(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"spring"},"Spring"),(0,r.kt)("h2",{id:"ioc"},"IOC"),(0,r.kt)("h3",{id:"\u83b7\u53d6\u5b9e\u4f8b"},"\u83b7\u53d6\u5b9e\u4f8b"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'ApplicationContext applicationContext = new ClassPathXmlApplicationContext("spring.xml");\n// 1. \u901a\u8fc7 id \u83b7\u53d6\u5b9e\u4f8b\nStudent student = (Student) applicationContext.getBean("student");\n// 2. \u901a\u8fc7\u8fd0\u884c\u65f6\u7c7b\u83b7\u53d6\u5b9e\u4f8b (\u7f3a\u70b9\uff1axml \u4e2d\u4e00\u79cd\u6570\u636e\u7c7b\u578b\u53ea\u80fd\u6709\u4e00\u4e2a\u5b9e\u4f8b)\n//Student student = (Student) applicationContext.getBean(Student.class);\nSystem.out.println(student);\n')),(0,r.kt)("h3",{id:"bean-\u914d\u7f6e"},"Bean \u914d\u7f6e"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u65e0\u53c2\u6784\u9020")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'<bean id="student" class="com.southwind.entity.Student"\n    scope="prototype" parent="student" autowire="byType" depends-on="a2">\n    <property name="id" value="1"/>\n    <property name="name" value="\u5f20\u4e09"/>\n    <property name="age" value="12"/>\n    <property name="address" ref="address"/>\n</bean>\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"scope: \u9ed8\u8ba4\u4e3a singleton\uff0c\u5355\u4f8b\u6a21\u5f0f\uff0cprototype \u4e3a\u5de5\u5382\u6a21\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"panent \u53c2\u6570\uff1a\u4e0d\u540c\u5bf9\u8c61\u53ea\u8981\u5c5e\u6027\u76f8\u540c\u5c31\u80fd\u7ee7\u627f"),(0,r.kt)("li",{parentName:"ul"},"autowire: byName \u6839\u636e id=(address) \u5bfb\u627e\uff0c\u6839\u636e class=(Student) \u5bfb\u627e"),(0,r.kt)("li",{parentName:"ul"},"depend-on: \u89c4\u5b9a bean \u521b\u5efa\u987a\u5e8f")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u6709\u53c2\u6784\u9020")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'<bean id="student3" class="com.southwind.entity.Student">\n    <constructor-arg name="id" value="3"/>\n    <constructor-arg name="name" value="\u674e\u56db"/>\n    \x3c!--\u53ef\u4ee5\u7528 index \u4ee3\u66ff name\uff0c\u4f46\u662f\u4e5f\u8981\u6309\u987a\u5e8f\u5199--\x3e\n    <constructor-arg name="age" value="14"/>\n    \x3c!--<constructor-arg index="2" value="14"/>--\x3e\n    <constructor-arg name="address" ref="address"/>\n    <constructor-arg name="addresses">\n        <list>\n            <ref bean="address"/>\n            <ref bean="address2"/>\n        </list>\n    </constructor-arg>\n</bean>\n')),(0,r.kt)("p",null,"::: tip \u63d0\u793a spring \u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u65e0\u53c2\u6784\u9020\u521b\u5efa\u5bf9\u8c61\uff0cbean \u5fc5\u987b\u6709\u65e0\u53c2\u6784\u9020 :::\nClassPathXmlApplicationContext \u7c7b\u5b9e\u73b0\u4e86 ApplicationContext \u63a5\u53e3\uff0c\u6709 getBean \u65b9\u6cd5\n\u4e0b\u9762\u662f\u4e00\u4e2a ClassPathXmlApplicationContext \u7684\u7b80\u5355\u5b9e\u73b0"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class ClassPathXmlApplicationContext implements ApplicationContext {\n\n    private Map<String, Object> ioc = new HashMap<>();\n\n    public ClassPathXmlApplicationContext(String path) {\n        try {\n            // xml \u6587\u4ef6\u89e3\u6790\n            SAXReader saxReader = new SAXReader();\n            Document document = saxReader.read("./src/main/resources/" + path);\n            System.out.println(document);\n            Element root = document.getRootElement();\n            Iterator<?> iterator = root.elementIterator();\n            // \u904d\u5386\u6240\u6709\u8282\u70b9\n            while (iterator.hasNext()) {\n                Element element = (Element) iterator.next();\n                String id = element.attributeValue("id");\n                String className = element.attributeValue("class");\n                // \u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u5bf9\u8c61\n                Class<?> clazz = Class.forName(className);\n                // \u83b7\u53d6\u65e0\u53c2\u6784\u9020\u51fd\u6570\n                Constructor<?> constructor = clazz.getConstructor();\n                Object object = constructor.newInstance();\n                Iterator<Element> beanIterator = element.elementIterator();\n                while (beanIterator.hasNext()) {\n                    Element property = beanIterator.next();\n                    String name = property.attributeValue("name");\n                    String value = property.attributeValue("value");\n                    String ref = property.attributeValue("ref");\n                    // \u83b7\u53d6 set \u65b9\u6cd5\n                    // 1. \u62fc\u63a5\u65b9\u6cd5\u540d\n                    String methodName = "set" + name.substring(0, 1).toUpperCase() + name.substring(1);\n                    // 2. \u83b7\u53d6\u5f62\u53c2\u7c7b\u578b\n                    Field field = clazz.getDeclaredField(name);\n                    // 3. \u83b7\u53d6\u5e26\u53c2\u6570\u7684\u65b9\u6cd5\n                    Method method = clazz.getDeclaredMethod(methodName, field.getType());\n                    // 4. \u5c06\u5b9e\u53c2\u7c7b\u578b String \u8f6c\u6362\u4e3a\u6240\u9700\u7684\n                    String fieldName = field.getType().getName();\n                    if (fieldName == "long") {\n                        method.invoke(object, Long.parseLong(value));\n                    } else if (fieldName == "int") {\n                        method.invoke(object, Integer.parseInt(value));\n                    } else {\n                        method.invoke(object, value);\n                    }\n                    if (ref != null) {\n                        method.invoke(object, ioc.get(ref));\n                        // \u8fd9\u91cc\u53ef\u80fd\u8981\u505a\u4e2a\u9012\u5f52\n                        // \u6216\u8005\u662f\u628a bean \u5168\u627e\u5230\u540e\u518d\u6839\u636e ref \u4e92\u76f8\u8d4b\u503c\n                        // \u8fd9\u91cc\u7b80\u5355\u5199\n                    }\n                }\n                ioc.put(id, object);\n                System.out.println(object);\n            }\n            System.out.println("XML \u89e3\u6790\u5b8c\u6bd5");\n        } catch (DocumentException | ClassNotFoundException | NoSuchMethodException | InstantiationException | InvocationTargetException | IllegalArgumentException | IllegalAccessException e) {\n            e.printStackTrace();\n        } catch (NoSuchFieldException e) {\n            e.printStackTrace();\n        }\n\n    }\n\n    @Override\n    public Object getBean(String id) {\n        return ioc.get(id);\n    }\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"\u9759\u6001\u5de5\u5382")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"factory")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class StaticCarFactory {\n    private static Map<Long, Car> carMap;\n    static {\n        carMap = new HashMap<>();\n        carMap.put(1L, new Car(1L, "\u5b9d\u9a6c"));\n        carMap.put(2L, new Car(2L, "\u5954\u9a70"));\n    }\n    public static Car getCar(long id) {\n        return carMap.get(id);\n    }\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"spring.xml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'\x3c!--\u914d\u7f6e\u9759\u6001\u5de5\u5382--\x3e\n<bean id="car" class="com.southwind.factory.StaticCarFactory"               factory-method="getCar">\n    <constructor-arg value="2"/>\n</bean>\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"\u5b9e\u4f8b\u5de5\u5382")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"factory")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class InstanceCarFactory {\n    private Map<Long, Car> carMap;\n    public InstanceCarFactory() {\n        carMap = new HashMap<>();\n        carMap.put(1L, new Car(1L, "\u5b9d\u9a6c"));\n        carMap.put(2L, new Car(2L, "\u5954\u9a70"));\n    }\n    public Car getCar(long id) {\n        return carMap.get(id);\n    }\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"xml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'\x3c!--\u914d\u7f6e\u5b9e\u4f8b\u5de5\u5382--\x3e\n<bean id="carFactory" class="com.southwind.factory.InstanceCarFactory"/>\n<bean id="car2" factory-bean="carFactory" factory-method="getCar">\n    <constructor-arg value="2"/>\n</bean>\n')),(0,r.kt)("h2",{id:"aop"},"AOP"),(0,r.kt)("h3",{id:"\u624b\u52a8\u53cd\u5c04\u5b9e\u73b0"},"\u624b\u52a8\u53cd\u5c04\u5b9e\u73b0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"handler")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'public class CalInvocationHandler implements InvocationHandler {\n    // \u63a5\u53d7\u59d4\u6258\u5bf9\u8c61\n    private Object object = null;\n\n    // \u8fd4\u56de\u4ee3\u7406\u5bf9\u8c61\n    public Object bind(Object object) {\n        this.object = object;\n        // \u83b7\u53d6\u8fd0\u884c\u65f6\u7c7b\n        Class<?> clazz = object.getClass();\n        // \u83b7\u53d6\u7c7b\u52a0\u8f7d\u5668\n        ClassLoader classLoader = clazz.getClassLoader();\n        // \u83b7\u53d6\u7c7b\u7684\u6240\u6709\u63a5\u53e3\n        Class<?>[] interfaces = clazz.getInterfaces();\n        //\u521b\u5efa\u80fd\u5b9e\u73b0\u59d4\u6258\u5bf9\u8c61\u6240\u6709\u529f\u80fd\u7684\u4ee3\u7406\u5bf9\u8c61\n        return Proxy.newProxyInstance(classLoader, interfaces, this);\n    }\n\n    @Override\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        System.out.println(method.getName() + "\u7684\u53c2\u6570\u662f" + Arrays.toString(args));\n        Object result = method.invoke(this.object, args);\n        System.out.println(method.getName() + "\u7684\u7ed3\u679c\u662f" + result);\n\n        return result;\n    }\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Test")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"public class Test {\n    public static void main(String[] args) {\n        Cal cal = new CalImpl();\n        CalInvocationHandler calInvocationHandler = new CalInvocationHandler();\n        cal = (Cal) calInvocationHandler.bind(cal);\n        cal.add(1, 2);\n    }\n}\n")),(0,r.kt)("h3",{id:"aspect-\u5b9e\u73b0"},"@Aspect \u5b9e\u73b0"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"loggerAspect")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'@Aspect  // \u8ba9\u666e\u901a\u5bf9\u8c61\u6210\u4e3a\u5207\u9762\u5bf9\u8c61\n@Component  // \u4ea4\u7ed9 ioc \u7ba1\u7406 bean  \u540c\u65f6\u59d4\u6258\u5bf9\u8c61\u4e5f\u8981\u88ab ioc \u7ba1\u7406\npublic class loggerAspect {\n\n    // \u65b9\u6cd5\u540d\u7528*\u4ee3\u66ff  \u53c2\u6570\u7528..\u4ee3\u66ff\n    //@Before("execution(public int com.southwind.utils.impl.CalImpl.add(int, int))")\n    @Before("execution(int com.southwind.utils.impl.CalImpl.*(..))")\n    public void before(JoinPoint joinPoint) {\n        String methodName = joinPoint.getSignature().getName();\n        String args = Arrays.toString(joinPoint.getArgs());\n        System.out.println(methodName + "\u7684\u53c2\u6570\u662f" + args);\n    }\n\n    @After("execution(int com.southwind.utils.impl.CalImpl.*(..))")\n    public void after(JoinPoint joinPoint) {\n        String methodName = joinPoint.getSignature().getName();\n        System.out.println(methodName + "\u6267\u884c\u5b8c\u6bd5");\n    }\n\n    @AfterReturning(\n            value = "execution(int com.southwind.utils.impl.CalImpl.*(..))",\n            returning = "result")\n    public void afterReturning(JoinPoint joinPoint, Object result) {\n        String methodName = joinPoint.getSignature().getName();\n        System.out.println(methodName + "\u7684\u7ed3\u679c\u662f" + result);\n    }\n\n    @AfterThrowing(\n            value = "execution(int com.southwind.utils.impl.CalImpl.*(..))",\n            throwing = "e")\n    public void afterThrowing(JoinPoint joinPoint, Exception e) {\n        String methodName = joinPoint.getSignature().getName();\n        System.out.println(methodName + "\u629b\u51fa\u5f02\u5e38" + e);\n    }\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"spring.xml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'\x3c!--\u81ea\u52a8\u626b\u63cf base-package \u4e0b\u7684\u5bf9\u8c61\uff0c\u5c06\u6dfb\u52a0\u4e86 @component \u6ce8\u89e3\u7684\u5bf9\u8c61\u52a0\u5165 ioc \u5bb9\u5668--\x3e\n<context:component-scan base-package="com.southwind"/>\n\n\x3c!--\u81ea\u52a8\u626b\u63cf\uff0c\u4e3a\u6dfb\u52a0\u4e86 @aspect \u6ce8\u89e3\u7684\u5bf9\u8c61\u81ea\u52a8\u751f\u6210\u4ee3\u7406\u5bf9\u8c61--\x3e\n<aop:aspectj-autoproxy/>\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Test2")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// \u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\nApplicationContext applicationContext = new ClassPathXmlApplicationContext("spring.xml");\n// \u81ea\u52a8\u751f\u6210\u7684\u4ee3\u7406\u5bf9\u8c61\u88ab\u81ea\u52a8\u52a0\u5165 ioc,\n// @component("id") \u5982\u679c\u4e0d\u52a0\u53c2\u6570 bean \u7684 id \u4e3a\u59d4\u6258\u5bf9\u8c61\u9996\u5b57\u6bcd\u5c0f\u5199\nCal proxy = (Cal) applicationContext.getBean("calImpl");\nproxy.add(1, 2);\n')),(0,r.kt)("h2",{id:"spring-mvc"},"spring-mvc"),(0,r.kt)("h2",{id:"mybatis"},"Mybatis"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pom.xml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"<dependency>\n    <groupId>org.mybatis</groupId>\n    <artifactId>mybatis</artifactId>\n    <version>3.5.6</version>\n</dependency>\n<dependency>\n    <groupId>mysql</groupId>\n    <artifactId>mysql-connector-java</artifactId>\n    <version>8.0.23</version>\n</dependency>\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"config.xml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version="1.0" encoding="UTF-8" ?>\n<!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "http://mybatis.org/dtd/mybatis-3-config.dtd">\n<configuration>\n\x3c!--    \u914d\u7f6e mybits \u8fd0\u884c\u73af\u5883--\x3e\n    <environments default="development">\n        <environment id="development">\n\x3c!--            JDBC \u4e8b\u52a1\u7ba1\u7406--\x3e\n            <transactionManager type="JDBC"></transactionManager>\n\x3c!--            POOLED \u914d\u7f6e\u6570\u636e\u5e93\u8fde\u63a5\u6c60--\x3e\n            <dataSource type="POOLED">\n                <property name="driver" value="com.mysql.cj.jdbc.Driver"/>\n                <property name="url" value="jdbc:mysql://localhost:3306/library?useUnicode=true&amp;characterEncoding=UTF-8"/>\n                <property name="username" value="root"/>\n                <property name="password" value=""/>\n            </dataSource>\n        </environment>\n    </environments>\n    \x3c!--\u6ce8\u518c xml \u6587\u4ef6--\x3e\n    <mappers>\n        <mapper resource="com/southwind/mapper/AccountMapper.xml"></mapper>\n        <mapper resource="com/southwind/mapper/StudentMapper.xml"></mapper>\n        <mapper resource="com/southwind/mapper/ClassesMapper.xml"></mapper>\n    </mappers>\n</configuration>\n')))}u.isMDXComponent=!0}}]);