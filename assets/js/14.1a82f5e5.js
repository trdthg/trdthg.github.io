(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{414:function(t,s,a){"use strict";a.r(s);var e=a(56),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"oauth-2-0-simplified"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oauth-2-0-simplified"}},[t._v("#")]),t._v(" OAuth 2.0 Simplified")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.oauth.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("www.oauth.com"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"_1-getting-ready-开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-getting-ready-开始"}},[t._v("#")]),t._v(" 1. Getting ready 开始")]),t._v(" "),a("h3",{attrs:{id:"_1-1-creating-an-application-一般需要-sign-up-as-a-developer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-creating-an-application-一般需要-sign-up-as-a-developer"}},[t._v("#")]),t._v(" 1.1 Creating an Application(一般需要 sign up as a developer)")]),t._v(" "),a("p",[t._v("user -> entering basic information such as the name, website, logo, etc.\nserver -> return a "),a("strong",[t._v("client_id")]),t._v(" (and a "),a("strong",[t._v("client_secret")]),t._v(" in some cases)")]),t._v(" "),a("h3",{attrs:{id:"_1-2-redirect-urls-and-state"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-redirect-urls-and-state"}},[t._v("#")]),t._v(" 1.2 Redirect URLs and State")]),t._v(" "),a("ol",[a("li",[t._v("为了使同一个clientID同时拥有多个状态, Some services may allow you to register multiple redirect URLs\n比如:")])]),t._v(" "),a("ul",[a("li",[t._v("Web app and Mobile app")]),t._v(" "),a("li",[t._v("development service and production service")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("为了保证安全: 必须使用https防止在认证过程中code被拦截")])]),t._v(" "),a("ul",[a("li",[t._v("大多数服务(service)需要路由完全匹配, 这意味着"),a("a",{attrs:{href:"https://example.com/auth",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://example.com/auth"),a("OutboundLink")],1),t._v(" 的重定向 URL 将与 "),a("a",{attrs:{href:"https://example.com/auth?destination=account",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://example.com/auth?destination=account"),a("OutboundLink")],1),t._v(" 不匹配. 所以最佳做法是不在url里使用query string parameters")]),t._v(" "),a("li",[t._v("少部分服务需要可以从多种url发起认证，可以选择注册多个重定向url, 或者改变这些请求的重定向url, 但是oauth2提供了一种机制=> 状态参数(State)\nState的特点")])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("State")])]),t._v(" "),a("ul",[a("li",[t._v("可以用来作为加密的salt")]),t._v(" "),a("li",[t._v("可以是某种随机数据")]),t._v(" "),a("li",[t._v("对与service来说是不可见的 -> 在初始化认证请求时(initial authorization request)传入的任何State都会在用户授权给app(user authorizes the application)后被返回")])]),t._v(" "),a("blockquote",[a("p",[t._v("state用于额外的安全检查, 当github返回数据时可以确认不是攻击者发出的请求, 比如将攻击者的authorization token发送给github, as well as SCRF attack")])]),t._v(" "),a("p",[t._v("比如: 你可以将一个重定向的url经过encode后like JWT, 在用户返回app后解析这个JWT将用户带回合适的位置")]),t._v(" "),a("h2",{attrs:{id:"_2-accessing-data-获取数据-github为例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-accessing-data-获取数据-github为例"}},[t._v("#")]),t._v(" 2. Accessing data 获取数据(github为例)")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$out_app")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"在github填的homepage"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$authorizeURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://github.com/login/oauth/authorize'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This is the endpoint we'll request an access token from")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tokenURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://github.com/login/oauth/access_token'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This is the GitHub base URL for API requests")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$apiURLBase")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://api.github.com/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The URL for this script, used as the redirect URL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$baseURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'SERVER_NAME'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'PHP_SELF'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ol",[a("li",[t._v("获取登录凭证(access_token)")])]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("           开始\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 从某处发起HttpRequest重定向到"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("authorizeURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("不一定是our"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 携带\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'response_type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'client_id'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$githubClientID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'redirect_uri'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$baseURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'scope'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'user public_repo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'status'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'random_string(10)'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            ∨\n        github认证界面\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 点击确认\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" status_send "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" status_resp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     携带code和status重定向到app界面\n            ∨\n        our"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("app")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("exchange")]),t._v(" the authorization code "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" an access token"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 携带\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'grant_type'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'authorization_code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'client_id'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$githubClientID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'client_secret'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$githubClientSecret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'redirect_uri'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$baseURL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'code'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'code'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 再次请求tokenURL使用code交换"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("token")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"access_token"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"e2f8c8e136c73b1e909bb1021b3b4c29"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"token_type"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"Bearer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"scope"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"public_repo,user"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 重定向到"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("homepage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("baseURL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("，用户成功登录\n            ∨\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("appHomePage")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 把access_token存入session"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" 下次进入app时就能通过access_token进入登录成功后的界面\n            ∨\n           End\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("利用access_token获取数据\n直接在header里添加access_token请求apiURLBase就完事了")])]),t._v(" "),a("h2",{attrs:{id:"_3-signing-in-with-google"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-signing-in-with-google"}},[t._v("#")]),t._v(" 3. Signing in with Google")]),t._v(" "),a("h3",{attrs:{id:"_3-1-如何获取用户信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-如何获取用户信息"}},[t._v("#")]),t._v(" 3.1 如何获取用户信息")]),t._v(" "),a("p",[t._v("两个关键词")]),t._v(" "),a("ul",[a("li",[t._v("authorization 鉴权: trying to gain access or modify something that belongs to the user.")]),t._v(" "),a("li",[t._v("authentication 校验: just verifying who the user is\nOAuth is designed as a authorization protocol(授权协议), 所以access_token不能被用来判断用户是谁\n有以下几种不同services为app提供的方法可以判断用户是谁")])]),t._v(" "),a("ol",[a("li",[t._v("a simple way: 让api顺便返回一些profile_info(用户信息), 不包含在OAuth标准里")]),t._v(" "),a("li",[t._v("a advanced approach: use OpenID Connect(an OAuth2.0 extension)\n"),a("ul",[a("li",[t._v("利用id_token")]),t._v(" "),a("li",[t._v("使用access_token\n如何选择获取user_info的方法\nA: For performance-sensitive applications where you might be reading ID tokens on every request or using them to maintain a session, you should definitely validate the ID token locally rather than making a network request."),a("a",{attrs:{href:"https://developers.google.com/identity/protocols/OpenIDConnect#validatinganidtoken",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developers.google.com/identity/protocols/OpenIDConnect#validatinganidtoken"),a("OutboundLink")],1),t._v("\nB: just for find the user’s name and email after they sign in, then extracting the data from the ID token and storing it in your application session")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-2-下面以google提供的api为例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-下面以google提供的api为例"}},[t._v("#")]),t._v(" 3.2 下面以Google提供的api为例")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$authorizeURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://accounts.google.com/o/oauth2/v2/auth'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This is Google's OpenID Connect token endpoint")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tokenURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://www.googleapis.com/oauth2/v4/token'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The URL for this script, used as the redirect URL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$baseURL")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'https://'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'SERVER_NAME'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$_SERVER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[t._v("'PHP_SELF'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("与github的不同")]),t._v(" "),a("ol",[a("li",[t._v("Google的认证界面只能选择使用那个帐号(用户), 没有点击授权的按钮")]),t._v(" "),a("li",[t._v("请求access_token的返回值")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"access_token"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ya29.Glins-oLtuljNVfthQU2bpJVJPTu"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"token_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Bearer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"expires_in"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id_token"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(' "eyJhbGciOiJSUzI1NiIsImtpZCI6ImFmZmM2MjkwN\n  2E0NDYxODJhZGMxZmE0ZTgxZmRiYTYzMTBkY2U2M2YifQ.eyJhenAi\n  OiIyNzIxOTYwNjkxNzMtZm81ZWI0MXQzbmR1cTZ1ZXRkc2pkdWdzZX\n  V0ZnBtc3QuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJhdWQi\n  OiIyNzIxOTYwNjkxNzMtZm81ZWI0MXQzbmR1cTZ1ZXRkc2pkdWdzZX\n  V0ZnBtc3QuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20iLCJzdWIi\n  OiIxMTc4NDc5MTI4NzU5MTM5MDU0OTMiLCJlbWFpbCI6ImFhcm9uLn\n  BhcmVja2lAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUs\n  ImF0X2hhc2giOiJpRVljNDBUR0luUkhoVEJidWRncEpRIiwiZXhwIj\n  oxNTI0NTk5MDU2LCJpc3MiOiJodHRwczovL2FjY291bnRzLmdvb2ds\n  ZS5jb20iLCJpYXQiOjE1MjQ1OTU0NTZ9.ho2czp_1JWsglJ9jN8gCg\n  WfxDi2gY4X5-QcT56RUGkgh5BJaaWdlrRhhN_eNuJyN3HRPhvVA_KJ\n  Vy1tMltTVd2OQ6VkxgBNfBsThG_zLPZriw7a1lANblarwxLZID4fXD\n  YG-O8U-gw4xb-NIsOzx6xsxRBdfKKniavuEg56Sd3eKYyqrMA0DWnI\n  agqLiKE6kpZkaGImIpLcIxJPF0-yeJTMt_p1NoJF7uguHHLYr6752h\n  qppnBpMjFL2YMDVeg3jl1y5DeSKNPh6cZ8H2p4Xb2UIrJguGbQHVIJ\n  vtm_AspRjrmaTUQKrzXDRCfDROSUU-h7XKIWRrEd2-W9UkV5oCg"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("下面是前两端的解码信息段")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RS256"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"kid"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"affc62907a446182adc1fa4e81fdba6310dce63f"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"azp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"272196069173-fo5eb41t3nduq6uetdsjdugseutfpmst.apps.googleusercontent.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aud"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"272196069173-fo5eb41t3nduq6uetdsjdugseutfpmst.apps.googleusercontent.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sub"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"117847912875913905493"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"email"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"aaron.parecki@gmail.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"email_verified"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"at_hash"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iEYc40TGInRHhTBbudgpJQ"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"exp"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1524599056")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"iss"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://accounts.google.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"iat"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1524595456")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("access_token should be tracted as opaque(不透明), 因为里面没有重要信息\n一般来说, 提取id_token中的信息之前进行校验是很重要的, 防止这个token是有其他人下发的, 在上面的示例中, 我们使用了https以确保token确实来自Google\nsub是用户的标识符，与帐号绑定，即使更换邮箱也不会变")]),t._v(" "),a("blockquote",[a("p",[t._v("下面是一些解释\nazp: 授权演示者的client_id 。仅当请求ID令牌的一方与ID令牌的受众不同时才需要此声明。\naud: 此ID令牌的目标受众。它必须是您应用程序的OAuth 2.0客户端ID之一。")])]),t._v(" "),a("h2",{attrs:{id:"_4-server-side-apps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-server-side-apps"}},[t._v("#")]),t._v(" 4 Server-Side Apps")]),t._v(" "),a("ol",[a("li",[t._v("请求code时的queryString")])]),t._v(" "),a("ul",[a("li",[t._v("response_type: 想要获取的返回值类型")]),t._v(" "),a("li",[t._v("client_id: app的identifier")]),t._v(" "),a("li",[t._v("redirect_url(optional): 授权完成后的跳转页面(需要在注册app时设置)")]),t._v(" "),a("li",[t._v("scope(optional): Include one or more scope values (space-separated) to request additional levels of access. The values will depend on the particular service.(用空格分隔)")]),t._v(" "),a("li",[t._v("status: 会被服务端完整返回，can be used to letyour app persist data between the user being directed to the authorization server and back again，")])]),t._v(" "),a("blockquote",[a("p",[t._v("比如using it as session_key to indicate what action the app to perform after authorization is complete(比如重定向的链接)\n如果每次request的status都是随机生成的，status也能用来保护from CSRF")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("交换access_token的queryString")])]),t._v(" "),a("ul",[a("li",[t._v("grant_type(required): 必须要设置为authorization_code")]),t._v(" "),a("li",[t._v("code(required):  will be in the query string parameter “code” in this request.")]),t._v(" "),a("li",[t._v("redirect_uri (possibly required)")]),t._v(" "),a("li",[t._v("Client Authentication (required): 一般是client_id和client_secret")])])])}),[],!1,null,null,null);s.default=n.exports}}]);