(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{424:function(t,s,a){"use strict";a.r(s);var r=a(56),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),a("h2",{attrs:{id:"_1-镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-镜像"}},[t._v("#")]),t._v(" 1 镜像")]),t._v(" "),a("h3",{attrs:{id:"_1-1-获取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-获取镜像"}},[t._v("#")]),t._v(" 1.1 获取镜像")]),t._v(" "),a("p",[a("code",[t._v("docker pull")])]),t._v(" "),a("p",[t._v("没必要， 直接 docker run 就行了")]),t._v(" "),a("h3",{attrs:{id:"_1-2-列出镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-列出镜像"}},[t._v("#")]),t._v(" 1.2 列出镜像")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("列出所有： "),a("code",[t._v("docker image list")])])]),t._v(" "),a("li",[a("p",[t._v("列出所有虚悬镜像： "),a("code",[t._v("docker image list -f dangling=true")])]),t._v(" "),a("p",[t._v("这个镜像既没有仓库名，也没有标签，均为 "),a("code",[t._v("<none>")])])])]),t._v(" "),a("h3",{attrs:{id:"_1-3-删除镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-删除镜像"}},[t._v("#")]),t._v(" 1.3 删除镜像")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("删除： "),a("code",[t._v("docker image rm xxx")])]),t._v(" "),a("p",[t._v("xxx 可以是 镜像短 ID、镜像长 ID、镜像名、或者镜像摘要")])]),t._v(" "),a("li",[a("p",[t._v("删除所有虚悬镜像： "),a("code",[t._v("docker image prune")])])]),t._v(" "),a("li",[a("p",[t._v("删除所有仓库名为redis的镜像："),a("code",[t._v("docker image rm $(docker image ls -q redis)")])])])]),t._v(" "),a("h2",{attrs:{id:"_2-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-容器"}},[t._v("#")]),t._v(" 2 容器")]),t._v(" "),a("h3",{attrs:{id:"_2-0-列出容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-0-列出容器"}},[t._v("#")]),t._v(" 2.0 列出容器")]),t._v(" "),a("p",[a("code",[t._v("docker container ls -a")])]),t._v(" "),a("p",[a("code",[t._v("docker ps -a")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-启动容器"}},[t._v("#")]),t._v(" 2.1 启动容器")]),t._v(" "),a("p",[t._v("新建容器： "),a("code",[t._v("docker run -d -it ubuntu:18.04 /bin/bash")])]),t._v(" "),a("h3",{attrs:{id:"_2-2-重启容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-重启容器"}},[t._v("#")]),t._v(" 2.2 重启容器")]),t._v(" "),a("p",[a("code",[t._v("docker container start")])]),t._v(" "),a("h3",{attrs:{id:"_2-3-终止容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-终止容器"}},[t._v("#")]),t._v(" 2.3 终止容器")]),t._v(" "),a("p",[a("code",[t._v("docker container stop")])]),t._v(" "),a("p",[a("code",[t._v("docker container restart")])]),t._v(" "),a("h3",{attrs:{id:"_2-4-进入容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-进入容器"}},[t._v("#")]),t._v(" 2.4 进入容器")]),t._v(" "),a("p",[a("code",[t._v("docker exec -it ubuntu:18.04 /bin/bash")])]),t._v(" "),a("h3",{attrs:{id:"_2-5-导入导出"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-导入导出"}},[t._v("#")]),t._v(" 2.5 导入导出")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("导出："),a("code",[t._v("docker export 7691a814370e > ubuntu.tar")])])]),t._v(" "),a("li",[a("p",[t._v("导入：")]),t._v(" "),a("ul",[a("li",[t._v("从文件："),a("code",[t._v("cat ubuntu.tar | docker import - test/ubuntu:v1.0")])]),t._v(" "),a("li",[t._v("从路径："),a("code",[t._v("docker import http://example.com/exampleimage.tgz example/imagerepo")])])])])]),t._v(" "),a("h3",{attrs:{id:"_2-6-删除容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-删除容器"}},[t._v("#")]),t._v(" 2.6 删除容器")]),t._v(" "),a("p",[t._v("删除已经关闭的一个容器： "),a("code",[t._v("docker container rm")])]),t._v(" "),a("p",[t._v("删除所有已经关闭的容器："),a("code",[t._v("docker container prune")])]),t._v(" "),a("h2",{attrs:{id:"_3-dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-dockerfile"}},[t._v("#")]),t._v(" 3 Dockerfile")]),t._v(" "),a("p",[t._v("这里会将一个Dockerfile的构建过程")]),t._v(" "),a("h3",{attrs:{id:"_3-0-格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-0-格式"}},[t._v("#")]),t._v(" 3.0 格式")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("指定基础镜像")]),t._v(" "),a("p",[t._v("定制一个镜像，需要以一个镜像为基础")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" alpine:latest")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("RUN 执行命令\n格式："),a("code",[t._v("RUN <命令>")]),t._v("，就像直接在命令行中输入的命令一样。刚才写的 Dockerfile 中的 "),a("code",[t._v("RUN")]),t._v(" 指令就是这种格式。")])])]),t._v(" "),a("h2",{attrs:{id:"_4-实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-实践"}},[t._v("#")]),t._v(" 4 实践")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" alpine:latest")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./cargo-config /cargo-config")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mkdir -p ~/.cargo && mv /cargo-config ~/.cargo/config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && sed -i "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g'")]),t._v(" /etc/apk/repositories "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && apk add --no-cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        redis "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        openssh "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        sudo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        libgcc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        clang-libs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        git "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        bash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        python3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        py3-setuptools "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        py3-pip "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        unzip "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        wget "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        alpine-sdk "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        cmake "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        cargo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && mkdir -p /opt/build /opt/redis-modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cd /opt/build "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && git clone https://github.com/RedisJSON/RedisJSON "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cd RedisJSON "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && git submodule update --init --recursive "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cd .. "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && git clone https://github.com/RediSearch/RediSearch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cd /opt/build/RedisJSON "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && make build shell=/bin/bash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cp target/release/librejson.so /opt/redis-modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cd /opt/build/RediSearch "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cmake . -DCMAKE_INSTALL_PREFIX="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/redis-modules"')]),t._v(" -Bbuild "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cmake --build build "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && cp build/redisearch.so /opt/redis-modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && rm -rf /opt/build "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && rm -rf ~/.cargo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && strip /opt/redis-modules/*.so "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && apk del --purge alpine-sdk cmake cargo python3 py3-setuptools py3-pip unzip wget bash git clang-libs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n        && adduser -D -s /bin/ash admin")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USER")]),t._v(" admin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VOLUME")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/home/admin"')]),t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /home/admin")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 6379")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis-server"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--loadmodule"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/redis-modules/librejson.so"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--loadmodule"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/opt/redis-modules/redisearch.so"')]),t._v("]")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);