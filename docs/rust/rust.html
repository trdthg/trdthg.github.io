<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>rust - Trdthg&#x27;s Self</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">trans</li><li class="chapter-item expanded "><a href="../../trans/2022-04-20-è¯‘-ä½¿ç”¨-Tokio-å¤„ç†-CPU-å¯†é›†å‹ä»»åŠ¡.html"><strong aria-hidden="true">1.</strong> 2022-04-20-è¯‘-ä½¿ç”¨-Tokio-å¤„ç†-CPU-å¯†é›†å‹ä»»åŠ¡</a></li><li class="chapter-item expanded "><a href="../../trans/2023-01-03-è¯‘-Rustå†’é™©:-æ»¥ç”¨-Serde.html"><strong aria-hidden="true">2.</strong> 2023-01-03-è¯‘-Rustå†’é™©:-æ»¥ç”¨-Serde</a></li><li class="chapter-item expanded "><a href="../../trans/2023-01-01-è¯‘-æ‹“å±•-Rust-ä¸­çš„-Map.html"><strong aria-hidden="true">3.</strong> 2023-01-01-è¯‘-æ‹“å±•-Rust-ä¸­çš„-Map</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-01-è¯‘-search_engine.html"><strong aria-hidden="true">4.</strong> 2022-04-01-è¯‘-search_engine</a></li><li class="chapter-item expanded "><a href="../../trans/2022-05-04-è¯‘-å¯è§†åŒ–-Rust-å„æ•°æ®ç±»å‹çš„å†…å­˜å¸ƒå±€.html"><strong aria-hidden="true">5.</strong> 2022-05-04-è¯‘-å¯è§†åŒ–-Rust-å„æ•°æ®ç±»å‹çš„å†…å­˜å¸ƒå±€</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-13-è¯‘-tail_latency.html"><strong aria-hidden="true">6.</strong> 2022-04-13-è¯‘-tail_latency</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-30-è¯‘-ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Rust-ï¼Ÿ.html"><strong aria-hidden="true">7.</strong> 2022-04-30-è¯‘-ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨-Rust-ï¼Ÿ</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-11-è¯‘-å¼‚æ­¥-Rustï¼šåä½œä¸æŠ¢å å¼è°ƒåº¦.html"><strong aria-hidden="true">8.</strong> 2022-04-11-è¯‘-å¼‚æ­¥-Rustï¼šåä½œä¸æŠ¢å å¼è°ƒåº¦</a></li><li class="chapter-item expanded "><a href="../../trans/2023-01-02-è¯‘-æœªåˆå§‹åŒ–å†…å­˜:-unsafe-Rustå¤ªéš¾äº†.html"><strong aria-hidden="true">9.</strong> 2023-01-02-è¯‘-æœªåˆå§‹åŒ–å†…å­˜:-unsafe-Rustå¤ªéš¾äº†</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/index.html"><strong aria-hidden="true">10.</strong> 2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-4-é‡æ„.html"><strong aria-hidden="true">10.1.</strong> Rust-å…­è¾¹å½¢æ¶æ„-4-é‡æ„</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-2-å†…å­˜å­˜å‚¨åº“.html"><strong aria-hidden="true">10.2.</strong> Rust-å…­è¾¹å½¢æ¶æ„-2-å†…å­˜å­˜å‚¨åº“</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-7-é•¿æœŸå­˜å‚¨åº“.html"><strong aria-hidden="true">10.3.</strong> Rust-å…­è¾¹å½¢æ¶æ„-7-é•¿æœŸå­˜å‚¨åº“</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-1-åŸŸ.html"><strong aria-hidden="true">10.4.</strong> Rust-å…­è¾¹å½¢æ¶æ„-1-åŸŸ</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-5-å…¶ä»–ç”¨ä¾‹.html"><strong aria-hidden="true">10.5.</strong> Rust-å…­è¾¹å½¢æ¶æ„-5-å…¶ä»–ç”¨ä¾‹</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-6-CLI.html"><strong aria-hidden="true">10.6.</strong> Rust-å…­è¾¹å½¢æ¶æ„-6-CLI</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/Rust-å…­è¾¹å½¢æ¶æ„-3-HTTP-API.html"><strong aria-hidden="true">10.7.</strong> Rust-å…­è¾¹å½¢æ¶æ„-3-HTTP-API</a></li><li class="chapter-item expanded "><a href="../../trans/2022-04-03-è¯‘-Rust-å…­è¾¹å½¢æ¶æ„/index.html"><strong aria-hidden="true">10.8.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">note</li><li class="chapter-item expanded "><a href="../../note/java/index.html"><strong aria-hidden="true">11.</strong> java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../note/java/java.html"><strong aria-hidden="true">11.1.</strong> java</a></li><li class="chapter-item expanded "><a href="../../note/java/springboot.html"><strong aria-hidden="true">11.2.</strong> springboot</a></li><li class="chapter-item expanded "><a href="../../note/java/spring.html"><strong aria-hidden="true">11.3.</strong> spring</a></li><li class="chapter-item expanded "><a href="../../note/java/sourceread.html"><strong aria-hidden="true">11.4.</strong> sourceread</a></li><li class="chapter-item expanded "><a href="../../note/java/index.html"><strong aria-hidden="true">11.5.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../note/frontend/index.html"><strong aria-hidden="true">12.</strong> frontend</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../note/frontend/mini_bundle.html"><strong aria-hidden="true">12.1.</strong> mini_bundle</a></li><li class="chapter-item expanded "><a href="../../note/frontend/js_advanced.html"><strong aria-hidden="true">12.2.</strong> js_advanced</a></li><li class="chapter-item expanded "><a href="../../note/frontend/mini_vue.html"><strong aria-hidden="true">12.3.</strong> mini_vue</a></li><li class="chapter-item expanded "><a href="../../note/frontend/vue.html"><strong aria-hidden="true">12.4.</strong> vue</a></li><li class="chapter-item expanded "><a href="../../note/frontend/list.html"><strong aria-hidden="true">12.5.</strong> list</a></li><li class="chapter-item expanded "><a href="../../note/frontend/http.html"><strong aria-hidden="true">12.6.</strong> http</a></li><li class="chapter-item expanded "><a href="../../note/frontend/flutter.html"><strong aria-hidden="true">12.7.</strong> flutter</a></li><li class="chapter-item expanded "><a href="../../note/frontend/css.html"><strong aria-hidden="true">12.8.</strong> css</a></li><li class="chapter-item expanded "><a href="../../note/frontend/vdom.html"><strong aria-hidden="true">12.9.</strong> vdom</a></li><li class="chapter-item expanded "><a href="../../note/frontend/index.html"><strong aria-hidden="true">12.10.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">blog</li><li class="chapter-item expanded "><a href="../../blog/index.html"><strong aria-hidden="true">13.</strong> README</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">docs</li><li class="chapter-item expanded "><a href="../../docs/log.html"><strong aria-hidden="true">14.</strong> log</a></li><li class="chapter-item expanded "><a href="../../docs/intro.html"><strong aria-hidden="true">15.</strong> intro</a></li><li class="chapter-item expanded "><a href="../../docs/magic/index.html"><strong aria-hidden="true">16.</strong> magic</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/magic/riscv.html"><strong aria-hidden="true">16.1.</strong> riscv</a></li><li class="chapter-item expanded "><a href="../../docs/magic/haskell.html"><strong aria-hidden="true">16.2.</strong> haskell</a></li><li class="chapter-item expanded "><a href="../../docs/magic/bash.html"><strong aria-hidden="true">16.3.</strong> bash</a></li><li class="chapter-item expanded "><a href="../../docs/magic/memory_ordering.html"><strong aria-hidden="true">16.4.</strong> memory_ordering</a></li><li class="chapter-item expanded "><a href="../../docs/magic/linuxIO.html"><strong aria-hidden="true">16.5.</strong> linuxIO</a></li><li class="chapter-item expanded "><a href="../../docs/magic/cicd.html"><strong aria-hidden="true">16.6.</strong> cicd</a></li><li class="chapter-item expanded "><a href="../../docs/magic/fd.html"><strong aria-hidden="true">16.7.</strong> fd</a></li><li class="chapter-item expanded "><a href="../../docs/magic/hadoop.html"><strong aria-hidden="true">16.8.</strong> hadoop</a></li><li class="chapter-item expanded "><a href="../../docs/magic/go.html"><strong aria-hidden="true">16.9.</strong> go</a></li><li class="chapter-item expanded "><a href="../../docs/magic/async.html"><strong aria-hidden="true">16.10.</strong> async</a></li><li class="chapter-item expanded "><a href="../../docs/magic/index.html"><strong aria-hidden="true">16.11.</strong> README</a></li><li class="chapter-item expanded "><a href="../../docs/magic/software_arch.html"><strong aria-hidden="true">16.12.</strong> software_arch</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs/riscv/index.html"><strong aria-hidden="true">17.</strong> riscv</a></li><li class="chapter-item expanded "><a href="../../docs/common/index.html"><strong aria-hidden="true">18.</strong> common</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/common/pgsql.html"><strong aria-hidden="true">18.1.</strong> pgsql</a></li><li class="chapter-item expanded "><a href="../../docs/common/git.html"><strong aria-hidden="true">18.2.</strong> git</a></li><li class="chapter-item expanded "><a href="../../docs/common/linux.html"><strong aria-hidden="true">18.3.</strong> linux</a></li><li class="chapter-item expanded "><a href="../../docs/common/datastructure.html"><strong aria-hidden="true">18.4.</strong> datastructure</a></li><li class="chapter-item expanded "><a href="../../docs/common/docker.html"><strong aria-hidden="true">18.5.</strong> docker</a></li><li class="chapter-item expanded "><a href="../../docs/common/analyze.html"><strong aria-hidden="true">18.6.</strong> analyze</a></li><li class="chapter-item expanded "><a href="../../docs/common/oci.html"><strong aria-hidden="true">18.7.</strong> oci</a></li><li class="chapter-item expanded "><a href="../../docs/common/unsorted.html"><strong aria-hidden="true">18.8.</strong> unsorted</a></li><li class="chapter-item expanded "><a href="../../docs/common/oauth2.html"><strong aria-hidden="true">18.9.</strong> oauth2</a></li><li class="chapter-item expanded "><a href="../../docs/common/vim.html"><strong aria-hidden="true">18.10.</strong> vim</a></li><li class="chapter-item expanded "><a href="../../docs/common/python.html"><strong aria-hidden="true">18.11.</strong> python</a></li><li class="chapter-item expanded "><a href="../../docs/common/index.html"><strong aria-hidden="true">18.12.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs/rust/index.html"><strong aria-hidden="true">19.</strong> rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/rust/mini_tokio.html"><strong aria-hidden="true">19.1.</strong> mini_tokio</a></li><li class="chapter-item expanded "><a href="../../docs/rust/wasm.html"><strong aria-hidden="true">19.2.</strong> wasm</a></li><li class="chapter-item expanded "><a href="../../docs/rust/rust_quiz.html"><strong aria-hidden="true">19.3.</strong> rust_quiz</a></li><li class="chapter-item expanded "><a href="../../docs/rust/rust.html" class="active"><strong aria-hidden="true">19.4.</strong> rust</a></li><li class="chapter-item expanded "><a href="../../docs/rust/print_into_detail.html"><strong aria-hidden="true">19.5.</strong> print_into_detail</a></li><li class="chapter-item expanded "><a href="../../docs/rust/net-piercer.html"><strong aria-hidden="true">19.6.</strong> net-piercer</a></li><li class="chapter-item expanded "><a href="../../docs/rust/rs_channel.html"><strong aria-hidden="true">19.7.</strong> rs_channel</a></li><li class="chapter-item expanded "><a href="../../docs/rust/lists.html"><strong aria-hidden="true">19.8.</strong> lists</a></li><li class="chapter-item expanded "><a href="../../docs/rust/index.html"><strong aria-hidden="true">19.9.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../docs/riscv/index.html"><strong aria-hidden="true">20.</strong> riscv</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../docs/riscv/index.html"><strong aria-hidden="true">20.1.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">other</li><li class="chapter-item expanded "><a href="../../other/2023-04-12-remote-usb.html"><strong aria-hidden="true">21.</strong> 2023-04-12-remote-usb</a></li><li class="chapter-item expanded "><a href="../../other/resources.html"><strong aria-hidden="true">22.</strong> resources</a></li><li class="chapter-item expanded "><a href="../../other/i3wm.html"><strong aria-hidden="true">23.</strong> i3wm</a></li><li class="chapter-item expanded "><a href="../../other/lsm.html"><strong aria-hidden="true">24.</strong> lsm</a></li><li class="chapter-item expanded "><a href="../../other/site_update_log.html"><strong aria-hidden="true">25.</strong> site_update_log</a></li><li class="chapter-item expanded "><a href="../../other/ioclub/index.html"><strong aria-hidden="true">26.</strong> ioclub</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../other/ioclub/share_1.html"><strong aria-hidden="true">26.1.</strong> share_1</a></li><li class="chapter-item expanded "><a href="../../other/ioclub/index.html"><strong aria-hidden="true">26.2.</strong> README</a></li></ol></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/index.html"><strong aria-hidden="true">27.</strong> 2021-åç«¯</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_1.html"><strong aria-hidden="true">27.1.</strong> backend_1</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_2.html"><strong aria-hidden="true">27.2.</strong> backend_2</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_3.html"><strong aria-hidden="true">27.3.</strong> backend_3</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_4.html"><strong aria-hidden="true">27.4.</strong> backend_4</a></li></ol></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/index.html"><strong aria-hidden="true">28.</strong> 2021-åç«¯</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_1.html"><strong aria-hidden="true">28.1.</strong> backend_1</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_2.html"><strong aria-hidden="true">28.2.</strong> backend_2</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_3.html"><strong aria-hidden="true">28.3.</strong> backend_3</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/backend_4.html"><strong aria-hidden="true">28.4.</strong> backend_4</a></li><li class="chapter-item expanded "><a href="../../other/2021-åç«¯/index.html"><strong aria-hidden="true">28.5.</strong> README</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">draft</li><li class="chapter-item expanded "><a href="../../draft/ç»„æˆåŸç†.html"><strong aria-hidden="true">29.</strong> ç»„æˆåŸç†</a></li><li class="chapter-item expanded "><a href="../../draft/è®¡ç®—æœºç½‘ç»œ.html"><strong aria-hidden="true">30.</strong> è®¡ç®—æœºç½‘ç»œ</a></li><li class="chapter-item expanded "><a href="../../draft/è¯‘-pkg_mng.html"><strong aria-hidden="true">31.</strong> è¯‘-pkg_mng</a></li><li class="chapter-item expanded "><a href="../../draft/DistributedSystem.html"><strong aria-hidden="true">32.</strong> DistributedSystem</a></li><li class="chapter-item expanded "><a href="../../draft/oscamp2022.html"><strong aria-hidden="true">33.</strong> oscamp2022</a></li><li class="chapter-item expanded "><a href="../../draft/compile.html"><strong aria-hidden="true">34.</strong> compile</a></li><li class="chapter-item expanded "><a href="../../draft/test.html"><strong aria-hidden="true">35.</strong> test</a></li><li class="chapter-item expanded "><a href="../../draft/ld.html"><strong aria-hidden="true">36.</strong> ld</a></li><li class="chapter-item expanded "><a href="../../draft/æ•°æ®åº“è®¾è®¡.html"><strong aria-hidden="true">37.</strong> æ•°æ®åº“è®¾è®¡</a></li><li class="chapter-item expanded "><a href="../../draft/index.html"><strong aria-hidden="true">38.</strong> README</a></li><li class="chapter-item expanded "><a href="../../draft/computer_network/index.html"><strong aria-hidden="true">39.</strong> computer_network</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../draft/computer_network/index.html"><strong aria-hidden="true">39.1.</strong> README</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">Trdthg&#x27;s Self</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<h2>sidebar_position: 1
sidebar_label: Rust è¯­è¨€
sidebar_class_name: green</h2>
<h1 id="rust-è¯­è¨€"><a class="header" href="#rust-è¯­è¨€">Rust è¯­è¨€</a></h1>
<h2 id="1-ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#1-ç”Ÿå‘½å‘¨æœŸ">1. ç”Ÿå‘½å‘¨æœŸ</a></h2>
<h3 id="è‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ"><a class="header" href="#è‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ">è‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Only one reference in input, so the output must be derived from that input
fn foo(&amp;A) -&gt; &amp;B; // sugar for:
fn foo&lt;'a&gt;(&amp;'a A) -&gt; &amp;'a B;

// Many inputs, assume they're all independent
fn foo(&amp;A, &amp;B, &amp;C); // sugar for:
fn foo&lt;'a, 'b, 'c&gt;(&amp;'a A, &amp;'b B, &amp;'c C);

// Methods, assume all output lifetimes are derived from `self`
fn foo(&amp;self, &amp;B, &amp;C) -&gt; &amp;D; // sugar for:
fn foo&lt;'a, 'b, 'c&gt;(&amp;'a self, &amp;'b B, &amp;'c C) -&gt; &amp;'a D;
<span class="boring">}
</span></code></pre></pre>
<h2 id="2-æ™ºèƒ½æŒ‡é’ˆ"><a class="header" href="#2-æ™ºèƒ½æŒ‡é’ˆ">2. æ™ºèƒ½æŒ‡é’ˆ</a></h2>
<h3 id="åŸºæœ¬æ¦‚å¿µ"><a class="header" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></h3>
<p>å®ç°äº† Deref Trait å’Œ Drop Trait çš„å°±æ˜¯æ™ºèƒ½æŒ‡é’ˆ</p>
<ol>
<li>Deref Trait: å…·æœ‰æŒ‡é’ˆè¯­ä¹‰</li>
<li>Drop Traitï¼šæ‹¥æœ‰å†…å­˜è‡ªåŠ¨ç®¡ç†çš„æœºåˆ¶</li>
</ol>
<p>çœ‹ä¸€çœ¼ Box çš„å®ç°</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]
impl&lt;T: ?Sized, A: Allocator&gt; Deref for Box&lt;T, A&gt; {
    type Target = T;

    fn deref(&amp;self) -&gt; &amp;T {
        &amp;**self
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="ç®€å•å®ç°"><a class="header" href="#ç®€å•å®ç°">ç®€å•å®ç°</a></h3>
<p>æˆ‘ä»¬å®ç°ä¸€ä¸ªæ™ºèƒ½æŒ‡é’ˆï¼ˆåªå®ç°äº† Deref Traitï¼‰</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::ops::Deref;

pub struct MySmartPointer&lt;T&gt; (T);

impl&lt;T&gt; MySmartPointer&lt;T&gt; {
    pub fn new(t: T) -&gt; Self {
        MySmartPointer(t)
    }
}

impl&lt;T&gt; Deref for MySmartPointer&lt;T&gt; {
    type Target = T;
    fn deref(&amp;self) -&gt; &amp;Self::Target {
        &amp;self.0
    }
}
// è°ƒç”¨*x å…¶å®å°±æ˜¯è°ƒç”¨ *x.deref()
let x = 5;
let a = MySmartPointer::new(x);
let b = Box::new(x);
assert_eq!(x, *a.deref());
assert_eq!(x, *a);
assert_eq!(x, *b.deref());
assert_eq!(x, *b);
print!(&quot;{}&quot;, a.to_string())
<span class="boring">}
</span></code></pre></pre>
<h3 id="è‡ªåŠ¨è§£å¼•ç”¨çš„æ—¶æœº"><a class="header" href="#è‡ªåŠ¨è§£å¼•ç”¨çš„æ—¶æœº">è‡ªåŠ¨è§£å¼•ç”¨çš„æ—¶æœº</a></h3>
<ul>
<li>
<p>é‡åˆ°*è¿ç®—ç¬¦è‡ªåŠ¨æ¥å¼•ç”¨</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>assert_eq!(x, *a.deref());
assert_eq!(x, *a);
<span class="boring">}
</span></code></pre></pre>
</li>
<li>
<p>é‡åˆ° . è¿ç®—ç¬¦æ¥å¼•ç”¨è°ƒç”¨æ–¹æ³•</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>print!(&quot;{}&quot;, a.to_string())
<span class="boring">}
</span></code></pre></pre>
</li>
<li>
<p>å‚æ•°ä¼ é€’è‡ªåŠ¨è§£å¼•ç”¨</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let s = String::from(&quot;aaaa&quot;);
fn take_str(s: &amp;str) {
    print!(&quot;{}&quot;, s);
}
take_str(&amp;s);

#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]
impl ops::Deref for String {
    type Target = str;

    #[inline]
    fn deref(&amp;self) -&gt; &amp;str {
        unsafe { str::from_utf8_unchecked(&amp;self.vec) }
    }
}
<span class="boring">}
</span></code></pre></pre>
</li>
</ul>
<h3 id="è‡ªåŠ¨ç®¡ç†å†…å­˜"><a class="header" href="#è‡ªåŠ¨ç®¡ç†å†…å­˜">è‡ªåŠ¨ç®¡ç†å†…å­˜</a></h3>
<p>è‡ªåŠ¨åŒ–ç®¡ç†å†…å­˜ (dropï¼Œä½œç”¨åŸŸå¤–è‡ªåŠ¨é‡Šæ”¾å†…å­˜)</p>
<h2 id="2-atomic-åœ¨-rust-ä¸­çš„å®è·µ"><a class="header" href="#2-atomic-åœ¨-rust-ä¸­çš„å®è·µ">2. Atomic åœ¨ rust ä¸­çš„å®è·µ</a></h2>
<p><a href="https://www.youtube.com/watch?v=rMGWeSjctlY">Crust of Rust: Atomics and Memory Ordering</a></p>
<h3 id="ä½¿ç”¨-atomic-å®ç°ç®€å•çš„-mutex"><a class="header" href="#ä½¿ç”¨-atomic-å®ç°ç®€å•çš„-mutex">ä½¿ç”¨ Atomic å®ç°ç®€å•çš„ Mutex</a></h3>
<pre><pre class="playground"><code class="language-rust">use std::{sync::atomic::{AtomicBool, Ordering, AtomicUsize}, thread::{self, spawn}, cell::UnsafeCell};

const UNLOCKED: bool = true;
const LOCKED: bool = false;

struct Mutex&lt;T&gt; {
    locked: AtomicBool,
    v: UnsafeCell&lt;T&gt;
}

unsafe impl&lt;T&gt; Sync for Mutex&lt;T&gt; where T: Send {}

impl&lt;T&gt; Mutex&lt;T&gt; {

    pub fn new(v: T) -&gt; Self {
        Self {
            locked: AtomicBool::new(UNLOCKED),
            v: UnsafeCell::new(v)
        }
    }

    /// æš´éœ²ä¸€ä¸ªå¯å˜å¼•ç”¨å‡ºå»
    ///
    /// å½“çº¿ç¨‹ A å’Œçº¿ç¨‹ B åŒæ—¶æ‰§è¡Œæ—¶ï¼ŒAï¼ŒB å¯èƒ½åŒæ—¶æ‹¿åˆ°ğŸ”“ï¼Œå¹¶åŒæ—¶ä¸Šé”ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹å¹¶æ²¡æœ‰`çœ‹åˆ°`å¯¹æ–¹é¡µæ‹¿åˆ°äº†é”
    /// æ‰€ä»¥å°±å‡ºå…ˆäº†ï¼Œçº¿ç¨‹ A å’Œ B åŒæ—¶ä»å¯„å­˜å™¨æ‹¿åˆ°å€¼ 1ï¼Œæ”¹ä¸ºäº† 2ï¼Œç„¶åå¤åˆ¶åˆ°å¯„å­˜å™¨å†…ï¼Œåä¿®æ”¹çš„ä¼šè¦†ç›–å‰ä¸€æ¬¡ä¿®æ”¹
    /// ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä¸‹é¢æ˜¯ä¸€äº›è§£å†³æ–¹æ³•
    ///
    /// æ–¹æ¡ˆ 1ï¼Œä½¿ç”¨`compare_exchange`åˆå¹¶åŠ é”ä¸Šé”è¿‡ç¨‹
    /// while self.locked.compare_exchange(UNLOCKED, LOCKED, Ordering::Relaxed, Ordering::Relaxed).is_err() {}
    ///
    /// #1 compare_exchange æ˜¯ä½æ•ˆçš„ï¼Œå¦‚æœæ˜¯å¤šæ ¸éƒ½åœ¨åŒæ—¶äº‰å¤ºé”ï¼Œ8 ä¸ªæ ¸ä¸­æœ‰ä¸€ä¸ªå’Œå…ˆæ‹¿åˆ°äº†é”
    /// é‚£ä¹ˆå‰©ä¸‹çš„ 7 ä¸ªæ ¸ä¾ç„¶ä¼šäº’ç›¸ç«äº‰ï¼Œè¿™ä¸ªå˜é‡çš„å†…å­˜å°±ä¼šåœ¨å¤šä¸ªæ ¸ä¸­ä¸æ–­æ‹·è´
    /// #2 ç›¸æ¯”äº mutexï¼Œmutex æ‹¿ä¸åˆ°é”å°±ä¼šé˜»å¡çº¿ç¨‹ï¼Œè€Œ compare_exchange æ‹¿ä¸åˆ°å°±ä¼šè¿”å›ä¸€ä¸ª Err
    /// #3 rust ä¸­è¿˜æä¾›äº† compare_and_exchange_weakï¼Œæœ€å¤§çš„åŒºåˆ«æ˜¯
    ///     compare_and_exchange åªå…è®¸åœ¨åˆ¤æ–­ Current v alue å’Œä¼ å…¥çš„å€¼ä¸ä¸€æ ·æ—¶è¿”å› Err
    ///     compare_and_exchange_weak å³ä½¿åœ¨ä¸€æ ·çš„æ—¶å€™ä¹Ÿå¯èƒ½ä¼šè¿”å› Errï¼Œè¿™ç§ç»†å°çš„å·®åˆ«èƒ½å¤Ÿç”¨äºæŸäº›åœºæ™¯ï¼Œè®©æ€§èƒ½æ›´å¥½
    ///     åŸå› æ˜¯ç”±äºåœ¨ä¸åŒå¹³å°ä¸Šçš„å®ç°ä¸åŒ
    ///         x86: compare_and_swap
    ///         ARM: LDREX STREX
    ///     åœ¨ x86 ä¸Š weak ä¸æ™®é€šçš„ç›¸åŒï¼Œ
    ///     åœ¨ ARM ä¸Šï¼š
    ///         compare_and_exchange: impl using a loop of LDREX and STREX
    ///         compare_and_exchange_weak: LDREX and STREX with no loop, it may be fake
    pub fn with_lock&lt;R&gt;(&amp;self, f: impl FnOnce(&amp;mut T) -&gt; R) -&gt; R {
        // æ‹¿ğŸ”“ ä¸ŠğŸ”“
        // while self.locked.load(Ordering::Relaxed) != UNLOCKED {}
        // self.locked.store(LOCKED, Ordering::Relaxed);

        // æ–¹æ¡ˆ 1
        // while self.locked.compare_exchange(UNLOCKED, LOCKED, Ordering::Relaxed, Ordering::Relaxed).is_err() {}

        // æ–¹æ¡ˆ 2 åœ¨ arm ä¸‹æœ‰æ›´å¥½çš„æ€§èƒ½
        while self.locked.compare_exchange_weak(UNLOCKED, LOCKED, Ordering::Relaxed, Ordering::Relaxed).is_err() {
            // å‡å¦‚ç°åœ¨ current value å°±æ˜¯ UNLOCKED çŠ¶æ€ï¼Œå·²ç»ä¿®æ”¹ä¸º LOCKED çŠ¶æ€ï¼Œé‚£ä¹ˆå°±å·²ç»æ‹¿åˆ°äº†æ‰€æœ‰æƒ
            // åŠ å…¥ç°åœ¨è¿˜æ²¡æœ‰ä¿®æ”¹å®Œæˆï¼Œcurrent value ä¾ç„¶æ˜¯ UNLOCKED çŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹å°±ä¼šå¡ä½ï¼Œç›´åˆ°æœ‰åˆ«çš„çº¿ç¨‹æˆåŠŸæ‹¿åˆ°äº†æ‰€æœ‰æƒ
            while self.locked.load(Ordering::Relaxed) == LOCKED {
                thread::yield_now();
            }
            thread::yield_now();
        }

        // æš´éœ²æ•°æ®
        let ret = f(unsafe { &amp;mut *self.v.get() });
        // è§£ğŸ”“
        self.locked.store(UNLOCKED, Ordering::Relaxed);
        ret
    }
}

fn main() {
    let l: &amp;'static _ = Box::leak(Box::new(Mutex::new(0)));

    let handles: Vec&lt;_&gt; = (0..1000).map(|_| {
        thread::spawn(move || {
            for _ in 0..1000 {
                l.with_lock(|v| {
                    *v += 1;
                })
            }
        })
    }).collect();

    for handle in handles {
        handle.join().unwrap();
    }

    // è¿™é‡Œä¾ç„¶ä¼šæŠ¥é”™
    assert_eq!(l.with_lock(|v| *v), 1000 * 1000);

}
</code></pre></pre>
<h3 id="acquire-ä¸-release"><a class="header" href="#acquire-ä¸-release">Acquire ä¸ Release</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>/// ä½†æ˜¯å³ä½¿ç”¨äº†ä¸Šé¢çš„ä¸œè¥¿ä¹Ÿæœ‰å¯èƒ½ä¼šå‡ºé—®é¢˜ï¼Œè™½ç„¶åœ¨ X86 64 ä½ç³»ç»Ÿä¸Šæ²¡æœ‰å‡ºç°é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºä»–ä¸æ”¯æŒï¼ï¼Œä»–åªæ”¯æŒ Seq çš„ï¼Œä¸è¿‡è¿˜æ˜¯è¦è¯´æ˜é—®é¢˜
/// å› ä¸ºä¸‹é¢å¯¹å˜é‡ v çš„ä¿®æ”¹å’Œä¸Šé”é‡Šæ”¾é”çš„è¿‡ç¨‹æ¯«ä¸ç›¸å…³ï¼Œ
/// æ‰€ä»¥ä¸‹ä¸€è¡Œå¯èƒ½è¢«é‡æ–°æ’åˆ—åœ¨åŠ é”ä¹‹å‰ï¼Œæˆ–è€…è§£é”ä¹‹åï¼Œè¿™ä¸¤ç§éƒ½æ˜¯ä¸å…è®¸çš„ï¼Œä½†æ˜¯ cpu å’Œç¼–è¯‘å™¨å°±å¯èƒ½è¿™æ ·åš
///
/// å¯¹æ­¤éœ€è¦ä½¿ç”¨ Acquire å’Œ Release
pub fn with_lock2&lt;R&gt;(&amp;self, f: impl FnOnce(&amp;mut T) -&gt; R) -&gt; R {
    // ä»»ä½•ä¹‹åçš„è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åˆ° Acquire ä¹‹å‰
    // åˆ«çš„çº¿ç¨‹ä¸­çš„å†™æ“ä½œï¼Œå¯¹äºè¿™é‡Œçš„ Acquire éƒ½æ˜¯å¯è§çš„
    while self.locked.compare_exchange_weak(UNLOCKED, LOCKED, Ordering::Acquire, Ordering::Relaxed).is_err() {
        while self.locked.load(Ordering::Relaxed) == LOCKED {
            thread::yield_now();
        }
        thread::yield_now();
    }
    let ret = f(unsafe { &amp;mut *self.v.get() });

    // ä»»ä½•ä¹‹å‰çš„è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åˆ° Release ä¹‹å
    // è¿™ä¸ªçº¿ç¨‹é‡Œçš„æ‰€æœ‰å†™æ“ä½œå¯¹åˆ«çš„çº¿ç¨‹ä¸­çš„ Acquire éƒ½æ˜¯å¯è§çš„
    self.locked.store(UNLOCKED, Ordering::Release);
    ret
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="å¿…éœ€ç”¨-seq-çš„åœºæ™¯"><a class="header" href="#å¿…éœ€ç”¨-seq-çš„åœºæ™¯">å¿…éœ€ç”¨ Seq çš„åœºæ™¯</a></h3>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[test]
fn seq_test() {
    // fetch_add always succeed

    let x: &amp;'static _ = Box::leak(Box::new(AtomicBool::new(false)));
    let y: &amp;'static _ = Box::leak(Box::new(AtomicBool::new(false)));
    let z: &amp;'static _ = Box::leak(Box::new(AtomicUsize::new(0)));
    let tx = thread::spawn(move || {
        x.store(true, Ordering::Release);                  // ï¼ï¼ï¼
    });
    let ty = thread::spawn(move || {
        y.store(true, Ordering::Release);
    });
    let t1 = spawn(move || {
        while !x.load(Ordering::Acquire) {}
        if y.load(Ordering::Acquire) {
            z.fetch_add(1, Ordering::Release);
        }
    });
    let t2 = spawn(move || {
        while !y.load(Ordering::Acquire) {}                    // è¿™è¡Œå’Œä¸‹é¢ä¸€è¡Œå¯èƒ½é‡æ’ (æˆ–è€…è¯´ä¸æ˜¯é‡æ’ï¼Œå•çº¯æ—¶å¯è§æ€§çš„é—®é¢˜ï¼Œä¸‹é¢çš„ x å°±æ˜¯çœ‹åˆ°äº† x æ˜¯ false)
        if x.load(Ordering::Acquire) {                         // ï¼ï¼ï¼x ä¸º falseï¼Œå½“ x è¢«ä¿®æ”¹ä¸º true åï¼Œä¹Ÿä¸ä¼šå‘ç”Ÿæ”¹å˜
            z.fetch_add(1, Ordering::Release);
        }
    });
    println!(&quot;{}&quot;, z.load(Ordering::SeqCst));

    // What are the possibles for z?
    // - is 0 possibly ?
    //   ç»è¿‡åˆ¤æ–­ï¼Œè‡³å°‘æœ‰ä¸‹é¢çš„æ¡ä»¶
    //     t1 must run after tx
    //     t2 must run after ty
    //   å‡ ç§æ’åˆ—ç»„åˆåº”è¯¥æ˜¯ 1 æˆ– 2ï¼Œæ²¡æœ‰ 0
    //   ä½†æ˜¯ 0 è¿˜æ˜¯å¯èƒ½çš„ï¼Œ
    //           t2    t1,t2
    //   MO(x)  false  true
    //           t1    t1,t2
    //   MO(y)  false  true
    // - is 1 possibly ?
    //   Yes: tx -&gt; t1 -&gt; ty -&gt; t2
    // - is 2 possibly ?
    //   Yes: tx -&gt; ty -&gt; t1 -&gt; t2

}
<span class="boring">}
</span></code></pre></pre>
<h2 id="3-å¸¸ç”¨-trait"><a class="header" href="#3-å¸¸ç”¨-trait">3. å¸¸ç”¨ Trait</a></h2>
<h3 id="31-read"><a class="header" href="#31-read">3.1 Read</a></h3>
<p>Read Trait çš„åŠŸèƒ½æ˜¯ï¼šä»æ•°æ®æºæ‹‰å– (Pull) ä¸€å®šæ•°æ®åˆ°æŒ‡å®šçš„ç¼“å†²åŒºï¼Œè¿”å›è¯»å–çš„å­—èŠ‚æ•°ã€‚</p>
<p><strong>å…³äºé˜»å¡ï¼š</strong> read å‡½æ•°ä¸ä¿è¯ Read æ˜¯å¦ä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ª read è¿‡ç¨‹é˜»å¡äº†è€Œä¸”ç­‰å¾…å¤±è´¥ï¼Œé‚£ä»–å°±ä¼šè¿”å›ä¸€ä¸ª [<code>Err</code>] æ ‡è®°ã€‚</p>
<p><strong>å…³äºè¿”å›å€¼ï¼š</strong> å¦‚æœ<code>read()</code>è¿”å›çš„æ˜¯ [<code>OK(n)</code>] , å®ƒçš„å®ç°å°±å¿…é¡»ä¿è¯<code>0 &lt;- n &lt; buf.len()</code>ã€‚
å¦‚æœ<code>n == 0</code>ï¼Œé‚£å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>reader å·²ç»åˆ°è¾¾äº†<code>the end of file</code>ï¼Œè€Œä¸”è¿™ä¸ª<code>file</code>å¯èƒ½ä¸ä¼šåœ¨äº§ç”Ÿæ–°æ•°æ®ã€‚æ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯ likelyï¼Œæ¯”å¦‚ï¼šåœ¨ linux
ç³»ç»Ÿä¸­ï¼Œread å¯èƒ½å¯¹ä¸€ä¸ª [<code>TcpStream</code>] è°ƒç”¨äº†<code>recv</code>ç³»ç»Ÿè°ƒç”¨ï¼Œ0 ä»£è¡¨è¿™ä¸ªè¿æ¥å·²ç»è¢«æˆåŠŸå…³é—­ï¼Œå¦‚æœæ˜¯å¯¹ [<code>File</code>] ,
é‚£å°±å¯èƒ½æ„å‘³ç€ç¡®å®è¯»å–åˆ°äº†æ–‡ä»¶çš„æœ«å°¾ï¼Œä½†æ˜¯å¦‚æœæœ‰æ›´å¤šçš„æ•°æ®è¢«è¿½åŠ  (append) åˆ°æ–‡ä»¶æœ«å°¾ï¼Œé‚£ä¹ˆæœªæ¥çš„ read æ“ä½œä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿”å›è¢«è¿½åŠ çš„æ•°æ®</li>
<li>ç¼“å†²åŒº (buffer) å¤§å°ç¡®å®å°±æ˜¯ 0</li>
</ol>
<p><code>n</code> åªè¦å°äºç¼“å†²åŒºçš„é•¿åº¦ä¸€èˆ¬å°±ä¸æ˜¯ä¸ªé”™è¯¯ï¼Œå³ä½¿æ–‡ä»¶è¿˜æ²¡æœ‰è¢«è¯»å–å®Œï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šå‘ç”Ÿåœ¨ï¼Œå½“å‰åªæœ‰ä¸€éƒ¨åˆ†æ•°æ®æ˜¯å¯ç”¨çš„ï¼Œæˆ–è€…æ˜¯ read æ“ä½œè¢«ä¸€ä¸ªä¿¡å·æ‰“æ–­äº†</p>
<p><strong>å…³äºå®‰å…¨æ€§ï¼š</strong></p>
<ul>
<li>
<p>å› ä¸ºå®ç°è¿™ä¸ª Trait æ˜¯å®‰å…¨çš„ï¼Œè°ƒç”¨è€…ä¸èƒ½ç”¨ <code>n &lt; buf.len()</code> å»ç¡®ä¿å®‰å…¨ï¼Œä½¿ç”¨ unsafe æ˜¯æ›´è¦å°å¿ƒç¡®ä¿è¯¸å¦‚è¶Šç•Œé—®é¢˜æ˜¯å¦ä¼šå‘ç”Ÿã€‚</p>
</li>
<li>
<p>read ä¸ä¿è¯ buf é‡Œçš„æ•°æ®æ˜¯å¯¹çš„ï¼Œæ‰€ä»¥ä¸æ¨èè¯»å–ç¼“å†²åŒºé‡Œçš„æ•°æ®ï¼Œåªæ¨èå‘ç¼“å†²åŒºé‡Œå†™å…¥æ•°æ®</p>
</li>
<li>
<p>ç›¸åº”çš„ï¼Œè°ƒç”¨è€…ä¸èƒ½æœ‰ä»»ä½•å‡è®¾ï¼Œè¿™ä¸ª buf ä¼šè¢« read æ€ä¹ˆä½¿ç”¨ï¼Œread å‡½æ•°ä¹Ÿå¯èƒ½ä¼šä»ä¸­è¯»å–å†…å®¹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯åœ¨è°ƒç”¨ read å‰ï¼Œè¿™ä¸ª buf
å·²ç»è¢«åˆå§‹åŒ–è¿‡äº†ï¼Œè°ƒç”¨æ²¡æœ‰è¢«åˆå§‹åŒ–çš„ buf æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸º</p>
</li>
</ul>
<p>*<strong>å…³äºé”™è¯¯ï¼š</strong> å¦‚æœé‡åˆ°äº† Errorï¼Œé‚£å°±å¿…é¡»ä¿è¯æ²¡æœ‰è¯»å–è¿‡ä»»ä½•å­—èŠ‚ï¼Œå¦‚æœé‡åˆ°äº†<code>ErrorKind::Interrupted</code>ï¼Œè€Œä¸”ä¸èƒ½ä½œåˆ«çš„äº‹æ—¶ï¼Œ
è¯»å–è¿‡ç¨‹å°±å¿…é¡»è¢«å›æ»š</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¥è‡ª doc çš„ä¾‹å­</p>
<pre><pre class="playground"><code class="language-rust">use std::io;
use std::io::prelude::*;
use std::fs::File;
fn main() -&gt; io::Result&lt;()&gt; {
    let mut f = File::open(&quot;foo.txt&quot;)?;
    let mut buffer = [0; 10];
    // read up to 10 bytes
    let n = f.read(&amp;mut buffer[..])?;
    println!(&quot;The bytes: {:?}&quot;, &amp;buffer[..n]);
    Ok(())
}
</code></pre></pre>
<h3 id="32-write"><a class="header" href="#32-write">3.2 Write</a></h3>
<p>Write çš„åŸºæœ¬åŠŸèƒ½å°±æ˜¯å‘ writer ä¸­å†™å…¥ä¸€æ®µ bufï¼Œè¿”å›å†™å…¥çš„å­—èŠ‚æ•° <strong>å…³äºé˜»å¡ï¼š</strong> write ä¼šå°è¯•å‘ writer ä¸­å†™å…¥æ•´ä¸ª buf
é‡Œçš„å†…å®¹ï¼Œä½†æ˜¯å†™å…¥å¯èƒ½ä¸æˆåŠŸï¼Œæˆ–è€…å†™å…¥æ—¶äº§ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼Œè°ƒç”¨ä¸€æ¬¡ write æ„å‘³ç€æœ€å¤šä¸€æ¬¡å°è¯•å†™å…¥ write å‡½æ•°åŒæ ·ä¸ä¿è¯ Write
æ˜¯å¦å¤„äºé˜»å¡çŠ¶æ€ä»¥ç­‰å¾…æ•°æ®è¢«å†™å…¥ï¼Œå¦‚æœä¸€æ¬¡å†™å…¥é˜»å¡äº†ï¼Œä»–å¯èƒ½ä¼šè¿”å›ä¸€ä¸ª [<code>Err</code>]ã€‚</p>
<p><strong>å…³äºè¿”å›å€¼ï¼š</strong> å¦‚æœ<code>write()</code>è¿”å›çš„æ˜¯ [<code>OK(n)</code>] , å®ƒçš„å®ç°å°±å¿…é¡»ä¿è¯<code>0 &lt;- n &lt; buf.len()</code>ã€‚
å¦‚æœ<code>n == 0</code>ï¼Œé‚£å¯èƒ½æœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ol>
<li>è¢«å†™å…¥çš„ä¸œè¥¿å·²ç»ä¸ä¼šæ¥å—æ–°æ•°æ®äº†ï¼Œä¹‹åä¹Ÿä¸ä¸€å®šä¼š</li>
<li>ç¼“å†²åŒº (buffer) å¤§å°ç¡®å®å°±æ˜¯ 0</li>
</ol>
<p><code>n</code> åªè¦å°äºç¼“å†²åŒºçš„é•¿åº¦ä¸€èˆ¬å°±ä¸æ˜¯ä¸ªé”™è¯¯ï¼Œå³ä½¿æ–‡ä»¶è¿˜æ²¡æœ‰è¢«è¯»å–å®Œï¼Œè¿™ç§æƒ…å†µå¯èƒ½ä¼šå‘ç”Ÿåœ¨ï¼Œå½“å‰åªæœ‰ä¸€éƒ¨åˆ†æ•°æ®æ˜¯å¯ç”¨çš„ï¼Œæˆ–è€…æ˜¯ read æ“ä½œè¢«ä¸€ä¸ªä¿¡å·æ‰“æ–­äº†</p>
<p>*<strong>å…³äºé”™è¯¯ï¼š</strong> å¦‚æœé‡åˆ°äº† Errorï¼Œé‚£å°±å¿…é¡»ä¿è¯æ²¡æœ‰ä»»ä½•å­—èŠ‚è¢«æˆåŠŸå†™å…¥ è¿”å›å€¼å°äº buf çš„é•¿åº¦ä¸è¢«å½“æˆæ˜¯é”™è¯¯
å¦‚æœé‡åˆ°äº†<code>ErrorKind::Interrupted</code>ï¼Œè€Œä¸”ä¸èƒ½ä½œåˆ«çš„äº‹æ—¶ï¼Œå†™å…¥è¿‡ç¨‹å°±å¿…é¡»è¢«å›æ»š</p>
<p>åŒæ ·æ˜¯å®˜æ–¹çš„ demo</p>
<pre><pre class="playground"><code class="language-rust">use std::io::prelude::*;
use std::fs::File;
fn main() -&gt; std::io::Result&lt;()&gt; {
    let mut buffer = File::create(&quot;foo.txt&quot;)?;
    // Writes some prefix of the byte string, not necessarily all of it.
    buffer.write(b&quot;some bytes&quot;)?;
    Ok(())
}
</code></pre></pre>
<h3 id="33-seek--bufreader--bufwriter"><a class="header" href="#33-seek--bufreader--bufwriter">3.3 Seek &amp; BufReader &amp; BufWriter</a></h3>
<p>[<code>Read</code>] å’Œ [<code>Write</code>] æ˜¯æœ€é‡è¦çš„ä¸¤ä¸ª Traitï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„ Trait[<code>Seek</code>] å’Œ [<code>BufRead</code>],
è¿™ä¸¤ä¸ªéƒ½å»ºç«‹åœ¨ reader åªä¸Šï¼Œç”¨æ¥æ§åˆ¶ read çš„è¿‡ç¨‹ã€‚</p>
<p>[<code>Seek</code>] è®©ä½ æ§åˆ¶ä¸‹ä¸€ä¸ªå­—èŠ‚å°†è¦è¯»å–çš„æ¥è‡ªå“ªé‡Œ</p>
<pre><pre class="playground"><code class="language-rust">use std::io;
use std::io::prelude::*;
use std::io::SeekFrom;
use std::fs::File;
fn main() -&gt; io::Result&lt;()&gt; {
    let mut f = File::open(&quot;foo.txt&quot;)?;
    let mut buffer = [0; 10];
    // skip to the last 10 bytes of the file
    f.seek(SeekFrom::End(-10))?;
    // read up to 10 bytes
    let n = f.read(&amp;mut buffer)?;
    println!(&quot;The bytes: {:?}&quot;, &amp;buffer[..n]);
    Ok(())
}
</code></pre></pre>
<p>åŸºäº byte çš„æ¥å£æ€§èƒ½ä¸ä½³ï¼Œæ‰€ä»¥æä¾›äº†å¾ˆå¤šåŸºäº buffer çš„æ¥å£ [<code>BufRead</code>] å°±æä¾›äº†æ›´å¤š Read ç›¸å…³çš„ API</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let f = File::open(&quot;foo.txt&quot;)?;
let mut reader = BufReader::new(f);
let mut buffer = String::new();
// read a line into buffer
reader.read_line(&amp;mut buffer)?;
<span class="boring">}
</span></code></pre></pre>
<p>[<code>BufWriter</code>] æ²¡æœ‰æä¾›æ›´å¤šå†™å…¥çš„æ–¹æ³•ï¼Œä»–åªæ˜¯ç¼“å†²äº†æ¯æ¬¡è°ƒç”¨</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let f = File::create(&quot;foo.txt&quot;)?;
{
    let mut writer = BufWriter::new(f);

    // write a byte to the buffer
    writer.write(&amp;[42])?;

} // the buffer is flushed once writer goes out of scope
<span class="boring">}
</span></code></pre></pre>
<h2 id="4-å…¶ä»–"><a class="header" href="#4-å…¶ä»–">4. å…¶ä»–</a></h2>
<h3 id="2-rc--arc"><a class="header" href="#2-rc--arc">2. Rc &amp; Arc</a></h3>
<h4 id="ä»‹ç»"><a class="header" href="#ä»‹ç»">ä»‹ç»</a></h4>
<blockquote>
<p>The key to our design is the RefCell type. The heart of RefCell is a pair of
methods:</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn borrow(&amp;self) -&gt; Ref&lt;'_, T&gt;;
fn borrow_mut(&amp;self) -&gt; RefMut&lt;'_, T&gt;;
<span class="boring">}
</span></code></pre></pre>
<blockquote>
<p>Introducing inherited mutability roots to shared types Shared smart pointer
types, including Rc and Arc, provide containers that can be cloned and shared
between multiple parties. Because the contained values may be
multiply-aliased, they can only be borrowed as shared references, not mutable
references. Without cells it would be impossible to mutate data inside of
shared boxes at all!</p>
</blockquote>
<blockquote>
<p>It's very common then to put a RefCell inside shared pointer types to
reintroduce mutability:</p>
</blockquote>
<pre><pre class="playground"><code class="language-rust">use std::collections::HashMap;
use std::cell::RefCell;
use std::rc::Rc;
fn main() {
    let shared_map: Rc&lt;RefCell&lt;_&gt;&gt; = Rc::new(RefCell::new(HashMap::new()));
    shared_map.borrow_mut().insert(&quot;africa&quot;, 92388);
    shared_map.borrow_mut().insert(&quot;kyoto&quot;, 11837);
    shared_map.borrow_mut().insert(&quot;piccadilly&quot;, 11826);
    shared_map.borrow_mut().insert(&quot;marbles&quot;, 38);
}
</code></pre></pre>
<blockquote>
<p>Note that this example uses Rc and not Arc. RefCells are for single-threaded
scenarios. Consider using Mutex if you need shared mutability in a
multi-threaded situation</p>
</blockquote>
<h4 id="try_unwrap"><a class="header" href="#try_unwrap">try_unwrap()</a></h4>
<blockquote>
<p>Get T from Rc&lt;T&gt; try to use <code>try_unwrap()</code>, which moves out the contents
of an Rc if its refcount is 1 ::: warning unwrap on Result requires that you
can debug-print the error case. RefCell only implements Debug if T does. Node
doesn't implement Debug. try:
Rc::try_unwrap(old_head).ok().unwrap().into_inner().elem :::</p>
</blockquote>
<h3 id="4-cell--refcell"><a class="header" href="#4-cell--refcell">4. Cell &amp; RefCell</a></h3>
<blockquote>
<p>Shareable mutable containers.</p>
<p>Values of the Cell and RefCell types may be mutated through shared references
(i.e. the common &amp;T type), whereas most Rust types can only be mutated through
unique (&amp;mut T) references. We say that Cell and RefCell provide 'interior
mutability', in contrast with typical Rust types that exhibit 'inherited
mutability'.</p>
<p>Cell types come in two flavors: Cell and RefCell. Cell provides get and set
methods that change the interior value with a single method call. Cell though
is only compatible with types that implement Copy. For other types, one must
use the RefCell type, acquiring a write lock before mutating.</p>
<p>RefCell uses Rust's lifetimes to implement 'dynamic borrowing', a process
whereby one can claim temporary, exclusive, mutable access to the inner value.
Borrows for RefCells are tracked 'at runtime', unlike Rust's native reference
types which are entirely tracked statically, at compile time. Because RefCell
borrows are dynamic it is possible to attempt to borrow a value that is
already mutably borrowed; when this happens it results in thread panic.</p>
</blockquote>
<h3 id="5-ref--refmut"><a class="header" href="#5-ref--refmut">5. Ref &amp; RefMut</a></h3>
<h4 id="refmap"><a class="header" href="#refmap">Ref::map()</a></h4>
<ol>
<li>example1</li>
</ol>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>map(Ref&lt; T&gt;, f: F) -&gt; Ref&lt;U&gt;
// Get Ref&lt;T&gt; from Ref&lt;Node&lt;T&gt;&gt;
// my example
pub fn peek_front(&amp;self) -&gt; Option&lt;Ref&lt;T&gt;&gt; {
    self.head.as_ref().map(|node| {
        Ref::map(node.borrow(), |node| &amp;node.elem)
    })
}
<span class="boring">}
</span></code></pre></pre>
<ol start="2">
<li>example2</li>
</ol>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// Makes a new Ref for a component of the borrowed data.

// The RefCell is already immutably borrowed, so this cannot fail.

// This is an associated function that needs to be used as Ref::map(...). A method would interfere with methods of the same name on the contents of a RefCell used through Deref.

use std::cell::{RefCell, Ref};

let c = RefCell::new((5, 'b'));
let b1: Ref&lt;(u32, char)&gt; = c.borrow();
let b2: Ref&lt;u32&gt; = Ref::map(b1, |t| &amp;t.0);
assert_eq!(*b2, 5)
<span class="boring">}
</span></code></pre></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../docs/rust/rust_quiz.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../docs/rust/print_into_detail.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../docs/rust/rust_quiz.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../docs/rust/print_into_detail.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
