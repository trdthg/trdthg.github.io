<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-java/java">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Java | Trdthg&#x27;s blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://trdthg.github.io//docs/java"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Java | Trdthg&#x27;s blog"><meta data-rh="true" name="description" content="基础知识"><meta data-rh="true" property="og:description" content="基础知识"><link data-rh="true" rel="icon" href="/img/logo_png.png"><link data-rh="true" rel="canonical" href="https://trdthg.github.io//docs/java"><link data-rh="true" rel="alternate" href="https://trdthg.github.io//docs/java" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://trdthg.github.io//docs/java" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Trdthg&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Trdthg&#39;s blog Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TM86KZ83J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4TM86KZ83J",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.6b28552f.css">
<link rel="preload" href="/assets/js/runtime~main.fa327763.js" as="script">
<link rel="preload" href="/assets/js/main.e82f1fb6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_png.png" alt="Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_png.png" alt="Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Trdthg</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">文档</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/草稿">草稿</a><button aria-label="打开/收起侧边栏菜单「草稿」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/frontend/css">frontend</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">个人博客</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/ioclub/backend_1">ioclub</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible menu__list-item-collapsible--active"><a class="menu__link menu__link--sublist menu__link--active" aria-current="page" aria-expanded="true" href="/docs/java">Java</a><button aria-label="打开/收起侧边栏菜单「Java」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/java/sourceread">集合框架</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/java/spring">Spring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/java/springboot">SprintBoot</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/log">日志</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/magic/async">magic</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/other/analyze">other</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/projects/mini_bundle">projects</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/rust">Rust</a><button aria-label="打开/收起侧边栏菜单「Rust」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Java</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Java</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="基础知识">基础知识<a class="hash-link" href="#基础知识" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="for-和-whiletrue-的区别">for(;;) 和 while(true) 的区别<a class="hash-link" href="#for-和-whiletrue-的区别" title="标题的直接链接">​</a></h3><p>虽然两者都能实现死循环，但是源码中都是选择 for(;;) 原因：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">编译前              编译后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while (1)           mov eax,1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    test eax,eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    je foo+23h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    jmp foo+18h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">编译前              编译后</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (;;)          jmp foo+23h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>对比之下，for (;;) 指令少，不占用寄存器，而且没有判断跳转，比 while (1) 好。
也就是说两者在在宏观上完全一样的逻辑，但是底层完全不一样，for 相对于来说更加简洁明了。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="equal-与的区别">equal 与==的区别<a class="hash-link" href="#equal-与的区别" title="标题的直接链接">​</a></h3><ol><li>区别</li></ol><ul><li>==是运算符，equal 是方法，</li><li>比较基本类型：只能用==, 不能用 equal</li><li>比较包装类型：==比较的是内存地址，而 equal 比较的是值</li><li>比较对象：==和 equal 比较的都是内存地址，因为 equal 没有被重写，没有被重写的 equal 都是 object 的 equal 方法 ::: warning
注意 String（还有 Date，Integer）类型重写了 equals 方法，使其比较的是存储对象的内容是否相等，而不是堆内存地址。 :::</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="classthis-和-this-的区别">Class.this 和 this 的区别<a class="hash-link" href="#classthis-和-this-的区别" title="标题的直接链接">​</a></h3><p>当 inner class（内部类）必顺使用到 outer class（外部类）的 this instance（实例）时，或者匿名内部类要使用外部类的实例。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="待续">待续...<a class="hash-link" href="#待续" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="包装类">包装类<a class="hash-link" href="#包装类" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="int-vs-integer">int VS Integer<a class="hash-link" href="#int-vs-integer" title="标题的直接链接">​</a></h3><h5 class="anchor anchorWithStickyNavbar_LWe7" id="初始化">初始化<a class="hash-link" href="#初始化" title="标题的直接链接">​</a></h5><ul><li>1 int 类的变量初始为 0. Integer 的变量则初始化为 null.</li><li>2 Integer 变量必须实例化后才能使用，int 变量不需要 .</li><li>3 在 Int 是将值直接存储，Integer 对象是生成指针指向此对象。</li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="比较">比较<a class="hash-link" href="#比较" title="标题的直接链接">​</a></h5><ol><li>Integer ? int <code>&lt;br/&gt;</code> 只要两个变量的值是向等的，则结果为 true。
因为包装类 Integer 和基本数据类型 int 比较时，java 会自动拆包装为 int，然后进行比较，实际上就变为两个 int 变量的比较。</li><li>new Integer() ? !new Integer()，<code>&lt;br/&gt;</code> 结果为 false ! new
Integer() 当变量值在 -128~127 之间时，非 new 生成的 Integer 变量指向的是 java 常量池中 cache 数组中存储的指向了堆中的 Integer 对象，
而 new Integer() 生成的变量指向堆中新建的对象，两者在内存中的地址不同；</li><li>new Interger() ? new Integer() <code>&lt;br/&gt;</code> false</li><li>!new Integer() ? !new Integer() <code>&lt;br/&gt;</code> 如果两个值相等，且在区间 -128 到 127 之间则 true
只要不同或者有值在区间外就不相同</li></ol><h5 class="anchor anchorWithStickyNavbar_LWe7" id="应用">应用<a class="hash-link" href="#应用" title="标题的直接链接">​</a></h5><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Integer a = Integer.parseInt(&quot;1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Integer b = Integer.parseInt(&quot;1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">synchronized(i)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="析构函数">&quot;析构函数&quot;<a class="hash-link" href="#析构函数" title="标题的直接链接">​</a></h2><p>java 提供 finalize() 方法，垃圾回收器准备释放内存的时候，会先调用 finalize()。</p><ul><li>特征</li></ul><ol><li>对象不一定会被回收。</li><li>垃圾回收不是析构函数。</li><li>垃圾回收只与内存有关。</li><li>垃圾回收和 finalize() 都是靠不住的，只要 JVM 还没有快到耗尽内存的地步，它是不会浪费时间进行垃圾回收的。</li></ol><ul><li>应对方法</li></ul><ol><li>主动调用 System.gc() 方法强制垃圾回收器来释放这些对象的内存。</li><li>Java 1.1 通过提供一个 System.runFinalizersOnExit() 方法，不象 System.gc()
方法那样，System.runFinalizersOnExit() 方法并不立即试图启动垃圾回收器。而是当应用程序或 Applet
退出时，它调用每个对象的 finalize() 方法。</li><li>继承 finalize()</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="泛型">泛型<a class="hash-link" href="#泛型" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="t-的位置">T 的位置<a class="hash-link" href="#t-的位置" title="标题的直接链接">​</a></h3><ol><li>示例</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static &lt;T&gt; void show(Collection&lt;T&gt; C) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;使用泛型 -------&gt;&quot; + C);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>解释</li></ol><ul><li>第一处：静态方法不能直接引用类定义处的泛型，需要提前定义好泛型才能使用</li><li>第二处：指定 Collection 的元素类型为 T</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="边界通配符">边界通配符<a class="hash-link" href="#边界通配符" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;? extends T&gt;和&lt;? super T&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol><li>引例</li></ol><ul><li>这种情况下是可行的</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Plate&lt;Fruit&gt; plate = new Plate&lt;&gt;(apple);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>这种情况下，虽然苹果和水果有继承关系，但盘子间没有继承关系会报错</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Plate&lt;Fruit&gt; plate = new Plate&lt;Apple&gt;(apple);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>上下界通配符</li></ol><ul><li>Apple -&gt; Fruit -&gt; Food</li><li><code>&lt;? extends T&gt;</code> 可以是任何 T 的子类</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Plate&lt;? extends Food&gt; plate = new Plate&lt;Fruit&gt;(apple);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>&lt;? super T&gt;</code> 可以是任何 T 的父类</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Plate&lt;? super Apple&gt; plate = new Plate&lt;Food&gt;(fruit);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>上下界通配符的副作用</li></ol><ul><li>上界<code>&lt;? extends T&gt;</code>不能往里存，只能往外取</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Plate&lt;? extends Food&gt; plate = new Plate&lt;Fruit&gt;(apple);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Food a = plate.getItem();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// plate.setItem(food);  失效</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>下界&lt;? super T&gt;不影响往里存，但往外取只能放在 Object 对象里</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Plate&lt;? super Apple&gt; plate = new Plate&lt;Food&gt;(fruit);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">plate2.setItem(apple);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Apple b = plate2.getItem(); 失效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 元素的类型信息全部丢失。</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>::: tip 补充</p><ul><li>?与 T 的区别</li><li>对编译器来说所有的 T 都代表同一种类型。比如下面这个泛型方法里，三个 T 都指代同一个类型，要么都是 String，要么都是 Integer。</li><li>但通配符<code>&lt;?&gt;没有这种约束，Plate&lt;?&gt;</code>单纯的就表示：盘子里放了一个东西，是什么我不知道。所以题主问题里的错误就在这里，Plate&lt;？
extends Fruit&gt;里什么都放不进去。 :::</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="注解">注解<a class="hash-link" href="#注解" title="标题的直接链接">​</a></h2><ol><li>注解会影响程序的编译和运行</li><li>注解本身只是一个标注，本身不用包含逻辑处理内容</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="作用范围">作用范围<a class="hash-link" href="#作用范围" title="标题的直接链接">​</a></h3><ul><li>RUNTIME：程序运行时起作用，例如：<code>@WebServlet</code></li><li>SOURCE：编译时期作用，例如 <code>@Override</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="target">@Target<a class="hash-link" href="#target" title="标题的直接链接">​</a></h3><p>指定注解针对的目标</p><ul><li>ElementType.Type 类、方法</li><li>ElementType.Field 成员变量</li><li>ElementType.METHOD 成员方法</li><li>ElementType.PARAMETER 方法参数</li><li>ElementType.CONSTRUCTOR 构造器</li><li>ElementType.PACKAGE 包</li><li>ElementType.ANNOTATION_TYPE 注解</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retention">@Retention<a class="hash-link" href="#retention" title="标题的直接链接">​</a></h3><p>指定注解的保留域</p><ul><li>RetentionPolicy.SOURCE 源代码级别，由编译器处理，处理后不再保留</li><li>RetentionPolicy.CLASS 注解信息保留到 class 文件中</li><li>RetentionPolicy.RUNTION 由 jvm 读取，运行时使用</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="示例">示例<a class="hash-link" href="#示例" title="标题的直接链接">​</a></h3><ol><li>注解类</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@Target(ElementType.METHOD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface InitAnno {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>被注解类</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @InitAnno</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void bar() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;进入了 bar 方法&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Main</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Class&lt;?&gt; clazz = Class.forName(&quot;Foo&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Annotation annotation = clazz.getAnnotation(InitAnno.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (annotation == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;类前没有 InitAnno 注解&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Method[] methods = clazz.getMethods();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (Method method : methods) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isInitAnno = method.isAnnotationPresent(InitAnno.class);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (isInitAnno) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            method.invoke(clazz.getConstructor(null).newInstance(null), null);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="多线程">多线程<a class="hash-link" href="#多线程" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实现">实现<a class="hash-link" href="#实现" title="标题的直接链接">​</a></h3><ol><li>继承 Thread 类</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MyThread thread = new MyThread();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread.start();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>实现 Runnable 接口</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MyRunnable runnable = new MyRunnable();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread thread = new Thread(runnable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread thread = new Thread(new MyRunnable() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for(int i = 0;i&lt;100;i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;MyRunnable1&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread.start();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>::: tip 提示 Runnable 相比 Thread 耦合低，lambda 表达式更低 ::: 3. 实现 Callable 接口</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Callable&lt;String&gt; callable = () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;进去了&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &quot;Hello&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FutureTask&lt;String&gt; featureTask = new FutureTask&lt;&gt;(callable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Thread thread = new Thread(featureTask);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(featureTask.get());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意！Callable 与 Thread 没有直接关系，需要间接实现</p></blockquote><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Sets this Future to the result of its computation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * unless it has been cancelled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void run();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Callable&lt;V&gt; callable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">graph LR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A[Callable] --&gt;B(FutureTask) --&gt; C(RunnableFuture) --&gt; D(Runnable) --&gt; E(Thread)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="常用方法">常用方法<a class="hash-link" href="#常用方法" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1. 休眠</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread.sleep(3000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. 合并</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thread.join(3000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. 礼让</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">yield();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="线程同步">线程同步<a class="hash-link" href="#线程同步" title="标题的直接链接">​</a></h3><p>每个 java 对象都有一个内置锁，内置锁会保护使用 synchronized 关键字修饰的方法 要调用该方法必须先获取锁，否则就处于堵塞状态</p><ul><li>静态变量</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class SameRunnable implements Runnable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static int num = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ++num;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Thread.sleep(10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;第&quot; + Thread.currentThread().getName() + &quot;位访客是第&quot; + num + &quot;个&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>静态代码块，锁定类 synchronized 关键字也能修饰代码块，以下例子也能有相同的效果</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 5; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread thread = new Thread(new Runnable() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Test test = new Test();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    test.print();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }).start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized void print() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized (Test.class) {    // 锁定类 (非静态可 this), 不能是类的实例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;开始&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.currentThread().sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;结束&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>锁定实例方法 ::: danger 注意 synchronized 关键字只是修饰共享的资源，下面的例子不能得到想要的效果 :::</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public synchronized void print() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;开始&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Thread.currentThread().sleep(1000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    System.out.println(&quot;结束&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="线程安全的单例模式">线程安全的单例模式<a class="hash-link" href="#线程安全的单例模式" title="标题的直接链接">​</a></h3><ul><li>锁定类</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public volatile class Runner {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static Runner runner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 记得加关键字，防止多个线程访问时还没创建过对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 1. 🔒整个方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized static Runner getRunner() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (runner == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            runner = new Runner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return runner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 只锁代码块，不影响该方法内的其他业务</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Runner getRunner() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized(Runner.class) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (runner == null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                runner = new Runner();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return runner;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>::: tip 其他锁定对象</p><ol><li>synchronized(runner): n 个空指针异常，不能锁空对象</li><li>Integer i = Integer.parseInt(&quot;1&quot;); synchronized(i): 也可以</li><li>Integer a = Integer.parseInt(&quot;1&quot;); Integer b = Integer.parseInt(&quot;1&quot;);
synchronized(i) 开启两个线程，若 a,b 值 (详情见 Integer 包装类) 相同，则线程安全，否则不安全 :::</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="voletile-关键字">voletile 关键字<a class="hash-link" href="#voletile-关键字" title="标题的直接链接">​</a></h3><ol><li>引例</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class exam {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int num = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int finalNum = num;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Thread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            while (finalNum == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TimeUnit.SECONDS.sleep(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>在该例子中，循环不会停止 new Thread 与 main 同时操作 num，他们分别从主内存复制到工作内存，对各自的工作内存中的数据进行操作，
main 线程对 num+1，同步到主线程，但 new Thread 的任务未停止，没有与主内存同步，循环不会终止</li><li>若循环中加一个执行语句，循环会终止，工作内存会即使与主内存进行同步</li></ul><p>当各个线程操作时，数据没有进行同步到主内存，产生错误 voletile 关键字使多个线程直接操作主内存，不在经过工作内存</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="待续-1">待续...<a class="hash-link" href="#待续-1" title="标题的直接链接">​</a></h3><h2 class="anchor anchorWithStickyNavbar_LWe7" id="juc">JUC<a class="hash-link" href="#juc" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="特征">特征<a class="hash-link" href="#特征" title="标题的直接链接">​</a></h3><p>synchronized 与 Lock 对比</p><ol><li>synchronized 自动上锁解锁，Lock 手动上锁解锁</li><li>synchronized 无法判断是否获取到锁，Lock 可以</li><li>synchronized 拿不到锁会一直等待，Lock 不会</li><li>synchronized 是关键字，jvm 实现，Lock 是接口，jdk 实现</li><li>synchronized 是非公平锁，Lock 自由设置</li></ol><blockquote><p>公平锁：多个线程排队加锁<code>&lt;br/&gt;</code> 非公平锁：不判断是否有其他等待线程，直接占用</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="基本操作">基本操作<a class="hash-link" href="#基本操作" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">private Lock lock = new ReentrantLock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lock.lock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lock.unlock();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="死锁">死锁<a class="hash-link" href="#死锁" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* num = 1 的人拿到 chopsticks1，等待 chopsticks2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* num = 2 的人拿到 chopsticks2，等待 chopsticks1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public void run() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (num == 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized (chopsticks1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Thread.sleep(100);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            synchronized (chopsticks2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(&quot;1 吃完了&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (num == 2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        synchronized (chopsticks2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            synchronized (chopsticks1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(&quot;2 吃完了&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="生产者消费者">生产者消费者<a class="hash-link" href="#生产者消费者" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 1. synchronize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Container {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int num = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized void add() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (num != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.wait();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num += 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TimeUnit.SECONDS.sleep(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(Thread.currentThread().getName() + &quot;生产了 1 个，还有&quot; + num + &quot;个&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.notify();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public synchronized void pop(int i) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (num == 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.wait();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num -= 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(i + &quot;购买了 1 个，还有&quot; + num + &quot;个&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.notify();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 2. Lock 要以 condition.await 和 condition.singal 代替 wait 和 notify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Container2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private int num = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ReentrantLock lock = new ReentrantLock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Condition condition = lock.newCondition();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void add() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.lock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while (num != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            condition.await();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num += 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TimeUnit.SECONDS.sleep(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(Thread.currentThread().getName() + &quot;生产了 1 个，还有&quot; + num + &quot;个&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        condition.signal();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.unlock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="trylock">tryLock<a class="hash-link" href="#trylock" title="标题的直接链接">​</a></h3><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class TimeLock {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private final ReentrantLock lock = new ReentrantLock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void tryLock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (lock.tryLock(3, TimeUnit.SECONDS)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(&quot;3 秒内拿到了锁&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                TimeUnit.SECONDS.sleep(5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(&quot;3 秒内没拿到锁&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (lock.isHeldByCurrentThread()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                lock.unlock();  // 只能由上锁者去解锁</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="同时读写">同时读写<a class="hash-link" href="#同时读写" title="标题的直接链接">​</a></h3><ol><li>对 ArrayList 读写操作同时存在会抛出异常</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ReadAndWrite {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //List&lt;String&gt; list = new Vector&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // List&lt;String&gt; list = new CopyOnWriteArrayList();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 10; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new Thread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    TimeUnit.MILLISECONDS.sleep(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                list.add(&quot;a&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(Thread.currentThread().getName() + list);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }, String.valueOf(i)).start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>原因 ArrayList 不是线程安全的</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public boolean add(E e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ensureCapacityInternal(size + 1);  // Increments modCount!!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elementData[size++] = e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>解决方法</li></ol><ul><li>更换为 Vector</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public synchronized boolean add(E e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    modCount++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ensureCapacityHelper(elementCount + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    elementData[elementCount++] = e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>更换为 Collections.synchronizedList()</p></li><li><p>JUC: CopyOnWriteList</p></li></ul><blockquote><p>CopyOnWrite 实现了读写分离，当我们往一个容器添加元素的时候，不是直接给容器添加，而是先将当前容器复制一
份，向新的容器中添加数据，添加完成之后，再将原容器的引用指向新的容器。</p></blockquote><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public boolean add(E e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final ReentrantLock lock = this.lock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lock.lock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object[] elements = getArray();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int len = elements.length;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Object[] newElements = Arrays.copyOf(elements, len + 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        newElements[len] = e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setArray(newElements);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.unlock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="计数器">计数器<a class="hash-link" href="#计数器" title="标题的直接链接">​</a></h3><ul><li>减法计数器 countDownLatch 可以确保某个线程优先执行，当计数器清零在唤醒其他线程</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class CountDown {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CountDownLatch countDownLatch = new CountDownLatch(80);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Thread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; 100; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                countDownLatch.countDown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        countDownLatch.await();   // 必须唤醒，且计数器要清零</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 10; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;main&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>::: warning 注意 new CountDownLatch(80), countDownLatch.countDown(),
countDownLatch.await() 必须配合使用，只要计数器没有清零，计数器不会停止，其他线程也不能唤醒 :::</p><ul><li>加法计数器 试图唤醒当前线程，当加到一定数量成功唤醒，之后清零，再次累加循环</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 构造器</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public CyclicBarrier(int parties, Runnable barrierAction) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (parties &lt;= 0) throw new IllegalArgumentException();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.parties = parties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.count = parties;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    this.barrierCommand = barrierAction;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CyclicBarrier_ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CyclicBarrier cyclicBarrier = new CyclicBarrier(5, () -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;放行&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 10; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final int temp = i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new Thread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                cyclicBarrier.await();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }).start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>计数线程限流 限制同时进入的线程数</li></ul><ol><li>初始化</li><li>获得许可</li><li>释放</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Semaphore semaphore = new Semaphore(5);   // 限制最多 5 人</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; 15; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new Thread(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                semaphore.acquire();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(Thread.currentThread().getName() + &quot;进去了&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                TimeUnit.SECONDS.sleep(2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(Thread.currentThread().getName() + &quot;出去了&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } catch (InterruptedException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } finally {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                semaphore.release();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }).start();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="读写锁">读写锁<a class="hash-link" href="#读写锁" title="标题的直接链接">​</a></h3><p>读写锁也是为了实现线程同步，只不过粒度更细，可以为读和写设置不同的锁</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Cache {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Map&lt;Integer, String&gt; map = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ReadWriteLock readWriteLock = new ReentrantReadWriteLock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void write(Integer id, String value) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readWriteLock.writeLock().lock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;开始写入 ID: &quot; + id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        map.put(id, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;写入完成 ID: &quot; + id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readWriteLock.writeLock().unlock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String read(Integer id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readWriteLock.readLock().lock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;开始读取 ID: &quot; + id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String a = map.get(id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;读取完成 ID: &quot; + id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        readWriteLock.readLock().unlock();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return a;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>::: tip 补充 写入锁也叫独占锁，只能被 1 个线程占用，读取锁也叫共享锁，多个线程可以同时占用。 :::</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="线程池">线程池<a class="hash-link" href="#线程池" title="标题的直接链接">​</a></h3><ol><li>基本使用</li></ol><p>预先创建好一定数量的线程对象，存入缓冲池中，需要用的时候直接从缓冲池中取出，用完之后不要销毁，还回到缓冲池中，为了提高资源的利用率。优势：</p><ul><li>提高线程的利用率</li><li>提高响应速度</li><li>便于统一管理线程对象</li><li>可以控制最大的并发数</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class ThreadPool_ {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 单例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //ExecutorService executorService = Executors.newSingleThreadExecutor();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 指定线程数量</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        //ExecutorService executorService = Executors.newFixedThreadPool(5);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 缓冲线程池</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ExecutorService executorService = Executors.newCachedThreadPool();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; 60; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            final int temp = i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executorService.execute(() -&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                System.out.println(Thread.currentThread().getName() + &quot; &quot; + temp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        executorService.shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>构造函数</li></ol><p>三个常用线程池都 return new ThreadPoolExecutor(); ThreadPoolExecutor 的构造函数如下</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public ThreadPoolExecutor(  int corePoolSize,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            int maximumPoolSize,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            long keepAliveTime,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            TimeUnit unit,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            BlockingQueue&lt;Runnable&gt; workQueue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            ThreadFactory threadFactory,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            RejectedExecutionHandler handler) {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>corePoolSize: 核心池数量</li><li>maximumPoolSize: 线程池容量上限，任务量增大时，线程池主动扩容</li><li>keepAliveTime: 线程对象存活时间</li><li>unit: 线程对象存活时间单位</li><li>workQueue: 线程队列 (新的任务在队列中等候获取线程对象)</li><li>threadFactory: 线程工厂创建线程对象</li><li>handler: 拒绝策略</li></ul><ol start="3"><li>拒绝策略</li></ol><p>RejectedExecutionHandler 是一个接口，均在 ThreadPoolExecutor 中实现</p><ul><li>AbortPolicyz:直接抛出异常</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * A handler for rejected tasks that throws a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * {@code RejectedExecutionException}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class AbortPolicy implements RejectedExecutionHandler {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>DiscardPolicy: 直接拒绝</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * A handler for rejected tasks that silently discards the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * rejected task.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class DiscardPolicy implements RejectedExecutionHandler {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>DiscardOldestPolicy: 尝试与等待队列中最开始的任务争夺，不抛出异常</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * A handler for rejected tasks that discards the oldest unhandled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * request and then retries {@code execute}, unless the executor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * is shut down, in which case the task is discarded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class DiscardOldestPolicy implements RejectedExecutionHandler {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>CallerRunsPolicy 由发起请求线程处理</li></ul><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * A handler for rejected tasks that runs the rejected task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * directly in the calling thread of the {@code execute} method,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * unless the executor has been shut down, in which case the task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    * is discarded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public static class CallerRunsPolicy implements RejectedExecutionHandler {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>自定义线程池</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">executorService = new ThreadPoolExecutor(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        2L,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        TimeUnit.SECONDS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new ArrayBlockingQueue&lt;&gt;(20),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Executors.defaultThreadFactory(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new ThreadPoolExecutor.AbortPolicy());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>4 种 workQueue 堵塞队列，用来存储等待执行的任务</p><ul><li>ArrayBlockingQueue: 基于数组的先进先出队列，创建时必须指定大小。</li><li>LinkedBlockingQueue: 基于链表的先进先出队列，创建时可以不指定大小，默认值是 Integer.MAX VALUE。最大值。</li><li>SynchronousQueue: 它不会保持提交的任务，而是直接新建一个线程来执行新来的任务。</li><li>PriorityBlockingQueue: 具有优先级的阻塞队列。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="forkjoin">Forkjoin<a class="hash-link" href="#forkjoin" title="标题的直接链接">​</a></h3><ol><li>概念</li></ol><ul><li>Forkjoin 是 JDK 1.7 后发布的多线程并发处理框架，功能上和 JUC 类似，
JUC 更多时候是使用单个类完成操作，Forkjoin 使用多个类同时完成某项工作，处理上比 JUC 更加丰富，</li><li>本质上是对线程池的一种的补充，对线程池功能的一种扩展，基于线程池，</li><li>它的核心思想就是将一个大型的任务拆分成很多个小任务，然后由多个线程并发执行，最终将小任务的结果进行汇总，生成最终的结果。</li></ul><ol start="2"><li>基本使用 设置临界值，递归分配任务，知道任务不能被再分</li></ol><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class FolkJoin_ extends RecursiveTask&lt;Long&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long start;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private Long temp = 200_0000L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public FolkJoin_(Long start, Long end) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.start = start;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.end = end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    protected Long compute() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if ((end - start) &lt; temp) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Long sum = 0L;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (Long i = start; i &lt; end ; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sum += i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return sum;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Long avg = (start + end) / 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FolkJoin_ tast1 = new FolkJoin_(start, avg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FolkJoin_ tast2 = new FolkJoin_(avg, end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tast1.fork();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tast2.fork();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return tast1.join()+tast2.join();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Main.java</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Long start = System.currentTimeMillis();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ForkJoinPool folkJoinPool = new ForkJoinPool();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FolkJoin_ task = new FolkJoin_(0L, 10_0000_0000L);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">folkJoinPool.execute(task);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(task.get() + &quot; &quot; + (System.currentTimeMillis() - start) / 1000.0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="待续-2">待续...<a class="hash-link" href="#待续-2" title="标题的直接链接">​</a></h3></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/ioclub/share_1"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">B+ 树以及在数据库中的应用</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/java/sourceread"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">集合框架</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基础知识" class="table-of-contents__link toc-highlight">基础知识</a><ul><li><a href="#for-和-whiletrue-的区别" class="table-of-contents__link toc-highlight">for(;;) 和 while(true) 的区别</a></li><li><a href="#equal-与的区别" class="table-of-contents__link toc-highlight">equal 与==的区别</a></li><li><a href="#classthis-和-this-的区别" class="table-of-contents__link toc-highlight">Class.this 和 this 的区别</a></li><li><a href="#待续" class="table-of-contents__link toc-highlight">待续...</a></li></ul></li><li><a href="#包装类" class="table-of-contents__link toc-highlight">包装类</a><ul><li><a href="#int-vs-integer" class="table-of-contents__link toc-highlight">int VS Integer</a></li></ul></li><li><a href="#析构函数" class="table-of-contents__link toc-highlight">&quot;析构函数&quot;</a></li><li><a href="#泛型" class="table-of-contents__link toc-highlight">泛型</a><ul><li><a href="#t-的位置" class="table-of-contents__link toc-highlight">T 的位置</a></li><li><a href="#边界通配符" class="table-of-contents__link toc-highlight">边界通配符</a></li></ul></li><li><a href="#注解" class="table-of-contents__link toc-highlight">注解</a><ul><li><a href="#作用范围" class="table-of-contents__link toc-highlight">作用范围</a></li><li><a href="#target" class="table-of-contents__link toc-highlight">@Target</a></li><li><a href="#retention" class="table-of-contents__link toc-highlight">@Retention</a></li><li><a href="#示例" class="table-of-contents__link toc-highlight">示例</a></li></ul></li><li><a href="#多线程" class="table-of-contents__link toc-highlight">多线程</a><ul><li><a href="#实现" class="table-of-contents__link toc-highlight">实现</a></li><li><a href="#常用方法" class="table-of-contents__link toc-highlight">常用方法</a></li><li><a href="#线程同步" class="table-of-contents__link toc-highlight">线程同步</a></li><li><a href="#线程安全的单例模式" class="table-of-contents__link toc-highlight">线程安全的单例模式</a></li><li><a href="#voletile-关键字" class="table-of-contents__link toc-highlight">voletile 关键字</a></li><li><a href="#待续-1" class="table-of-contents__link toc-highlight">待续...</a></li></ul></li><li><a href="#juc" class="table-of-contents__link toc-highlight">JUC</a><ul><li><a href="#特征" class="table-of-contents__link toc-highlight">特征</a></li><li><a href="#基本操作" class="table-of-contents__link toc-highlight">基本操作</a></li><li><a href="#死锁" class="table-of-contents__link toc-highlight">死锁</a></li><li><a href="#生产者消费者" class="table-of-contents__link toc-highlight">生产者消费者</a></li><li><a href="#trylock" class="table-of-contents__link toc-highlight">tryLock</a></li><li><a href="#同时读写" class="table-of-contents__link toc-highlight">同时读写</a></li><li><a href="#计数器" class="table-of-contents__link toc-highlight">计数器</a></li><li><a href="#读写锁" class="table-of-contents__link toc-highlight">读写锁</a></li><li><a href="#线程池" class="table-of-contents__link toc-highlight">线程池</a></li><li><a href="#forkjoin" class="table-of-contents__link toc-highlight">Forkjoin</a></li><li><a href="#待续-2" class="table-of-contents__link toc-highlight">待续...</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Trdthg's blog. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fa327763.js"></script>
<script src="/assets/js/main.e82f1fb6.js"></script>
</body>
</html>