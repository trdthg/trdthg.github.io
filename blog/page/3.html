<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Blog | Trdthg&#x27;s blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://trdthg.github.io//blog/page/3"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="Blog | Trdthg&#x27;s blog"><meta data-rh="true" name="description" content="Blog"><meta data-rh="true" property="og:description" content="Blog"><meta data-rh="true" name="docusaurus_tag" content="blog_posts_list"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_posts_list"><link data-rh="true" rel="icon" href="/img/logo_png.png"><link data-rh="true" rel="canonical" href="https://trdthg.github.io//blog/page/3"><link data-rh="true" rel="alternate" href="https://trdthg.github.io//blog/page/3" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://trdthg.github.io//blog/page/3" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Trdthg&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Trdthg&#39;s blog Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TM86KZ83J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4TM86KZ83J",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.6b28552f.css">
<link rel="preload" href="/assets/js/runtime~main.ce766e05.js" as="script">
<link rel="preload" href="/assets/js/main.dc8abca6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="è·³åˆ°ä¸»è¦å†…å®¹"><a href="#" class="skipToContent_fXgn">è·³åˆ°ä¸»è¦å†…å®¹</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_png.png" alt="Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_png.png" alt="Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Trdthg</b></a><a class="navbar__item navbar__link" href="/docs/intro">æ–‡æ¡£</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰" aria-label="åˆ‡æ¢æµ…è‰²/æš—é»‘æ¨¡å¼ï¼ˆå½“å‰ä¸ºæµ…è‰²æ¨¡å¼ï¼‰"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="æœ€è¿‘åšæ–‡å¯¼èˆª"><div class="sidebarItemTitle_pO2u margin-bottom--md">å…¨éƒ¨åšæ–‡</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/03/[è¯‘] Rustå†’é™©: æ»¥ç”¨ Serde">[è¯‘] Rustå†’é™©: æ»¥ç”¨ Serde</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/02/[è¯‘] æœªåˆå§‹åŒ–å†…å­˜: unsafe Rustå¤ªéš¾äº†">[è¯‘] æœªåˆå§‹åŒ–å†…å­˜: unsafe Rustå¤ªéš¾äº†</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/01/[è¯‘] æ‹“å±• Rust ä¸­çš„ Map">[è¯‘] æ‹“å±• Rust ä¸­çš„ Map</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/i3wm">Linux å‘è¡Œç‰ˆé…ç½®</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/resources">èµ„æºæ•´ç†</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/site_update_log">ç½‘ç«™æ›´æ–°æ—¥å¿—</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/DistributedSystem">åˆ†å¸ƒå¼ç³»ç»Ÿ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/[è¯‘] pkg_mng">Let&#x27;s Dev: A Package Manager</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/test">åƒåœ¾è½¯ä»¶</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/æ•°æ®åº“è®¾è®¡">æ•°æ®åº“è®¾è®¡</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/ç»„æˆåŸç†">è®¡ç®—æœºç»„æˆåŸç†</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/è®¡ç®—æœºç½‘ç»œ">è®¡ç®—æœºç½‘ç»œ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/04/[è¯‘] å¯è§†åŒ– Rust å„æ•°æ®ç±»å‹çš„å†…å­˜å¸ƒå±€">[è¯‘] å¯è§†åŒ– Rust å„æ•°æ®ç±»å‹çš„å†…å­˜å¸ƒå±€</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/30/[è¯‘] ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ Rust ï¼Ÿ">[è¯‘] ä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ Rust ï¼Ÿ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/20/[è¯‘] ä½¿ç”¨ Tokio å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡">[è¯‘] ä½¿ç”¨ Tokio å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/13/[è¯‘] tail_latency">å¯¹é‡è¯·æ±‚ - åº”å¯¹å°¾éƒ¨å»¶è¿Ÿ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/11/[è¯‘] å¼‚æ­¥ Rustï¼šåä½œä¸æŠ¢å å¼è°ƒåº¦">[è¯‘] å¼‚æ­¥ Rustï¼šåä½œä¸æŠ¢å å¼è°ƒåº¦</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/README">Rust å…­è¾¹å½¢æ¶æ„</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 1 åŸŸ">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 1 åŸŸ</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 2 å†…å­˜å­˜å‚¨åº“">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 2 å†…å­˜å­˜å‚¨åº“</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 3 HTTP API">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 3 HTTP API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 4 é‡æ„">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 4 é‡æ„</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 5 å…¶ä»–ç”¨ä¾‹">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 5 å…¶ä»–ç”¨ä¾‹</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 6 CLI">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 6 CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 7 é•¿æœŸå­˜å‚¨åº“">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 7 é•¿æœŸå­˜å‚¨åº“</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/01/[è¯‘] search_engine">æŸ¥è¯¢å¼•æ“ï¼šæ¨é€ä¸æ‹‰å–</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 3 HTTP API">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 3 HTTP API</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-03T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ3æ—¥</time> Â· <!-- -->é˜…è¯»éœ€ 15 åˆ†é’Ÿ</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-3/" target="_blank" rel="noopener noreferrer">https://alexis-lozano.com/hexagonal-architecture-in-rust-3/</a></p><p>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>æœ¬æ–‡ç”± <a href="https://Rustt.org" target="_blank" rel="noopener noreferrer">Rustt</a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org" target="_blank" rel="noopener noreferrer">StudyRust</a> è£èª‰æ¨å‡º</p></blockquote><h1>2021-08-26 - Rust å…­è¾¹å½¢æ¶æ„ #3 - HTTP API</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯ä¸‹é¢ç³»åˆ—çš„ä¸€éƒ¨åˆ†</p><ul><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-1/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #1 - Domain</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-2/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #2 - In-memory repository</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-3/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #3 - HTTP API</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-4/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #4 - Refactoring</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-5/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #5 - Remaining use-cases</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-6/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #6 - CLI</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-7/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #7 - Long-lived repositories</a></li></ul><p>é›†ç»“å§ï¼Œæˆ‘çš„æˆ˜å‹ä»¬ã€‚ä»Šå¤©æˆ‘ä»¬å°†è¦æˆ˜æ–—ï¼è°ï¼Ÿä½ é—®æˆ‘ã€‚å®ƒæ˜¯è¿™ç‰‡åœŸåœ°ä¸Šä¸è¨€è€Œå–»çš„æ¶é­”ï¼šğŸ‘¿å€Ÿç”¨æ£€æŸ¥ï¼</p><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬æš‚æ—¶åœæ­¢è¿™ä¸ªæŒ‡ç¯ç‹é£æ ¼çš„å°è±¡ï¼Œå·¥ä½œç­‰å¾…ç€æˆ‘ä»¬ : )</p><p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬çš„åŸŸå®ä½“ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ªç”¨ä¾‹å’Œä¸€ä¸ªå­˜å‚¨åº“ã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ domain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ create_pokemon.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ entities.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ mod.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ repositories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â”œâ”€â”€ mod.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ pokemon.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ main.rs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬æœ¬å¯ä»¥æŠŠå®ƒäº¤ç»™æˆ‘ä»¬çš„å®¢æˆ·ï¼Œä½†æ˜¯é™¤äº†è¿è¡Œæµ‹è¯•èƒ½å¤Ÿé€šè¿‡ä¹‹å¤–ï¼Œ<em>main.rs</em> æ–‡ä»¶ä»ç„¶åªè¾“å‡ºä¸€ä¸ª hello
worldã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æŠŠæˆ‘ä»¬çš„é¡¹ç›®è½¬æ¢æˆä¸€ä¸ªè¿”å› JSON çš„ HTTP APIã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="http-api">HTTP API<a class="hash-link" href="#http-api" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å¦‚æœä½ æ²¡è®°é”™çš„è¯ï¼Œæˆ‘æ²¡æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¼‚æ­¥ã€‚è¿™æ˜¯ä¸ºäº†ä¸“æ³¨äºè€ƒè™‘æˆ‘ä»¬åº”ç”¨ç¨‹åºçš„æ¶æ„ã€‚å¦‚æœä½ çœŸçš„æƒ³ä½¿ç”¨å¼‚æ­¥ï¼Œé‚£å°±å»å§ : ) éå¼‚æ­¥çš„ Web
æ¡†æ¶å¹¶ä¸å¤šï¼Œä½†ä»ç„¶æœ‰ä¸€äº›ã€‚æˆ‘å†æœ¬æ–‡ä¸­çš„é€‰æ‹©æ˜¯
<a href="https://github.com/tomaka/rouille" target="_blank" rel="noopener noreferrer">rouille</a>ï¼Œå®ƒèƒ½å¾ˆå¥½åœ°å¤„ç†æˆ‘ä»¬çš„ç”¨ä¾‹ã€‚</p><p>æ‰€ä»¥é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€ <em>Cargo.toml</em> å¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„ä¾èµ–é¡¹ä¸­ï¼š</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rouille = &quot;3.2.1&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŒ…å«æˆ‘ä»¬æ‰€æœ‰çš„ API çš„æ–‡ä»¶å¤¹ã€‚è¿™é‡Œé¢åŒ…æ‹¬ <em>mod.rs</em> æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä¸­æ·»åŠ åŸºæœ¬çš„è·¯ç”±é€»è¾‘ã€‚æˆ‘è¿˜å°†æ·»åŠ ä¸€ä¸ªç®€å•çš„
<em>health.rs</em> æ–‡ä»¶æ¥å¤„ç†æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè·¯ç”±ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    â”œâ”€â”€ health.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    â””â”€â”€ mod.rs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬åªä¼šåœ¨ <em>api</em> æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨åˆ° <code>rouille</code>ï¼Œå¦‚æœåœ¨ä»¥åï¼Œæˆ‘ä»¬æƒ³ç”¨ <code>actix</code> ä»£æ›¿ <code>rouille</code>ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ <em>api</em>
çš„éƒ¨åˆ†å³å¯ (å…¶å®æˆ‘ä»¬è¿˜è¦æŠŠä¸€äº›å‡½æ•°è½¬æ¢ä¸ºå¼‚æ­¥çš„ï¼Œä½†æ˜¯å®ƒä¸ Web æ¡†æ¶çš„é€‰æ‹©å¹¶ä¸ç›¸å…³)</p><p>ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåŸºæœ¬å¯ç”¨çš„ APIï¼Œå½“æˆ‘ä»¬åœ¨å‘ <code>/health</code> ä¸Šå‘é€ GET è¯·æ±‚æ—¶ï¼Œå®ƒåº”è¯¥è¿”å›ä¸€äº›æ–‡æœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦åœ¨ <em>main.rs</em> ä¸­å¼•å…¥
<code>rutille</code>, å¹¶ä½¿ç”¨ä¹‹åä¼šåˆ›å»ºçš„ <code>serve</code> å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod api;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod domain;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod repositories;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[macro_use]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern crate rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api::serve(&quot;localhost:8000&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥ï¼Œåœ¨ <em>api/mod.rs</em> é‡Œæ·»åŠ  <code>serve</code> å‡½æ•°</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod health;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(url: &amp;str) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::start_server(url, move |req| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        router!(req,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (GET) (/health) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                health::serve()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                rouille::Response::from(Status::NotFound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨åªéœ€è¦ç¼–è¾‘ <em>api/health.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve() -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::Response::text(&quot;Gotta catch them all!&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æ‚¨åº”è¯¥å¯ä»¥ä½¿ç”¨ <code>cargo run</code> è¿è¡Œç¨‹åºå¹¶ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://localhost:8000/healthã€‚
åœ¨é‚£é‡Œï¼Œä¸€æ¡ç¾ä¸½çš„ä¿¡æ¯åœ¨ç­‰ç€ä½ ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Gotta catch them all!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¤ªæ£’äº†ï¼ä½†æˆ‘ä¹‹å‰è¯´è¿‡æˆ‘ä»¬æƒ³è¦ä¸€ä¸ª JSON APIã€‚è®©æˆ‘ä»¬å°†è¿™ä¸ª API æ¥å£è½¬æ¢ä¸ºè¿”å› JSONã€‚æˆ‘ä»¬å°†ç”¨åˆ° <code>serde</code>ã€‚<code>rouille</code>
æœ¬èº«å·²ç»ä½¿ç”¨äº†ä¸€äº› <code>serde</code> çš„ç‰¹å¾ï¼Œä½ å¯ä»¥é€šè¿‡ <code>cargo tree | grep serde</code> æŸ¥çœ‹ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ serde v1.0.129</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ serde_derive v1.0.129 (proc-macro)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ serde_json v1.0.66</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”‚   â””â”€â”€ serde v1.0.129</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€è®©æˆ‘ä»¬åœ¨ <em>Cargo.toml</em> ä¸­æ·»åŠ ä¸ <code>rouille</code> ä½¿ç”¨çš„ç‰ˆæœ¬ç›¸åŒçš„ <code>serde</code> ä¾èµ–ã€‚</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rouille = &quot;3.2.1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serde = { version = &quot;1.0.129&quot;, features = [&quot;derive&quot;] }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serde_json = &quot;1.0.66&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æ¥ä¿®æ”¹ <em>api/health.rs</em>:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use serde::Serialize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Serialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve() -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::Response::json(&amp;Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message: String::from(&quot;Gotta catch them all!&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨æ¬¡è®¿é—®ä½ çš„æµè§ˆå™¨ ğŸ‰ :D</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Gotta catch them all!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è·å–è¯·æ±‚">è·å–è¯·æ±‚<a class="hash-link" href="#è·å–è¯·æ±‚" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä»¬çš„å®¢æˆ·æƒ³è¦çš„æ˜¯èƒ½å¤Ÿåˆ›é€ ä¸€ä¸ªå®å¯æ¢¦ã€‚é¦–å…ˆï¼Œç”±äºæˆ‘ä»¬çš„ API å°†æ˜¯ RESTfulï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨çš„ HTTP è¯·æ±‚çš„ç¤ºä¾‹ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- POST http://localhost:8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Headers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Content-Type: application/json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;number&quot;: 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;Charmander&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;types&quot;: [&quot;Fire&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å›åˆ° <em>api/mod.rs</em> æ·»åŠ ä¸€ä¸ªæ–°çš„è·¯ç”±</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod create_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod health;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(url: &amp;str) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::start_server(url, move |req| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        router!(req,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (POST) (/) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create_pokemon::serve(req)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ <em>api/create<!-- -->_<!-- -->pokemon.rs</em> å¹¶å†™å…¥ä¸‹é¢çš„å†…å®¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use serde::Serialize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Serialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    message: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(_req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::Response::json(&amp;Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        message: String::from(&quot;Pokemon created!&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ REST å®¢æˆ·ç«¯ (postmanã€curlã€...) åœ¨ http://localhost:8000 ä¸Šå‘é€ POST è¯·æ±‚ï¼Œbody
å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ã€‚ä½ åº”è¯¥ä¼šæ”¶åˆ°ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Pokemon created!&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½†æ˜¯å½“è¯·æ±‚ä¸Šä¸‹æ–‡ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ—¶ï¼ŒAPI æœ€å¥½èƒ½è¿”å› 400 çŠ¶æ€ç ã€‚è®©æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ <em>api/create<!-- -->_<!-- -->pokemon.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::api::Status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use serde::{Deserialize, Serialize};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Deserialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match rouille::input::json_input::&lt;Request&gt;(req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(_) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœå‘ API å‘é€ä¸€ä¸ªæ²¡æœ‰ <code>name</code> å€¼çš„è¯·æ±‚ï¼Œæˆ–è€…å¦‚æœ <code>number</code> ä¸ºè´Ÿæ•°ï¼Œç”¨æˆ·å°†ä¼šæ”¶åˆ° 400 çŠ¶æ€ç ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ·»åŠ å­˜å‚¨åº“">æ·»åŠ å­˜å‚¨åº“<a class="hash-link" href="#æ·»åŠ å­˜å‚¨åº“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å¥½çš„ï¼Œä½†æ˜¯å®é™…ä¸Šç°åœ¨å®å¯æ¢¦æ—¢æ²¡æœ‰åˆ›å»ºä¹Ÿæ²¡æœ‰æ·»åŠ åˆ°å­˜å‚¨åº“ä¸­ã€‚è€Œä¸” API ä¹Ÿä¸ä¼šè°ƒç”¨ç”¨ä¾‹ï¼é¦–å…ˆè®©æˆ‘ä»¬åœ¨ <em>main.rs</em>
ä¸­åˆ›å»ºä¸€ä¸ªå†…å­˜å­˜å‚¨åº“ï¼Œå¹¶æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™ APIï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use repositories::pokemon::InMemoryRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = InMemoryRepository::new();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api::serve(&quot;localhost:8000&quot;, &amp;mut repo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»ç›¸åº”åœ°ç¼–è¾‘ <em>api/mod.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(url: &amp;str, repo: &amp;mut dyn Repository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::start_server(url, move |req| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        router!(req,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (POST) (/) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create_pokemon::serve(repo, req)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ«å¿˜äº†ä¿®æ”¹ <em>api/create<!-- -->_<!-- -->pokemon.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(_repo: &amp;mut dyn Repository, req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½ ç°åœ¨å¯ä»¥è¿è¡Œ <code>cargo run</code> äº†ï¼Œå®ƒåº”è¯¥ ...</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error[E0277]: `dyn Repository` cannot be sent between threads safely</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">= help: the trait `Send` is not implemented for `dyn Repository`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error[E0277]: `dyn Repository` cannot be shared between threads safely</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">= help: the trait `Sync` is not implemented for `dyn Repository`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">error: aborting due to 2 previous errors</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘åªä¿ç•™äº†æœ€åŸºç¡€çš„é”™è¯¯æ—¥å¿—ã€‚æœ‰äº›ä¸œè¥¿ä¸èµ·ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸º......å€Ÿç”¨æ£€æŸ¥å™¨ã€‚æˆ‘çš„æ„æ€æ˜¯è¿™å…¶å®æ˜¯æˆ‘çš„é”™ï¼Œä½†æ˜¯å€Ÿç”¨æ£€æŸ¥å™¨åœ¨ç½©ç€æˆ‘ä»¬ : )</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ‰“è´¥å€Ÿç”¨æ£€æŸ¥å™¨">æ‰“è´¥å€Ÿç”¨æ£€æŸ¥å™¨<a class="hash-link" href="#æ‰“è´¥å€Ÿç”¨æ£€æŸ¥å™¨" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åƒå¾€å¸¸ä¸€æ ·ï¼Œç¼–è¯‘å™¨å¾ˆæœ‰å¸®åŠ©ï¼šå®ƒå‘Šè¯‰æˆ‘ä»¬éœ€è¦åœ¨ <code>Repository</code> ä¸Šå®ç° <code>Send</code> å’Œ <code>Sync</code>ã€‚è®©æˆ‘ä»¬ä¿®æ”¹
<code>repositories/pokemon.rs</code> æ¥å®ç°è¿™ä¸€ç‚¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(&amp;mut self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Rust å¾ˆå®¹æ˜“ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬çš„ä¿®å¤å°†éå¸¸å¿«ï¼Œå› ä¸ºä¸€æ—¦è¿è¡Œ <code>cargo run</code>ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error[E0621]: explicit lifetime required in the type of `repo`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> --&gt; src/api/mod.rs:7:5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 | pub fn serve(url: &amp;str, repo: &amp;mut dyn Repository) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |                               ------------------- help: add explicit lifetime `&#x27;static` to the type of `repo`: `&amp;&#x27;static mut (dyn Repository + &#x27;static)`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬å­˜å‚¨åº“ä¸Šéœ€è¦ä¸€ä¸ª
â€œé™æ€ç”Ÿå‘½å‘¨æœŸâ€ã€‚è®©æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ï¼Œè¿™é‡ŒçœŸæ­£çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿæˆ‘ä»¬å¸Œæœ›å°†å­˜å‚¨åº“çš„å¼•ç”¨å‘é€åˆ°ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆçš„çº¿ç¨‹ä¸­ã€‚ç°åœ¨æˆ‘ä»¬ä½¿ç”¨æˆ‘ä»¬çš„
<code>InMemoryRepository</code>
ç»“æ„ä½“åˆ›å»ºäº†ä¸€ä¸ªå­˜å‚¨åº“ã€‚é—®é¢˜æ˜¯ï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰§è¡Œåˆ°ä¸»å‡½æ•°ç»“æŸæ—¶ï¼Œè¿™ä¸ªå­˜å‚¨åº“çš„èµ„æºå°†è¢«é‡Šæ”¾ã€‚ä½†ä¹Ÿè®¸æœ‰äº›çº¿ç¨‹ä»ç„¶ä¼šå¼•ç”¨åˆ°å®ƒã€‚æœ€ç»ˆå¯¼è‡´ç¼–è¯‘å™¨é”™è¯¯ã€‚</p><p>æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä»¥æŸç§æ–¹å¼å‘Šè¯‰ç¨‹åºï¼Œåªæœ‰åœ¨å¼•ç”¨ä¸å†å­˜åœ¨æ—¶å†é‡Šæ”¾æ‰æˆ‘ä»¬çš„å­˜å‚¨åº“ã€‚è¿™ç§æ–¹å¼ç§°ä¸ºå¼•ç”¨è®¡æ•°å™¨ã€‚æˆ‘ä»¬å¾ˆå¹¸è¿ï¼ŒRust
ä¸ºæ­¤æä¾›äº†ä¸¤ç§ç±»å‹ï¼Œå…¶ä¸­ä¸€ç§æ˜¯ä¸“é—¨ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´å®‰å…¨å…±äº«è€Œåˆ›å»ºçš„ã€‚å®ƒçš„åå­—æ˜¯ <strong><code>Arc</code></strong>ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ã€‚</p><p>å› æ­¤ï¼Œè®©æˆ‘ä»¬åœ¨ <em>main.rs</em> ä¸­ç”¨ <code>Arc</code> åŒ…è£…æˆ‘ä»¬çš„å­˜å‚¨åº“ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api::serve(&quot;localhost:8000&quot;, repo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç§»é™¤äº†ä¸¤ä¸ªä¸œè¥¿ï¼šä¸€ä¸ª <code>&amp;</code> å’Œä¸€ä¸ª <code>mut</code>ã€‚ <code>Arc</code>
å®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå› æ­¤å®ƒçš„å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥çš„ã€‚å®ƒæŒ‡å‘ä½äºå †ä¸­çš„å­˜å‚¨åº“ã€‚å› æ­¤æˆ‘ä»¬ä¸éœ€è¦å¼•ç”¨å®ƒã€‚å…¶æ¬¡ï¼ŒArc
æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å†…éƒ¨å¯å˜æ€§ã€‚è¿™ç‚¹æˆ‘ä»¬ç¨åå†è°ˆã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬ä¿®æ”¹ <em>api/mod.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(url: &amp;str, repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::start_server(url, move |req| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        router!(req,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (POST) (/) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                create_pokemon::serve(repo.clone(), req)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åå†æ¥ä¿®æ”¹ <em>api/create<!-- -->_<!-- -->pokemon.rs</em>:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(_repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç¼–è¯‘æˆåŠŸ \o/</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åŸŸä¹Ÿéœ€è¦çˆ±-">åŸŸä¹Ÿéœ€è¦çˆ± ğŸ’“<a class="hash-link" href="#åŸŸä¹Ÿéœ€è¦çˆ±-" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä»¬å›´ç»•ç€ä¸€ä¸ªåŸŸè®¾è®¡äº†æˆ‘ä»¬çš„ç¨‹åºï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨ç”¨ä¾‹è·å–æ•°æ®å’Œä¸€ä¸ªå­˜å‚¨åº“ç”¨æ¥ä¿å­˜æ•°æ®ã€‚åƒä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»åœ¨ç”¨ä¾‹ä¸­æŠŠå­˜å‚¨åº“æ›¿æ¢ä¸º <code>Arc</code>
çš„å¯å˜å¼•ç”¨ã€‚å¥½åœ¨æˆ‘ç°åœ¨åªå®ç°äº†ä¸€ä¸ªç”¨ä¾‹ : ) è®©æˆ‘ä»¬åœ¨ <em>domain/create<!-- -->_<!-- -->pokemon.rs</em> ä¸­ä¿®æ”¹å‡½æ•°ç­¾åï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Response {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸è¦å¿˜è®°æµ‹è¯•ä¸­ä¹Ÿè¦ä¿®æ”¹ï¼</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let res = execute(repo, req);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨è¿è¡Œ <code>cargo run</code> ä¹‹åï¼Œæˆ‘ä»¬å¶ç„¶å‘ç°äº†æˆ‘ä¹‹å‰è®¨è®ºè¿‡çš„ä¸€ä¸ªé—®é¢˜ï¼š<code>Arc</code> æ˜¯ä¸å¯å˜çš„ã€‚</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">25 |         (Ok(number), Ok(name), Ok(types)) =&gt; match repo.insert(number, name, types) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |                                                    ^^^^ cannot borrow as mutable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æœæˆ‘ä»¬æ£€æŸ¥ <em>repositories/pokemon.rs</em> ä¸­çš„ <code>Repository</code> Traitï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>insert</code>
æ–¹æ³•å¸Œæœ›å­˜å‚¨åº“æ˜¯å¯å˜çš„ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(&amp;mut self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰€ä»¥æˆ‘ä»¬å°†åœ¨ <code>Repository</code> Trait å’Œæˆ‘ä»¬çš„å®ç°ä¸­åˆ é™¤è¿™ä¸ª <code>mut</code> : ) è®©æˆ‘ä»¬è¿è¡Œ <code>cargo run</code>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">36 |     fn insert(&amp;self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |               ----- help: consider changing this to be a mutable reference: `&amp;mut self`</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">46 |         self.pokemons.push(Pokemon::new(number_clone, name, types));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |         ^^^^^^^^^^^^^ `self` is a `&amp;` reference, so the data it refers to cannot be borrowed as mutable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å“å‘€ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯ä¸æ˜¯å¾ˆæœ‰å¸®åŠ©ã€‚æˆ‘ä»¬åˆšåˆšåˆ é™¤äº† <code>mut</code>ï¼Œç°åœ¨ç¼–è¯‘å™¨å¸Œæœ›æˆ‘ä»¬é‡æ–°æ·»åŠ å®ƒã€‚å®é™…ä¸Šè¿™æ˜¯åˆä¹é€»è¾‘çš„ï¼Œç¼–è¯‘å™¨ä¸çŸ¥é“å­˜å‚¨åº“åœ¨ <code>Arc</code> ä¸­ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œé—®é¢˜ä¸å†åœ¨äº <code>trait</code>ï¼Œè€Œåœ¨äºæˆ‘ä»¬çš„å­˜å‚¨åº“å®ç°ã€‚æˆ‘ä»¬éœ€è¦èƒ½å¤Ÿåœ¨ <code>self</code> ä¸å¯å˜çš„æƒ…å†µä¸‹æ”¹å˜å†…éƒ¨çš„ <code>pokemons</code>ã€‚
è¿™å°±æ˜¯å†…éƒ¨å¯å˜æ€§ã€‚è€Œä¸”ï¼ŒRust å†æ¬¡ä¸ºæ­¤æä¾›äº†ä¸€äº›åŸè¯­ï¼æˆ‘ä»¬å°†é€‰æ‹© <code>Mutex</code> åŸè¯­ï¼Œå› ä¸ºå®ƒæ˜¯ä¸ºäº†åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®è€Œè®¾è®¡çš„ã€‚å› æ­¤ï¼Œè®©æˆ‘ä»¬å°†
<code>pokemons</code> åŒ…è£…åˆ° <code>Mutex</code> ä¸­ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Mutex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error: bool,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pokemons: Mutex&lt;Vec&lt;Pokemon&gt;&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn new() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let pokemons: Mutex&lt;Vec&lt;Pokemon&gt;&gt; = Mutex::new(vec![]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            error: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pokemons,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¿…é¡»é”å®š <code>Mutex</code> æ‰èƒ½è¯»å–æˆ–å†™å…¥å®å¯æ¢¦ã€‚é”å®š <code>Mutex</code>
æ„å‘³ç€æ‰€æœ‰çº¿ç¨‹å¿…é¡»è½®æµç­‰å¾…è¯»å–æˆ–å†™å…¥å®ƒæ‰€ä¿å­˜çš„æ•°æ®ï¼Œå› æ­¤åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®æ•°æ®ã€‚</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(&amp;self, number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Insert {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Insert::Error;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let mut lock = match self.pokemons.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; return Insert::Error,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if lock.iter().any(|pokemon| pokemon.number == number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Insert::Conflict;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let number_clone = number.clone();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.push(Pokemon::new(number_clone, name, types));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Insert::Ok(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨å®ƒç¼–è¯‘é€šè¿‡ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æµ‹è¯•ä¹Ÿä»ç„¶é€šè¿‡ï¼</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="api--domain--3">API + domain =&lt; 3<a class="hash-link" href="#api--domain--3" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ˜¯æ—¶å€™å°† API è¿æ¥åˆ° Domain äº†ã€‚è®©æˆ‘ä»¬ä¿®æ”¹ <code>api/create_pokemon.rs</code>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::create_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = match rouille::input::json_input::&lt;Request&gt;(req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(req) =&gt; create_pokemon::Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number: req.number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name: req.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types: req.types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match create_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create_pokemon::Response::Ok(number) =&gt; rouille::Response::json(&amp;Response { number }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create_pokemon::Response::BadRequest =&gt; rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create_pokemon::Response::Conflict =&gt; rouille::Response::from(Status::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        create_pokemon::Response::Error =&gt; rouille::Response::from(Status::InternalServerError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®°å¾—æŠŠåŸŸä¸­éœ€è¦çš„ä»£ç æ”¹ä¸º pubï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// domain/mod.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod create_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// domain/create_pokemon.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨æ¬¡è¿è¡Œ <code>cargo run</code> å¹¶å‘ <code>create_pokemon</code> è·¯ç”±å‘é€æœ‰æ•ˆè¯·æ±‚ï¼š</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>\o/</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä¸‹ä¸€æ­¥">ä¸‹ä¸€æ­¥<a class="hash-link" href="#ä¸‹ä¸€æ­¥" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è¿™ç¯‡æ–‡ç« æ¯”é¢„æœŸçš„è¦é•¿ï¼Œå¯¹æ­¤æˆ‘æ„Ÿåˆ°æŠ±æ­‰ã€‚å¸Œæœ›å®ƒå¯¹ä½ æœ‰ç”¨ :) åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å®ç°å…¶ä»–çš„ç”¨ä¾‹ (å®¢æˆ·åŒå€¦äº†ç­‰å¾…æˆ‘è§£é‡Šä¸€åˆ‡ï¼Œå®¢æˆ·çœŸç³Ÿç³• :p)
å†ä¹‹åï¼Œæˆ‘å°†å®ç°å…¶ä»–çš„å‰ç«¯å’Œå­˜å‚¨åº“ï¼Œä»¥æ›´å¥½åœ°äº†è§£å…­è¾¹å½¢æ¶æ„çš„å¼ºå¤§åŠŸèƒ½ã€‚</p><p>åƒå¾€å¸¸ä¸€æ ·ï¼Œä»£ç å¯ä»¥åœ¨ <a href="https://github.com/alexislozano/pokedex/tree/article-3" target="_blank" rel="noopener noreferrer">github</a>
ä¸ŠæŸ¥çœ‹ã€‚</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 4 é‡æ„">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 4 é‡æ„</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-03T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ3æ—¥</time> Â· <!-- -->é˜…è¯»éœ€ 10 åˆ†é’Ÿ</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-4/" target="_blank" rel="noopener noreferrer">https://alexis-lozano.com/hexagonal-architecture-in-rust-4/</a></p><p>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>æœ¬æ–‡ç”± <a href="https://Rustt.org" target="_blank" rel="noopener noreferrer">Rustt</a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org" target="_blank" rel="noopener noreferrer">StudyRust</a> è£èª‰æ¨å‡º</p></blockquote><h1>2021-09-02 - Rust å…­è¾¹å½¢æ¶æ„ #4 - é‡æ„</h1><p>è¿™ç¯‡æ–‡ç« æ˜¯ä¸‹é¢ç³»åˆ—çš„ä¸€éƒ¨åˆ†</p><ul><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-1/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #1 - Domain</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-2/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #2 - In-memory repository</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-3/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #3 - HTTP API</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-4/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #4 - Refactoring</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-5/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #5 - Remaining use-cases</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-6/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #6 - CLI</a></li><li><a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-7/" target="_blank" rel="noopener noreferrer">Hexagonal architecture in Rust #7 - Long-lived repositories</a></li></ul><p>å—¨ï¼Œåˆæ˜¯æˆ‘ï¼èµ·åˆï¼Œæˆ‘æƒ³å®ç°æˆ‘ä»¬ä»ç„¶éœ€è¦å¤„ç†çš„å‰©ä½™çš„ç”¨ä¾‹ã€‚ä½†è¿™å°†ä¼šæ˜¯ä¸‹ä¸€æ¬¡çš„å†…å®¹ã€‚ä»Šå¤©æˆ‘ä»¬å°†åšä¸€äº›é‡æ„ :)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¼€å§‹ä¹‹å‰">å¼€å§‹ä¹‹å‰<a class="hash-link" href="#å¼€å§‹ä¹‹å‰" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘åšäº†ä¸¤ä¸ªæˆ‘åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­æ²¡æœ‰çœ‹åˆ°çš„æ›´æ”¹ã€‚åœ¨ <code>domain/entities.rs</code> ä¸­ï¼Œæˆ‘ç”¨ Self æ›¿æ¢äº† u16ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl From&lt;PokemonNumber&gt; for u16 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn from(n: PokemonNumber) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        n.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ <code>repositories/pokemons.rs</code> ä¸­ï¼Œæˆ‘åœ¨ <code>with_error</code> ä¸Šæ·»åŠ äº†ä¸€ä¸ªæµ‹è¯•æ³¨é‡Šï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn with_error(self) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            error: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ..self</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬ç°åœ¨è¿›è¡Œé‡æ„ :)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨-result-æ›¿æ¢è‡ªå®šä¹‰æšä¸¾">ä½¿ç”¨ <code>Result</code> æ›¿æ¢è‡ªå®šä¹‰æšä¸¾<a class="hash-link" href="#ä½¿ç”¨-result-æ›¿æ¢è‡ªå®šä¹‰æšä¸¾" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰æšä¸¾ä½œä¸ºç”¨ä¾‹å’Œ å­˜å‚¨åº“ çš„è¿”å›å€¼ï¼Œç°åœ¨æŠŠä»–ä»¬é‡æ„ä¸º Resultã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ›´æ”¹ç”¨ä¾‹çš„è¿”å›å€¼ç±»å‹">æ›´æ”¹ç”¨ä¾‹çš„è¿”å›å€¼ç±»å‹<a class="hash-link" href="#æ›´æ”¹ç”¨ä¾‹çš„è¿”å›å€¼ç±»å‹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç”¨ä¾‹çš„è¿”å›å€¼æš‚æ—¶è®¾ç½®ä¸º 500 ä»¥æ–¹ä¾¿æµ‹è¯•ã€</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rouille::Response::from(Status::InternalServerError)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // match create_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     create_pokemon::Response::Ok(number) =&gt; rouille::Response::json(&amp;Response { number }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     create_pokemon::Response::BadRequest =&gt; rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     create_pokemon::Response::Conflict =&gt; rouille::Response::from(Status::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //     create_pokemon::Response::Error =&gt; rouille::Response::from(Status::InternalServerError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬å°†æµ‹è¯•çš„è¿”å›å€¼ä¿®æ”¹ä¸º Result ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_a_bad_request_error_when_request_is_invalid() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::BadRequest) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_a_conflict_error_when_pokemon_number_already_exists() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::Conflict) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_an_unknown_error_when_an_unexpected_error_happens() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::Unknown) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_the_pokemon_number_otherwise() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(res_number) =&gt; assert_eq!(res_number, number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€å†ä¿®æ”¹ç”¨ä¾‹ï¼ŒæŠŠå®ƒçš„è¿”å›å€¼ä¿®æ”¹ä¸º Resultï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;u16, Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name), Ok(types)) =&gt; match repo.insert(number, name, types) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Insert::Ok(number) =&gt; Ok(u16::from(number)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Insert::Conflict =&gt; Err(Error::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Insert::Error =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(Error::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æµ‹è¯•ç°åœ¨åº”è¯¥é€šè¿‡äº†ï¼</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">running 4 tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_conflict_error_when_pokemon_number_already_exists ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_bad_request_error_when_request_is_invalid ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_an_unknown_error_when_an_unexpected_error_happens ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_the_pokemon_number_otherwise ... ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åå†å»ä¿®æ”¹æˆ‘ä»¬çš„ APIï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match create_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number) =&gt; rouille::Response::json(&amp;Response { number }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::BadRequest) =&gt; rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::Conflict) =&gt; rouille::Response::from(Status::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::Unknown) =&gt; rouille::Response::from(Status::InternalServerError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Usecase ä¿®æ”¹å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å»å¤„ç† Reposity</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ›´æ”¹-repository-çš„è¿”å›ç±»å‹">æ›´æ”¹ Repository çš„è¿”å›ç±»å‹<a class="hash-link" href="#æ›´æ”¹-repository-çš„è¿”å›ç±»å‹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>Repository æ²¡æœ‰æµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ä¿®æ”¹ç”¨ä¾‹è°ƒç”¨ repo çš„è¿”å›å€¼å¼€å§‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::{InsertError, ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;u16, Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name), Ok(types)) =&gt; match repo.insert(number, name, types) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(number) =&gt; Ok(u16::from(number)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(InsertError::Conflict) =&gt; Err(Error::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(InsertError::Unknown) =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(Error::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨å®å¯æ¢¦ç¼–å·å†²çªçš„æµ‹è¯•æ—¶ï¼Œæ‚¨åº”è¯¥å°† <code>.ok()</code> æ·»åŠ åˆ°å­˜å‚¨åº“ insert æ“ä½œä¹‹åã€‚ç°åœ¨è®©æˆ‘ä»¬åœ¨ <em>repositories/pokemon.rs</em>
ä¸­åˆ é™¤ <code>Insert</code> å¹¶åˆ›å»º <code>InsertError</code>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub enum InsertError {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Conflict,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€ååœ¨æ›´æ”¹ <code>Repository</code> Trait å’Œ <code>InMemoryRepository</code> çš„è¿”å›å€¼ç±»å‹å³å¯ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(&amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Result&lt;PokemonNumber, InsertError&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Result&lt;PokemonNumber, InsertError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(InsertError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let mut lock = match self.pokemons.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; return Err(InsertError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if lock.iter().any(|pokemon| pokemon.number == number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(InsertError::Conflict);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let number_clone = number.clone();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.push(Pokemon::new(number_clone, name, types));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å¡«åŠ ä¸€ä¸ªæ–°çš„ç”¨ä¾‹">å¡«åŠ ä¸€ä¸ªæ–°çš„ç”¨ä¾‹<a class="hash-link" href="#å¡«åŠ ä¸€ä¸ªæ–°çš„ç”¨ä¾‹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨å¸¸è§„çš„ HTTP API ä¸­ï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œæˆ‘é€šå¸¸ä¼šæŠŠè¿™ä¸ªå¯¹è±¡åœ¨è¿”å›å›å»ã€‚ç‰¹åˆ«æ˜¯å½“è¿”å›çš„å¯¹è±¡ä¸­åŒ…å«ä¸€åˆ‡å‰ç«¯æ²¡æœ‰ä¼ æ¥çš„å­—æ®µã€‚æ¯”å¦‚ <code>create_at</code>
ç­‰ç”±å­˜å‚¨åº“æ·»åŠ çš„å­—æ®µã€‚</p><p>é¦–å…ˆï¼Œæˆ‘éœ€è¦ä½ åƒæˆ‘ä»¬ä¸€å¼€å§‹é‚£æ ·æš‚æ—¶æ³¨é‡Šæ‰ <code>api/create_pokemon.rs</code>ã€‚ä»¥ä¾¿äºæˆ‘ä»¬ä¸“æ³¨äºæµ‹è¯•ã€‚</p><p>åœ¨ <em>domain/create<!-- -->_<!-- -->pokemon.rs</em> ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æµ‹è¯•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_the_pokemon_number_otherwise() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: 25,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: String::from(&quot;Pikachu&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: vec![String::from(&quot;Electric&quot;)],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(number, 25);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(name, String::from(&quot;Pikachu&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(types, vec![String::from(&quot;Electric&quot;)]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åŒæ—¶åˆ›å»ºä¸€ä¸ª <code>Response</code> ç»“æ„ä½“</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¿®æ”¹ <code>execute</code> å‡½æ•°ï¼Œåœ¨æ’å…¥æˆåŠŸæ—¶åº”è¯¥è¿”å› <code>Pokemon</code> çš„æ‰€æœ‰å­—æ®µï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::entities::{Pokemon, ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;Response, Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name), Ok(types)) =&gt; match repo.insert(number, name, types) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(Pokemon {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }) =&gt; Ok(Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: u16::from(number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: String::from(name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                types: Vec::&lt;String&gt;::from(types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(InsertError::Conflict) =&gt; Err(Error::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(InsertError::Unknown) =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(Error::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨ <code>insert</code> æ‰§è¡ŒæˆåŠŸåï¼Œç›´æ¥è¿”å›ä¸€ä¸ª <code>Pokemon</code> ç»“æ„ä½“ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Result&lt;Pokemon, InsertError&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Result&lt;Pokemon, InsertError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let pokemon = Pokemon::new(number, name, types);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.push(pokemon.clone());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(pokemon)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ºäº†ä½¿ <code>pokemon.clone()</code> èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸º <code>Pokemon</code> å®ç° <code>Clone</code> Traitï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct PokemonName(String);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct PokemonTypes(Vec&lt;PokemonType&gt;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum PokemonType {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Pokemon {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨å­˜å‚¨åº“çš„æ’å…¥é€»è¾‘å·²ç»å®Œæˆï¼Œç”¨ä¾‹å¸Œæœ›èƒ½å¤Ÿç›´æ¥æ‹¿åˆ° <code>Pokemon</code> çš„ <code>name</code> å’Œ <code>types</code> å­—æ®µï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸¤ä¸ªå­—ç«¯ä¹Ÿè½¬ä¸ºå…¬å¼€çš„ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Pokemon {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ä¸º <code>Response</code> å®ç°ç±»å‹è½¬æ¢ï¼Œä» <code>PokemonNumber</code> è½¬æ¢ä¸º <code>u16</code>ã€ä» <code>PokemonName</code> è½¬æ¢ä¸º
<code>String</code>ã€ä» <code>PokemonTypes</code> è½¬æ¢ä¸º <code>Vec&lt;String&gt;</code>:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl From&lt;PokemonName&gt; for String {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn from(n: PokemonName) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        n.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl From&lt;PokemonTypes&gt; for Vec&lt;String&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn from(pts: PokemonTypes) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let mut ts = vec![];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for pt in pts.0.into_iter() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ts.push(String::from(pt));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl From&lt;PokemonType&gt; for String {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn from(t: PokemonType) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String::from(match t {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonType::Electric =&gt; &quot;Electric&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonType::Fire =&gt; &quot;Fire&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æµ‹è¯•åº”è¯¥èƒ½å¤Ÿé€šè¿‡äº†ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">running 4 tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_conflict_error_when_pokemon_number_already_exists ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_bad_request_error_when_request_is_invalid ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_an_unknown_error_when_an_unexpected_error_happens ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_the_pokemon_number_otherwise ... ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬å»æ›´æ–° api çš„å†…å®¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Serialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;, req: &amp;rouille::Request) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match create_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(create_pokemon::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }) =&gt; rouille::Response::json(&amp;Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::BadRequest) =&gt; rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::Conflict) =&gt; rouille::Response::from(Status::Conflict),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::Unknown) =&gt; rouille::Response::from(Status::InternalServerError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>cargo run</code> ä¹‹åï¼Œå†æ¬¡å‘ server å‘é€æ•°æ®ï¼š</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">17</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Charmander&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Fire&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ›å»ºä¸€äº›æµ‹è¯•å€¼">åˆ›å»ºä¸€äº›æµ‹è¯•å€¼<a class="hash-link" href="#åˆ›å»ºä¸€äº›æµ‹è¯•å€¼" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä½ å–œæ¬¢åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä½¿ç”¨ <code>PokemonName::try_from(String::from(&quot;Pikachu&quot;)).unwrap()</code>
ä¹‹ç±»çš„ä¸œè¥¿å—ï¼Ÿè®©æˆ‘ä»¬åœ¨ <em>domain/entities.rs</em> ä¸­åˆ›å»ºä¸€äº›å‡½æ•°ï¼š</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å®å¯æ¢¦ç¼–å·">å®å¯æ¢¦ç¼–å·<a class="hash-link" href="#å®å¯æ¢¦ç¼–å·" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl PokemonNumber {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn pikachu() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(25)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn charmander() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å®å¯æ¢¦åå­—">å®å¯æ¢¦åå­—<a class="hash-link" href="#å®å¯æ¢¦åå­—" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl PokemonName {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn pikachu() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(String::from(&quot;Pikachu&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn charmander() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(String::from(&quot;Charmander&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn bad() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(String::from(&quot;&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å®å¯æ¢¦ç±»å‹">å®å¯æ¢¦ç±»å‹<a class="hash-link" href="#å®å¯æ¢¦ç±»å‹" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl PokemonTypes {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn pikachu() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(vec![PokemonType::Electric])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn charmander() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(vec![PokemonType::Fire])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬åœ¨ç”¨ä¾‹æµ‹è¯•ä¸­ä½¿ç”¨è¿™äº›æµ‹è¯•å€¼ã€‚é¦–å…ˆä¸º <code>Request</code> æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç”¨çš„ <code>new</code> æ–¹æ³•ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´è½»æ¾çš„æ¨¡æ‹Ÿä¸€ä¸ªè¯·æ±‚ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    impl Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fn new(number: PokemonNumber, name: PokemonName, types: PokemonTypes) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: u16::from(number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: String::from(name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                types: Vec::&lt;String&gt;::from(types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥å°±æ˜¯å„ç§çš„æµ‹è¯•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_a_bad_request_error_when_request_is_invalid() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::bad(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_a_conflict_error_when_pokemon_number_already_exists() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repo.insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .ok();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::charmander(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::charmander(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_an_unknown_error_when_an_unexpected_error_happens() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_the_pokemon_otherwise() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request::new(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res.number, u16::from(PokemonNumber::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res.name, String::from(PokemonName::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res.types, Vec::&lt;String&gt;::from(PokemonTypes::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä»¬ç»ˆäºå®Œæˆäº†è¿™ä¸ªæ¼«é•¿çš„é‡æ„ï¼Œå¸Œæœ›ä¸€åˆ‡é¡ºåˆ© :) æˆ‘ä¿è¯ï¼Œä¸‹æ¬¡æˆ‘ä»¬å°†å»å®ç°ä¸€äº›æ–°çš„ç”¨ä¾‹ï¼</p><p>ä»£ç å¯ä»¥åœ¨ <a href="https://github.com/alexislozano/pokedex/tree/article-4" target="_blank" rel="noopener noreferrer">Github</a> ä¸ŠæŸ¥çœ‹</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 5 å…¶ä»–ç”¨ä¾‹">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 5 å…¶ä»–ç”¨ä¾‹</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-03T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ3æ—¥</time> Â· <!-- -->é˜…è¯»éœ€ 15 åˆ†é’Ÿ</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-5/" target="_blank" rel="noopener noreferrer">https://alexis-lozano.com/hexagonal-architecture-in-rust-5/</a></p><p>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>æœ¬æ–‡ç”± <a href="https://Rustt.org" target="_blank" rel="noopener noreferrer">Rustt</a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org" target="_blank" rel="noopener noreferrer">StudyRust</a> è£èª‰æ¨å‡º</p></blockquote><h1>2021-09-12 - Rust å…­è¾¹å½¢æ¶æ„ #5 - å…¶ä»–ç”¨ä¾‹</h1><p>ä¸Šæ¬¡ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›é‡æ„ã€‚ä¸çŸ¥ä½•æ•…ï¼Œæˆ‘ä»¬çš„å®¢æˆ·å¯¹æˆ‘ä»¬å¾ˆç”Ÿæ°”â€¦â€¦æˆ‘çš„æ„æ€æ˜¯ï¼Œä»–åº”è¯¥é«˜å…´ï¼Œä»£ç ç°åœ¨æ¯”ä»¥å‰æ›´å¹²å‡€äº†ã€‚</p><p>åœ¨åƒå®Œä¸€å—è›‹ç³•ä¹‹å (æ˜¾ç„¶ï¼Œè¿™æ˜¯æˆ‘ä»¬åº”å¾—çš„)ï¼Œè®©æˆ‘ä»¬ç»§ç»­å®ç°å‰©ä¸‹çš„ç”¨ä¾‹ã€‚è¿™ç¯‡æ–‡ç« å¯èƒ½ä¼šæœ‰ç‚¹é•¿ï¼Œä½†æ˜¯ï¼Œå˜¿ï¼Œå¦‚æœä½ ä¸æƒ³é˜…è¯»æ•´ä¸ªè¿‡ç¨‹ï¼Œä»£ç åœ¨ github ä¸Š : )
æˆ‘ä»¬å°†å®ç°çš„ç”¨ä¾‹æ˜¯ï¼š</p><ul><li>è·å–æ‰€æœ‰å®å¯æ¢¦</li><li>æŸ¥è¯¢ä¸€åªå®å¯æ¢¦</li><li>åˆ é™¤ä¸€åªå®å¯æ¢¦</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è·å–æ‰€æœ‰å®å¯æ¢¦">è·å–æ‰€æœ‰å®å¯æ¢¦<a class="hash-link" href="#è·å–æ‰€æœ‰å®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä»æµ‹è¯•å¼€å§‹ã€‚è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨ä¾‹ æ–‡ä»¶ï¼š<em>domain/fetch<!-- -->_<!-- -->all<!-- -->_<!-- -->pokemons.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// domain/mod.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod fetch_all_pokemons;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªç”¨ä¾‹æœ‰å“ªäº›å¯èƒ½çš„ç»“æœï¼Ÿ</p><ol><li>æˆåŠŸäº†ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å®å¯æ¢¦</li><li>å­˜å‚¨åº“ä¸­å‘ç”Ÿäº†æœªçŸ¥é”™è¯¯ï¼Œæˆ‘ä»¬æ— æ³•å¾—åˆ°æˆ‘ä»¬çš„å®å¯æ¢¦</li></ol><p>è®©æˆ‘ä»¬å…ˆä»é”™è¯¯æ¡ˆä¾‹å¼€å§‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use super::*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use crate::repositories::pokemon::InMemoryRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_an_unknown_error_when_an_unexpected_error_happens() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new().with_error());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::Unknown) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»ç„¶æ²¡æœ‰å†™ä¸€è¡Œä»£ç ï¼Œåªå†™äº†æµ‹è¯•ã€‚å½“ç„¶ï¼Œç°åœ¨è¿˜ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚è¿™é‡Œæœ‰ä¸¤ä»¶äº‹å¾ˆæœ‰è¶£ï¼š</p><ul><li>è¿™é‡Œçš„æµ‹è¯•å’Œåˆ›å»ºå®å¯æ¢¦é‚£é‡Œå‡ ä¹ä¸€æ ·</li><li>è¿™é‡Œä¸éœ€è¦ repo ä¹‹å¤–çš„å…¶ä»–å‚æ•°</li></ul><p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›å¿…è¦çš„ä»£ç è®©æµ‹è¯•é€šè¿‡ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum Error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;) -&gt; Result&lt;(), Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(Error::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€ç»§ç»­æ·»åŠ ä¸‹ä¸€ä¸ªæµ‹è¯•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_all_the_pokemons_ordered_by_increasing_number_otherwise() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repo.insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .ok();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repo.insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::charmander(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::charmander(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::charmander(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .ok();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let res = execute(repo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res[0].number, u16::from(PokemonNumber::charmander()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res[0].name, String::from(PokemonName::charmander()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res[0].types, Vec::&lt;String&gt;::from(PokemonTypes::charmander()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res[1].number, u16::from(PokemonNumber::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res[1].name, String::from(PokemonName::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            assert_eq!(res[1].types, Vec::&lt;String&gt;::from(PokemonTypes::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨æµ‹è¯•é‡Œï¼Œæˆ‘æŒ‰ç…§ <code>number</code> é€’å‡çš„é¡ºåºæ’å…¥äº†å®å¯æ¢¦ï¼Œæ‰€ä»¥å­˜å‚¨åº“ä¸­å®å¯æ¢¦çš„æ’åºåº”è¯¥æ˜¯ç¡®å®šçš„ã€‚å½“å­˜å‚¨åº“æ²¡æœ‰è¾“å‡ºé”™è¯¯æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½ä»ç”¨ä¾‹ä¸­å¾—åˆ°ä¸€ä¸ª
<code>Vec&lt;Response&gt;</code>ã€‚ç°åœ¨æˆ‘ä»¬è¦ä¸ºç”¨ä¾‹åŠ å…¥ <code>Response</code>ï¼Œå¹¶ç¼–å†™ä¸€éƒ¨åˆ†ç”¨ä¾‹å‡½æ•°çš„å†…å®¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;) -&gt; Result&lt;Vec&lt;Response&gt;, Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match repo.fetch_all() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(pokemons) =&gt; Ok(pokemons</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .into_iter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(|p| Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: u16::from(p.number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: String::from(p.name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                types: Vec::&lt;String&gt;::from(p.types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect::&lt;Vec&lt;Response&gt;&gt;()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(FetchAllError::Unknown) =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç„¶åå†ä¸ºå­˜å‚¨åº“æ·»åŠ å¹¶å®ç° <code>fetch_all</code> æ–¹æ³•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub enum FetchAllError {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_all(&amp;self) -&gt; Result&lt;Vec&lt;Pokemon&gt;, FetchAllError&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_all(&amp;self) -&gt; Result&lt;Vec&lt;Pokemon&gt;, FetchAllError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(FetchAllError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let lock = match self.pokemons.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let mut pokemons = lock.to_vec();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pokemons.sort_by(|a, b| a.number.cmp(&amp;b.number));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(pokemons)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ºäº†å®ç°å®å¯æ¢¦æŒ‰ç…§ <code>number</code> æ’åºï¼Œ<code>PokemonNumber</code> éœ€è¦å®ç° <code>PartialEq</code>ã€ <code>Eq</code>ã€<code>PartialOrd</code>ã€<code>Ord</code>
è¿™ 4 ä¸ª Trait</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Clone, PartialEq, Eq, PartialOrd, Ord)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct PokemonNumber(u16);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿è¡Œ c<code>argo test</code>ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">running 6 tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">it_should_return_an_unknown_error_when_an_unexpected_error_happens ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">it_should_return_all_the_pokemons_ordered_by_increasing_number_otherwise ... ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬å·²ç»å®Œæˆäº†è¿™ä¸ªç”¨ä¾‹ :) ç°åœ¨è®©æˆ‘ä»¬å¿«é€Ÿå®ç° apiã€‚åœ¨ <em>api/mod.rs</em> ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod fetch_all_pokemons;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// in the router macro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(GET) (/) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch_all_pokemons::serve(repo.clone())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€å®ç°å…·ä½“çš„ handler api/fetch_all_pokemons.rsï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::api::Status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::fetch_all_pokemons;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use serde::Serialize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Serialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match fetch_all_pokemons::execute(repo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; rouille::Response::json(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &amp;res.into_iter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .map(|p| Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    number: p.number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    name: p.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    types: p.types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .collect::&lt;Vec&lt;Response&gt;&gt;(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_all_pokemons::Error::Unknown) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rouille::Response::from(Status::InternalServerError)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æ‚¨å¯ä»¥è¿è¡Œ <code>cargo run</code>ï¼Œå¹¶ä½¿ç”¨ä½ æœ€å–œæ¬¢çš„ HTTP å®¢æˆ·ç«¯ (curlã€postmanã€...)ã€‚é€šè¿‡åœ¨ <code>/</code> ä¸Šå‘é€ POST
è¯·æ±‚æ¥åˆ›å»ºä¸€äº›å®å¯æ¢¦ã€‚ç„¶åæ‚¨å¯ä»¥ä½¿ç”¨æµè§ˆå™¨è®¿é—® http://localhost:8000ã€‚è¿™æ˜¯æˆ‘å¾—åˆ°çš„ï¼š</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Charmander&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Fire&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Pikachu&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Electric&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æŸ¥è¯¢ä¸€åªå®å¯æ¢¦">æŸ¥è¯¢ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#æŸ¥è¯¢ä¸€åªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ç¬¬äºŒä¸ªç”¨ä¾‹ï¼ç°åœ¨æˆ‘ä»¬æƒ³é€šè¿‡ç»™ç³»ç»Ÿä¸€ä¸ªå®å¯æ¢¦çš„ç¼–å·æ¥è·å–ä¸€ä¸ªå®å¯æ¢¦ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨ä¾‹æ–‡ä»¶ <em>domain/fetch<!-- -->_<!-- -->pokemon.rs</em>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// domain/mod.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod fetch_pokemon;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬æ€è€ƒä¸€ä¸‹ç”¨ä¾‹è¿è¡Œæ—¶å¯èƒ½é‡åˆ°ä»€ä¹ˆæƒ…å†µã€‚</p><ol><li>å­˜å‚¨åº“å¯èƒ½ä¼šå¼•å‘æœªçŸ¥é”™è¯¯ã€‚</li><li>è¯·æ±‚å‚æ•°å¯èƒ½æ˜¯ä¸åˆæ³•çš„ã€‚</li><li>ç”¨æˆ·ç»™å®šçš„ç¼–å·å¯èƒ½å¯¹åº”æ²¡æœ‰å®å¯æ¢¦ã€‚</li><li>è·å¾—å®å¯æ¢¦æˆåŠŸäº†</li></ol><p>è®©æˆ‘ä»¬ä»æœªçŸ¥é”™è¯¯çš„æµ‹è¯•å¼€å§‹ã€‚æ–°å»º <em>domain/fetch<!-- -->_<!-- -->pokemon.rs</em> å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::entities::PokemonNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use super::*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use crate::repositories::pokemon::InMemoryRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_an_unknown_error_when_an_unexpected_error_happens() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new().with_error());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let req = Request::new(PokemonNumber::pikachu());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::Unknown) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€ï¼Œä¸ºæµ‹è¯•å®ç°å¿…è¦çš„ç±»å‹å’Œå‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum Error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ºäº†è®©æµ‹è¯•æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬è¿˜ä¸º <code>Request</code> å®ç°äº†ä¸€ä¸ª <code>new</code> æ–¹æ³•ï¼Œå½“ç„¶åªåœ¨æµ‹è¯•æ—¶ä½¿ç”¨ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    impl Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fn new(number: PokemonNumber) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: u16::from(number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åï¼Œå†å®ç°ä¸€ä¸ªåªç”¨æ»¡è¶³è¿™é¡¹æµ‹è¯•çš„ <code>execute</code> å‡½æ•°å³å¯ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;(), Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(Error::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬è¿è¡Œ <code>cargo test fetch_pokemon</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_an_unknown_error_when_an_unexpected_error_happens ... ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¥½çš„ã€‚æˆ‘ä»¬å¯ä»¥å¼€å§‹ä¸‹ä¸€ä¸ªæµ‹è¯•äº†ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¯·æ±‚æ ¼å¼é”™è¯¯çš„æƒ…å†µï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_a_bad_request_error_when_request_is_invalid() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request::new(PokemonNumber::bad());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(Error::BadRequest) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨ <code>PokemonNumber</code> ä¸­åˆ›å»º <code>bad</code> å‡½æ•°ã€‚åœ¨ <em>domain/entities.rs</em> ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl PokemonNumber {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn bad() -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Self(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€ï¼Œåœ¨ <code>Error</code> ä¸­æ·»åŠ  <code>Badrequest</code> ç±»å‹ä¸ä¹‹å¯¹åº”ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub enum Error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BadRequest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨å·²ç»èƒ½å¤Ÿé€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯æµ‹è¯•å°šä¸”ä¸èƒ½é€šè¿‡ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬çš„ <code>execute</code> å‡½æ•°æš‚æ—¶åªèƒ½è¿”å› <code>Unknown</code> ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::convert::TryFrom;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;(), Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match PokemonNumber::try_from(req.number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number) =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(Error::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ä¸¤ä¸ªæµ‹è¯•éƒ½é€šè¿‡äº†ï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥è¿›è¡Œç¬¬ä¸‰ä¸ªæµ‹è¯•ï¼šåœ¨å­˜å‚¨åº“ä¸­æ‰¾ä¸åˆ°å®å¯æ¢¦æ—¶ï¼Œåº”è¯¥è¿”å› <code>NotFound</code>:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn it_should_return_a_not_found_error_when_the_repo_does_not_contain_the_pokemon() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = Request::new(PokemonNumber::pikachu());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(Error::NotFound) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åŒæ ·ï¼Œåœ¨ <code>Error</code> ä¸­è¡¥å…… <code>NotFound</code> é”™è¯¯ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub enum Error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NotFound,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åƒä¹‹å‰ä¸€æ ·ï¼Œæµ‹è¯•æ²¡æœ‰é€šè¿‡ã€‚æˆ‘ä»¬éœ€è¦åœ¨ <code>execute</code> å‡½æ•°ä¸­å¤„ç†å¯¹åº”çš„é”™è¯¯ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::{FetchOneError, ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(number) =&gt; match repo.fetch_one(number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(_) =&gt; Ok(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(FetchOneError::NotFound) =&gt; Err(Error::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(FetchOneError::Unknown) =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€åœ¨ <em>repositories/pokemon.rs</em> ä¸­è¡¥å……å¯¹åº”çš„æ–¹æ³•å’Œé”™è¯¯ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub enum FetchOneError {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NotFound,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), FetchOneError&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), FetchOneError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(FetchOneError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(FetchOneError::NotFound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Et voilÃ ï¼Œæµ‹è¯•é€šè¿‡äº†ï¼æœ€åå»å¤„ç†è·å–æˆåŠŸçš„æµ‹è¯•å§ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use crate::domain::entities::{PokemonName, PokemonTypes};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_the_pokemon_otherwise() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repo.insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonName::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .ok();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let req = Request::new(PokemonNumber::pikachu());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(res) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                assert_eq!(res.number, u16::from(PokemonNumber::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                assert_eq!(res.name, String::from(PokemonName::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                assert_eq!(res.types, Vec::&lt;String&gt;::from(PokemonTypes::pikachu()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆåˆ›å»º <code>Response</code> ç±»å‹ï¼Œå¹¶æ”¹å˜ <code>execute</code> çš„è¿”å›å€¼ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;Response, Error&gt; {</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å»å¤„ç† <code>Ok(_)</code> çš„éƒ¨åˆ†ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::entities::{Pokemon, ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(Pokemon {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}) =&gt; Ok(Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16::from(number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String::from(name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec::&lt;String&gt;::from(types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åä¿®æ”¹å­˜å‚¨åº“çš„ <code>fetch_one</code> å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;Pokemon, FetchOneError&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;Pokemon, FetchOneError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(FetchOneError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let lock = match self.pokemons.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; return Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match lock.iter().find(|p| p.number == number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Some(pokemon) =&gt; Ok(pokemon.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            None =&gt; Err(FetchOneError::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡äº†ç°åœ¨ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_not_found_error_when_the_repo_does_not_contain_the_pokemon ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_the_pokemon_otherwise ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_bad_request_error_when_request_is_invalid ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_an_unknown_error_when_an_unexpected_error_happens ... ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬ç°åœ¨å‘ API ä¸­å‰åŠ ä¸€ä¸ªæ–°è·¯ç”±ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod fetch_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// in the router macro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(GET) (/{number: u16}) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fetch_pokemon::serve(repo.clone(), number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€å† <em>api/fetch<!-- -->_<!-- -->pokemon.rs</em> åˆ›å»ºå¯¹åº”çš„ <code>serve</code> å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::api::Status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::fetch_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use serde::Serialize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Serialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;, number: u16) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = fetch_pokemon::Request { number };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match fetch_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(fetch_pokemon::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }) =&gt; rouille::Response::json(&amp;Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_pokemon::Error::BadRequest) =&gt; rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_pokemon::Error::NotFound) =&gt; rouille::Response::from(Status::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_pokemon::Error::Unknown) =&gt; rouille::Response::from(Status::InternalServerError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æ‚¨å¯ä»¥è¿è¡Œåº”ç”¨ç¨‹åºï¼Œæ‰“å¼€æ‚¨çš„ HTTP å®¢æˆ·ç«¯å¹¶å°†ä¸€äº›å®å¯æ¢¦æ·»åŠ åˆ°å­˜å‚¨åº“ä¸­ã€‚ç„¶åï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿé€šè¿‡åœ¨ç½‘å€æœ«å°¾æ·»åŠ å®å¯æ¢¦çš„æ•°é‡æ¥ä¸€ä¸€è·å–å®ƒä»¬ã€‚
ä¾‹å¦‚ï¼Œåœ¨æˆ‘çš„è®¡ç®—æœºä¸Šï¼Œhttp://localhost:8000/25 ä¸Šçš„ GET è¯·æ±‚è¿”å›äº†ï¼š</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;number&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Pikachu&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;types&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;Electric&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ é™¤ä¸€åªå®å¯æ¢¦">åˆ é™¤ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#åˆ é™¤ä¸€åªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä¿è¯ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šå®Œæˆã€‚åˆ é™¤å®å¯æ¢¦æ˜¯æˆ‘ä»¬çš„æœ€åä¸€ä¸ªç”¨ä¾‹ã€‚è¿™ä¸ªç”¨ä¾‹çš„ç»“æœæœ‰å››ç§å¯èƒ½ï¼š</p><ul><li>æˆåŠŸ</li><li>è¯·æ±‚æ ¼å¼é”™è¯¯</li><li>æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„å®å¯æ¢¦</li><li>æœªçŸ¥é”™è¯¯</li></ul><p>æ‚¨åº”è¯¥å·²ç»æ³¨æ„åˆ°ï¼Œå®ƒä»¬ä¸è·å– Pokemon ç”¨ä¾‹ä¸­çš„å®Œå…¨ç›¸åŒã€‚æˆ‘ä¼šè§£é‡Šæ›´å¿«ä¸€äº›ã€‚ç°åœ¨å°±å¼€å§‹äº†ã€‚è®©æˆ‘ä»¬ç›´æ¥ç¼–å†™æ‰€æœ‰æµ‹è¯•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// domain/mod.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub mod delete_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// domain/delete_pokemon.rs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[cfg(test)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mod tests {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use super::*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use crate::domain::entities::{PokemonName, PokemonTypes};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    use crate::repositories::pokemon::InMemoryRepository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_an_unknown_error_when_an_unexpected_error_happens() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new().with_error());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let req = Request::new(PokemonNumber::pikachu());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::Unknown) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_a_bad_request_error_when_request_is_invalid() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let req = Request::new(PokemonNumber::bad());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::BadRequest) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_a_not_found_error_when_the_repo_does_not_contain_the_pokemon() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let req = Request::new(PokemonNumber::pikachu());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(Error::NotFound) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #[test]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn it_should_return_ok_otherwise() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        repo.insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonNumber::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonName::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            PokemonTypes::pikachu(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .ok();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let req = Request::new(PokemonNumber::pikachu());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let res = execute(repo, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match res {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(()) =&gt; {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    impl Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fn new(number: PokemonNumber) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: u16::from(number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é™¤äº†æˆåŠŸæƒ…å†µä¸‹çš„æµ‹è¯•ï¼Œå…¶ä»–çš„æµ‹è¯•åŸºæœ¬ä¸Šæ˜¯å¯¹ <em>domain/fetch<!-- -->_<!-- -->pokemon.rs</em> çš„å¤åˆ¶ç²˜è´´ã€‚æ¥ä¸‹æ¥æ˜¯ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub enum Error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BadRequest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NotFound,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬ä¸éœ€è¦å®šä¹‰ <code>Response</code> ç±»å‹ï¼Œå› ä¸ºåœ¨ <code>Ok</code> æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šè¿”å›ä»»ä½•å†…å®¹ã€‚è®©æˆ‘ä»¬å®šä¹‰ <code>execute</code> å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::entities::PokemonNumber;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::{DeleteError, Repository};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::convert::TryFrom;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn execute(repo: Arc&lt;dyn Repository&gt;, req: Request) -&gt; Result&lt;(), Error&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match PokemonNumber::try_from(req.number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number) =&gt; match repo.delete(number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(()) =&gt; Ok(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(DeleteError::NotFound) =&gt; Err(Error::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Err(DeleteError::Unknown) =&gt; Err(Error::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(Error::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¤ªå¥½äº†ï¼ç°åœ¨æˆ‘ä»¬åªå‰©ä¸‹å®ç°å­˜å‚¨åº“äº†ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šå®Œæˆï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub enum DeleteError {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NotFound,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Unknown,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub trait Repository: Send + Sync {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn delete(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), DeleteError&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for InMemoryRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn delete(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), DeleteError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if self.error {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(DeleteError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let mut lock = match self.pokemons.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; return Err(DeleteError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let index = match lock.iter().position(|p| p.number == number) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Some(index) =&gt; index,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            None =&gt; return Err(DeleteError::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lock.remove(index);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿è¡Œæµ‹è¯•ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_bad_request_error_when_request_is_invalid ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_a_not_found_error_when_the_repo_does_not_contain_the_pokemon ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_an_unknown_error_when_an_unexpected_error_happens ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test it_should_return_ok_otherwise ... ok</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">We can now add the new route in our API. Let&#x27;s add the following to api/mod.rs:</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ API ä¸­æ·»åŠ æ–°è·¯ç”±ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod delete_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// in the router macro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(DELETE) (/{number: u16}) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete_pokemon::serve(repo.clone(), number)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum Status {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl From&lt;Status&gt; for rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn from(status: Status) -&gt; Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let status_code = match status {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Status::Ok =&gt; 200,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘åœ¨ <code>Status</code> ä¸­è¡¥å……ä¸€ä¸ª OK ç±»å‹ç”¨æ¥è¡¨ç¤ºæ²¡æœ‰ç›¸åº”ä½“çš„ 200 çŠ¶æ€ç ï¼Œç°åœ¨æ·»åŠ å¯¹åº”çš„ <code>serve</code> å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::api::Status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::delete_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use rouille;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn serve(repo: Arc&lt;dyn Repository&gt;, number: u16) -&gt; rouille::Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = delete_pokemon::Request { number };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match delete_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(()) =&gt; rouille::Response::from(Status::Ok),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(delete_pokemon::Error::BadRequest) =&gt; rouille::Response::from(Status::BadRequest),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(delete_pokemon::Error::NotFound) =&gt; rouille::Response::from(Status::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(delete_pokemon::Error::Unknown) =&gt; rouille::Response::from(Status::InternalServerError),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é€šè¿‡ä½¿ç”¨ HTTP å®¢æˆ·ç«¯ï¼Œç°åœ¨ä½ åº”è¯¥èƒ½å¤Ÿåˆ é™¤å®å¯æ¢¦äº† :)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘å¸Œæœ›å®ƒä¸ä¼šå¤ªé•¿......ä½†ç°åœ¨æˆ‘ä»¬çš„å®¢æˆ·å¾ˆé«˜å…´ï¼è€¶ï¼ä¸‹ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†ä¸ºæˆ‘ä»¬çš„ç”¨ä¾‹å®ç°å¦ä¸€ä¸ªå‰ç«¯ã€‚ç°åœ¨æˆ‘ä»¬åªæœ‰ä¸€ä¸ª HTTP APIï¼Œå¦‚æœè¿˜èƒ½æœ‰ä¸€ä¸ª CLI
æ¥ç®¡ç†æˆ‘ä»¬çš„å®å¯æ¢¦å°±å¥½äº† :)</p><p>ä»£ç å¯ä»¥åœ¨ <a href="https://github.com/alexislozano/pokedex/tree/article-5" target="_blank" rel="noopener noreferrer">Github</a> ä¸ŠæŸ¥çœ‹</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 6 CLI">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 6 CLI</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-03T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ3æ—¥</time> Â· <!-- -->é˜…è¯»éœ€ 10 åˆ†é’Ÿ</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-6/" target="_blank" rel="noopener noreferrer">https://alexis-lozano.com/hexagonal-architecture-in-rust-6/</a></p><p>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>æœ¬æ–‡ç”± <a href="https://Rustt.org" target="_blank" rel="noopener noreferrer">Rustt</a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org" target="_blank" rel="noopener noreferrer">StudyRust</a> è£èª‰æ¨å‡º</p></blockquote><h1>2021-10-09 - Rust å…­è¾¹å½¢æ¶æ„ #6 - CLI</h1><p>å˜¿ï¼Œå¥½ä¹…ä¸è§ï¼ä¸Šæ¬¡ï¼Œæˆ‘ä»¬å®ç°äº†å‰©ä½™çš„ç”¨ä¾‹ï¼Œå¹¶å°†å®ƒä»¬è¿æ¥åˆ°æˆ‘ä»¬çš„ APIã€‚ç°åœ¨ï¼Œæˆ‘æƒ³æ·»åŠ å¦ä¸€ç§æ–¹å¼æ¥ä½¿ç”¨æˆ‘ä»¬çš„ç¨‹åºã€‚æˆ‘ä»¬å°†ä½¿ç”¨ CLIã€‚CLI æ˜¯
Command Line Interface (å‘½ä»¤è¡Œæ¥å£) çš„æ„æ€ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç¼©å†™è¯ï¼Œæ„æ€æ˜¯ï¼šâ€œè®©æˆ‘ä»¬é€šè¿‡ç»ˆç«¯ä½¿ç”¨è¿™ä¸ªç¨‹åºâ€ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ­å»ºè„šæ‰‹æ¶">æ­å»ºè„šæ‰‹æ¶<a class="hash-link" href="#æ­å»ºè„šæ‰‹æ¶" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æ„å»º CLI æ„å‘³ç€æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ æ–°çš„ä¾èµ–å’Œä¸€ä¸ªæ–°æ–‡ä»¶å¤¹ã€‚è®©æˆ‘ä»¬ä»æ·»åŠ ä¾èµ–å¼€å§‹ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•ï¼Œå†è¿è¡Œä¹‹å‰éœ€è¦æç¤ºç”¨æˆ·æ˜¯è¿è¡Œ CLI è¿˜æ˜¯ HTTP
APIã€‚æˆ‘ä»¬å°†ä½¿ç”¨ <code>clap</code> æ·»åŠ å‘½ä»¤è¡Œå¼€å…³è®©ç”¨æˆ·é€‰æ‹©å¯åŠ¨æ–¹å¼ï¼ŒåŒæ—¶è¿˜ä¼šä½¿ç”¨ <code>dialoguer</code> å»åˆ›å»ºæç¤ºä¿¡æ¯ã€‚</p><p>æ‰“å¼€ Cargo.tomlï¼Œå¹¶æ·»åŠ ï¼š</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clap = &quot;2.33.3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dialoguer = &quot;0.8.0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“ä½ å†è¯»è¿™ç¯‡æ–‡ç« æ—¶å¯ä»¥å°†ä¾èµ–æ¢ä¸ºæœ€æ–°çš„ã€‚ç°åœ¨è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›å‘½ä»¤è¡Œå¼€å…³ï¼Œæ‰“å¼€ <em>main.rs</em>:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[macro_use]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extern crate clap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use clap::{App, Arg};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">And then we can use it:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let matches = App::new(crate_name!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .version(crate_version!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .author(crate_authors!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .arg(Arg::with_name(&quot;cli&quot;).long(&quot;cli&quot;).help(&quot;Runs in CLI mode&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .get_matches();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match matches.occurrences_of(&quot;cli&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        0 =&gt; api::serve(&quot;localhost:8000&quot;, repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; unreachable!(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰€ä»¥ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºäº†å­˜å‚¨åº“ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¤„ç† CLI çš„ clap åº”ç”¨ç¨‹åºã€‚å¦‚æœåœ¨è¿è¡Œç¨‹åºæ—¶æ·»åŠ  <code>--cli</code> æ ‡å¿—ï¼Œç¨‹åºç°åœ¨å°†
panicã€‚å¦‚æœæ²¡æœ‰æ·»åŠ ï¼Œå°±ä¼šè¿è¡Œ APIã€‚æ­£å¦‚æˆ‘ä¹‹å‰æ‰€è¯´ï¼Œ<code>clap</code> èƒ½è®©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºä¸€ä¸ª CLIã€‚æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œæ¥å°è¯•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run -- --help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pokedex 0.1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Alexis Lozano &lt;alexis.pascal.lozano@gmail.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USAGE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pokedex [FLAGS]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLAGS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --cli        Runs in CLI mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -h, --help       Prints help information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -V, --version    Prints version information</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>éå¸¸ä¸é”™æ˜¯å§ :)</p><p>ç°åœ¨æˆ‘ä»¬è¦æŠŠ <code>unreachable!()</code> æ›¿æ¢ä¸º <code>cli::run(repo)</code>ã€‚æˆ‘ä»¬ç°åœ¨è¦åˆ›å»ºä¸€ä¸ª <code>cli</code> æ¨¡å—ï¼Œæ‰€æœ‰å’Œ cli
ç›¸å…³çš„ä»£ç éƒ½ä¼šåœ¨è¯¥æ¨¡å—é‡Œã€‚åœ¨ <em>main.rs</em> é‡Œå¼•å…¥æ¨¡å—ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod cli;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€è®©æˆ‘ä»¬åˆ›å»º <em>src/cli</em> æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ ä¸€ä¸ª <em>mod.rs</em> æ–‡ä»¶ã€‚åœ¨ <em>cli/mod.rs</em> ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨è¿è¡Œ <code>cargo run -- --cli</code> åº”è¯¥ä¸ä¼š panic äº†ã€‚</p><p>æ¥ç€è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use dialoguer::{theme::ColorfulTheme, Select};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let choices = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Fetch all Pokemons&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Fetch a Pokemon&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Create a Pokemon&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Delete a Pokemon&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Exit&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let index = match Select::with_theme(&amp;ColorfulTheme::default())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .with_prompt(&quot;Make your choice&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .items(&amp;choices)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .default(0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .interact()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(index) =&gt; index,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; continue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match index {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            4 =&gt; break,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; continue,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬åˆ—å‡ºäº†æ‰€æœ‰ç”¨æˆ·èƒ½å¤Ÿè¿è¡Œçš„å‘½ä»¤ã€‚å¦‚æœç”¨æˆ·é€‰æ‹© <code>Exit</code>ï¼Œç¨‹åºå°±ä¼šé€€å‡ºã€‚å¦åˆ™ï¼Œç¨‹åºæš‚æ—¶ä»€ä¹ˆéƒ½ä¸ä¼šåšã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬é©¬ä¸Šå°±ä¼šå®ç°å…¶ä»–çš„å‘½ä»¤ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ›å»ºä¸€ä¸ªå®å¯æ¢¦">åˆ›å»ºä¸€ä¸ªå®å¯æ¢¦<a class="hash-link" href="#åˆ›å»ºä¸€ä¸ªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>è®©æˆ‘ä»¬ä»åˆ›å»ºå¼€å§‹ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿæœ‰æ–¹æ³•å‘å­˜å‚¨åº“ä¸­æ·»åŠ å®å¯æ¢¦ï¼Œåé¢çš„æµ‹è¯•å°±æ›´å®¹æ˜“åšäº†ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">match index {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2 =&gt; create_pokemon::run(repo.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ¨¡å—ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod create_pokemon;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¥½äº†ï¼Œåœ¨ <em>cli/create_pokemon.rs</em> ä¸­å¡«åŠ ä¸Šå¯¹åº”çš„å‡½æ•°ç­¾åï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸ºäº†åˆ›å»ºä¸€ä¸ªå®å¯æ¢¦ï¼ŒCLI éœ€è¦å‘ç”¨æˆ·è¯¢é—®å®å¯æ¢¦çš„ ç¼–å·ã€åç§°å’Œç±»å‹ã€‚ä¸ºäº†æ–¹ä¾¿è¿™ä¸ªè¿‡ç¨‹ï¼Œå¹¶ä¸”æé«˜æç¤ºä¿¡æ¯çš„å¤ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šä¸ºè¿™äº›ä¿¡æ¯åˆ†åˆ«å®ç°å„è‡ªçš„æç¤ºå‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::cli::{prompt_name, prompt_number, prompt_types};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let number = prompt_number();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let name = prompt_name();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let types = prompt_types();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€åœ¨ <em>cli/mod.rs</em> ä¸­å®ç°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use dialoguer::{..., Input, MultiSelect};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn prompt_number() -&gt; Result&lt;u16, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match Input::new().with_prompt(&quot;Pokemon number&quot;).interact_text() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number) =&gt; Ok(number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn prompt_name() -&gt; Result&lt;String, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match Input::new().with_prompt(&quot;Pokemon name&quot;).interact_text() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(name) =&gt; Ok(name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn prompt_types() -&gt; Result&lt;Vec&lt;String&gt;, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let types = [&quot;Electric&quot;, &quot;Fire&quot;];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match MultiSelect::new()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .with_prompt(&quot;Pokemon types&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .items(&amp;types)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .interact()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(indexes) =&gt; Ok(indexes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .into_iter()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .map(|index| String::from(types[index]))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .collect::&lt;Vec&lt;String&gt;&gt;()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>æç¤ºï¼šå¤šé€‰æ¡†æŒ‰ç©ºæ ¼é€‰ä¸­</p></blockquote><p>å¦‚ä½ æ‰€è§ï¼Œæ‰€æœ‰çš„æç¤ºéƒ½å¯èƒ½å¤±è´¥ï¼Œè®©æˆ‘ä»¬å›åˆ° <em>cli/create<!-- -->_<!-- -->pokemon.rs</em>ï¼Œæœ‰äº†ç”¨æˆ·çš„è¾“å…¥ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒå°è£…ä¸ºç”¨ä¾‹ä¸­éœ€è¦çš„
<code>Request</code> ç»“æ„ä½“ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::create_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = match (number, name, types) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name), Ok(types)) =&gt; create_pokemon::Request {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            println!(&quot;An error occurred during the prompt&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“å‘ç”Ÿè¾“å…¥é”™è¯¯æ—¶ï¼Œæˆ‘ä»¬ä¼šé€€å›åˆ°ä¸»èœå•ã€‚ç°åœ¨æœ‰äº† <code>Request</code> ç»“æ„ä½“ï¼Œæˆ‘ä»¬å°±èƒ½è°ƒç”¨åˆ›å»ºå®å¯æ¢¦çš„ç”¨ä¾‹äº†ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match create_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; {},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::BadRequest) =&gt; println!(&quot;The request is invalid&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::Conflict) =&gt; println!(&quot;The Pokemon already exists&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(create_pokemon::Error::Unknown) =&gt; println!(&quot;An unknown error occurred&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬å¤„ç†äº†æ‰€æœ‰çš„é”™è¯¯ç±»å‹ï¼Œæ¯ç§é”™è¯¯éƒ½ä¼šåé¦ˆåˆ°ç”¨æˆ·çš„ç»ˆç«¯ä¸Šã€‚å½“ç”¨ä¾‹æ‰§è¡ŒæˆåŠŸæ—¶ï¼Œæˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ª <code>Response</code>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match create_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; println!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;{:?}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: res.number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: res.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                types: res.types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼æ‰“å¼€ç»ˆç«¯ï¼Œä»¥å‘½ä»¤è¡Œæ¨¡å¼è¿è¡Œï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">âœ” Make your choice Â· Create a Pokemon</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pokemon number: 25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pokemon name: Pikachu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pokemon types: Electric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Response { number: 25, name: &quot;Pikachu&quot;, types: [&quot;Electric&quot;] }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Great! First command implemented, let&#x27;s do the next one!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è·å–æ‰€æœ‰å®å¯æ¢¦">è·å–æ‰€æœ‰å®å¯æ¢¦<a class="hash-link" href="#è·å–æ‰€æœ‰å®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ç°åœ¨æˆ‘ä»¬å»å®ç°è·å–æ‰€æœ‰å®å¯æ¢¦ï¼é¦–å…ˆæˆ‘ä»¬åœ¨å¯¹åº”çš„ <code>index</code> æ·»åŠ ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">match index {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0 =&gt; fetch_all_pokemons::run(repo.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ›å»ºæ¨¡å—</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod fetch_all_pokemons;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨å®ç°å…·ä½“çš„åŠŸèƒ½ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::fetch_all_pokemons;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match fetch_all_pokemons::execute(repo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; res.into_iter().for_each(|p| {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            println!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;{:?}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    number: p.number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    name: p.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    types: p.types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_all_pokemons::Error::Unknown) =&gt; println!(&quot;An unknown error occurred&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘å·²ç»è¯¦ç»†çš„è§£é‡Šè¿‡ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œå°±æ²¡å¿…è¦ä¸€æ­¥ä¸€æ­¥è¯´æ˜äº†ã€‚è¿™ä¸ªå‘½ä»¤ä¸éœ€è¦ä»»ä½•å‚èµ›ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦ä»»ä½•æç¤ºä¿¡æ¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä»å­˜å‚¨åº“æ‹¿åˆ°ç»“æœï¼Œä¾æ¬¡æ‰“å°å³å¯ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦">æŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦<a class="hash-link" href="#æŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å’Œä¹‹å‰ä¸€æ ·ï¼Œåˆ›å»ºä¸€ä¸ªæ¨¡å—ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod fetch_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match index {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1 =&gt; fetch_pokemon::run(repo.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ›å»ºå¯¹åº”çš„å¤„ç†å‡½æ•°</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::cli::prompt_number;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::fetch_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Debug)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let number = prompt_number();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = match number {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number) =&gt; fetch_pokemon::Request { number },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            println!(&quot;An error occurred during the prompt&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match fetch_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(res) =&gt; println!(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;{:?}&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Response {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                number: res.number,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                name: res.name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                types: res.types,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_pokemon::Error::BadRequest) =&gt; println!(&quot;The request is invalid&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_pokemon::Error::NotFound) =&gt; println!(&quot;The Pokemon does not exist&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(fetch_pokemon::Error::Unknown) =&gt; println!(&quot;An unknown error occurred&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå‘ç”¨æˆ·è¯¢é—®äº†ç¼–å·ï¼Œå¦‚æœè·å–å¤±è´¥äº†å°±è¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚æ¥ç€æ„å»º Request ç»“æ„ä½“ï¼Œè°ƒç”¨ç”¨ä¾‹ï¼ŒæˆåŠŸå°±æ‰“å°ç»“æœï¼Œå¦åˆ™æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p><h1>åˆ é™¤ä¸€ä¸ªå®å¯æ¢¦</h1><p>æœ€åä¸€ä¸ªå‘½ä»¤ï¼</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mod delete_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match index {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3 =&gt; delete_pokemon::run(repo.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åˆ›å»ºæ–°æ¨¡å—ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use crate::cli::prompt_number;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::domain::delete_pokemon;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use crate::repositories::pokemon::Repository;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::Arc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub fn run(repo: Arc&lt;dyn Repository&gt;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let number = prompt_number();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let req = match number {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(number) =&gt; delete_pokemon::Request { number },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            println!(&quot;An error occurred during the prompt&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match delete_pokemon::execute(repo, req) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(()) =&gt; println!(&quot;The Pokemon has been deleted&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(delete_pokemon::Error::BadRequest) =&gt; println!(&quot;The request is invalid&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(delete_pokemon::Error::NotFound) =&gt; println!(&quot;The Pokemon does not exist&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(delete_pokemon::Error::Unknown) =&gt; println!(&quot;An unknown error occurred&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å’ŒæŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦åŸºæœ¬ä¸€æ ·ï¼Œåªä¸è¿‡ä¸éœ€è¦è¿”å›ä¿¡æ¯ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ç°åœ¨æ‚¨æ— éœ€ç›´æ¥å‘é€ HTTP è¯·æ±‚å³å¯åœ¨ç»ˆç«¯ä¸­äº«å—ä½¿ç”¨ç¨‹åº : D
ä½†æ˜¯ä½ çŸ¥é“æˆ‘ä»¬ç¼ºå°‘ä»€ä¹ˆå—ï¼Ÿä¸€ä¸ªçœŸæ­£å­˜å‚¨æˆ‘ä»¬çš„å®å¯æ¢¦çš„åœ°æ–¹ã€‚ç›®å‰ï¼Œå®ƒä»¬åªå­˜åœ¨äºå†…å­˜ä¸­ï¼Œå› æ­¤æ¯æ¬¡æˆ‘ä»¬è¿è¡Œç¨‹åºæ—¶å­˜å‚¨åº“éƒ½æ˜¯ç©ºçš„ã€‚ä» CLI åˆ›å»ºæˆ‘ä»¬çš„å®å¯æ¢¦ç„¶åä»
API è·å–å®ƒä»¬ä¼šå¾ˆé…· : ) ä¸‹ä¸€ç¯‡å°†æ˜¯æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« ï¼šå®ç°ä¸€ä¸ªé•¿æœŸä¿å­˜çš„å­˜å‚¨åº“ã€‚</p><p>ä»£ç å¯ä»¥åœ¨ <a href="https://github.com/alexislozano/pokedex/tree/article-6" target="_blank" rel="noopener noreferrer">Github</a> ä¸ŠæŸ¥çœ‹</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/03/[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 7 é•¿æœŸå­˜å‚¨åº“">[è¯‘] Rust å…­è¾¹å½¢æ¶æ„/Rust å…­è¾¹å½¢æ¶æ„ 7 é•¿æœŸå­˜å‚¨åº“</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-03T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ3æ—¥</time> Â· <!-- -->é˜…è¯»éœ€ 27 åˆ†é’Ÿ</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>åŸæ–‡é“¾æ¥ï¼š<a href="https://alexis-lozano.com/hexagonal-architecture-in-rust-7/" target="_blank" rel="noopener noreferrer">https://alexis-lozano.com/hexagonal-architecture-in-rust-7/</a></p><p>ç¿»è¯‘ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>é€‰é¢˜ï¼š<a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer">trdthg</a></p><p>æœ¬æ–‡ç”± <a href="https://Rustt.org" target="_blank" rel="noopener noreferrer">Rustt</a> ç¿»è¯‘ï¼Œ<a href="https://studyrust.org" target="_blank" rel="noopener noreferrer">StudyRust</a> è£èª‰æ¨å‡º</p></blockquote><h1>2021-10-17 - Rust å…­è¾¹å½¢æ¶æ„ #7 - é•¿æœŸå­˜å‚¨åº“</h1><p>è¿™é‡Œæ˜¯æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« äº†ã€‚éå¸¸æ„Ÿè°¢ä½ ï¼Œåœ¨ä¸ƒç¯‡æ–‡ç« ä¹‹åä»ç„¶åœ¨è¿™é‡Œçš„åŒ¿åè¯»è€…ã€‚æˆ‘ä»¬å·²ç»ä»‹ç»äº†å¾ˆå¤šä¸œè¥¿ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªåŸŸï¼Œæˆ‘ä»¬èƒ½å¤Ÿå­˜å‚¨æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ CLI å’Œ
HTTP æœåŠ¡å™¨æ¥æ“ä½œæˆ‘ä»¬çš„ç¨‹åºã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦åšä»€ä¹ˆå‘¢ï¼Ÿå“¦ï¼Œæˆ‘çœ‹åˆ°å®¢æˆ·äº†ï¼Œæˆ‘ä»¬é—®é—®ä»–å§ã€‚</p><ul><li>å˜¿ï¼Œæœ€è¿‘å¥½å—ï¼Ÿ</li><li>æˆ‘å¾ˆå¥½ï¼Œä½†ä½ çš„è½¯ä»¶ä¸æ˜¯å¾ˆå¥½ã€‚</li><li>å“¦... æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</li><li>å½“æˆ‘é‡å¯ç¨‹åºæ—¶ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¸¢å¤±äº†ã€‚</li><li>å•Šï¼Œå¯¹ï¼Œé‚£å¾ˆæ­£å¸¸ã€‚æˆ‘ä»¬ç°åœ¨ä¾ç„¶æ˜¯åœ¨ç›´æ¥æ“ä½œå†…å­˜ã€‚</li><li>ä½ èƒ½è®©è¿™äº›æ•°æ®å¾—ä»¥é•¿æœŸä¿å­˜å—ï¼Ÿ</li><li>è¿™äº›æ•°æ®ï¼Ÿå½“ç„¶å¯ä»¥ã€‚æ‚¨èƒ½ç»™æˆ‘ä»¬æä¾›ä¿å­˜çš„åœ°æ–¹å—ï¼Ÿ</li><li>å—¯ï¼Œæˆ‘ä¸çŸ¥é“ã€‚æˆ‘è¦å»æ‰¾äººé—®é—®ã€‚ä½ èƒ½ä¸èƒ½è®©ç¨‹åºæš‚æ—¶æŠŠæ•°æ®å­˜å‚¨å†ç¡¬ç›˜ä¸Šï¼Ÿ</li><li>é©¬ä¸Šå®Œæˆï¼</li></ul><p>å¥½çš„ï¼Œæˆ‘ä»¬æƒ³è¦æŠŠæ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå½“ç¨‹åºé‡å¯åä¹Ÿä¸ä¼šè¢«åˆ é™¤ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ–‡ä»¶ï¼ŒåŒæ—¶å› ä¸ºæˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¸€ç§å¯é çš„æ–¹å¼å»æŸ¥è¯¢æ•°æ®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ SQLã€‚æ–‡ä»¶å’Œ
SQL... æœ‰ä¸œè¥¿åœ¨æˆ‘è„‘æµ·é‡Œå°–å«è€… <strong>SQLite</strong></p><p>æœ‰ä¸€ç‚¹å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å®ç°äº†ä¸€ä¸ªå­˜å‚¨åº“ç³»ç»Ÿï¼Œæˆ‘ä»¬åªéœ€è¦å¡«åŠ ä¸€ä¸ªæ–°çš„å­˜å‚¨åº“ï¼Œä»¥åŠä¸€ä¸ªå‘½ä»¤è¡Œå¼€å…³å»å†³å®šä½¿ç”¨é‚£ç§å­˜å‚¨åº“å³å¯ã€‚å› ä¸ºæœ‰å…­è¾¹å½¢æ¶æ„ï¼Œæˆ‘ä»¬çš„åŸŸå®Œå…¨ä¸ç”¨ä¿®æ”¹
: D</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨-sqlite-ä½œä¸ºæœ¬åœ°å­˜å‚¨">ä½¿ç”¨ SQLite ä½œä¸ºæœ¬åœ°å­˜å‚¨<a class="hash-link" href="#ä½¿ç”¨-sqlite-ä½œä¸ºæœ¬åœ°å­˜å‚¨" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“<a class="hash-link" href="#åˆ›å»ºæ•°æ®åº“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é¦–å…ˆæˆ‘ä»¬è¦ä½¿ç”¨ sqlite3 æä¾›çš„å‘½ä»¤è¡Œå·¥å…·åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sqlite3 path/to/the/database.sqlite</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½ åº”è¯¥å·²ç»å¾—åˆ°äº† SQLite çš„æç¤ºã€‚ç°åœ¨æˆ‘ä»¬è¦åˆ›å»ºä¸¤å¼ è¡¨ã€‚ä¸ºä»€ä¹ˆæ˜¯ä¸¤å¼ ï¼Ÿå› ä¸ºä¸€ä¸ªå®å¯æ¢¦æœ‰å¾ˆå¤šç§ç±»å‹ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å†ä¸€åˆ—ä¸­å­˜å‚¨æ‰€æœ‰çš„ç±»å‹ã€‚</p><p>å®é™…ä¸Šï¼Œå®å¯æ¢¦è¡¨ä¸ç±»å‹è¡¨æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼š</p><ul><li>ä¸€åªå®å¯æ¢¦æœ‰å¤šç§ç±»å‹</li><li>ä¸€ä¸ªç±»å‹å¯ä»¥å¯¹åº”å¤šä¸ªå®å¯æ¢¦</li></ul><p>æ‰€ä»¥å®Œæ•´çš„æ•°æ®åº“åº”è¯¥æ˜¯ä¸‹é¢çš„æ ·å­ï¼Œå®ƒä¸€å…±æœ‰ 3 å¼ è¡¨ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pokemons           | number          | name     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">types              | id              | name     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pokemons_to_types  | pokemons.number | types.id |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ç±»å‹çš„ <code>id</code>ï¼Œæš‚æ—¶æˆ‘ä»¬åªéœ€è¦ä¸¤å¼ è¡¨ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pokemons | number          | name |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">types    | pokemons.number | name |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬å›åˆ° SQLite çš„å‘½ä»¤è¡Œä¸­ã€‚é¦–å…ˆæˆ‘ä»¬è¦æ¿€æ´»å¤–é”® (é»˜è®¤æ˜¯å…³é—­çš„)ã€‚</p><blockquote><p>æ³¨æ„ï¼šè¿™ä¸ªæ“ä½œåªä¼šåœ¨æœ¬æ¬¡è¿æ¥ä¸­ç”Ÿæ•ˆï¼Œ</p></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pragma foreign_keys </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬å¼€å§‹åˆ›å»ºæ•°æ®è¡¨ï¼š</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> pokemons </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number </span><span class="token keyword" style="color:#00009f">integer</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">types</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pokemon_number </span><span class="token keyword" style="color:#00009f">integer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name </span><span class="token keyword" style="color:#00009f">text</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">foreign</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pokemon_number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">references</span><span class="token plain"> pokemons </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">number</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">delete</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">cascade</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">primary</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">key</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pokemon_number</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>on delete cascade</code> çš„æ•ˆæœæ˜¯å½“ä¸€ä¸ªå®å¯æ¢¦è¢«åˆ é™¤æ—¶ï¼Œç±»å‹è¡¨ä¸­æ‰€æœ‰ <code>pokemon_number</code> å’Œ <code>number</code>
ç›¸åŒçš„è¡Œä¹Ÿä¼šè¢«åˆ é™¤ã€‚è¿™æ ·æˆ‘ä»¬åœ¨ç¨‹åºä¸­å°±ä¸ç”¨åœ¨å…³å¿ƒäº†ï¼š) ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨ Ctrl-D é€€å‡º SQLite äº†ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ·»åŠ é€‰æ‹©å­˜å‚¨åº“çš„å¼€å…³">æ·»åŠ é€‰æ‹©å­˜å‚¨åº“çš„å¼€å…³<a class="hash-link" href="#æ·»åŠ é€‰æ‹©å­˜å‚¨åº“çš„å¼€å…³" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ç°åœ¨æˆ‘ä»¬æœ‰ SQLite ä½œä¸ºæ•°æ®åº“ï¼Œæˆ‘ä»¬è¦å†æ·»åŠ ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°å‘Šè¯‰ç¨‹åºæˆ‘ä»¬æƒ³ä½¿ç”¨ SQLiteã€‚å¤§æ¦‚æ•ˆæœæ˜¯è¿™æ ·</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pokedex --sqlite path/to/the/database.sqlite</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“ä½ ä½¿ç”¨ cargo run æ—¶éœ€è¦æ”¹ä¸ºè¿™æ ·ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cargo run -- --sqlite path/to/the/database.sqlite</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn main() { let repo = Arc::new(InMemoryRepository::new());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let matches = App::new(crate_name!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .version(crate_version!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .author(crate_authors!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .arg(Arg::with_name(&quot;cli&quot;).long(&quot;cli&quot;).help(&quot;Runs in CLI mode&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .arg(Arg::with_name(&quot;sqlite&quot;).long(&quot;sqlite&quot;).value_name(&quot;PATH&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .get_matches();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match matches.occurrences_of(&quot;cli&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        0 =&gt; api::serve(&quot;localhost:8000&quot;, repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; cli::run(repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æ•°æ®åº“å¼€å…³å·²ç»åŠ ä¸Šäº†ï¼Œé€šè¿‡ <code>--help</code> æŸ¥çœ‹ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OPTIONS: --sqlite &lt;PATH&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬å»åˆå§‹åŒ–ä¸€ä¸ªæš‚æ—¶è¿˜æ²¡æœ‰å®ç°çš„ <code>SqliteRepository</code>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use repositories::pokemon::{..., SqliteRepository};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let matches = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = build_repo(matches.value_of(&quot;sqlite&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match matches.occurrences_of(&quot;cli&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        0 =&gt; api::serve(&quot;localhost:8000&quot;, repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; cli::run(repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn build_repo(sqlite_value: Option&lt;&amp;str&gt;) -&gt; Arc&lt;dyn Repository&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if let Some(path) = sqlite_value {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match SqliteRepository::try_new(path) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(repo) =&gt; return Arc::new(repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; panic!(&quot;Error while creating sqlite repo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Arc::new(InMemoryRepository::new())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“ <code>--sqlite</code> æ‰“å¼€æ—¶ï¼Œç¨‹åºä¼šå°è¯•åˆå§‹åŒ– SQLite å­˜å‚¨åº“ã€‚å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œç¨‹åºå°±ä¼šå´©æºƒå¹¶æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰å¼€å¯ <code>--sqlite</code>
å°±ä¼šä½¿ç”¨é»˜è®¤çš„å†…å­˜å­˜å‚¨åº“ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å®ç°-sqlite-å­˜å‚¨åº“">å®ç° SQlite å­˜å‚¨åº“<a class="hash-link" href="#å®ç°-sqlite-å­˜å‚¨åº“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä»æ–‡ç« ä¸€å¼€å§‹å°±åœ¨è°ˆè®º SQLiteã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€ç§ä» Rust è°ƒç”¨æ•°æ®åº“çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ <code>rusqlite</code> å»å®ç°ã€‚è®©æˆ‘ä»¬åœ¨
<code>Cargo.toml</code> ä¸­å¯¼å…¥å®ƒï¼š</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rusqlite = &quot;0.26.0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬è¦å®ç° <code>SQLiteRepository</code>ï¼Œæˆ‘è¦åœ¨ <code>InMemoryRepository</code> æ‰€åœ¨çš„æ–‡åŠ ä¸­åˆ›å»º
<code>SQLiteRepository</code>ã€‚å½“ç„¶ï¼Œè¿™ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®å»è¦æŠŠå®ƒæ”¾åœ¨ä¸€ä¸ªæ–°æ–‡ä»¶ä¸­ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rusqlite::Connection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub struct SqliteRepository { connection: Mutex&lt;Connection&gt;, }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>main.rs</em> ä¸­çš„ <code>use</code> ç°åœ¨åº”è¯¥ä¸ä¼šæŠ¥é”™äº†ï¼Œæ¥ç€å®ç° <code>try_new</code> æ–¹æ³•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rusqlite::{..., OpenFlags};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">impl SqliteRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn try_new(path: &amp;str) -&gt; Result&lt;Self, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let connection = match Connection::open_with_flags(path, OpenFlags::SQLITE_OPEN_READ_WRITE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(connection) =&gt; connection,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        match connection.execute(&quot;pragma foreign_keys = 1&quot;, []) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Ok(_) =&gt; Ok(Self {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                connection: Mutex::new(connection),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            _ =&gt; Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆï¼Œæˆ‘ä»¬è°ƒç”¨ <code>rusqlite</code> å»æ–°å»ºä¸€ä¸ªå¯¹æ•°æ®æ–‡ä»¶çš„è¿æ¥ã€‚è€Œä¸”æˆ‘ä»¬é€šè¿‡ <code>OpenFlags</code> å»æ˜ç¡®ç¦æ­¢å½“æ–‡ä»¶ä¸å­˜åœ¨æ—¶ <code>rusqulite</code>
å»è‡ªåŠ¨åˆ›å»ºæ•°æ®æ–‡ä»¶ã€‚å¦‚æœè¿æ¥æˆåŠŸï¼Œæˆ‘ä»¬å°±ä¼šæ‰§è¡Œåªå‰æåˆ°çš„å‘½ä»¤ï¼Œç¡®ä¿å¤–é”®å¼€å¯ã€‚æœ€åæˆ‘ä»¬å»è¿”å›è¿™ä¸ªå­˜å‚¨åº“ã€‚</p><p>å¦‚æœä½ ç°åœ¨å°è¯•è¿è¡Œç¨‹åºï¼Œè¿˜ä¸èƒ½é€šè¿‡ç¼–è¯‘ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰å®ç° <code>Repository</code> Trait å®šä¹‰çš„çš„æ‰€æœ‰æ–¹æ³•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for SqliteRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Result&lt;Pokemon, InsertError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(InsertError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_all(&amp;self) -&gt; Result&lt;Vec&lt;Pokemon&gt;, FetchAllError&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(FetchAllError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;Pokemon, FetchOneError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(FetchOneError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn delete(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), DeleteError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(DeleteError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç¼–è¯‘é€šè¿‡äº†ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å­˜å‚¨åº“ä¾ç„¶æ²¡ä»€ä¹ˆç”¨ç°åœ¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦å®ç°é‚£äº›æ–¹æ³• :)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="è¾…åŠ©å‡½æ•°">è¾…åŠ©å‡½æ•°<a class="hash-link" href="#è¾…åŠ©å‡½æ•°" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨æˆ‘ä»¬å®ç°å­˜å‚¨åº“éœ€è¦çš„å‡½æ•°ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå®šä¹‰ä¸¤ä¸ªè¾…åŠ©å‡½æ•°ã€‚æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢ä¸€ä¸ªæˆ–è€…æ˜¯æ‰€æœ‰å®å¯æ¢¦ï¼Œç”¨ SQL è¯­å¥æè¿°å°±æ˜¯ä¸€ä¸ª
<code>select</code>ã€‚æˆ‘ä»¬åˆ›å»ºçš„è¾…åŠ©å‡½æ•°èƒ½å¤ŸæŠŠè¿™ä¸¤ä¸ªæŸ¥è¯¢é€»è¾‘æ•´åˆåˆ°ä¸€èµ·ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ªèƒ½å¤Ÿæ‹¿åˆ°æ‰€æœ‰å®å¯æ¢¦ç¼–å·å’Œåå­—çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªå·²ç»æ‹¿åˆ°é”çš„å­˜å‚¨åº“ï¼Œä¹Ÿå¯èƒ½ä¼šéœ€è¦ä¸€ä¸ªå®å¯æ¢¦çš„ç¼–å·ã€‚å¦‚æœå‡½æ•°æ¥æ”¶åˆ°äº†ç¼–å·ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨ SQL
è¯­å¥ä¸Šæ·»åŠ  <code>where</code> å­å¥ã€‚è¿™ä¸ªå‡½æ•°ä¼šè¢«æ·»åŠ åˆ° <code>impl SqliteRepository</code> å—å†…ï¼Œå› ä¸ºå®ƒä¸æ˜¯ <code>Repository Trait</code>
çš„ä¸€éƒ¨åˆ†ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å°†ç›´æ¥è¿”å›åŸå§‹æ•°æ® ( <code>u16</code> å’Œ <code>String</code> )ï¼Œè€Œä¸”è¿™ä¸ªå‡½æ•°åº”è¯¥æ˜¯ç§æœ‰çš„ã€‚</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use std::sync::{..., MutexGuard};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_pokemon_rows(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lock: &amp;MutexGuard&lt;&#x27;_, Connection&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: Option&lt;u16&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;Vec&lt;(u16, String)&gt;, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è®©æˆ‘ä»¬å¼€å§‹å§ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ ¹æ®æ•°å­—æ˜¯å¦å­˜åœ¨æ¥å®šä¹‰æŸ¥è¯¢è¯­å¥å’ŒæŸ¥è¯¢å‚æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let (query, params) = match number {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Some(number) =&gt; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;select number, name from pokemons where number = ?&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec![number],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; (&quot;select number, name from pokemons&quot;, vec![]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç›¸å½“ç®€å•å§ï¼Ÿç°åœ¨æˆ‘ä»¬å¿…é¡»å‡†å¤‡ä¸€ä¸ª <code>statment</code> å¹¶ä¼ é€’æˆ‘ä»¬çš„å‚æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rusqlite::{..., params_from_iter};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut stmt = match lock.prepare(query) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(stmt) =&gt; stmt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut rows = match stmt.query(params_from_iter(params)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(rows) =&gt; rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬å·²ç»å¾—åˆ°æŸ¥è¯¢ç»“æœï¼Œç°åœ¨éœ€è¦æŠŠç»“æœè½¬æ¢ä¸ºä¸€ä¸ª <code>(u16, String)</code> ç±»å‹çš„å…ƒç»„ å†æŠŠä»–ä»¬æ±‡é›†åˆ°ä¸€ä¸ªå‘é‡é‡Œè¿”å›</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut pokemon_rows = vec![];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while let Ok(Some(row)) = rows.next() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match (row.get::&lt;usize, u16&gt;(0), row.get::&lt;usize, String&gt;(1)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name)) =&gt; pokemon_rows.push((number, name)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(pokemon_rows)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¯¹ <code>types</code> è¡¨ä¹Ÿä¸€æ ·ï¼Œè¿™ä¸ªè¾…åŠ©å‡½æ•°æ¥æ”¶ä¸€ä¸ªæ•°æ®åº“è¿æ¥å’Œä¸€ä¸ª <code>number</code>ï¼ŒæŸ¥è¯¢æˆåŠŸä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²å‘é‡ï¼Œè¡¨ç¤ºæŸä¸€åªå®å¯æ¢¦çš„ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_type_rows(lock: &amp;MutexGuard&lt;&#x27;_, Connection&gt;, number: u16) -&gt; Result&lt;Vec&lt;String&gt;, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å‡†å¤‡æŸ¥è¯¢è¯­å¥ï¼Œå¸¦ç€å‚æ•°è¿›è¡ŒæŸ¥è¯¢ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let mut stmt = match lock.prepare(&quot;select name from types where pokemon_number = ?&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(stmt) =&gt; stmt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut rows = match stmt.query([number]) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(rows) =&gt; rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¾æ¬¡ä»ç»“æœä¸­æå–å‡ºç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let mut type_rows = vec![];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while let Ok(Some(row)) = rows.next() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match row.get::&lt;usize, String&gt;(0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(name) =&gt; type_rows.push(name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(type_rows)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Aaaandï¼Œé¡ºåˆ©å®Œæˆï¼è¿™ä¸¤ä¸ªåŠŸèƒ½ç°åœ¨éƒ½å®ç°äº†ã€‚ä½¿ç”¨å®ƒä»¬å»å®ç° <code>fetch_one</code> å’Œ <code>fetch_all</code> ä¼šæ›´å®¹æ˜“:)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æŸ¥è¯¢ä¸€åªå®å¯æ¢¦">æŸ¥è¯¢ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#æŸ¥è¯¢ä¸€åªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>æˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥æ¥ï¼Œé¦–å…ˆå¤„ç†ä¸‹é¢çš„æ–¹æ³•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;Pokemon, FetchOneError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å…ˆæ‹¿åˆ°é”ï¼Œå¹¶é€šè¿‡è°ƒç”¨ä¹‹å‰çš„è¾…åŠ©å‡½æ•°å»æŸ¥è¯¢å®å¯æ¢¦ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let lock = match self.connection.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut pokemon_rows = match Self::fetch_pokemon_rows(&amp;lock, Some(u16::from(number.clone()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(pokemon_rows) =&gt; pokemon_rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å½“æŸ¥è¯¢ç»“æœä¸ºç©ºæ—¶ï¼Œæˆ‘ä»¬å°±è¿”å› <code>NotFound</code>ï¼Œå¦åˆ™è¿”å›æŸ¥è¯¢ç»“æœçš„ç¬¬ä¸€ä¸ªï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if pokemon_rows.is_empty() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Err(FetchOneError::NotFound);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let pokemon_row = pokemon_rows.remove(0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä¸é”™ã€‚ç°åœ¨æˆ‘ä»¬å»æŸ¥è¯¢å®å¯æ¢¦ç±»å‹ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let type_rows = match Self::fetch_type_rows(&amp;lock, pokemon_row.0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(type_rows) =&gt; type_rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬å·²ç»æœ‰å®å¯æ¢¦çš„ç¼–å·ã€åç§°å’Œç±»å‹ã€‚æ€»æ˜¯æ—¶å€™æŠŠä»–ä»¬å°è£…ä¸º <code>Response</code> äº†ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PokemonNumber::try_from(pokemon_row.0),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PokemonName::try_from(pokemon_row.1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PokemonTypes::try_from(type_rows),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Ok(number), Ok(name), Ok(types)) =&gt; Ok(Pokemon::new(number, name, types)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æŸ¥è¯¢æ‰€æœ‰å®å¯æ¢¦">æŸ¥è¯¢æ‰€æœ‰å®å¯æ¢¦<a class="hash-link" href="#æŸ¥è¯¢æ‰€æœ‰å®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_all(&amp;self) -&gt; Result&lt;Vec&lt;Pokemon&gt;, FetchAllError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆè·å–é”å¹¶æŸ¥è¯¢æ‰€æœ‰å®å¯æ¢¦ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let lock = match self.connection.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let pokemon_rows = match Self::fetch_pokemon_rows(&amp;lock, None) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(pokemon_rows) =&gt; pokemon_rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ä½ å¯ä»¥æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬æŠŠ <code>number</code> å‚æ•°è®¾ç½®ä¸ºäº† <code>None</code>ï¼Œå¯¹æ¯ä¸ªå®å¯æ¢¦ï¼Œæˆ‘ä»¬ä¼šå•ç‹¬æŸ¥è¯¢å®ƒçš„ç±»å‹ï¼Œæœ€ç»ˆå°è£…ä¸ºä¸€ä¸ªåˆ—è¡¨ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut pokemons = vec![];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for pokemon_row in pokemon_rows {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let type_rows = match Self::fetch_type_rows(&amp;lock, pokemon_row.0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(type_rows) =&gt; type_rows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let pokemon = match (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::try_from(pokemon_row.0),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::try_from(pokemon_row.1),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::try_from(type_rows),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name), Ok(types)) =&gt; Pokemon::new(number, name, types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pokemons.push(pokemon);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(pokemons)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ’å…¥ä¸€åªå®å¯æ¢¦">æ’å…¥ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#æ’å…¥ä¸€åªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;Pokemon, InsertError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä»è¿æ¥ä¸­è·å–é”ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let mut lock = match self.connection.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(InsertError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬æ²¡æœ‰ç›´æ¥æ‰§è¡Œä¸€æ¡å‘½ä»¤ï¼Ÿå› ä¸ºæˆ‘ä»¬éœ€è¦å‘ <code>pokemons</code> ä¸­æ’å…¥ä¸€åªå®å¯æ¢¦ï¼ŒåŒæ—¶è¦æƒ³ <code>types</code>
ä¸­æ’å…¥å®ƒçš„ç±»å‹ã€‚å¦‚æœè¿™ä¸¤æ¬¡æ’å…¥æœ‰ä¸€ä¸ªå¤±è´¥äº†ï¼Œè¿™æ¬¡æ’å…¥æœ€å¥½èƒ½å›æ»šã€‚ä½¿ç”¨äº‹åŠ¡æ—¶ï¼Œä½ éœ€è¦å…ˆåˆ›å»º <code>SQL</code> è¯­å¥ï¼Œä¹‹åæäº¤ã€‚å¦‚æœæœ‰é”™è¯¯å‘ç”Ÿï¼Œ<code>rusqlite</code>
ä¼šè‡ªåŠ¨å®Œæˆå›æ»šã€‚</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let transaction = match lock.transaction() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(transaction) =&gt; transaction,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(InsertError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬è¦å‘äº‹åŠ¡ä¸­æ·»åŠ ç¬¬ä¸€æ¡å‘½ä»¤ã€‚æˆ‘ä»¬è¦æ’å…¥ä¸€åªå®å¯æ¢¦ã€‚å¦‚æœå·²ç»å­˜åœ¨ï¼Œæˆ‘ä»¬å¸Œæœ›å‡½æ•°æ‰§è¡Œå¤±è´¥å¹¶è¿”å›ä¸€ä¸ªé”™è¯¯ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use rusqlite::{..., Error::SqliteFailure, params};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match transaction.execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;insert into pokemons (number, name) values (?, ?)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params![u16::from(number.clone()), String::from(name.clone())],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(_) =&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Err(SqliteFailure(_, Some(message))) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if message == &quot;UNIQUE constraint failed: pokemons.number&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(InsertError::Conflict);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(InsertError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(InsertError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>rusqlite</code> è¿”å›çš„é”™è¯¯ä¿¡æ¯æ¥æ£€æŸ¥é”™è¯¯æ˜¯å¦æ˜¯ç”±äºå†²çªå¼•èµ·çš„ã€‚ç°åœ¨å®å¯æ¢¦çš„æ’å…¥é€»è¾‘å®Œæˆäº†ã€‚</p><p>æ¥ä¸‹æ¥è¦å¤„ç†æ’å…¥ç±»å‹ã€‚æˆ‘ä»¬éœ€è¦ä¸º <code>PokemonTypes</code> å‚æ•°ä¸­çš„æ¯ç§ç±»å‹éƒ½åˆ†åˆ«æ‰§è¡Œä¸€æ¬¡æ’å…¥æ“ä½œï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for _type in Vec::&lt;String&gt;::from(types.clone()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if let Err(_) = transaction.execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;insert into types (pokemon_number, name) values (?, ?)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        params![u16::from(number.clone()), _type],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Err(InsertError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æäº¤è¿™ä¸ªäº‹åŠ¡ï¼Œå¹¶è¿”å›ç»“æœã€‚</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match transaction.commit() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(_) =&gt; Ok(Pokemon::new(number, name, types)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; Err(InsertError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ é™¤ä¸€åªå®å¯æ¢¦">åˆ é™¤ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#åˆ é™¤ä¸€åªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn delete(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), DeleteError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let lock = match self.connection.lock() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(lock) =&gt; lock,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(DeleteError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">match lock.execute(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;delete from pokemons where number = ?&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    params![u16::from(number)],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(0) =&gt; Err(DeleteError::NotFound),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(_) =&gt; Ok(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; Err(DeleteError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼šç¬¬ä¸€ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†å…³æ³¨åˆ é™¤å®å¯æ¢¦æ—¶è®°å¾—åˆ é™¤ç±»å‹ä¿¡æ¯ï¼Œåœ¨åˆ›å»ºæ•°æ®è¡¨æ—¶æˆ‘ä»¬å·²ç»è®¾ç½®äº† <code>on delete cascade</code> è®© sqlite
å»è‡ªåŠ¨å¤„ç†ã€‚ç¬¬äºŒï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ é™¤æ“ä½œè¿”å›çš„è¡Œæ•°å»åˆ¤æ–­æ˜¯å¦åˆ é™¤æˆåŠŸï¼Œå¦‚æœæ•°é‡æ˜¯ 0ï¼Œå°±è¡¨ç¤ºåˆ é™¤å¤±è´¥ã€‚</p><p>ä½ ç°åœ¨åº”è¯¥èƒ½ä½¿ç”¨ä½ çš„ SQLite æ•°æ®åº“ä½œä¸ºå­˜å‚¨åº“äº†ï¼Œè€Œä¸”èƒ½é€šè¿‡ CLI å’Œ HTTP API ä¸¤ç§æ–¹å¼è®¿é—®ã€‚ä½ å¯ä»¥å°è¯•ä» CLI åˆ›å»ºä¸€äº›æ–°çš„å®å¯æ¢¦ï¼Œå¹¶ä»
HTTP API å»è·å–ä»–ä»¬ :)</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="å°æ’æ›²">å°æ’æ›²<a class="hash-link" href="#å°æ’æ›²" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ğŸ™€ æˆ‘çœ‹åˆ°å®¢æˆ·äº†ï¼Œä»–æ­£æœç€æˆ‘è¿™è¾¹æ¥ã€‚</p><ul><li>ä½ å¥½ Alexisï¼</li><li>ä½ å¥½ å®¢æˆ·ï¼æˆ‘å·²ç»å®ç°äº†ä¸€ä¸ªæŒä¹…åŒ–çš„å­˜å‚¨åº“ï¼Œå®ƒæŠŠæ•°æ®å­˜å‚¨åœ¨è®¡ç®—æœºçš„ç¡¬ç›˜ä¸Šã€‚</li><li>å“¦ï¼Œå¤ªå¥½äº†ï¼è™½ç„¶ç°åœ¨æˆ‘çŸ¥é“äº†æˆ‘ä»¬å°†ä½¿ç”¨ä»€ä¹ˆä½œä¸ºå­˜å‚¨åº“ã€‚</li><li>ä¸é”™ï¼Œé€Ÿåº¦å¾ˆå¿«ã€‚æ˜¯ PostgreSQL å—ï¼Ÿè¿˜æ˜¯ Mysqlï¼Ÿ</li><li>éƒ½ä¸æ˜¯ï¼Œæˆ‘ä»¬çš„å…¬å¸å¸Œæœ›å®ƒæ˜¯æ°´å¹³å¯æ‹“å±•çš„ã€‚</li><li>å—¯ï¼Œè¿™è®©æˆ‘æƒ³èµ·äº†ä¸€ä¸ª<a href="https://www.youtube.com/watch?v=b2F-DItXtZs" target="_blank" rel="noopener noreferrer">ææ€–æ•…äº‹</a>ã€‚é‚£å¥½å§ï¼Œä½ ä»¬å…¬å¸æ‰“ç®—ä½¿ç”¨ä»€ä¹ˆæŠ€æœ¯ï¼Ÿ</li><li>ä»–ä»¬æƒ³ä½¿ç”¨ Airtableï¼Œä¸€ä¸ªç±»ä¼¼äº Excel çš„åœ¨çº¿è¡¨æ ¼ã€‚</li><li>å“¦... è®©æˆ‘çœ‹çœ‹æˆ‘èƒ½åšçš„ã€‚</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ä½¿ç”¨-airtable-å®ç°å¼¹æ€§å­˜å‚¨åº“">ä½¿ç”¨ Airtable å®ç°å¼¹æ€§å­˜å‚¨åº“<a class="hash-link" href="#ä½¿ç”¨-airtable-å®ç°å¼¹æ€§å­˜å‚¨åº“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬å¿…é¡»åˆ›å»ºå¦ä¸€ä¸ªå­˜å‚¨åº“äº†ã€‚ç”Ÿæ´»å°±æ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨å¯ä»¥å» Airtable
ç½‘ç«™çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆä½¿ç”¨çš„ã€‚ä½ å¿…é¡»åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼Œå¹¶ä¸”æ–°å»ºä¸€ä¸ªå·¥ä½œåŒºã€‚åœ¨è¿™ä¸ªå·¥ä½œåŒºé‡Œï¼Œä½ åº”è¯¥æœ‰ä¸€ä¸ªé»˜è®¤çš„å·¥ä½œè¡¨ã€‚æŠŠä»–é‡å‘½åä¸º
<code>pokemons</code>ã€‚ä½ å¯ä»¥æŠŠè¡¨æ ¼çš„åˆ—æ”¹ä¸ºä¸‹é¢çš„æ ·å­ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">number:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    é€‰æ‹© Number ç±»å‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    é€‰æ‹© Integer å­ç±»å‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å…³é—­å…è®¸è´Ÿæ•°</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    é€‰æ‹© Single line text ç±»å‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">types:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    é€‰æ‹© Multiple select ç±»å‹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    å†é€‰é¡¹é‡Œæ·»åŠ  Electric å’Œ Fire</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬èƒ½ç”¨ä¸€å¼ æ•°æ®è¡¨å»ä¸ºæˆ‘ä»¬çš„æ•°æ®å»ºæ¨¡äº† : )</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦çŸ¥é“æˆ‘ä»¬çš„ç¨‹åºæ€æ ·å’Œ Airtable è¿›è¡Œäº¤äº’ã€‚è®©æˆ‘ä»¬å»é˜…è¯»ä¸€ä¸‹ API æ–‡æ¡£ã€‚åœ¨é‚£é‡Œä½ åº”è¯¥èƒ½çœ‹åˆ° Airtable
ç°åœ¨æ”¯æŒçš„å®¢æˆ·ç«¯ï¼Œæ’°å†™æœ¬æ–‡æ—¶å¹¶æ²¡æœ‰æä¾› Rust çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å°è¯•ä½¿ç”¨å®ƒä»¬çš„ HTTP APIã€‚æˆ‘ä»¬çš„ç¨‹åºç°åœ¨éœ€è¦ä¸€ä¸ª HTTP å®¢æˆ·ç«¯ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨
<code>ureq</code>:</p><div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ureq = { version = &quot;2.2.0&quot;, features = [&quot;json&quot;] }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¼€å¯ <code>json</code> ç‰¹æ€§èƒ½å¤Ÿå¸®æˆ‘ä»¬æŠŠ HTTP å“åº”è½¬åŒ–ä¸º ç»“æ„ä½“ ( æ„Ÿè°¢ <code>serde</code> )ã€‚ä½†æ˜¯å†æˆ‘ä»¬å®ç°å­˜å‚¨åº“ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å†ç¨‹åºå¼€å§‹å‰è®©ç”¨æˆ·èƒ½å¤Ÿé€‰æ‹©ä½¿ç”¨
Airtable ä½œä¸ºå­˜å‚¨åº“ã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="æ·»åŠ å¯åŠ¨å¼€å…³">æ·»åŠ å¯åŠ¨å¼€å…³<a class="hash-link" href="#æ·»åŠ å¯åŠ¨å¼€å…³" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>é¦–å…ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ APIã€‚è¿™é‡Œæ˜¯æ–‡æ¡£ç»™å‡ºçš„ä¸€ä¸ªè¯·æ±‚ç¤ºä¾‹ï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl https://api.airtable.com/v0/&lt;WORKSPACE_ID&gt;/pokemons -H &quot;Authorization: Bearer &lt;API_KEY&gt;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å¥½çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç¨‹åºéœ€è¦ä¸¤ä¸ªå‚æ•° <code>api_key</code> å’Œ <code>workspace_id</code>ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let matches = App::new(crate_name!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .version(crate_version!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .author(crate_authors!())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .arg(Arg::with_name(&quot;cli&quot;).long(&quot;cli&quot;).help(&quot;Runs in CLI mode&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .arg(Arg::with_name(&quot;sqlite&quot;).long(&quot;sqlite&quot;).value_name(&quot;PATH&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .arg(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Arg::with_name(&quot;airtable&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .long(&quot;airtable&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .value_names(&amp;[&quot;API_KEY&quot;, &quot;WORKSPACE_ID&quot;]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .get_matches();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œè¿è¡Œ <code>pokedex --airtable &lt;API_KEY&gt; &lt;WORKSPACE_ID&gt;</code> å°±èƒ½è®¾ç½® Airtable ä½œä¸ºå­˜å‚¨åº“ï¼Œä½¿ç”¨ cargo
run å¯åŠ¨çš„è¯ï¼Œä½ å¯ä»¥è¾“å…¥ <code>cargo run -- --airtable &lt;API_KEY&gt; &lt;WORKSPACE_ID&gt;</code>ã€‚å¯ä»¥ä½¿ç”¨ <code>--help</code>
æ£€æŸ¥æ˜¯å¦ç”Ÿæ•ˆï¼š</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">OPTIONS:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        --airtable &lt;API_KEY&gt; &lt;WORKSPACE_ID&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ›´æ–° build_repo å‡½æ•°ï¼Œä½¿å®ƒèƒ½å¤Ÿåˆ›å»ºä¸€ä¸ª AirtableRepositoryï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use clap::{..., Values};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">use repositories::pokemon::{AirtableRepository, ...};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    let repo = build_repo(matches.value_of(&quot;sqlite&quot;), matches.values_of(&quot;airtable&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fn build_repo(sqlite_value: Option&lt;&amp;str&gt;, airtable_values: Option&lt;Values&gt;) -&gt; Arc&lt;dyn Repository&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if let Some(values) = airtable_values {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if let [api_key, workspace_id] = values.collect::&lt;Vec&lt;&amp;str&gt;&gt;()[..] {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            match AirtableRepository::try_new(api_key, workspace_id) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Ok(repo) =&gt; return Arc::new(repo),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                _ =&gt; panic!(&quot;Error while creating airtable repo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ‰€ä»¥ç°åœ¨å¦‚æœè®¾ç½®äº† <code>--airtable</code> æ ‡å¿—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Airtable ä½œä¸ºå­˜å‚¨åº“ã€‚å¦‚æœè®¾ç½®äº† <code>--sqlite</code> æ ‡å¿—ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨
SQLiteã€‚å¦åˆ™æˆ‘ä»¬ä½¿ç”¨å†…å­˜å­˜å‚¨åº“ã€‚ç°åœ¨è®©æˆ‘ä»¬å®ç°å­˜å‚¨åº“ï¼›ï¼‰</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="å®ç°å­˜å‚¨åº“">å®ç°å­˜å‚¨åº“<a class="hash-link" href="#å®ç°å­˜å‚¨åº“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><blockquote><p>æ³¨æ„ï¼šç½‘ç«™çš„ API ç»å¸¸å‘ç”Ÿå˜åŠ¨ï¼Œå¦‚æœä¸‹é¢çš„æµ‹è¯•å¤±è´¥äº†ï¼Œè¯·åˆ°<a href="https://airtable.com/api/meta" target="_blank" rel="noopener noreferrer">å®˜ç½‘</a>æŸ¥çœ‹æœ€æ–°çš„ APIã€‚</p></blockquote><p>æˆ‘å°†åœ¨ <em>repositories/pokemon.rs</em> ä¸­æ·»åŠ 
<code>AirtableRepository</code>ã€‚åƒä»¥å‰ä¸€æ ·ï¼Œæ‚¨å¯ä»¥å°†å…¶æ”¾åœ¨æ–°çš„æ–‡ä»¶ä¸­ã€‚è®©æˆ‘ä»¬é¦–å…ˆåˆ›å»ºç»“æ„ä½“ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pub struct AirtableRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    url: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth_header: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬ä¾ç„¶éœ€è¦å®ç° <code>try_new</code> å‡½æ•°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ <code>workspace_id</code> åˆ›å»º <code>url</code>ï¼Œä½¿ç”¨ <code>api_key</code> åˆ›å»º
<code>auth_header</code>ã€‚æ¥ç€è¿˜è¦å‘å‡ºè¯·æ±‚ä»¥ç¡®ä¿æˆ‘ä»¬å¯ä»¥è¿æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl AirtableRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub fn try_new(api_key: &amp;str, workspace_id: &amp;str) -&gt; Result&lt;Self, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let url = format!(&quot;https://api.airtable.com/v0/{}/pokemons&quot;, workspace_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        let auth_header = format!(&quot;Bearer {}&quot;, api_key);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if let Err(_) = ureq::get(&amp;url).set(&quot;Authorization&quot;, &amp;auth_header).call() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return Err(());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ok(Self { url, auth_header })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€æˆ‘ä»¬è¦ä¸ºå®ƒå®ç° <code>Repository</code> Traitï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impl Repository for AirtableRepository {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; Result&lt;Pokemon, InsertError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(InsertError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_all(&amp;self) -&gt; Result&lt;Vec&lt;Pokemon&gt;, FetchAllError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(FetchAllError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;Pokemon, FetchOneError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(FetchOneError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn delete(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), DeleteError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Err(DeleteError::Unknown)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="è¾…åŠ©å‡½æ•°-1">è¾…åŠ©å‡½æ•°<a class="hash-link" href="#è¾…åŠ©å‡½æ•°-1" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><p>ä½ ç°åœ¨åº”è¯¥å·²ç»ä¹ æƒ¯äº†ï¼Œè¿™æ¬¡æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªè¾…åŠ©å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°èƒ½è®©æˆ‘ä»¬ä» Airtable ä¸­è·å–æŸä¸€è¡Œæˆ–è€…å¤šè¡Œæ•°æ®ã€‚å®ƒçš„å‚æ•° <code>&amp;self</code> å’Œ ä¸€ä¸ªå¯é€‰çš„
<code>number</code>ã€‚å®ƒçš„è¿”å›å€¼å¯èƒ½æ˜¯ä¸ª <code>json</code> æˆ–è€…æ˜¯ä¸ª <code>Error</code>ã€‚å®ƒä¾ç„¶æ˜¯ä¸ªç§æœ‰çš„æ–¹æ³•ï¼Œå† <code>impl AirtableRepository</code>
å—ä¸­å®ç°ã€‚æœ‰äº† <code>serde</code> æˆ‘ä»¬èƒ½å°† <code>json</code> ç›´æ¥è½¬åŒ–ä¸ºç»“æ„ä½“ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰å¯¹åº”çš„ç»“æ„ä½“ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Deserialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct AirtableJson {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    records: Vec&lt;AirtableRecord&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Deserialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct AirtableRecord {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fields: AirtableFields,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#[derive(Deserialize)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct AirtableFields {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: u16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: String,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: Vec&lt;String&gt;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ç€æ˜¯è¾…åŠ©å‡½æ•°ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_pokemon_rows(&amp;self, number: Option&lt;u16&gt;) -&gt; Result&lt;AirtableJson, ()&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç¬¬ä¸€æ­¥è¦æ ¹æ®ç”¨æˆ·ä¼ æ¥çš„ <code>number</code> å»åˆ›å»ºè¯·æ±‚é“¾æ¥ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let url = match number {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Some(number) =&gt; format!(&quot;{}?filterByFormula=number%3D{}&quot;, self.url, number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None =&gt; format!(&quot;{}?sort%5B0%5D%5Bfield%5D=number&quot;, self.url),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¯·æ±‚å‚æ•°çœ‹èµ·æ¥ç¨å¾®æœ‰ä¸€ç‚¹å¥‡æ€ªã€‚ç¬¬ä¸€ä¸ªæ˜¯ä¾é  <code>number</code> è¿›è¡Œè¿‡æ»¤ï¼Œç¬¬äºŒä¸ªæ˜¯æ ¹æ® <code>number</code> å¯¹æ•°æ®æ’åºã€‚ç°åœ¨æˆ‘ä»¬èƒ½ç”¨ <code>ureq</code> å°è¯•å‘å‡ºè¯·æ±‚äº†ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let res = match ureq::get(&amp;url)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .set(&quot;Authorization&quot;, &amp;self.auth_header)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .call()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(res) =&gt; res,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬åœ¨è¿”å›å€¼ä¸­æ¥æ”¶åˆ°äº† <code>json</code> ï¼Œæ¥ç€æˆ‘ä»¬æŠŠå®ƒè½¬æ¢ä¸º <code>AirtableJson</code>:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">match res.into_json::&lt;AirtableJson&gt;() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(json) =&gt; Ok(json),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; Err(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¾…åŠ©å‡½æ•°å®Œæˆäº† : )</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦">æŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦<a class="hash-link" href="#æŸ¥è¯¢ä¸€ä¸ªå®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_one(&amp;self, number: PokemonNumber) -&gt; Result&lt;Pokemon, FetchOneError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆï¼Œæˆ‘ä»¬è®©ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å®ç°çš„å‡½æ•°è·å– <code>json</code> ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let mut json = match self.fetch_pokemon_rows(Some(u16::from(number.clone()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(json) =&gt; json,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œå¦‚æœ <code>json</code> è®°å½•ä¸ºç©ºï¼Œåˆ™æ„å‘³ç€æˆ‘ä»¬æƒ³è¦çš„å®å¯æ¢¦ä¸å­˜åœ¨ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å–ç¬¬ä¸€æ¡è®°å½•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if json.records.is_empty() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Err(FetchOneError::NotFound);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let record = json.records.remove(0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯æŠŠè¿™æ¡è®°å½•è½¬æ¢ä¸ºå®å¯æ¢¦ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PokemonNumber::try_from(record.fields.number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PokemonName::try_from(record.fields.name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PokemonTypes::try_from(record.fields.types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (Ok(number), Ok(name), Ok(types)) =&gt; Ok(Pokemon::new(number, name, types)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; Err(FetchOneError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="è·å–æ‰€æœ‰å®å¯æ¢¦">è·å–æ‰€æœ‰å®å¯æ¢¦<a class="hash-link" href="#è·å–æ‰€æœ‰å®å¯æ¢¦" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn fetch_all(&amp;self) -&gt; Result&lt;Vec&lt;Pokemon&gt;, FetchAllError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>é¦–å…ˆï¼Œä¾ç„¶æ˜¯ä½¿ç”¨è¾…åŠ©å‡½æ•°è·å– <code>json</code> ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let json = match self.fetch_pokemon_rows(None) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(json) =&gt; json,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘æ²¡æœ‰ç»™è¾…åŠ©å‡½æ•°æä¾› <code>number</code> ã€‚ç°åœ¨è®©æˆ‘ä»¬å°†è¿™äº›è®°å½•è½¬æ¢ä¸º <code>Pokemons</code> å¹¶è¿”å›ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let mut pokemons = vec![];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for record in json.records.into_iter() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    match (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonNumber::try_from(record.fields.number),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonName::try_from(record.fields.name),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PokemonTypes::try_from(record.fields.types),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (Ok(number), Ok(name), Ok(types)) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pokemons.push(Pokemon::new(number, name, types))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _ =&gt; return Err(FetchAllError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(pokemons)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="æ’å…¥ä¸€åªå®å¯æ¢¦-1">æ’å…¥ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#æ’å…¥ä¸€åªå®å¯æ¢¦-1" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn insert(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &amp;self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    number: PokemonNumber,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name: PokemonName,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    types: PokemonTypes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Result&lt;Pokemon, InsertError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Airtable æœ¬èº«å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š<code>AirtableRecord</code> çš„ä¸»é”®å¹¶ä¸èƒ½ä¿è¯æ•°æ®çš„å”¯ä¸€æ€§ã€‚æˆ–è®¸ä½ å·²ç»æ³¨æ„åˆ°äº† <code>AirtableRecord</code> ä¸­çš„
<code>id</code> å­—æ®µ :) å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½å°è¯•æ’å…¥è®°å½•å¹¶ç­‰å¾…è¿”å›é”™è¯¯ï¼ŒAirtable
åªä¼šè´Ÿè´£åœ¨è¡¨ä¸­æ·»åŠ æ–°è¡Œã€‚ç„¶åæˆ‘ä»¬è¦åšçš„æ˜¯é¦–å…ˆå°è¯•è·å–ç›¸åŒç¼–å·çš„å®å¯æ¢¦ï¼Œå¦‚æœæ­¤è¯·æ±‚çš„ç»“æœä¸ä¸ºç©ºï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let json = match self.fetch_pokemon_rows(Some(u16::from(number.clone()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(json) =&gt; json,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(InsertError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if !json.records.is_empty() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Err(InsertError::Conflict);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨æˆ‘ä»¬å·²ç»åšåˆ°äº†ï¼Œæˆ‘ä»¬èƒ½ä¿è¯æ²¡æœ‰è®°å½•å…±äº«ç›¸åŒçš„ <code>number</code> ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ’å…¥æˆ‘ä»¬çš„å®å¯æ¢¦ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª <code>json</code> è¯·æ±‚ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let body = ureq::json!({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;records&quot;: [{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;fields&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;number&quot;: u16::from(number.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;name&quot;: String::from(name.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;types&quot;: Vec::&lt;String&gt;::from(types.clone()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æœ€åï¼Œæˆ‘ä»¬è¦å¸¦ä¸Š <code>body</code> å‘å‡ºè¯·æ±‚ï¼Œå¹¶åœ¨æˆåŠŸæ—¶è¿”å› <code>Pokemon</code> ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if let Err(_) = ureq::post(&amp;self.url)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .set(&quot;Authorization&quot;, &amp;self.auth_header)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .send_json(body)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Err(InsertError::Unknown);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ok(Pokemon::new(number, name, types))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="åˆ é™¤ä¸€åªå®å¯æ¢¦-1">åˆ é™¤ä¸€åªå®å¯æ¢¦<a class="hash-link" href="#åˆ é™¤ä¸€åªå®å¯æ¢¦-1" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h4><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fn delete(&amp;self, number: PokemonNumber) -&gt; Result&lt;(), DeleteError&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // code will go here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>å’Œæ’å…¥æ—¶ä¸€æ ·ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆå°è¯•æŸ¥è¯¢ä¸æˆ‘ä»¬ä¼ é€’çš„ <code>number</code> ç›¸åŒçš„è®°å½•ã€‚å½“è®°å½•ä¸ºç©ºæ—¶ï¼Œæˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬ä¸èƒ½åˆ é™¤ä¸å­˜åœ¨çš„è®°å½• : )
å¦åˆ™ï¼Œæˆ‘ä»¬å°†æ‹¿åˆ°ç¬¬ä¸€æ¡è®°å½•ã€‚</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let mut json = match self.fetch_pokemon_rows(Some(u16::from(number.clone()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(json) =&gt; json,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; return Err(DeleteError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if json.records.is_empty() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Err(DeleteError::NotFound);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let record = json.records.remove(0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è®°å½•çš„ id å­—æ®µæ¥åˆ é™¤è®°å½•ï¼š</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">match ureq::delete(&amp;format!(&quot;{}/{}&quot;, self.url, record.id))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .set(&quot;Authorization&quot;, &amp;self.auth_header)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .call()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ok(_) =&gt; Ok(()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _ =&gt; Err(DeleteError::Unknown),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="æ€»ç»“">æ€»ç»“<a class="hash-link" href="#æ€»ç»“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>ä½ ç°åœ¨åº”è¯¥èƒ½ä½¿ç”¨ å†…å­˜ï¼ŒAirtableï¼Œæˆ–è€…æ˜¯ä¸€ä¸ª SQLite æ•°æ®åº“ä½œä¸ºç¨‹åºçš„å­˜å‚¨åº“ã€‚è€Œä¸”ä½ èƒ½é€šè¿‡ CLI å’Œ HTTP API ä¸¤ç§æ–¹å¼å»æ“ä½œ :D</p><p>é‚£æ˜¯æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« ã€‚æ„Ÿè°¢æ‚¨ä¸€ç›´çœ‹åˆ°è¿™é‡Œ :) æˆ‘å¸Œæœ›è¿™äº›æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ã€‚</p><p>è¯¥ä»£ç ä¾ç„¶åœ¨ <a href="https://github.com/alexislozano/pokedex/tree/article-7" target="_blank" rel="noopener noreferrer">github</a> ä¸ŠæŸ¥çœ‹ã€‚</p></div></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/blog/2022/04/01/[è¯‘] search_engine">æŸ¥è¯¢å¼•æ“ï¼šæ¨é€ä¸æ‹‰å–</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-04-01T00:00:00.000Z" itemprop="datePublished">2022å¹´4æœˆ1æ—¥</time> Â· <!-- -->é˜…è¯»éœ€ 5 åˆ†é’Ÿ</div></header><div class="markdown" itemprop="articleBody"><p><a href="http://justinjaffray.com/query-engines-push-vs.-pull/" target="_blank" rel="noopener noreferrer">Query Engines: Push vs. Pull</a></p><p>è€ƒè™‘ä»¥ä¸‹çš„ SQL è¯­å¥</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> customer_first_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> customer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> customer_balance </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æŸ¥è¯¢ä¼˜åŒ–å™¨é€šå¸¸å°†è¿™æ ·çš„ SQL æŸ¥è¯¢ç¼–è¯‘æˆä¸€ç³»åˆ—ç¦»æ•£è¿ç®—ç¬¦ï¼š
<img loading="lazy" src="https://trdthg-img-for-md-1306147581.cos.ap-beijing.myqcloud.com/img/202204202254060.png" class="img_ev3q"></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Distinct</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;- Map(customer_first_name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;- Select(customer_balance &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;- customer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åœ¨åŸºäº Pull çš„ç³»ç»Ÿä¸­ï¼Œæ¶ˆè´¹è€… <code>customers</code> é©±åŠ¨ç³»ç»Ÿã€‚æ¯ä¸ªè¿ç®—ç¬¦è¿ç®—åéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°è¡Œï¼šç”¨æˆ·å°†å‘æ ¹èŠ‚ç‚¹ï¼ˆDistinctï¼‰è¯·æ±‚ä¸€è¡Œï¼Œè¿™ä¸€è¡Œå›å‘
Map è¯¢é—®ä¸€è¡Œï¼Œæ¥ç€å‘ Select è¯¢é—®ä¸€è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚</p><p>åœ¨åŸºäº Push çš„ç³»ç»Ÿä¸­ï¼Œç”Ÿäº§è€… <code>producers</code> é©±åŠ¨ç³»ç»Ÿã€‚æ¯ä¸ªè¿ç®—ç¬¦ï¼Œå½“ä»–æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œå°±ä¼šå‘ŠçŸ¥ä¸‹æ¸¸çš„è¿ç®—ç¬¦ï¼Œ<code>customer</code>
ä½œä¸ºæŸ¥è¯¢åŸºè¡¨å›å‘Šè¯‰ Select è‡ªå·±çš„ä¿¡æ¯ï¼Œæ¥ç€æ˜¯ Mapã€Distinctã€‚</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pull-based-æŸ¥è¯¢å¼•æ“">Pull-Based æŸ¥è¯¢å¼•æ“<a class="hash-link" href="#pull-based-æŸ¥è¯¢å¼•æ“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h3><p>åŸºäºæ‹‰å–çš„æŸ¥è¯¢å¼•æ“ä¸€èˆ¬ä¹Ÿè¢«ç§°ä¸ºä½¿ç”¨ Volcano æˆ– Iterator æ¨¡å‹ã€‚è¿™æ˜¯æœ€å¤è€å’Œæœ€è‘—åçš„æŸ¥è¯¢æ‰§è¡Œæ¨¡å‹ï¼Œå¹¶ä»¥ 1994 å¹´æ ‡å‡†åŒ–å…¶çº¦å®šçš„è®ºæ–‡å‘½åã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªå…³ç³»ï¼Œæˆ‘ä»¬é€šè¿‡ Scan æŠŠå®ƒä¸“ä¸ºä¸€ä¸ªè¿­ä»£å™¨</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> customer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;justin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sissel&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;justin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;smudge&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;smudge&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">coll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> coll</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æ¥ä¸‹æ¥ä¸ºä»–å®ç°ä¸€äº›æ“ä½œç¬¦</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">p</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> iter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> iter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">p</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token known-class-name class-name">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">f</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> iter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> iter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Distinct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">iter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> seen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> x </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> iter</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">seen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">yield</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      seen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ç¿»è¯‘æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DISTINCT</span><span class="token plain"> customer_first_name </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> customer </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> customer_balance </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function maybe-class-name" style="color:#d73a49">Distinct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function maybe-class-name" style="color:#d73a49">Select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">customer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="push-based-æŸ¥è¯¢å¼•æ“">Push-Based æŸ¥è¯¢å¼•æ“<a class="hash-link" href="#push-based-æŸ¥è¯¢å¼•æ“" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åŸºäºæ¨é€çš„æŸ¥è¯¢å¼•æ“ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º Reactiveã€Observerã€Stream æˆ–å›è°ƒåœ°ç‹±æ¨¡å‹ï¼Œå¦‚æ‚¨æ‰€æ–™ï¼Œä¸æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹ç±»ä¼¼ï¼Œä½†å®ƒé¢ è¦†äº†å®ƒã€‚è®©æˆ‘ä»¬ä»å®šä¹‰
Scan å¼€å§‹</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> customer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;justin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sissel&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;justin&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;smudge&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">id</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">firstName</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;smudge&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">balance</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">relation</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r </span><span class="token keyword" style="color:#00009f">of</span><span class="token plain"> relation</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æˆ‘ä»¬å°†â€œæ­¤è¿ç®—ç¬¦å‘Šè¯‰ä¸‹æ¸¸è¿ç®—ç¬¦â€æ„å»ºä¸ºå®ƒéœ€è¦è°ƒç”¨çš„é—­åŒ…ã€‚</p><p>å‰©ä¸‹çš„è¿ç®—ç¬¦ä¹Ÿæ˜¯å¦‚æ­¤</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">p</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">p</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token known-class-name class-name">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">f</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">f</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Distinct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">out</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> seen </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">seen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">has</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      seen</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">add</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>æŸ¥è¯¢è¯­å¥å»ºæ¨¡ï¼š</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function maybe-class-name" style="color:#d73a49">Scan</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  customer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function maybe-class-name" style="color:#d73a49">Select</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">balance</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">firstName</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function maybe-class-name" style="color:#d73a49">Distinct</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">push</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">r</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="åŒºåˆ«">åŒºåˆ«<a class="hash-link" href="#åŒºåˆ«" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>åœ¨åŸºäº Pull çš„ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œç¬¦éƒ½æ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰å½“æ•°æ®éœ€è¦æ—¶ï¼Œæ“ä½œç¬¦æ‰ä¼šå¼€å§‹è®¡ç®—ï¼ˆyieldï¼‰ã€‚è¿™ä¹Ÿæ„å‘³ç€ç³»ç»Ÿçš„è¡Œä¸ºå’Œç”¨æˆ·çš„è¡Œä¸ºç´§å¯†è€¦åˆã€‚</p><p>å†åŸºäº Push çš„ç³»ç»Ÿä¸­ï¼Œç³»ç»Ÿå¼€å§‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œç›´åˆ°ä»–æ¥å—åˆ°ä¸€è¡Œæ•°æ®ã€‚å› æ­¤ç³»ç»Ÿçš„å·¥ä½œå’Œæ¶ˆè´¹è€…æ˜¯è§£è€¦çš„ã€‚</p><p>åŸºäº Push çš„ç³»ç»Ÿè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç¼“å†²åŒºï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœæ”¾åˆ°é‡Œé¢ã€‚è¿™å°±æ˜¯åŸºäº Push çš„ç³»ç»Ÿç»™äººçš„æ„Ÿè§‰ã€‚å®ƒä¼šå‡è®¾æ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œå½“è¢«è¯·æ±‚æ—¶ï¼Œèƒ½å¤Ÿç«‹å³ä½œå‡ºå“åº”ã€‚</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dag-yo">DAG, yo<a class="hash-link" href="#dag-yo" title="æ ‡é¢˜çš„ç›´æ¥é“¾æ¥">â€‹</a></h2><p>SQL ä¸­æœ‰ä¸€ä¸ª With ç»“æ„ï¼Œå®ƒå…è®¸åœ¨æŸ¥è¯¢ä¸­å¤šæ¬¡å¼•ç”¨åŒä¸€ä¸ªç»“æœé›†ï¼š</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> foo </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">some</span><span class="token plain"> complex query</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> foo </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> c</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> foo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    foo </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> foo2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> foo1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> foo2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="å¤åˆ¶ä»£ç åˆ°å‰ªè´´æ¿" title="å¤åˆ¶" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>åŸºäº Push çš„ç³»ç»Ÿèƒ½å¤Ÿä¼˜åŒ–æŸ¥è¯¢ç»“æ„ï¼Œå¤ç”¨ç»“æœé›†ï¼Œè€ŒåŸºäº Pull çš„ç³»ç»Ÿæ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p></div></article><nav class="pagination-nav" aria-label="åšæ–‡åˆ—è¡¨åˆ†é¡µå¯¼èˆª"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/page/2"><div class="pagination-nav__label">è¾ƒæ–°çš„åšæ–‡</div></a></nav></main></div></div></div></div>
<script src="/assets/js/runtime~main.ce766e05.js"></script>
<script src="/assets/js/main.dc8abca6.js"></script>
</body>
</html>