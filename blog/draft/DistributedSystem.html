<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">分布式系统 | Trdthg&#x27;s blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://trdthg.github.io//blog/draft/DistributedSystem"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="分布式系统 | Trdthg&#x27;s blog"><meta data-rh="true" name="description" content="优势"><meta data-rh="true" property="og:description" content="优势"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-11-10T10:40:08.000Z"><link data-rh="true" rel="icon" href="/img/logo_png.png"><link data-rh="true" rel="canonical" href="https://trdthg.github.io//blog/draft/DistributedSystem"><link data-rh="true" rel="alternate" href="https://trdthg.github.io//blog/draft/DistributedSystem" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://trdthg.github.io//blog/draft/DistributedSystem" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Trdthg&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Trdthg&#39;s blog Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4TM86KZ83J"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-4TM86KZ83J",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.6b28552f.css">
<link rel="preload" href="/assets/js/runtime~main.dd3dbc08.js" as="script">
<link rel="preload" href="/assets/js/main.916d2c7b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a href="#" class="skipToContent_fXgn">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo_png.png" alt="Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo_png.png" alt="Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Trdthg</b></a><a class="navbar__item navbar__link" href="/docs/intro">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">全部博文</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/03/[译] Rust冒险: 滥用 Serde">[译] Rust冒险: 滥用 Serde</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/02/[译] 未初始化内存: unsafe Rust太难了">[译] 未初始化内存: unsafe Rust太难了</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/01/01/[译] 拓展 Rust 中的 Map">[译] 拓展 Rust 中的 Map</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/i3wm">Linux 发行版配置</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/lsm">数据库存储引擎</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/resources">资源整理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/site_update_log">网站更新日志</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/draft/DistributedSystem">分布式系统</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/[译] pkg_mng">Let&#x27;s Dev: A Package Manager</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/ld">链接脚本</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/oscamp2022">2022 秋冬季开源操作系统训练营</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/riscv">RISC-V</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/test">垃圾软件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/数据库设计">数据库设计</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/组成原理">计算机组成原理</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/draft/计算机网络">计算机网络</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/05/04/[译] 可视化 Rust 各数据类型的内存布局">[译] 可视化 Rust 各数据类型的内存布局</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/30/[译] 什么时候不应该使用 Rust ？">[译] 什么时候不应该使用 Rust ？</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/20/[译] 使用 Tokio 处理 CPU 密集型任务">[译] 使用 Tokio 处理 CPU 密集型任务</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/13/[译] tail_latency">对重请求 - 应对尾部延迟</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/11/[译] 异步 Rust：协作与抢占式调度">[译] 异步 Rust：协作与抢占式调度</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/README">Rust 六边形架构</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 1 域">[译] Rust 六边形架构/Rust 六边形架构 1 域</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 2 内存存储库">[译] Rust 六边形架构/Rust 六边形架构 2 内存存储库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 3 HTTP API">[译] Rust 六边形架构/Rust 六边形架构 3 HTTP API</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 4 重构">[译] Rust 六边形架构/Rust 六边形架构 4 重构</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 5 其他用例">[译] Rust 六边形架构/Rust 六边形架构 5 其他用例</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 6 CLI">[译] Rust 六边形架构/Rust 六边形架构 6 CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/03/[译] Rust 六边形架构/Rust 六边形架构 7 长期存储库">[译] Rust 六边形架构/Rust 六边形架构 7 长期存储库</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2022/04/01/[译] search_engine">查询引擎：推送与拉取</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">分布式系统</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-11-10T10:40:08.000Z" itemprop="datePublished">2022年11月10日</time> · <!-- -->阅读需 13 分钟</div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="优势">优势<a class="hash-link" href="#优势" title="标题的直接链接">​</a></h2><ul><li><p>通过并行计算增加容量 (parallelism)</p></li><li><p>通过复制容忍故障 (fault tolerance)</p></li><li><p>匹配物理设备的分布 (physical)</p></li><li><p>通过隔离来实现安全 (security / isolated)</p><ul><li>将安全的和不安全的计算放在不同机器上运行</li><li>系统间通过网络进行交互</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="挑战">挑战<a class="hash-link" href="#挑战" title="标题的直接链接">​</a></h2><ul><li><p>分布式系统有许多部分组成，这些部分是同时运行的，会遇到各种并发编程和复杂交互带来的问题。因此需要某些机制在时间上进行控制（比如超时机制，熔断机制）。</p></li><li><p>多台计算机加网络会使故障原因也更加复杂</p></li><li><p>性能，n 台计算机并不能达到 n 倍的性能</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="主题">主题<a class="hash-link" href="#主题" title="标题的直接链接">​</a></h2><ol><li><p>一致性</p><p>通用的基础设施需要有明确的行为。例如，&quot;Get(k) 获取最近一次 Put(k,v) 的值&quot;。</p><p>实现良好的行为是很难的！ &quot;复制&quot; 的服务器很难保持一致。</p></li><li><p>性能</p><p>目标：可扩展的吞吐量</p><p>Nx 个服务器，通过并行的 CPU、磁盘、网络实现 Nx 个总吞吐量。随着 N 的增长，扩展会变得更加困难，负载不平衡。有些事情不会随着 N 的增加而加快，例如初始化、交互。</p></li><li><p>权衡</p><p>容错性、一致性和性能是敌人。实现容错性和一致性需要通信</p><ul><li><p>发送数据到备份</p></li><li><p>检查数据是否是最新的。</p></li><li><p>通信通常很慢，而且不可扩展</p></li><li><p>许多设计只提供弱的一致性，以获得速度。</p><ul><li>例如，Get() 并不*产生最新的 Put()! 对于应用程序的程序员来说，这是很痛苦的，但可能是一个很好的权衡。</li></ul></li></ul><p>我们会在一致性/性能中看到许多设计点。</p></li><li><p>实现</p><p>RPC、线程、并发控制。</p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="lab">Lab<a class="hash-link" href="#lab" title="标题的直接链接">​</a></h2><ul><li><p>Map-Reduce</p></li><li><p>Raft 解决容错性</p></li><li><p>使用 Raft 构建 K/V server，它可以被复制</p></li><li><p>Sharded K/V server 将有可复制能力的主备 K/V server 克隆到多个组中，并将之前的数据分割存储到这些组中，提高运行速度（每个组只存储自己对应的数据，组合起来就是一整份数据）。同时还要实现在不同的服务期间移动数据，保证不会丢失（数据分片到各个组中，各组的服务器内也会有主从复制）。</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="map-reduce">Map-Reduce<a class="hash-link" href="#map-reduce" title="标题的直接链接">​</a></h2><p>以一个 word-count 为例，如果集群要对上万的文件进行计算，GFS 会先寻找到文件的所在位置，然后直接在本机的 map-reduce 程序中运行，从而节约了大量的网络传输。</p><blockquote><p>将按行存储转换为按列存储的过程，在论文中成为 shuffle</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a class="hash-link" href="#概述" title="标题的直接链接">​</a></h3><p>背景：在多 TB 级数据集上进行多小时的计算，例如，建立搜索索引，或排序，或分析网络的结构，只有在有 1000 台计算机的情况下才实用。</p><p>但是应用不是由分布式系统专家编写的，它的总体目标是让非专业的程序员也能轻松使用，对于程序员来说，他只需要定义 Map 和 Reduce 函数 (通常是相当简单的同步代码). MR 管理并隐藏了分布式的所有细节！</p><p>一个 MapReduce 作业的抽象视图</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">输入 1 -&gt; Map -&gt; a,1 b,1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">输入 2 -&gt; Map -&gt; b,1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">输入 3 -&gt; Map -&gt; a,1 c,1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| | |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| | -&gt; Reduce -&gt; c,1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -----&gt; Reduce -&gt; b,2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---------&gt; Reduce -&gt; a,2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>1) 输入文件（已经）被分成 M 个文件</li><li>2) MR 对每个输入文件调用 Map()，产生一组 k2, v2 的 &quot;中间&quot; 数据，每个 Map() 调用都是一个 &quot;任务&quot;</li><li>3) 当地图被 Reduce 时。MR 会收集给定 k2 的所有中间 v2。并将每个键和值传递给一个 Reduce 调用</li><li>4) 最终输出是来自 Reduce() 的&lt;k2,v3&gt;对的集合。</li></ul><p>以 wordcount 为例：</p><ul><li>Map(k, v) 将 v 分割成单词</li><li>对于每个词 w, emit(w, &quot;1&quot;)</li><li>Reduce(k, v_set)</li><li>emit(len(v_set))</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mapreduce-系统的优缺点">MapReduce 系统的优缺点<a class="hash-link" href="#mapreduce-系统的优缺点" title="标题的直接链接">​</a></h3><ol><li><p>MapReduce 的扩展性很好。</p><p>N 个 worker 计算机（可能）让你获得 Nx 的吞吐量。Maps() 和 Reduce() 可以并行运行，因为它们不相互影响。因此，更多的计算机可以带来更多的吞吐量！</p></li><li><p>MapReduce 隐藏了很多细节。</p><ul><li>发送应用代码到服务器</li><li>跟踪哪些任务已经完成</li><li>将中间数据从 Maps &quot;洗&quot; 到 Reduce 中去</li><li>平衡服务器上的负载</li><li>从故障中恢复。</li></ul></li><li><p>MapReduce 限制了应用程序可以做的事。</p><ul><li>没有互动或状态 (除了通过中间输出)</li><li>没有迭代</li><li>没有实时或流式处理</li></ul></li><li><p>MapReduce 输入和输出都存储在 GFS 集群文件系统上</p><ul><li>MR 需要巨大的并行输入和输出的吞吐量。</li><li>GFS 将文件分割到许多服务器上，以 64MB 为一个块。<ul><li>Map 并行读取</li><li>Reduce 并行写入</li></ul></li><li>GFS 还将每个文件复制到 2 或 3 个服务器上</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mr-的工作细节">MR 的工作细节。<a class="hash-link" href="#mr-的工作细节" title="标题的直接链接">​</a></h3><ol><li><p>MapReduce 需要一个协调器，将任务分配给 worker 并纪录进度。</p><p>协调器将 Map 任务分配给 worker，直到所有的 Map 完成。</p><ul><li>Map 将输出（或者说中间数据）写到本地磁盘上</li><li>Map 通过哈希将输出分割到每个 Reduce 任务的一个文件中。</li></ul><p>在所有 Map 完成后，协调器将 Reduce 任务分配给 worker</p><ul><li>每个 Reduce 任务从（所有）Map worker 那里获取其中间输出。</li><li>每个 Reduce 任务在 GFS 上写入一个单独的输出文件</li></ul></li><li><p>什么可能会限制性能？</p><p>CPU、内存、磁盘、网络？在 2004 年，论文作者受到了网络容量的限制。</p><p>MR 在网络上发送什么？</p><ul><li>Map 从 GFS 读取输入。</li><li>Reduces 读取 Map 的中间输出。通常和输入一样大，例如用于排序。</li><li>Reduces 写输出文件到 GFS。</li></ul><p>在 MR 的 shuffle 过程中，一半的流量要经过根交换机。</p><p>论文的根交换机速度为 100 ~ 200 Gb/s，总共有 1800 台机器，所以每台机器可以分得 55 Gb/s。相比于磁盘或 RAM 的速度小得多。</p></li><li><p>MR 如何尽量减少网络的使用？</p><ul><li><p>协调器试图在存储其输入的 GFS 服务器上原地运行每个 Map 任务。所有的计算机都会同时运行 GFS 和 MR worker, 所以 Map 的输入都会通过 GFS 在本地磁盘读取，而不是网络。</p></li><li><p>中间数据被分割为许多文件，每个文件都存储了许多 key. 文件数量比 key 要少得多，大文件传输的效率要更高</p></li></ul></li><li><p>MR 如何处理负载均衡？</p><p>如果 N-1 个服务器必须等待 1 个慢速服务器完成，则是浪费和缓慢的。但有些任务可能确实比其他任务花的时间更长。</p><p>解决方法：比 worker 数量多得多的任务</p><ul><li>协调器将新的任务分配给完成先前任务的 worker。</li><li>因此，没有一个任务大到可以支配完成时间（希望如此）。</li><li>因此，快的服务器会比慢的服务器做更多的任务，完成的时间也差不多。</li></ul></li><li><p>MR 的容错性如何？</p><p>如果一个 worker 在 MP 任务中崩溃了怎么办？
MR 会对程序员隐藏故障。</p><p>MR 不必从头开始重新运行整个工作，它只重新运行失败的 Map 和 Reduce。假设 MR 将一个 Map 运行了两次，一个 Reduce 看到了第一次运行的输出。另一个 Reduce 看到了第二次运行的输出？</p><p>正确性要求重新执行时产生完全相同的输出。所以 Map 和 Reduce 必须是纯确定性的函数。它们只允许看它们的参数/输入。没有状态，没有文件 I/O，没有交互，没有外部通信。</p><p>如果你想允许 non-functional 的 Map 或 Reduce 呢？worker 失败将重新执行整个工作。或者是回滚到某个全局检查点。</p></li><li><p>崩溃恢复的细节</p><ul><li><p>一个 Map worker 崩溃了。</p><ul><li>协调器注意到 worker 不再响应 ping</li><li>协调器知道哪些 Map 任务在该 worker 上运行<ul><li>这些任务的中间输出现在已经丢失，必须重新运行</li><li>协调器通知其他 worker 运行这些任务</li></ul></li><li>如果所有的 Reduce 任务都获取了中间数据，可以不重新运行。</li></ul></li><li><p>一个 Reduce worker 崩溃了。</p><ul><li>完成的任务是好的 -- 已经存储在 GFS 中，并且保存有副本。</li><li>协调器在其他 worker 上重新启动未完成的任务。</li></ul></li></ul></li><li><p>其他故障/问题。</p><ul><li><p>如果协调者给两个 worker 分配了相同的 Map 任务怎么办？</p><p>  = 也许协调器错误地认为一个 worker 死了。它将只告诉 Reduce worer 其中一个。</p></li><li><p>如果协调者给了两个 worker 同样的 Reduce() 任务怎么办？</p><ul><li>他们都会试图在 GFS 上写下同一个输出文件！</li><li>GFS 的原子重命名可以防止混合；一个完整的文件将是可见的。</li></ul></li><li><p>如果一个 worker 非常慢 --&quot;散兵游勇&quot;，怎么办？</p><ul><li>也许是硬件它弱。</li><li>协调器启动最后几个任务的第二个副本。</li></ul></li><li><p>如果一个 worker 由于硬件或软件损坏而计算出不正确的输出，怎么办？</p><ul><li>太糟糕了！MR 假设 &quot;故障停止&quot; 的 CPU 和软件。</li></ul></li><li><p>如果协调器崩溃了怎么办？</p></li></ul></li><li><p>目前的状况？</p><ul><li>影响力巨大（Hadoop, Spark, &amp;c）。</li><li>可能谷歌已经不使用了。<ul><li>被Flume/FlumeJava取代（见Chambers等人的论文）。</li><li>GFS 被 Colossus（没有好的描述）和 BigTable 取代。</li></ul></li></ul></li><li><p>结论</p><p>MapReduce 使大集群计算流行起来。</p><ul><li>不是最有效或最灵活的。</li></ul><ul><li>扩展性好。</li><li>易于编程 -- 失败和数据移动被隐藏。</li></ul><p>这些在实践中是很好的权衡。现在已经有了一些更高级的继承者。</p></li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="博文分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/site_update_log"><div class="pagination-nav__sublabel">较新一篇</div><div class="pagination-nav__label">网站更新日志</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/draft/[译] pkg_mng"><div class="pagination-nav__sublabel">较旧一篇</div><div class="pagination-nav__label">Let&#x27;s Dev: A Package Manager</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#优势" class="table-of-contents__link toc-highlight">优势</a></li><li><a href="#挑战" class="table-of-contents__link toc-highlight">挑战</a></li><li><a href="#主题" class="table-of-contents__link toc-highlight">主题</a></li><li><a href="#lab" class="table-of-contents__link toc-highlight">Lab</a></li><li><a href="#map-reduce" class="table-of-contents__link toc-highlight">Map-Reduce</a><ul><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#mapreduce-系统的优缺点" class="table-of-contents__link toc-highlight">MapReduce 系统的优缺点</a></li><li><a href="#mr-的工作细节" class="table-of-contents__link toc-highlight">MR 的工作细节。</a></li></ul></li></ul></div></div></div></div></div></div>
<script src="/assets/js/runtime~main.dd3dbc08.js"></script>
<script src="/assets/js/main.916d2c7b.js"></script>
</body>
</html>