<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | Trdthg&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="logo.png">
    <meta name="description" content="我的个人网站">
    
    <link rel="preload" href="/assets/css/0.styles.cd4198cc.css" as="style"><link rel="preload" href="/assets/js/app.2c224476.js" as="script"><link rel="preload" href="/assets/js/2.8e748a32.js" as="script"><link rel="preload" href="/assets/js/24.087acdc6.js" as="script"><link rel="prefetch" href="/assets/js/10.da4c0d66.js"><link rel="prefetch" href="/assets/js/11.151c900c.js"><link rel="prefetch" href="/assets/js/12.f749247f.js"><link rel="prefetch" href="/assets/js/13.055a50a4.js"><link rel="prefetch" href="/assets/js/14.4b560188.js"><link rel="prefetch" href="/assets/js/15.3f51f422.js"><link rel="prefetch" href="/assets/js/16.df5ead6d.js"><link rel="prefetch" href="/assets/js/17.56201c0f.js"><link rel="prefetch" href="/assets/js/18.986a6399.js"><link rel="prefetch" href="/assets/js/19.7a4189b1.js"><link rel="prefetch" href="/assets/js/20.2ec18c91.js"><link rel="prefetch" href="/assets/js/21.f1cfc916.js"><link rel="prefetch" href="/assets/js/22.5b790db6.js"><link rel="prefetch" href="/assets/js/23.dc2915c6.js"><link rel="prefetch" href="/assets/js/25.35dd058d.js"><link rel="prefetch" href="/assets/js/26.6fb066e5.js"><link rel="prefetch" href="/assets/js/27.28561eb7.js"><link rel="prefetch" href="/assets/js/28.4173ce23.js"><link rel="prefetch" href="/assets/js/29.e09d92de.js"><link rel="prefetch" href="/assets/js/3.3ec313a7.js"><link rel="prefetch" href="/assets/js/30.02d80a0c.js"><link rel="prefetch" href="/assets/js/31.4c05aedb.js"><link rel="prefetch" href="/assets/js/32.21d714c9.js"><link rel="prefetch" href="/assets/js/33.123fca7a.js"><link rel="prefetch" href="/assets/js/34.deaa6889.js"><link rel="prefetch" href="/assets/js/35.7fb7cee9.js"><link rel="prefetch" href="/assets/js/36.564faecb.js"><link rel="prefetch" href="/assets/js/4.29554731.js"><link rel="prefetch" href="/assets/js/5.617dcac1.js"><link rel="prefetch" href="/assets/js/6.7fd21c66.js"><link rel="prefetch" href="/assets/js/7.9a186dae.js"><link rel="prefetch" href="/assets/js/8.e550dfbf.js"><link rel="prefetch" href="/assets/js/9.ca89ae3f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd4198cc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Trdthg's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/java/java.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/js/vue.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/python/python.html" class="nav-link">
  Python
</a></div><div class="nav-item"><a href="/rust/wasm.html" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/magic/haskell.html" class="nav-link">
  魔法
</a></div><div class="nav-item"><a href="/ioclub/oauth2.html" class="nav-link">
  IO Club
</a></div><div class="nav-item"><a href="/other/other.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/java/java.html" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/js/vue.html" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/python/python.html" class="nav-link">
  Python
</a></div><div class="nav-item"><a href="/rust/wasm.html" class="nav-link">
  Rust
</a></div><div class="nav-item"><a href="/magic/haskell.html" class="nav-link">
  魔法
</a></div><div class="nav-item"><a href="/ioclub/oauth2.html" class="nav-link">
  IO Club
</a></div><div class="nav-item"><a href="/other/other.html" class="nav-link">
  其他
</a></div><div class="nav-item"><a href="https://github.com/trdthg" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/magic/haskell.html" class="sidebar-link">Haskell 学习</a></li><li><a href="/magic/fd.html" class="sidebar-link">文件系统</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="docker"><a href="#docker" class="header-anchor">#</a> Docker</h1> <h2 id="_1-镜像"><a href="#_1-镜像" class="header-anchor">#</a> 1 镜像</h2> <h3 id="_1-1-获取镜像"><a href="#_1-1-获取镜像" class="header-anchor">#</a> 1.1 获取镜像</h3> <p><code>docker pull</code></p> <p>没必要， 直接 docker run 就行了</p> <h3 id="_1-2-列出镜像"><a href="#_1-2-列出镜像" class="header-anchor">#</a> 1.2 列出镜像</h3> <ol><li><p>列出所有： <code>docker image list</code></p></li> <li><p>列出所有虚悬镜像： <code>docker image list -f dangling=true</code></p> <p>这个镜像既没有仓库名，也没有标签，均为 <code>&lt;none&gt;</code></p></li></ol> <h3 id="_1-3-删除镜像"><a href="#_1-3-删除镜像" class="header-anchor">#</a> 1.3 删除镜像</h3> <ol><li><p>删除： <code>docker image rm xxx</code></p> <p>xxx 可以是 镜像短 ID、镜像长 ID、镜像名、或者镜像摘要</p></li> <li><p>删除所有虚悬镜像： <code>docker image prune</code></p></li> <li><p>删除所有仓库名为redis的镜像：<code>docker image rm $(docker image ls -q redis)</code></p></li></ol> <h2 id="_2-容器"><a href="#_2-容器" class="header-anchor">#</a> 2 容器</h2> <h3 id="_2-0-列出容器"><a href="#_2-0-列出容器" class="header-anchor">#</a> 2.0 列出容器</h3> <p><code>docker container ls -a</code></p> <p><code>docker ps -a</code></p> <h3 id="_2-1-启动容器"><a href="#_2-1-启动容器" class="header-anchor">#</a> 2.1 启动容器</h3> <p>新建容器： <code>docker run -d -it ubuntu:18.04 /bin/bash</code></p> <h3 id="_2-2-重启容器"><a href="#_2-2-重启容器" class="header-anchor">#</a> 2.2 重启容器</h3> <p><code>docker container start</code></p> <h3 id="_2-3-终止容器"><a href="#_2-3-终止容器" class="header-anchor">#</a> 2.3 终止容器</h3> <p><code>docker container stop</code></p> <p><code>docker container restart</code></p> <h3 id="_2-4-进入容器"><a href="#_2-4-进入容器" class="header-anchor">#</a> 2.4 进入容器</h3> <p><code>docker exec -it ubuntu:18.04 /bin/bash</code></p> <h3 id="_2-5-导入导出"><a href="#_2-5-导入导出" class="header-anchor">#</a> 2.5 导入导出</h3> <ol><li><p>导出：<code>docker export 7691a814370e &gt; ubuntu.tar</code></p></li> <li><p>导入：</p> <ul><li>从文件：<code>cat ubuntu.tar | docker import - test/ubuntu:v1.0</code></li> <li>从路径：<code>docker import http://example.com/exampleimage.tgz example/imagerepo</code></li></ul></li></ol> <h3 id="_2-6-删除容器"><a href="#_2-6-删除容器" class="header-anchor">#</a> 2.6 删除容器</h3> <p>删除已经关闭的一个容器： <code>docker container rm</code></p> <p>删除所有已经关闭的容器：<code>docker container prune</code></p> <h2 id="_3-dockerfile"><a href="#_3-dockerfile" class="header-anchor">#</a> 3 Dockerfile</h2> <p>这里会将一个Dockerfile的构建过程</p> <h3 id="_3-0-格式"><a href="#_3-0-格式" class="header-anchor">#</a> 3.0 格式</h3> <ol><li><p>指定基础镜像</p> <p>定制一个镜像，需要以一个镜像为基础</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> alpine:latest</span>
</code></pre></div></li> <li><p>RUN 执行命令
格式：<code>RUN &lt;命令&gt;</code>，就像直接在命令行中输入的命令一样。刚才写的 Dockerfile 中的 <code>RUN</code> 指令就是这种格式。</p></li></ol> <h2 id="_4-实践"><a href="#_4-实践" class="header-anchor">#</a> 4 实践</h2> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> alpine:latest</span>

<span class="token instruction"><span class="token keyword">COPY</span> ./cargo-config /cargo-config</span>

<span class="token instruction"><span class="token keyword">RUN</span> mkdir -p ~/.cargo &amp;&amp; mv /cargo-config ~/.cargo/config <span class="token operator">\</span>
<span class="token operator">\</span>
        &amp;&amp; sed -i <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g'</span> /etc/apk/repositories <span class="token operator">\</span>
        &amp;&amp; apk add --no-cache <span class="token operator">\</span>
        redis <span class="token operator">\</span>
        openssh <span class="token operator">\</span>
        sudo <span class="token operator">\</span>
        libgcc <span class="token operator">\</span>
<span class="token operator">\</span>
        clang-libs <span class="token operator">\</span>
        git <span class="token operator">\</span>
        bash <span class="token operator">\</span>
        python3 <span class="token operator">\</span>
        py3-setuptools <span class="token operator">\</span>
        py3-pip <span class="token operator">\</span>
        unzip <span class="token operator">\</span>
        wget <span class="token operator">\</span>
        alpine-sdk <span class="token operator">\</span>
        cmake <span class="token operator">\</span>
        cargo <span class="token operator">\</span>
<span class="token operator">\</span>
        &amp;&amp; mkdir -p /opt/build /opt/redis-modules <span class="token operator">\</span>
<span class="token operator">\</span>
        &amp;&amp; cd /opt/build <span class="token operator">\</span>
        &amp;&amp; git clone https://github.com/RedisJSON/RedisJSON <span class="token operator">\</span>
        &amp;&amp; cd RedisJSON <span class="token operator">\</span>
        &amp;&amp; git submodule update --init --recursive <span class="token operator">\</span>
        &amp;&amp; cd .. <span class="token operator">\</span>
        &amp;&amp; git clone https://github.com/RediSearch/RediSearch <span class="token operator">\</span>
<span class="token operator">\</span>
        &amp;&amp; cd /opt/build/RedisJSON <span class="token operator">\</span>
        &amp;&amp; make build shell=/bin/bash <span class="token operator">\</span>
        &amp;&amp; cp target/release/librejson.so /opt/redis-modules <span class="token operator">\</span>
<span class="token operator">\</span>
        &amp;&amp; cd /opt/build/RediSearch <span class="token operator">\</span>
        &amp;&amp; cmake . -DCMAKE_INSTALL_PREFIX=<span class="token string">&quot;/opt/redis-modules&quot;</span> -Bbuild <span class="token operator">\</span>
        &amp;&amp; cmake --build build <span class="token operator">\</span>
        &amp;&amp; cp build/redisearch.so /opt/redis-modules <span class="token operator">\</span>
<span class="token operator">\</span>
        &amp;&amp; rm -rf /opt/build <span class="token operator">\</span>
        &amp;&amp; rm -rf ~/.cargo <span class="token operator">\</span>
        &amp;&amp; strip /opt/redis-modules/*.so <span class="token operator">\</span>
        &amp;&amp; apk del --purge alpine-sdk cmake cargo python3 py3-setuptools py3-pip unzip wget bash git clang-libs <span class="token operator">\</span>
        &amp;&amp; adduser -D -s /bin/ash admin</span>

<span class="token instruction"><span class="token keyword">USER</span> admin</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> [<span class="token string">&quot;/home/admin&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /home/admin</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 6379</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;redis-server&quot;</span>, <span class="token string">&quot;--loadmodule&quot;</span>, <span class="token string">&quot;/opt/redis-modules/librejson.so&quot;</span>, <span class="token string">&quot;--loadmodule&quot;</span>, <span class="token string">&quot;/opt/redis-modules/redisearch.so&quot;</span>]</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/4/2021, 11:29:48 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2c224476.js" defer></script><script src="/assets/js/2.8e748a32.js" defer></script><script src="/assets/js/24.087acdc6.js" defer></script>
  </body>
</html>
